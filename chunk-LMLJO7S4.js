import{a as Pi}from"./chunk-PZOY7T5J.js";import{a as Ht}from"./chunk-EKTLF5UE.js";import{a as Si,b as Ti,c as Ai,d as Fi,e as xi,f as ki}from"./chunk-NMS32VKY.js";import{a as Ct,b as yi}from"./chunk-A4D4NCYO.js";import{a as Ui}from"./chunk-FKH2EOOQ.js";import{a as vi,b as hi,c as Ci,d as ht,e as bi,f as _i,g as Ei}from"./chunk-Z6NN5YBC.js";import{a as Bi,b as Ri,c as Mi}from"./chunk-B5TQJMVQ.js";import{a as Vt}from"./chunk-C2BSI5XP.js";import{a as wi,b as Ii}from"./chunk-JUZAHXMJ.js";import{a as Di,b as _e}from"./chunk-DQJB75ZH.js";import{a as $t,b as Yt,d as ze,e as We}from"./chunk-2K3GGOJ3.js";import{b as Qt,c as Kt}from"./chunk-LCGQWH44.js";import{a as gi,b as fi,c as le,d as K}from"./chunk-57X3MC42.js";import{a as li,b as ae,c as ci,d as mi,e as be,f as se,g as ue,j as di,r as pi}from"./chunk-5CVYVRTT.js";import{a as Oi}from"./chunk-5UCQUYSM.js";import{D as ai,E as si,F as ui,a as Jt,b as Xt,c as ei,d as Ke,e as ti,f as ii,g as oi,k as vt,l as Ye,m as He,n as Ze,p as Je,s as Xe,w as ni,x as ri}from"./chunk-XGZHVJI3.js";import{a as ne}from"./chunk-XRX4MRYS.js";import{a as Qe}from"./chunk-M5RCGXCJ.js";import{c as Nt}from"./chunk-BQLV7WLJ.js";import{$ as F,$a as C,A as $,Aa as u,Bb as fe,D as St,Db as r,Eb as V,Fb as te,Fc as Pt,G as Tt,Ga as h,Gb as Ie,H,Ha as dt,Hb as Ue,I as At,Ib as Be,Ic as Pe,Ja as M,Jb as Re,Ka as X,L as Ae,Na as xe,Nc as gt,O as _,Ob as It,Oc as Ne,P as lt,Q as A,Qb as Ut,Qc as f,R as Ft,Rc as y,S as xt,Tc as S,Ua as p,Wa as g,Wb as ve,Wc as $e,Xb as Bt,Xc as Ve,Y as oe,Ya as ee,Yb as Me,Yc as Ge,Z,Za as z,Zc as je,_ as de,_a as W,_c as Ce,a as ut,ab as a,ad as I,b as U,ba as kt,bb as s,bd as Gt,cb as v,cc as Rt,cd as jt,db as x,dc as Mt,ea as D,eb as E,ec as he,ed as ft,fa as w,fb as ke,gd as Lt,ha as Dt,hd as Le,i as Et,k as P,l as N,la as Fe,lb as Q,ma as J,n as ye,nd as qt,ob as b,p as R,pb as wt,pd as zt,q as Se,qa as ct,qb as d,qd as Wt,r as Te,rd as qe,s as yt,sd as re,ta as pe,tc as Oe,ua as ge,uc as Ot,xb as De,xc as pt,ya as mt,yb as we}from"./chunk-57KELPP2.js";import{W as Zt}from"./chunk-LRFDAHTL.js";var Ee=class{constructor(i){return i}},Ni="messaging",bt=class{constructor(){return ei(Ni)}};var _t=new de("angularfire2.messaging-instances");function Qi(o,i,e){if(pt(e))return null;let t=Xt(Ni,o,i);return t&&new Ee(t)}function Ki(o){return(i,e,t)=>{if(pt(t))return null;let n=i.runOutsideAngular(()=>o(e));return new Ee(n)}}var Yi={provide:bt,deps:[[new ct,_t]]},Hi={provide:Ee,useFactory:Qi,deps:[[new ct,_t],ii,ge]};function $i(o,...i){return Zt("angularfire",Jt.full,"fcm"),kt([Hi,Yi,{provide:_t,useFactory:Ki(o),multi:!0,deps:[Fe,Dt,ge,Ke,oi,...i]}])}var Vi=ti(yi,!0);var et=class o extends ze{constructor(){super()}ngOnInit(){f("DeleteConfirmComponent.OnInit()")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["gitfire-delete-confirm"]],features:[xe],decls:10,vars:0,consts:[[1,"m-3"]],template:function(e,t){e&1&&(x(0,"div",0)(1,"div"),r(2,"\u672C\u5F53\u306B\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F"),E(),x(3,"ul")(4,"li"),r(5,"Google / Twitter \u306A\u3069\u306E\u30A2\u30AB\u30A6\u30F3\u30C8\u60C5\u5831\u306F\u524A\u9664\u3055\u308C\u307E\u305B\u3093\u3002"),E(),x(6,"li"),r(7,"\u516C\u958B\u3055\u308C\u305F\u6295\u7A3F\u306F\u524A\u9664\u3055\u308C\u307E\u305B\u3093\u3002"),E(),x(8,"li"),r(9,"\u53D6\u308A\u6D88\u3057\u306F\u3067\u304D\u307E\u305B\u3093\u3002"),E()()())},encapsulation:2})};var Zi=["specialAuthContainer"];function Ji(o,i){if(o&1){let e=Q();x(0,"a",7),wt("click",function(n){let l=D(e).$implicit,c=d();return w(c.onClickReauthProvider(n,l))}),r(1),E()}if(o&2){let e=i.$implicit;u(),V(e.providerId)}}var it=class o extends ze{constructor(e,t){super();this.loader=e;this.toastr=t}static SUPPORTED_PROVIDERS={};static SupportedOauthProviderIds=[];destroy$=new U;get providers(){return this.currentUser().providerData}currentUser=Mt.required();reauthed=Rt();specialAuthContainer=he("specialAuthContainer",{read:dt});static{let e=o.SUPPORTED_PROVIDERS;e[vt.PROVIDER_ID]=vt,e[Ze.PROVIDER_ID]=Ze,e[Ye.PROVIDER_ID]=Ye,e[He.PROVIDER_ID]=He;let t=o.SupportedOauthProviderIds;t.push(Ze.PROVIDER_ID),t.push(Ye.PROVIDER_ID),t.push(He.PROVIDER_ID)}ngOnDestroy(){this.destroy$.next()}isOAuthProvider(e){return!!o.SupportedOauthProviderIds.includes(e)}async onClickReauthProvider(e,t){f("onClickReauthProvider()",e,t),e.preventDefault();let n=o.SUPPORTED_PROVIDERS[t.providerId],l=new n,c=this.specialAuthContainer(),Y=this.currentUser();if(c.clear(),this.isOAuthProvider(t.providerId)){try{await ni(Y,l)}catch(L){S("Error while reauth",L);let B=L instanceof Error?L.message:"Unknown error";this.toastr.error(`\u518D\u8A8D\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${B} )`);return}f("Reanthenticated via OAuth provider")}else{let{GitfireLoginModule:L}=await import("./chunk-RYKY42XJ.js"),{InputAuthComponent:B}=await import("./chunk-7I63XUTT.js"),m=this.loader.appendComponentRef(c,L,B);try{m.setInput("isReauth",!0),m.setInput("reauthUser",Y),m.setInput("showFederations",!1);let q=m.instance.reauthed;try{q.subscribe(()=>{})}catch(ce){S("Error while reauth done",ce);let T=ce instanceof Error?ce.message:"Unknown error";this.toastr.error(`\u518D\u8A8D\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${T} )`);return}}finally{m.destroy()}f("Reanthenticated via password")}this.reauthed.emit(),super.close()}static \u0275fac=function(t){return new(t||o)(h(Ht),h(ne))};static \u0275cmp=M({type:o,selectors:[["gitfire-reauth-box"]],viewQuery:function(t,n){t&1&&De(n.specialAuthContainer,Zi,5,dt),t&2&&we()},inputs:{currentUser:[1,"currentUser"]},outputs:{reauthed:"reauthed"},features:[xe],decls:11,vars:0,consts:[["specialAuthContainer",""],[1,"m-3"],[1,"btn-group"],["type","button","data-bs-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","btn-primary","dropdown-toggle"],[1,"visually-hidden"],[1,"dropdown-menu"],["href","#",1,"dropdown-item"],["href","#",1,"dropdown-item",3,"click"]],template:function(t,n){t&1&&(x(0,"div",1)(1,"div",2)(2,"button",3)(3,"span",4),r(4,"Toggle Dropdown"),E(),r(5,"\u8A8D\u8A3C\u65B9\u6CD5"),E(),x(6,"div",5),z(7,Ji,2,1,"a",6,ee),E()(),ke(9,"div",null,0),E()),t&2&&(u(7),W(n.providers))},encapsulation:2})};function G(o,i){if(o.value!==i){if(o.dirty){S(`Upstream value has been changed to ${o.value} -> ${i} but sillengly ignore the value.`);return}o.setErrors(null),o.setValue(i)}}function k(o){o.markAsPristine(),o.markAsUntouched()}var Xi=new de("angularfire2.messaging.vapid-key"),eo=new de("angularfire2.messaging.service-worker-registeration"),ji=(()=>{class o{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(e,t,n,l,c,Y,L){let B=L,m=ye(void 0).pipe(N(c.outsideAngular),P(c.insideAngular),_(Ct),_(T=>T?import("./chunk-QNUO3SSD.js"):Et),R(()=>Fi(e,l,t)),_(T=>xi(`${T.name}.messaging`,"AngularFireMessaging",T.name,()=>ye(T.messaging()),[])),Ae({bufferSize:1,refCount:!1}));this.requestPermission=m.pipe(N(c.outsideAngular),P(c.insideAngular),_(()=>Notification.requestPermission())),this.getToken=m.pipe(N(c.outsideAngular),P(c.insideAngular),_(async T=>{if(Notification.permission==="granted"){let me=B?await B:null;return await T.getToken({vapidKey:Y,serviceWorkerRegistration:me})}else return null}));let q=new ut(T=>{navigator.permissions.query({name:"notifications"}).then(me=>{me.onchange=()=>T.next()})}),ce=m.pipe(N(c.outsideAngular),P(c.insideAngular),lt(q),lt(this.getToken));return this.tokenChanges=m.pipe(N(c.outsideAngular),P(c.insideAngular),_(()=>yt(this.getToken,ce))),this.messages=m.pipe(N(c.outsideAngular),P(c.insideAngular),_(T=>new ut(me=>T.onMessage(me)))),this.requestToken=m.pipe(N(c.outsideAngular),P(c.insideAngular),_(()=>this.requestPermission),St(()=>ye(null)),Te(()=>this.tokenChanges)),this.deleteToken=()=>m.pipe(N(c.outsideAngular),P(c.insideAngular),_(T=>T.deleteToken()),Tt(!1)),Si(this,m,l)}static \u0275fac=function(t){return new(t||o)(F(Ti),F(Ai,8),F(ge),F(Fe),F(Ke),F(Xi,8),F(eo,8))};static \u0275prov=oe({token:o,factory:o.\u0275fac,providedIn:"any"})}return o})();var so=(o,i)=>i.id;function uo(o,i){if(o&1){let e=Q();a(0,"button",20),b("click",function(n){D(e);let l=d().$implicit,c=d();return w(c.onClickDeleteDevice(n,l))}),r(1,"\u524A\u9664"),s()}}function lo(o,i){if(o&1){let e=Q();a(0,"div",7)(1,"app-switch",18),ve(2,"date"),b("checkChanged",function(n){let l=D(e).$implicit,c=d();return w(c.onToggleDevice(n,l))}),s(),p(3,uo,2,0,"button",19),s()}if(o&2){let e=i.$implicit,t=d();u(),C("controlLabel",Ut("",e.name||"No Name"," ",e.id===t.registeredDeviceId()?"[\u3053\u306E\u7AEF\u672B]":null," (\u767B\u9332\u65E5: ",Me(2,8,e.createdAt.toDate(),"yyyy-MM-dd"),")"))("formName",It("device-",e.id))("parentForm",t.deviceForm),u(2),g(e.id!==t.registeredDeviceId()?3:-1)}}function co(o,i){if(o&1&&(a(0,"div"),r(1),s()),o&2){let e=i.$implicit,t=i.$index;u(),Ie("",t,": ",e)}}function mo(o,i){if(o&1&&(a(0,"div"),r(1),s()),o&2){let e=i.$implicit,t=i.$index;u(),Ie("",t,": ",e)}}function po(o,i){if(o&1&&(a(0,"div"),r(1),s()),o&2){let e=i.$implicit,t=i.$index;u(),Ie("",t,": ",e)}}function go(o,i){if(o&1&&(a(0,"div"),r(1),ve(2,"json"),s()),o&2){let e=i.$implicit;u(),V(Bt(2,1,e))}}var ot=class o{constructor(i,e,t,n,l,c){this.auth=i;this.dialog=e;this.toastr=t;this.firestore=n;this.funcs=l;this.messaging=c;this.currentUser$=this.auth.clientSideUser$.pipe($(Y=>!!Y))}destroy$=new U;mainForm;userPrivStore$;deviceForm;messagingTypeArray;configArray;currentUser$;registeredDeviceId=J(null);registeredToken;debugObservable={};devices;tokenReceived=new U;tokenReceived$;MessagingDeviceConverter=Di(["createdAt","updatedAt"]);async onToggleDevice(i,e){f("onToggleDevice()");let t=this.getDeviceControl(e),n={deviceId:e.id,off:!t.value};try{await this.funcs.call("toggleSuspendDevice",n),this.toastr.success("\u7AEF\u672B\u306E\u8A2D\u5B9A\u3092\u66F4\u65B0\u3057\u307E\u3057\u305F\u3002")}catch{this.toastr.error("\u7AEF\u672B\u306E\u8A2D\u5B9A\u304C\u66F4\u65B0\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}onClickDeleteDevice(i,e){f("onClickDeleteDevice()"),this.messaging.deleteToken(e.token).pipe(A(this.destroy$)).subscribe({next:async n=>{y(`deleteToken() result ${n}`),this.toastr.success("\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")},error:n=>{S(`Failed to delete token token: ${e.token}`,n),this.toastr.error("\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u65E2\u306B\u5931\u52B9\u3057\u3066\u3044\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002")}});let t={deviceId:e.id};try{this.funcs.call("revokeDevice",t),this.toastr.success("\u30B7\u30B9\u30C6\u30E0\u4E0A\u304B\u3089\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")}catch{this.toastr.error("\u30B7\u30B9\u30C6\u30E0\u4E0A\u306E\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}ngOnInit(){let e=this.currentUser$.pipe(H(1),$(t=>!!t)).pipe(_(t=>{let n=se(this.firestore,"users/v1/protected",t.uid,"fcm").withConverter(this.MessagingDeviceConverter);return mi(n,{idField:"id"})}),Ae(1));e.pipe(A(this.destroy$)).subscribe(t=>{this.devices=t;for(let n in this.deviceForm.controls)this.deviceForm.removeControl(n);for(let n of this.devices)this.addDeviceControl(n);this.triggerTokenRefresh()}),this.mainForm.addControl("messagingOn",new I(!1,[])),this.deviceForm=new Ce({}),this.mainForm.addControl("devices",this.deviceForm),this.mainForm.addControl("messagingSystemCheck",new I(!1,[])),this.mainForm.addControl("messagingTrivialCheck",new I(!1,[])),this.mainForm.addControl("messagingMentionCheck",new I(!1,[])),this.mainForm.addControl("messagingAdminCheck",new I(!1,[])),this.messagingTypeArray=new ft([this.typeSystemControl,this.typeMentionControl,this.typeAdminControl]),this.configArray=new ft([this.typeTrivialControl,this.messagingTypeArray]),this.userPrivStore$.pipe(A(this.destroy$)).subscribe(t=>{y("this.userPrivStore$.subscribe()",t);let n=t.messagingTypes||["mention","admin"];G(this.typeSystemControl,n.includes("system")),G(this.typeMentionControl,n.includes("mention")),G(this.typeAdminControl,n.includes("admin")),G(this.typeTrivialControl,t.isWatchTrivial)}),this.tokenReceived$=this.tokenReceived.pipe($(t=>t!==null),At()),Se(this.tokenReceived$,e).pipe(A(this.destroy$)).subscribe(async([t,n])=>{f("this.messaging.tokenReceived subscribe()",t,n);let l=!!t;if(this.debugObservable.registeredToken=t,this.registeredToken=t,t){let c=this.findDeviceId(t,n);if(!c){this.toastr.error("\u30C7\u30D0\u30A4\u30B9\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002");return}this.registeredDeviceId.set(c)}G(this.messagingOnControl,!!this.registeredDeviceId())}),this.triggerTokenRefresh(),this.debugObservable.messages=[],this.messaging.messages.pipe(A(this.destroy$)).subscribe(t=>{y("message received from messaging",t),this.debugObservable.messages.push(t)}),this.debugObservable.getToken$=this.messaging.getToken,this.debugObservable.getToken=[],this.debugObservable.getToken$.subscribe({next:t=>this.debugObservable.getToken.push(t),complete:()=>y("Complete getToken()")}),this.debugObservable.tokenChanges$=this.messaging.tokenChanges,this.debugObservable.tokenChanges=[],this.debugObservable.tokenChanges$.subscribe({next:t=>this.debugObservable.tokenChanges.push(t),complete:()=>y("Complete tokenChanges()")}),this.debugObservable.tokenReceived=[]}findDeviceId(i,e){for(let t of e)if(t.token===i)return t.id;return null}ngOnDestroy(){this.destroy$.next()}triggerTokenRefresh(){this.messaging.getToken.pipe(H(1),A(this.destroy$)).subscribe({next:i=>this.tokenReceived.next(i),complete:()=>f("Completed getToken")})}get messagingOnControl(){return this.mainForm.get("messagingOn")}getDeviceControl(i){return this.deviceForm.get(`device-${i.id}`)}addDeviceControl(i){let e=new I(!i.isSuspend,[]);this.deviceForm.addControl(`device-${i.id}`,e)}get typeTrivialControl(){return this.mainForm.get("messagingTrivialCheck")}get typeSystemControl(){return this.mainForm.get("messagingSystemCheck")}get typeMentionControl(){return this.mainForm.get("messagingMentionCheck")}get typeAdminControl(){return this.mainForm.get("messagingAdminCheck")}async revokeNotification(){if(!this.registeredDeviceId()){S("Unexpectedly no deviceId is found."),this.toastr.error("\u30C7\u30D0\u30A4\u30B9\u60C5\u5831\u3092\u7121\u52B9\u306B\u3067\u304D\u307E\u305B\u3093\u3002");return}try{let i={deviceId:this.registeredDeviceId()};this.funcs.call("revokeDevice",i),this.toastr.info("\u30B7\u30B9\u30C6\u30E0\u304B\u3089\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002")}catch(i){S("Error while deleting token via Functions",i),this.messagingOnControl.setValue(!0),k(this.messagingOnControl),this.toastr.error("\u30B7\u30B9\u30C6\u30E0\u306E\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002");return}this.messaging.getToken.pipe(Ft(i=>f(`getToken before deleteToken ${i}`)),Te(i=>this.messaging.deleteToken(i)),H(1),A(this.destroy$)).subscribe({next:i=>{y(`Deleted result: ${i} on FCM.`),k(this.messagingOnControl),this.toastr.success("\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002")},error:i=>{S("Error while deleting token on FCM",i),this.toastr.error("\u901A\u77E5\u60C5\u5831\u304C\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}})}async onToggleMessaging(i){if(f("UserSettingsComponent.onToggleMessaging()"),this.messagingOnControl.value){if(!this.registeredDeviceId()&&this.devices&&this.devices.length>=Ne.FCMDeviceMaxCount){this.toastr.error("\u767B\u9332\u3055\u308C\u305F\u30C7\u30D0\u30A4\u30B9\u304C\u591A\u3059\u304E\u307E\u3059\u3002\u524A\u9664\u3057\u3066\u304B\u3089\u3084\u308A\u76F4\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}await this.updateRequestToken()}else{let t=this.dialog.createHtmlBuilder(),n=new $t(`
<div>
\u767B\u9332\u3092\u89E3\u9664\u3059\u308B\u3068\u3059\u3079\u3066\u306E\u901A\u77E5\u306F\u505C\u6B62\u3057\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F
</div>
`);t.setMessage(n).setType(1).setSize(1).setTitle("\u78BA\u8A8D").okButton(async()=>{await this.revokeNotification()}).cancelButton(()=>{this.messagingOnControl.setValue(!0),k(this.messagingOnControl)}).open()}}getMessagingTypes(){let i=[];return this.typeSystemControl.value&&i.push("system"),this.typeMentionControl.value&&i.push("mention"),this.typeAdminControl.value&&i.push("admin"),i}async updateRequestToken(){this.messaging.requestToken.pipe(H(1),A(this.destroy$)).subscribe({next:async i=>{if(this.tokenReceived.next(i),this.debugObservable.tokenReceived.push(i),!i){S("No token returned from requestToken"),this.messagingOnControl.setValue(!1),k(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u60C5\u5831\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002");return}try{f(`Updated token with ${i}`);let e={token:i,deviceId:this.registeredDeviceId()};this.registeredToken=i,this.registeredDeviceId.set(await this.funcs.call("saveDeviceToken",e)),this.toastr.success("\u901A\u77E5\u60C5\u5831\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002"),k(this.messagingOnControl)}catch(e){S("Error while save token to Firestore",e),this.messagingOnControl.setValue(!1),k(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u60C5\u5831\u3092\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}},error:i=>{S("Error while request Token",i),this.messagingOnControl.setValue(!1),k(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u3092\u6709\u52B9\u306B\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u30D6\u30E9\u30A6\u30B6\u306E\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002")}})}async onClickUpdateMessaging(i){f("UserSettingsComponent.onClickUpdateMessaging()");try{let e={messageTypes:this.getMessagingTypes(),token:this.registeredToken,isWatchTrivial:this.typeTrivialControl.value};await this.funcs.call("setNotifications",e),k(this.configArray),this.toastr.success("\u8A2D\u5B9A\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002")}catch(e){S("Failed to save configuration",e),this.toastr.error("\u8A2D\u5B9A\u304C\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}async onClickSubscribeTopic(i){if(!this.debugObservable.topicText){alert("Not set");return}let e={topic:this.debugObservable.topicText,token:this.registeredToken},t=await this.funcs.call("subscribeTopicTest",e);y("subscribeTopicTest ->",t),this.toastr.success(`done subscribe ${t}`)}async onClickUnsubscribeTopic(i){if(!this.debugObservable.topicText){alert("Not set");return}let e={topic:this.debugObservable.topicText,token:this.registeredToken},t=await this.funcs.call("unsubscribeTopicTest",e);y("unsubscribeTopicTest ->",t),this.toastr.success(`done unsubscribe ${t}`)}async onClickPostToTopic(i){if(!this.debugObservable.topicText||!this.debugObservable.topicPostText){alert("Not set");return}let e={topic:this.debugObservable.topicText,title:this.debugObservable.topicPostText},t=await this.funcs.call("postTopicTest",e);y("postTopicTest ->",t),this.toastr.success(`done post ${t}`)}async onClickConditionPostToTopic(i){if(!this.debugObservable.conditionTopicPostText||!this.debugObservable.conditionTopicPostText){alert("Not set");return}let e={topic:this.debugObservable.conditionTopicPostText,title:this.debugObservable.topicPostText},t=await this.funcs.call("postConditionTopicTest",e);y("postConditionTopicTest ->",t),this.toastr.success(`done post ${t}`)}onClickClearMessages(i){this.debugObservable.messages=[]}static \u0275fac=function(e){return new(e||o)(h(K),h(We),h(ne),h(ae),h(le),h(ji))};static \u0275cmp=M({type:o,selectors:[["gitfire-user-notification"]],inputs:{mainForm:"mainForm",userPrivStore$:"userPrivStore$"},decls:74,vars:11,consts:[[1,"m-2"],["title","\u3053\u306E\u6A5F\u80FD\u306F\u30C6\u30B9\u30C8\u4E2D\u306E\u305F\u3081\u5909\u66F4\u3055\u308C\u308B\u3053\u3068\u3084\u3001\u60F3\u5B9A\u5916\u306E\u6319\u52D5\u3092\u3059\u308B\u5834\u5408\u304C\u3042\u308A\u307E\u3059\u3002\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u306E\u901A\u77E5\u3092\u30B3\u30F3\u30C8\u30ED\u30FC\u30EB\u3057\u307E\u3059\u3002\u8A2D\u5B9A\u304C\u3046\u307E\u304F\u3044\u304B\u306A\u3044\u5834\u5408\u306F\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u5F53\u30B5\u30A4\u30C8\u306E\u901A\u77E5 on/off \u3092\u3057\u305F\u308A\u3001\u300E\u7AEF\u672B\u306E\u524A\u9664\u300F\u3092\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002","src","/assets/octicons/question.svg",1,"m-3","octicon-info","help-icon"],[1,"m-2",3,"formGroup"],[1,"row","p-1"],[1,"d-flex","align-content-start","flex-wrap","p-1"],["controlLabel","\u901A\u77E5\u3092\u53D7\u3051\u53D6\u308B","formName","messagingOn","tooltipText","\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u306E\u901A\u77E5\u3092\u30B3\u30F3\u30C8\u30ED\u30FC\u30EB\u3057\u307E\u3059\u3002",1,"p-2",3,"checkChanged","parentForm"],[1,"d-flex","align-content-start","flex-wrap","p-3"],[1,"m-1","input-group"],[1,"row","m-2"],["controlLabel","\u3061\u3087\u3063\u3068\u3057\u305F\u901A\u77E5","formName","messagingTrivialCheck","tooltipText","\u3061\u3087\u3063\u3068\u3057\u305F\u901A\u77E5\u3082\u53D7\u3051\u53D6\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002\u901A\u5E38\u306F\u4E0D\u8981\u3067\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u30B7\u30B9\u30C6\u30E0","formName","messagingSystemCheck","tooltipText","\u30B7\u30B9\u30C6\u30E0\u304B\u3089\u306E\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u3042\u306A\u305F\u3078\u306E\u8A00\u53CA","formName","messagingMentionCheck","tooltipText","\u30B7\u30B9\u30C6\u30E0\u306E\u30E1\u30C3\u30BB\u30FC\u30B8\u30B7\u30B9\u30C6\u30E0\u3067\u3042\u306A\u305F\u306B\u8A00\u53CA\u3055\u308C\u305F\u5834\u5408\u306B\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u7BA1\u7406\u4EBA\u304B\u3089","formName","messagingAdminCheck","tooltipText","\u7BA1\u7406\u4EBA\u304C\u624B\u52D5\u3067\u3042\u306A\u305F\u306B\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u9001\u3063\u305F\u5834\u5408\u306B\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],[1,"btn","btn-primary",3,"click","disabled"],[2,"width","100%","overflow-wrap","break-word"],["type","text",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-warning",3,"click"],["tooltipText","\u767B\u9332\u3055\u308C\u305F Device \u306E\u901A\u77E5\u3092\u4E00\u6642\u7684\u306B\u505C\u6B62\u3057\u307E\u3059\u3002",1,"m-2",3,"checkChanged","parentForm","controlLabel","formName"],["title","\u767B\u9332\u60C5\u5831\u3092\u524A\u9664\u3057\u3066\u3001\u3053\u306E\u7AEF\u672B\u3078\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"btn","btn-warning"],["title","\u767B\u9332\u60C5\u5831\u3092\u524A\u9664\u3057\u3066\u3001\u3053\u306E\u7AEF\u672B\u3078\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"btn","btn-warning",3,"click"]],template:function(e,t){e&1&&(a(0,"h2",0),r(1,"\u901A\u77E5\u8A2D\u5B9A (\u30C6\u30B9\u30C8\u4E2D)"),v(2,"img",1),s(),a(3,"div",2)(4,"div",3)(5,"div",4)(6,"app-switch",5),b("checkChanged",function(l){return t.onToggleMessaging(l)}),s()()(),a(7,"div",0)(8,"h3"),r(9,"\u767B\u9332\u3055\u308C\u305F\u30C7\u30D0\u30A4\u30B9"),s(),a(10,"div",6),z(11,lo,4,11,"div",7,so),s()(),a(13,"div")(14,"div",8)(15,"h3"),r(16,"\u91CD\u8981\u5EA6"),s(),a(17,"div",4),v(18,"app-switch",9),s()(),a(19,"div",8)(20,"h3"),r(21,"\u7A2E\u985E"),s(),a(22,"div",4),v(23,"app-switch",10)(24,"app-switch",11)(25,"app-switch",12),s()(),a(26,"div",8)(27,"button",13),b("click",function(l){return t.onClickUpdateMessaging(l)}),r(28,"\u66F4\u65B0"),s()()()(),a(29,"div",14)(30,"div"),r(31,"Token: "),a(32,"div"),r(33),s()(),a(34,"div"),r(35,"GetToken: "),z(36,co,2,2,"div",null,ee),s(),a(38,"div"),r(39,"TokenChanges: "),z(40,mo,2,2,"div",null,ee),s(),a(42,"div"),r(43,"TokenReceived: "),z(44,po,2,2,"div",null,ee),s(),a(46,"div")(47,"div")(48,"label"),r(49,"Topic: "),a(50,"input",15),Re("ngModelChange",function(l){return Be(t.debugObservable.topicText,l)||(t.debugObservable.topicText=l),l}),s()(),a(51,"button",16),b("click",function(l){return t.onClickSubscribeTopic(l)}),r(52,"subscribe"),s(),a(53,"button",16),b("click",function(l){return t.onClickUnsubscribeTopic(l)}),r(54,"unsubscribe"),s()(),a(55,"div")(56,"label"),r(57,"Post Title: "),a(58,"input",15),Re("ngModelChange",function(l){return Be(t.debugObservable.topicPostText,l)||(t.debugObservable.topicPostText=l),l}),s()(),a(59,"button",16),b("click",function(l){return t.onClickPostToTopic(l)}),r(60,"Post"),s()(),a(61,"div")(62,"label"),r(63,"Condition Topic Post: "),a(64,"input",15),Re("ngModelChange",function(l){return Be(t.debugObservable.conditionTopicPostText,l)||(t.debugObservable.conditionTopicPostText=l),l}),s()(),a(65,"button",16),b("click",function(l){return t.onClickConditionPostToTopic(l)}),r(66,"CondPost"),s()()()(),a(67,"div")(68,"button",17),b("click",function(l){return t.onClickClearMessages(l)}),r(69,"Clear"),s(),a(70,"div"),r(71,"Messages: "),z(72,go,3,3,"div",null,ee),s()()),e&2&&(u(3),C("formGroup",t.mainForm),u(3),C("parentForm",t.mainForm),u(5),W(t.devices),u(7),C("parentForm",t.mainForm),u(5),C("parentForm",t.mainForm),u(),C("parentForm",t.mainForm),u(),C("parentForm",t.mainForm),u(2),C("disabled",t.configArray.invalid||!t.configArray.dirty),u(6),V(t.debugObservable.registeredToken),u(3),W(t.debugObservable.getToken),u(4),W(t.debugObservable.tokenChanges),u(4),W(t.debugObservable.tokenReceived),u(6),Ue("ngModel",t.debugObservable.topicText),u(8),Ue("ngModel",t.debugObservable.topicPostText),u(6),Ue("ngModel",t.debugObservable.conditionTopicPostText),u(8),W(t.debugObservable.messages))},dependencies:[re,$e,Ge,je,Le,qe,Gt,Qt,Oe,Ot],encapsulation:2})};var vo=["protectedSettings"],ho=["imageBox"];function Co(o,i){if(o&1&&v(0,"img",10),o&2){let e=d();C("src",e.photoURL,mt)}}function bo(o,i){o&1&&r(0,"\u753B\u50CF\u304C\u3042\u308A\u307E\u305B\u3093")}function _o(o,i){if(o&1){let e=Q();a(0,"span",36),r(1," -> "),s(),a(2,"label",9),r(3,"\u65B0\u3057\u3044\u753B\u50CF"),s(),v(4,"img",37),a(5,"button",38),b("click",function(n){let l=D(e),c=d(2);return w(c.onClickOkImage(n,l))}),r(6,"\u78BA\u5B9A"),s()}o&2&&(u(4),C("src",i,mt))}function Eo(o,i){o&1&&v(0,"div",18)}function yo(o,i){if(o&1&&(a(0,"div",18),r(1),s()),o&2){let e=d(3);u(),te("\u6B8B\u308A ",e.nicknameResult.changesRemain," \u56DE \u5909\u66F4\u3067\u304D\u307E\u3059\u3002")}}function So(o,i){o&1&&(a(0,"div",39),r(1,"\u3053\u308C\u4EE5\u4E0A\u306F\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3002"),s())}function To(o,i){if(o&1&&(p(0,yo,2,1,"div",18),p(1,So,2,0,"div",39)),o&2){let e=d(2);g(e.nicknameResult.changesRemain>0?0:-1),u(),g(e.nicknameResult.changesRemain===0?1:-1)}}function Ao(o,i){o&1&&(a(0,"div",39),r(1,"\u5165\u529B\u5FC5\u9808\u3067\u3059\u3002"),s())}function Fo(o,i){o&1&&(a(0,"div",39),r(1,"\u9577\u3059\u304E\u307E\u3059\u3002"),s())}function xo(o,i){o&1&&(a(0,"div",39),r(1,"\u77ED\u3059\u304E\u307E\u3059\u3002"),s())}function ko(o,i){if(o&1&&(p(0,Ao,2,0,"div",39),p(1,Fo,2,0,"div",39),p(2,xo,2,0,"div",39)),o&2){let e=d(2);g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.required?0:-1),u(),g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.maxlength?1:-1),u(),g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.minlength?2:-1)}}function Do(o,i){o&1&&v(0,"div",18)}function wo(o,i){o&1&&(a(0,"div",39),r(1,"\u9577\u3059\u304E\u307E\u3059\u3002"),s())}function Io(o,i){if(o&1&&p(0,wo,2,0,"div",39),o&2){let e=d(2);g(e.aboutControl.errors!=null&&e.aboutControl.errors.maxlength?0:-1)}}function Uo(o,i){if(o&1&&v(0,"hr")(1,"gitfire-user-notification",40),o&2){let e=d(2);u(),C("mainForm",e.notificationForm)("userPrivStore$",e.userPrivate$)}}function Bo(o,i){o&1&&v(0,"div",18)}function Ro(o,i){o&1&&(a(0,"div",39),r(1,"E \u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059\u3002"),s())}function Mo(o,i){o&1&&(a(0,"div",39),r(1,"E \u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),s())}function Oo(o,i){if(o&1&&(p(0,Ro,2,0,"div",39),p(1,Mo,2,0,"div",39)),o&2){let e=d(2);g(e.emailControl.errors!=null&&e.emailControl.errors.required?0:-1),u(),g(e.emailControl.errors!=null&&e.emailControl.errors.minlength||e.emailControl.errors!=null&&e.emailControl.errors.maxlength?1:-1)}}function Po(o,i){o&1&&(a(0,"div",18),r(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u5F37\u5EA6\u306F\u5145\u5206\u306B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),s())}function No(o,i){o&1&&(a(0,"div",39),r(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),s())}function $o(o,i){o&1&&(a(0,"div",39),r(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u9577\u3055\u304C\u8DB3\u308A\u307E\u305B\u3093\u3002"),s())}function Vo(o,i){if(o&1&&(p(0,No,2,0,"div",39),p(1,$o,2,0,"div",39)),o&2){let e=d(2);g(e.passwordControl.errors!=null&&e.passwordControl.errors.required?0:-1),u(),g(e.passwordControl.errors!=null&&e.passwordControl.errors.minlength?1:-1)}}function Go(o,i){if(o&1){let e=Q();a(0,"div",3)(1,"form",4,0)(3,"h2",5),r(4,"\u516C\u958B\u8A2D\u5B9A"),v(5,"img",6),s(),a(6,"div")(7,"div",7)(8,"div",8)(9,"label",9),r(10,"\u73FE\u5728\u306E\u753B\u50CF"),s(),p(11,Co,1,1,"img",10)(12,bo,1,0),p(13,_o,7,1),s(),a(14,"div",11),v(15,"input",12,1),a(17,"button",13),b("click",function(n){D(e);let l=d();return w(l.onClickUploadImage(n))}),r(18,"Upload"),s()()(),a(19,"div",14)(20,"label",15),r(21,"\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0"),v(22,"img",16),s(),v(23,"input",17),a(24,"button",13),b("click",function(n){D(e);let l=d();return w(l.onClickUpdateNickname(n))}),r(25,"\u66F4\u65B0"),s()(),p(26,Eo,1,0,"div",18),p(27,To,2,2),p(28,ko,3,3),a(29,"div",14)(30,"label",15),r(31,"\u81EA\u5DF1\u7D39\u4ECB"),v(32,"img",19),s(),v(33,"textarea",20),a(34,"button",21),b("click",function(n){D(e);let l=d();return w(l.onClickUpdateAbout(n))}),r(35,"\u66F4\u65B0"),s()()(),p(36,Do,1,0,"div",18)(37,Io,1,1),p(38,Uo,2,2),v(39,"hr"),a(40,"a",22),b("click",function(n){D(e);let l=d();return w(l.onClickImportant(n))}),r(41),s(),a(42,"div",23,2)(44,"div",24)(45,"label",25),r(46,"\u540D\u524D"),v(47,"img",26),s(),v(48,"input",27),s(),a(49,"div",24)(50,"label",25),r(51,"Email"),v(52,"img",28),s(),v(53,"input",29),a(54,"button",30),b("click",function(n){D(e);let l=d();return w(l.onClickUpdateEmail(n))}),r(55,"\u66F4\u65B0"),s(),p(56,Bo,1,0,"div",18)(57,Oo,2,2),s(),a(58,"div",24)(59,"label",25),r(60,"Password"),v(61,"img",31),s(),v(62,"input",32),a(63,"button",30),b("click",function(n){D(e);let l=d();return w(l.onClickUpdatePassword(n))}),r(64,"\u66F4\u65B0"),s(),p(65,Po,2,0,"div",18)(66,Vo,2,2),s(),a(67,"h3",33),r(68,"\u30A2\u30AB\u30A6\u30F3\u30C8\u306E\u7D42\u4E86"),s(),a(69,"div",34)(70,"button",35),b("click",function(n){D(e);let l=d();return w(l.onClickDeleteAccount(n))}),r(71,"\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u524A\u9664"),s()()()()()}if(o&2){let e,t=i,n=d();u(),C("formGroup",n.inputForm),u(10),g(t.photoURL?11:12),u(2),g((e=n.profileTempImage())?13:-1,e),u(4),C("disabled",n.userIconControl.invalid||!n.userIconControl.dirty),u(2),fe("was-validated",n.nicknameControl.dirty||n.nicknameControl.touched),u(5),C("disabled",n.nicknameControl.invalid||!n.nicknameControl.dirty),u(2),g(n.nicknameControl.invalid?-1:26),u(),g(n.nicknameResult?27:-1),u(),g(n.nicknameControl.invalid?28:-1),u(),fe("was-validated",n.aboutControl.dirty||n.aboutControl.touched),u(5),C("disabled",n.aboutControl.invalid||!n.aboutControl.dirty),u(2),g(n.aboutControl.invalid?37:36),u(2),g(n.auth.isDeveloper?38:-1),u(3),V(n.isOpenOther()?"\u518D\u8A8D\u8A3C":"\u305D\u306E\u4ED6\u306E\u8A2D\u5B9A"),u(7),C("value",t.displayName),u(),fe("was-validated",n.emailControl.dirty||n.emailControl.touched),u(5),C("disabled",n.emailControl.invalid||!n.emailControl.dirty),u(2),g(n.emailControl.invalid?57:56),u(2),fe("was-validated",n.passwordControl.dirty||n.passwordControl.touched),u(5),C("disabled",!n.passwordControl.value||n.passwordControl.invalid||!n.passwordControl.dirty),u(2),g(n.passwordControl.invalid?66:65)}}var nt=class o{constructor(i,e,t,n,l,c,Y,L){this.auth=i;this.firestore=e;this.storage=t;this.funcs=n;this.toastr=l;this.router=c;this.dialog=Y;this.localSession=L;f("UserSettingsComponent()"),this.inputForm=new Ce({}),this.pubUser=se(this.firestore,"users/v1/public"),this.privUser=se(this.firestore,"users/v1/protected"),this.nicknameIndex=se(this.firestore,"index/users/usernick"),this.currentUser$=this.auth.clientSideUser$,this.currentUser=Nt(this.currentUser$);let B=this.currentUser$.pipe(H(1),$(m=>!!m));B.pipe(_(m=>{let q=ue(this.pubUser,m.uid).withConverter(this.UserPublicStoreConverter);return be(q)}),A(this.destroy$)).subscribe(m=>{this.userPublic=m,G(this.aboutControl,m.about),this.aboutControl.enable(),G(this.nicknameControl,m.nickname),this.nicknameControl.enable()}),B.pipe(_(m=>{let q=ue(this.privUser,m.uid).withConverter(this.UserProtectedStoreConverter);return be(q)}),A(this.destroy$)).subscribe(m=>{this.userPrivate$.next(m)}),B.pipe(xt(this.viewInited$),R(([m,q])=>m),A(this.destroy$)).subscribe(m=>{this.emailControl.setValue(m.email)})}destroy$=new U;viewInited$=new U;currentUser;currentUser$;userPublic;userPrivate$=new U;profileTempImage=J(null);inputForm;notificationForm;isOpenOther=J(!1);nicknameResult=null;protectedSettings=he.required("protectedSettings",{read:pe});imageBox=he.required("imageBox",{read:pe});pubUser;privUser;nicknameIndex;UserPublicStoreConverter=_e(["createdAt","updatedAt"]);UserProtectedStoreConverter=_e(["createdAt","updatedAt"]);ngOnInit(){f("UserSettingsComponent.OnInit()"),this.inputForm.addControl("userIcon",new I("",[Ve.required])),this.inputForm.addControl("email",new I({value:"",disabled:!1},[Ve.required])),this.inputForm.addControl("password",new I("",[])),this.inputForm.addControl("nickname",new I({value:"",disabled:!0},[Ve.required])),this.inputForm.addControl("about",new I({value:"",disabled:!0},[])),this.notificationForm=new Ce({}),this.inputForm.addControl("messaging",this.notificationForm)}ngAfterViewInit(){this.viewInited$.next()}ngOnDestroy(){this.destroy$.next()}get emailControl(){return this.inputForm.get("email")}get passwordControl(){return this.inputForm.get("password")}get aboutControl(){return this.inputForm.get("about")}get nicknameControl(){return this.inputForm.get("nickname")}get userIconControl(){return this.inputForm.get("userIcon")}onClickDeleteAccount(i){this.dialog.createDefaultBuilder().prepareBody(et).setType(1).setSize(1).setTitle("\u6700\u7D42\u78BA\u8A8D").okButton(()=>{this.doDeleteAccount()}).cancelButton(()=>{}).open()}async doDeleteAccount(){let i=this.currentUser(),e=i.uid;try{await i.delete(),f("Account is deleted")}catch(t){S("Error while delete account",t);let n=t instanceof Error?t.message:"Unknown error";this.toastr.error(`\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${n} )`);return}this.localSession.unmarkLogin(),this.router.navigate(["/"])}updateError(i,e){S(`Error while update tag:${i}`,e);let t=e instanceof Error?e.message:"Unknown error";this.toastr.error(`${i} \u306E\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${t} )`)}updateSucceeded(i,e){this.toastr.success(`${i} \u3092 "${e}" \u306B\u66F4\u65B0\u3057\u307E\u3057\u305F\u3002`)}async updateProfileImage(i){if(i==="")return;let e="\u30D7\u30ED\u30D5\u30A3\u30FC\u30EB\u753B\u50CF",t=this.currentUser();try{await ui(t,{photoURL:i});let n={photoURL:i,updatedAt:li()},l=ue(this.pubUser,t.uid);await pi(l,n),this.updateSucceeded(e,"Upload \u3057\u305F\u753B\u50CF");let c=this.getProfileRef("temp_profile");await Ci(c),this.profileTempImage.set(null),this.userIconControl.setValue(""),k(this.userIconControl)}catch(n){this.updateError(e,n)}}async onClickUpdateNickname(i){if(this.nicknameControl.invalid)return;let e=this.nicknameControl.value;if(e===this.userPublic.nickname)return;let t="\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0";try{let n={nickname:e};this.nicknameResult=await this.funcs.call("updateNickname",n),this.updateSucceeded(t,e),k(this.nicknameControl)}catch(n){this.updateError(t,n)}}async onClickUpdateAbout(i){if(this.aboutControl.invalid)return;let e=this.aboutControl.value;if(e===this.userPublic.about)return;let t="\u81EA\u5DF1\u7D39\u4ECB";try{let n={about:e};await this.funcs.call("updateAbout",n),this.updateSucceeded(t,e),k(this.aboutControl)}catch(n){this.updateError(t,n)}}async onClickUpdateEmail(i){if(this.emailControl.invalid)return;let e=this.emailControl.value,t=this.currentUser();if(e===t.email)return;this.dialog.createSimpleBuilder().setType(1).setSize(1).setMessage("\u767B\u9332\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5909\u66F4\u3057\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F").setTitle("\u78BA\u8A8D").okButton(()=>{this.doChangeEmail(e)}).cancelButton(()=>{}).open()}async doChangeEmail(i){let e="Email",t=this.currentUser();try{await ai(t,i),await ri(t),this.updateSucceeded(e,i),k(this.emailControl),this.toastr.info("\u78BA\u8A8D\u306E\u30E1\u30FC\u30EB\u3092\u9001\u4FE1\u3057\u307E\u3057\u305F\u3002")}catch(n){this.updateError(e,n)}}async onClickUpdatePassword(i){if(this.passwordControl.invalid)return;let e=this.passwordControl.value;if(e==="")return;let t="\u30D1\u30B9\u30EF\u30FC\u30C9",n=this.currentUser();try{await si(n,e),this.updateSucceeded(t,"********"),k(this.passwordControl)}catch(l){this.updateError(t,l)}finally{this.passwordControl.setValue("")}}listProvider(){}ensureImageFile(){let i=this.imageBox().nativeElement;if(i.files.length===0)return this.toastr.error("\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),null;let e=i.files[0];return e.size>=512*1024?(this.toastr.error("\u30D5\u30A1\u30A4\u30EB\u306E\u30B5\u30A4\u30BA\u304C\u5927\u304D\u3059\u304E\u307E\u3059\u3002(\u7D04 500kb \u307E\u3067)"),null):e}getProfileRef(i){let e=this.currentUser();return _i(this.storage,`/image/${e.uid}/profile/${i}`)}async onClickUploadImage(i){let e=this.ensureImageFile();if(!e)return;let t=await this.uploadProfileImage("temp_profile",e);this.profileTempImage.set(await ht(t.ref))}async uploadProfileImage(i,e){let t=this.getProfileRef(i);return await Ei(t,e)}async doChangePhoto(i){let e=await this.uploadProfileImage("profile",i),t=await ht(e.ref);this.updateProfileImage(t)}initializeReauth(i){i.setInput("currentUser",this.currentUser());let e=i.instance,t=this.protectedSettings().nativeElement;e.reauthed.subscribe(()=>{new Yt(t).show(),this.isOpenOther.set(!0)})}constructReauth(){return i=>{}}onClickImportant(i){f("onClickImportant()"),this.dialog.createDefaultBuilder().initBox(it,t=>this.initializeReauth(t)).setupChild(this.constructReauth()).setType(3).setSize(1).setTitle("\u518D\u8A8D\u8A3C").cancelButton(()=>{}).closeButton(()=>{}).open()}onClickOkImage(i,e){let t=this.ensureImageFile();if(!t)return;this.dialog.createSimpleBuilder().setType(3).setSize(1).setMessage("\u753B\u50CF\u306F\u516C\u958B\u3055\u308C\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F").setTitle("\u78BA\u8A8D").okButton(()=>{this.doChangePhoto(t)}).cancelButton(()=>{}).open()}static \u0275fac=function(e){return new(e||o)(h(K),h(ae),h(vi),h(le),h(ne),h(Vt),h(We),h(Qe))};static \u0275cmp=M({type:o,selectors:[["ng-component"]],viewQuery:function(e,t){e&1&&De(t.protectedSettings,vo,5,pe)(t.imageBox,ho,5,pe),e&2&&we(2)},decls:1,vars:1,consts:[["configForm",""],["imageBox",""],["protectedSettings",""],[1,"container"],[3,"formGroup"],[1,"mb-3"],["title","\u4E00\u822C\u516C\u958B\u3055\u308C\u308B\u60C5\u5831\u3092\u7DE8\u96C6\u3067\u304D\u307E\u3059\u3002","src","/assets/octicons/question.svg",1,"m-3","octicon-info","help-icon"],[1,"my-2"],[1,"input-group","my-1"],[1,"visually-hidden"],["alt","Profile \u753B\u50CF",1,"user-settings-profile-image","rounded",3,"src"],[1,"input-group"],["id","appGitfireInputIconFileInput","name","userIcon","formControlName","userIcon","type","file","placeholder","\u30A2\u30A4\u30B3\u30F3\u3092\u9078\u629E","accept","image/*",1,"form-control"],[1,"btn","btn-primary",3,"click","disabled"],[1,"input-group","my-2"],[1,"input-group-text"],["title","\u30E1\u30C3\u30BB\u30FC\u30B8\u4E0A\u306B\u8868\u793A\u3055\u308C\u308B\u3042\u306A\u305F\u306E\u540D\u524D\u3067\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","nickname","placeholder","\u4F8B: hogehoge1032","formControlName","nickname","autofocus","","type","text","maxlength","19","minlength","4","required","",1,"form-control"],[1,"valid-feedback"],["title","\u30D5\u30EA\u30FC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3067\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","about","placeholder","\u4F8B: Ingress: kagura2718 (RES) \u30DD\u30B1\u30E2\u30F3go: kagura271(\u8D64)","formControlName","about","maxlength","200","type","text",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["role","button","aria-expanded","false",1,"btn","btn-secondary","collapsed",3,"click"],["id","appGitfireUserSettingsSecretContainer",1,"collapse","m-3"],[1,"row","input-group","m-3"],[1,"col-2","text-md-end","col-form-label"],["title","\u8A8D\u8A3C\u30D7\u30ED\u30D0\u30A4\u30C0\u304B\u3089\u63D0\u4F9B\u3055\u308C\u305F\u540D\u524D\u3067\u3059\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","displayname","placeholder","\u4F8B: hogehoge1032","type","text","disabled","",1,"col-10","form-control",3,"value"],["title","\u8A8D\u8A3C\u306B\u4F7F\u308F\u308C\u308B\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3067\u3059\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","email","placeholder","email@example.com","formControlName","email","autocomplete","email","type","email","required","","autofill","","maxlength","1024","minlength","5",1,"col-8","form-control"],[1,"btn","btn-primary","col-2",3,"click","disabled"],["title","\u30ED\u30B0\u30A4\u30F3\u6642\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3067\u3059\u3002\u4ED6\u4EBA\u306B\u63A8\u6E2C\u3055\u308C\u306A\u3044\u3082\u306E\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","password","placeholder","\u5909\u66F4\u306A\u3057","formControlName","password","type","password","autocomplete","new-password","maxlength","256","minlength","6",1,"col-8","form-control"],[1,"m-3"],[1,"input-group","m-3"],["tabindex","-1",1,"btn","btn-warning",3,"click"],[1,"p-3"],["alt","\u65B0\u3057\u3044 Profile \u753B\u50CF",1,"user-settings-profile-image","rounded",3,"src"],[1,"btn","btn-primary",3,"click"],[1,"invalid-feedback"],[3,"mainForm","userPrivStore$"]],template:function(e,t){if(e&1&&p(0,Go,72,25,"div",3),e&2){let n;g((n=t.currentUser())?0:-1,n)}},dependencies:[re,jt,$e,Ge,je,qt,zt,Wt,Le,Lt,ot],styles:[".user-settings-profile-image[_ngcontent-%COMP%]{width:80px;height:80px}.help-icon[_ngcontent-%COMP%]{width:20px;height:20px}"]})};function jo(o,i){if(o&1&&(x(0,"div"),r(1),E()),o&2){let e=d();u(),te("URL: ",e.url)}}function Lo(o,i){if(o&1&&(x(0,"div")(1,"div")(2,"div"),r(3),E(),p(4,jo,2,1,"div"),x(5,"div"),r(6),E(),x(7,"div"),r(8),ve(9,"date"),E()(),ke(10,"hr"),x(11,"div"),r(12),E()()),o&2){let e=i;u(3),te("Title: ",e.title),u(),g(e.url?4:-1),u(2),te("Done: ",e.hasRead),u(2),te("Date: ",Me(9,5,e.createdAt.toDate(),"yyyy-MM-dd hh:mm:ss")),u(4),V(e.body)}}function qo(o,i){o&1&&r(0,"No message found")}var rt=class o{constructor(i,e,t){this.auth=i;this.route=e;this.firestore=t}destroy$=new U;TrayConverter=_e(["createdAt"]);trayStore=J(null);ngOnInit(){f("UserTrayMessageComponent.OnInit()");let i=this.route.queryParams.pipe($(e=>"id"in e),R(e=>e.id));Se(i,this.auth.clientSideUser$).pipe($(([e,t])=>t!==null),_(([e,t])=>{let n=ue(this.firestore,"users/v1/protected",t.uid,"tray",e).withConverter(this.TrayConverter);return be(n,{idField:"id"}).pipe()}),A(this.destroy$)).subscribe(e=>{this.trayStore.set(e)})}ngOnDestroy(){f("UserTrayMessageComponent.OnDestroy()"),this.destroy$.next()}static \u0275fac=function(e){return new(e||o)(h(K),h(Pt),h(ae))};static \u0275cmp=M({type:o,selectors:[["app-user-tray-message"]],decls:2,vars:1,template:function(e,t){if(e&1&&p(0,Lo,13,8,"div")(1,qo,1,0),e&2){let n;g((n=t.trayStore())?0:1,n)}},dependencies:[Oe],encapsulation:2})};var j=class o{constructor(i,e){this.auth=i;this.router=e;f("AuthGuard.constructor")}canActivate(i,e){return Xe(this.auth).pipe(R(t=>{if(y("AuthGuard",t),t)return!0;let n={queryParams:{redirectPath:e.url}};return f("auth.guard Prepare to redirect",n),this.router.createUrlTree(["/Gitfire/login"],n)}))}static \u0275fac=function(e){return new(e||o)(F(Je),F(Pe))};static \u0275prov=oe({token:o,factory:o.\u0275fac,providedIn:"root"})};var ie=class o{constructor(i,e,t){this.auth=i;this.localSession=e;this.router=t}canActivate(i,e){return Xe(this.auth).pipe(R(t=>(y("LoginGuard",t),t?this.router.createUrlTree(["/"]):!0)))}static \u0275fac=function(e){return new(e||o)(F(Je),F(Qe),F(Pe))};static \u0275prov=oe({token:o,factory:o.\u0275fac,providedIn:"root"})};var Wo=[{path:"login.htm",loadChildren:()=>import("./chunk-RYKY42XJ.js").then(o=>o.GitfireLoginModule),data:{mode:"login"},canActivate:[ie]},{path:"login",redirectTo:"login.htm"},{path:"signup.htm",loadChildren:()=>import("./chunk-RYKY42XJ.js").then(o=>o.GitfireLoginModule),data:{mode:"signup"},canActivate:[ie]},{path:"signup",redirectTo:"signup.htm"},{path:"reset.htm",loadChildren:()=>import("./chunk-RYKY42XJ.js").then(o=>o.GitfireLoginModule),data:{mode:"reset"}},{path:"reset",redirectTo:"reset.htm"},{path:"chat.htm",loadChildren:()=>import("./chunk-OS5TVFIR.js").then(o=>o.GitfireChatModule),canActivate:[j]},{path:"chat",redirectTo:"chat.htm"},{path:"post.htm",loadChildren:()=>import("./chunk-NOAT4YY4.js").then(o=>o.GitfirePostModule),canActivate:[j]},{path:"post",redirectTo:"post.htm"},{path:"settings.htm",component:nt,canActivate:[j]},{path:"settings",redirectTo:"settings.htm"},{path:"tray.htm",component:rt,canActivate:[j]},{path:"tray",redirectTo:"tray.htm"}],at=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=X({type:o});static \u0275inj=Z({imports:[gt.forChild(Wo),gt]})};var st=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=X({type:o});static \u0275inj=Z({providers:[Ii,wi],imports:[qe,re,Ui,Mi,Ri,Bi]})};var Wi=class o{constructor(){y("Dynamically loaded GitfireModule")}static \u0275fac=function(e){return new(e||o)};static \u0275mod=X({type:o});static \u0275inj=Z({providers:[K,j,ie,le,hi(()=>bi()),ci(()=>di()),gi(()=>fi(void 0,Ne.FirebaseCloudFunctionsRegion)),$i(()=>Vi())],imports:[at,ki,st,Kt,Oi,Pi]})};export{Wi as a};
