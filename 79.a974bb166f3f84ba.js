"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[79],{8079:(oI,Kf,ae)=>{ae.d(Kf,{Qe:()=>Ud,cM:()=>Ry});var zf=ae(177),se=ae(3953),qe=ae(1825),li=ae(9253),yt=ae(1152),jf=ae(3236),Qf=ae(1985),hi=ae(8455),ku=ae(7673),Ns=ae(9172),$f=ae(9974),Wf=ae(4360);function ks(){return(0,$f.N)((r,e)=>{let t,n=!1;r.subscribe((0,Wf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var Gt,Bu,Je=ae(6354),Fs=ae(2816),Hf=ae(3294),Fu=ae(5964),Jf=(ae(2438),ae(3345)),b=ae(467),di=ae(8742),Mu=ae(1362),Ye=ae(8041),ee=ae(1076),Ou=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lu={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,p,I){I||(I=0);var E=Array(16);if("string"==typeof p)for(var v=0;16>v;++v)E[v]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;var P=T.g[3],y=(p=T.g[0])+(P^(I=T.g[1])&((v=T.g[2])^P))+E[0]+3614090360&4294967295;y=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=I+(y<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=p+(v^P&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=p+(I^v^P)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=p+(v^(I|~P))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((P=(p=I+((y=p+(v^(I|~P))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=P+((y=v+(p^(P|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+P&4294967295}function a(T,p){this.h=p;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var P=0|T[v];E&&P==p||(I[v]=P,E=!1)}this.g=I}(function e(T,p){function I(){}I.prototype=p.prototype,T.D=p.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,P){for(var y=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)y[gt-2]=arguments[gt];return p.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,p){void 0===p&&(p=T.length);for(var I=p-this.blockSize,E=this.B,v=this.h,P=0;P<p;){if(0==v)for(;P<=I;)i(this,T,P),P+=this.blockSize;if("string"==typeof T){for(;P<p;)if(E[v++]=T.charCodeAt(P++),v==this.blockSize){i(this,E),v=0;break}}else for(;P<p;)if(E[v++]=T[P++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=p},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var I=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=255&I,I/=256;for(this.u(T),T=Array(16),p=I=0;4>p;++p)for(var E=0;32>E;E+=8)T[I++]=this.g[p]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,p){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=p(T)}(T,function(p){return new a([0|p],0>p?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return D(h(-T));for(var p=[],I=1,E=0;T>=I;E++)p[E]=T/I|0,I*=4294967296;return new a(p,0)}var g=c(0),_=c(1),A=c(16777216);function x(T){if(0!=T.h)return!1;for(var p=0;p<T.g.length;p++)if(0!=T.g[p])return!1;return!0}function k(T){return-1==T.h}function D(T){for(var p=T.g.length,I=[],E=0;E<p;E++)I[E]=~T.g[E];return new a(I,~T.h).add(_)}function B(T,p){return T.add(D(p))}function K(T,p){for(;(65535&T[p])!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function U(T,p){this.g=T,this.h=p}function z(T,p){if(x(p))throw Error("division by zero");if(x(T))return new U(g,g);if(k(T))return p=z(D(T),p),new U(D(p.g),D(p.h));if(k(p))return p=z(T,D(p)),new U(D(p.g),p.h);if(30<T.g.length){if(k(T)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=p;0>=E.l(T);)I=H(I),E=H(E);var v=$(I,1),P=$(E,1);for(E=$(E,2),I=$(I,2);!x(E);){var y=P.add(E);0>=y.l(T)&&(v=v.add(I),P=y),E=$(E,1),I=$(I,1)}return p=B(T,v.j(p)),new U(v,p)}for(v=g;0<=T.l(p);){for(I=Math.max(1,Math.floor(T.m()/p.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(P=h(I)).j(p);k(y)||0<y.l(T);)y=(P=h(I-=E)).j(p);x(P)&&(P=_),v=v.add(P),T=B(T,y)}return new U(v,T)}function H(T){for(var p=T.g.length+1,I=[],E=0;E<p;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(I,T.h)}function $(T,p){var I=p>>5;p%=32;for(var E=T.g.length-I,v=[],P=0;P<E;P++)v[P]=0<p?T.i(P+I)>>>p|T.i(P+I+1)<<32-p:T.i(P+I);return new a(v,T.h)}(r=a.prototype).m=function(){if(k(this))return-D(this).m();for(var T=0,p=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(k(this))return"-"+D(this).toString(T);for(var p=h(Math.pow(T,6)),I=this,E="";;){var v=z(I,p).g,P=((0<(I=B(I,v.j(p))).g.length?I.g[0]:I.h)>>>0).toString(T);if(x(I=v))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return k(T=B(this,T))?-1:x(T)?0:1},r.abs=function(){return k(this)?D(this):this},r.add=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=p;v++){var P=E+(65535&this.i(v))+(65535&T.i(v)),y=(P>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(P&=65535)}return new a(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(x(this)||x(T))return g;if(k(this))return k(T)?D(this).j(D(T)):D(D(this).j(T));if(k(T))return D(this.j(D(T)));if(0>this.l(A)&&0>T.l(A))return h(this.m()*T.m());for(var p=this.g.length+T.g.length,I=[],E=0;E<2*p;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var P=this.i(E)>>>16,y=65535&this.i(E),gt=T.i(v)>>>16,jr=65535&T.i(v);I[2*E+2*v]+=y*jr,K(I,2*E+2*v),I[2*E+2*v+1]+=P*jr,K(I,2*E+2*v+1),I[2*E+2*v+1]+=y*gt,K(I,2*E+2*v+1),I[2*E+2*v+2]+=P*gt,K(I,2*E+2*v+2)}for(E=0;E<p;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=p;E<2*p;E++)I[E]=0;return new a(I,0)},r.A=function(T){return z(this,T).h},r.and=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)&T.i(E);return new a(I,this.h&T.h)},r.or=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)|T.i(E);return new a(I,this.h|T.h)},r.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)^T.i(E);return new a(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Bu=Lu.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,p){if(0==T.length)throw Error("number format error: empty string");if(2>(p=p||10)||36<p)throw Error("radix out of range: "+p);if("-"==T.charAt(0))return D(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(p,8)),E=g,v=0;v<T.length;v+=8){var P=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+P),p);8>P?(P=h(Math.pow(p,P)),E=E.j(P).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},Gt=Lu.Integer=a}).apply(typeof Ou<"u"?Ou:typeof self<"u"?self:typeof window<"u"?window:{});var Uu,qu,rr,Gu,mi,Ms,Ku,zu,ju,fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof fi&&fi];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var w=o[m];if(!(w in d))break e;d=d[w]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,w={next:function(){if(!m&&d<o.length){var S=d++;return{value:l(S,o[S]),done:!1}}return m=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,m),o.apply(l,w)}}return function(){return o.apply(l,arguments)}}function _(o,l,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function A(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,w,S){for(var M=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)M[ie-2]=arguments[ie];return l.prototype[w].apply(m,M)}}function k(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function D(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const w=o.length||0,S=m.length||0;o.length=w+S;for(let M=0;M<S;M++)o[w+M]=m[M]}else o.push(m)}}function K(o){return/^[\s\xa0]*$/.test(o)}function U(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function z(o){return z[" "](o),o}z[" "]=function(){};var H=!(-1==U().indexOf("Gecko")||-1!=U().toLowerCase().indexOf("webkit")&&-1==U().indexOf("Edge")||-1!=U().indexOf("Trident")||-1!=U().indexOf("MSIE")||-1!=U().indexOf("Edge"));function $(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function p(o){const l={};for(const d in o)l[d]=o[d];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let d,m;for(let w=1;w<arguments.length;w++){for(d in m=arguments[w],m)o[d]=m[d];for(let S=0;S<I.length;S++)d=I[S],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function v(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function P(o){u.setTimeout(()=>{throw o},0)}function y(){var o=cu;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var jr=new class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new Py,o=>o.reset());class Py{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Qr,$r=!1,cu=new class gt{constructor(){this.h=this.g=null}add(l,d){const m=jr.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},qd=()=>{const o=u.Promise.resolve(void 0);Qr=()=>{o.then(Vy)}};var Vy=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){P(d)}var l=jr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}$r=!1};function Lt(){this.s=this.s,this.C=this.C}function Ne(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Lt.prototype.s=!1,Lt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Lt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ne.prototype.h=function(){this.defaultPrevented=!0};var Sy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Wr(o,l){if(Ne.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(H){e:{try{z(l.nodeName);var w=!0;break e}catch{}w=!1}w||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:by[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Wr.aa.h.call(this)}}x(Wr,Ne);var by={2:"touch",3:"pen",4:"mouse"};Wr.prototype.h=function(){Wr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Hr="closure_listenable_"+(1e6*Math.random()|0),xy=0;function Cy(o,l,d,m,w){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=w,this.key=++xy,this.da=this.fa=!1}function ps(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function _s(o){this.src=o,this.g={},this.h=0}function lu(o,l){var d=l.type;if(d in o.g){var S,m=o.g[d],w=Array.prototype.indexOf.call(m,l,void 0);(S=0<=w)&&Array.prototype.splice.call(m,w,1),S&&(ps(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function hu(o,l,d,m){for(var w=0;w<o.length;++w){var S=o[w];if(!S.da&&S.listener==l&&S.capture==!!d&&S.ha==m)return w}return-1}_s.prototype.add=function(o,l,d,m,w){var S=o.toString();(o=this.g[S])||(o=this.g[S]=[],this.h++);var M=hu(o,l,m,w);return-1<M?(l=o[M],d||(l.fa=!1)):((l=new Cy(l,this.src,S,!!m,w)).fa=d,o.push(l)),l};var du="closure_lm_"+(1e6*Math.random()|0),fu={};function Gd(o,l,d,m,w){if(m&&m.once)return zd(o,l,d,m,w);if(Array.isArray(l)){for(var S=0;S<l.length;S++)Gd(o,l[S],d,m,w);return null}return d=_u(d),o&&o[Hr]?o.K(l,d,h(m)?!!m.capture:!!m,w):Kd(o,l,d,!1,m,w)}function Kd(o,l,d,m,w,S){if(!l)throw Error("Invalid event type");var M=h(w)?!!w.capture:!!w,ie=gu(o);if(ie||(o[du]=ie=new _s(o)),(d=ie.add(l,d,m,M,S)).proxy)return d;if(m=function Dy(){const l=Ny;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)Sy||(w=M),void 0===w&&(w=!1),o.addEventListener(l.toString(),m,w);else if(o.attachEvent)o.attachEvent(Qd(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function zd(o,l,d,m,w){if(Array.isArray(l)){for(var S=0;S<l.length;S++)zd(o,l[S],d,m,w);return null}return d=_u(d),o&&o[Hr]?o.L(l,d,h(m)?!!m.capture:!!m,w):Kd(o,l,d,!0,m,w)}function jd(o,l,d,m,w){if(Array.isArray(l))for(var S=0;S<l.length;S++)jd(o,l[S],d,m,w);else m=h(m)?!!m.capture:!!m,d=_u(d),o&&o[Hr]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=hu(S=o.g[l],d,m,w))&&(ps(S[d]),Array.prototype.splice.call(S,d,1),0==S.length&&(delete o.g[l],o.h--))):o&&(o=gu(o))&&(l=o.g[l.toString()],o=-1,l&&(o=hu(l,d,m,w)),(d=-1<o?l[o]:null)&&mu(d))}function mu(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Hr])lu(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(Qd(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=gu(l))?(lu(d,o),0==d.h&&(d.src=null,l[du]=null)):ps(o)}}}function Qd(o){return o in fu?fu[o]:fu[o]="on"+o}function Ny(o,l){if(o.da)o=!0;else{l=new Wr(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&mu(o),o=d.call(m,l)}return o}function gu(o){return(o=o[du])instanceof _s?o:null}var pu="__closure_events_fn_"+(1e9*Math.random()>>>0);function _u(o){return"function"==typeof o?o:(o[pu]||(o[pu]=function(l){return o.handleEvent(l)}),o[pu])}function ke(){Lt.call(this),this.i=new _s(this),this.M=this,this.F=null}function Be(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new Ne(l,o);else if(l instanceof Ne)l.target=l.target||o;else{var w=l;E(l=new Ne(m,o),w)}if(w=!0,d)for(var S=d.length-1;0<=S;S--){var M=l.g=d[S];w=ys(M,m,!0,l)&&w}if(w=ys(M=l.g=o,m,!0,l)&&w,w=ys(M,m,!1,l)&&w,d)for(S=0;S<d.length;S++)w=ys(M=l.g=d[S],m,!1,l)&&w}function ys(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var w=!0,S=0;S<l.length;++S){var M=l[S];if(M&&!M.da&&M.capture==d){var ie=M.listener,Se=M.ha||M.src;M.fa&&lu(o.i,M),w=!1!==ie.call(Se,m)&&w}}return w&&!m.defaultPrevented}function $d(o,l,d){if("function"==typeof o)d&&(o=_(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=_(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Wd(o){o.g=$d(()=>{o.g=null,o.i&&(o.i=!1,Wd(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}x(ke,Lt),ke.prototype[Hr]=!0,ke.prototype.removeEventListener=function(o,l,d,m){jd(this,o,l,d,m)},ke.prototype.N=function(){if(ke.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)ps(d[m]);delete o.g[l],o.h--}}this.F=null},ke.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},ke.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class ky extends Lt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Wd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jr(o){Lt.call(this),this.h=o,this.g={}}x(Jr,Lt);var Hd=[];function Jd(o){$(o.g,function(l,d){this.g.hasOwnProperty(d)&&mu(l)},o),o.g={}}Jr.prototype.N=function(){Jr.aa.N.call(this),Jd(this)},Jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yu=u.JSON.stringify,Fy=u.JSON.parse,My=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Iu(){}function Xd(){}Iu.prototype.h=null;var Yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Tu(){Ne.call(this,"d")}function Eu(){Ne.call(this,"c")}x(Tu,Ne),x(Eu,Ne);var hn={},Zd=null;function Is(){return Zd=Zd||new ke}function ef(o){Ne.call(this,hn.La,o)}function Xr(o){const l=Is();Be(l,new ef(l))}function tf(o,l){Ne.call(this,hn.STAT_EVENT,o),this.stat=l}function Ue(o){const l=Is();Be(l,new tf(l,o))}function nf(o,l){Ne.call(this,hn.Ma,o),this.size=l}function Zr(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function ei(){this.g=!0}function Zn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function Uy(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var w=m[1];if(Array.isArray(w)&&!(1>w.length)){var S=w[0];if("noop"!=S&&"stop"!=S&&"close"!=S)for(var M=1;M<w.length;M++)w[M]=""}}}return yu(d)}catch{return l}}(o,d)+(m?" "+m:"")})}hn.La="serverreachability",x(ef,Ne),hn.STAT_EVENT="statevent",x(tf,Ne),hn.Ma="timingevent",x(nf,Ne),ei.prototype.xa=function(){this.g=!1},ei.prototype.info=function(){};var vu,Ts={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},rf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Es(){}function Bt(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new Jr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new sf}function sf(){this.i=null,this.g="",this.h=!1}x(Es,Iu),Es.prototype.g=function(){return new XMLHttpRequest},Es.prototype.i=function(){return{}},vu=new Es;var of={},Au={};function wu(o,l,d){o.L=1,o.v=Rs(pt(l)),o.m=d,o.P=!0,af(o,null)}function af(o,l){o.F=Date.now(),vs(o),o.A=pt(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Ef(d.i,"t",m),o.C=0,d=o.j.J,o.h=new sf,o.g=Bf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new ky(_(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var w="readystatechange";Array.isArray(w)||(w&&(Hd[0]=w.toString()),w=Hd);for(var S=0;S<w.length;S++){var M=Gd(d,w[S],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Xr(),function Oy(o,l,d,m,w,S){o.info(function(){if(o.g)if(S)for(var M="",ie=S.split("&"),Se=0;Se<ie.length;Se++){var Z=ie[Se].split("=");if(1<Z.length){var Fe=Z[0];Z=Z[1];var Me=Fe.split("_");M=2<=Me.length&&"type"==Me[1]?M+(Fe+"=")+Z+"&":M+(Fe+"=redacted&")}}else M=null;else M=S;return"XMLHTTP REQ ("+m+") [attempt "+w+"]: "+l+"\n"+d+"\n"+M})}(o.i,o.u,o.A,o.l,o.R,o.m)}function uf(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function qy(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?Au:(d=Number(l.substring(d,m)),isNaN(d)?of:(m+=1)+d>l.length?Au:(l=l.slice(m,m+d),o.C=m+d,l))}function vs(o){o.S=Date.now()+o.I,cf(o,o.I)}function cf(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=Zr(_(o.ba,o),l)}function Ru(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function ti(o){0==o.j.G||o.J||Ff(o.j,o)}function dn(o){Ru(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,Jd(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Pu(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Vu(d.h,o)))if(!o.K&&Vu(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var w=m;if(0==w[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;xs(d),Ss(d)}Cu(d),Ue(18)}}else d.za=w[1],0<d.za-d.T&&37500>w[2]&&d.F&&0==d.v&&!d.C&&(d.C=Zr(_(d.Za,d),6e3));if(1>=df(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else mn(d,11)}else if((o.K||d.g==o)&&xs(d),!K(l))for(w=d.Da.g.parse(l),l=0;l<w.length;l++){let Z=w[l];if(d.T=Z[0],Z=Z[1],2==d.G)if("c"==Z[0]){d.K=Z[1],d.ia=Z[2];const Fe=Z[3];null!=Fe&&(d.la=Fe,d.j.info("VER="+d.la));const Me=Z[4];null!=Me&&(d.Aa=Me,d.j.info("SVER="+d.Aa));const nr=Z[5];null!=nr&&"number"==typeof nr&&0<nr&&(d.L=m=1.5*nr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const He=o.g;if(He){const Ds=He.g?He.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ds){var S=m.h;S.g||-1==Ds.indexOf("spdy")&&-1==Ds.indexOf("quic")&&-1==Ds.indexOf("h2")||(S.j=S.l,S.g=new Set,S.h&&(Su(S,S.h),S.h=null))}if(m.D){const Nu=He.g?He.g.getResponseHeader("X-HTTP-Session-Id"):null;Nu&&(m.ya=Nu,he(m.I,m.D,Nu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var M=o;if((m=d).qa=Lf(m,m.J?m.ia:null,m.W),M.K){ff(m.h,M);var ie=M,Se=m.L;Se&&(ie.I=Se),ie.B&&(Ru(ie),vs(ie)),m.g=M}else Nf(m);0<d.i.length&&bs(d)}else"stop"!=Z[0]&&"close"!=Z[0]||mn(d,7);else 3==d.G&&("stop"==Z[0]||"close"==Z[0]?"stop"==Z[0]?mn(d,7):xu(d):"noop"!=Z[0]&&d.l&&d.l.ta(Z),d.v=0)}Xr()}catch{}}Bt.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==_t(o)?l.j():this.Y(o)},Bt.prototype.Y=function(o){try{if(o==this.g)e:{const Me=_t(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Me)&&(3!=Me||this.g&&(this.h.h||this.g.oa()||Sf(this.g)))){this.J||4!=Me||7==l||Xr(),Ru(this);var d=this.g.Z();this.X=d;t:if(uf(this)){var m=Sf(this.g);o="";var w=m.length,S=4==_t(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){dn(this),ti(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<w;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(S&&l==w-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=200==d,function Ly(o,l,d,m,w,S,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+w+"]: "+l+"\n"+d+"\n"+S+" "+M})}(this.i,this.u,this.A,this.l,this.R,Me,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Se=this.g;if((ie=Se.g?Se.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ie)){var Z=ie;break t}}Z=null}if(!(d=Z)){this.o=!1,this.s=3,Ue(12),dn(this),ti(this);break e}Zn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Pu(this,d)}if(this.P){let He;for(d=!0;!this.J&&this.C<M.length;){if(He=qy(this,M),He==Au){4==Me&&(this.s=4,Ue(14),d=!1),Zn(this.i,this.l,null,"[Incomplete Response]");break}if(He==of){this.s=4,Ue(15),Zn(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}Zn(this.i,this.l,He,null),Pu(this,He)}if(uf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Me||0!=M.length||this.h.h||(this.s=1,Ue(16),d=!1),this.o=this.o&&d,d){if(0<M.length&&!this.W){this.W=!0;var Fe=this.j;Fe.g==this&&Fe.ba&&!Fe.M&&(Fe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Du(Fe),Fe.M=!0,Ue(11))}}else Zn(this.i,this.l,M,"[Invalid Chunked Response]"),dn(this),ti(this)}else Zn(this.i,this.l,M,null),Pu(this,M);4==Me&&dn(this),this.o&&!this.J&&(4==Me?Ff(this.j,this):(this.o=!1,vs(this)))}else(function iI(o){const l={};o=(o.g&&2<=_t(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(K(o[m]))continue;var d=v(o[m]);const w=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const S=l[w]||[];l[w]=S,S.push(d)}!function T(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<M.indexOf("Unknown SID")?(this.s=3,Ue(12)):(this.s=0,Ue(13)),dn(this),ti(this)}}}catch{}},Bt.prototype.cancel=function(){this.J=!0,dn(this)},Bt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function By(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Xr(),Ue(17)),dn(this),this.s=2,ti(this)):cf(this,this.S-o)};var Gy=class{constructor(o,l){this.g=o,this.map=l}};function lf(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hf(o){return!!o.h||!!o.g&&o.g.size>=o.j}function df(o){return o.h?1:o.g?o.g.size:0}function Vu(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function Su(o,l){o.g?o.g.add(l):o.h=l}function ff(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function mf(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return k(o.i)}function gf(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function zy(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function Ky(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),w=m.length,S=0;S<w;S++)l.call(void 0,m[S],d&&d[S],o)}lf.prototype.cancel=function(){if(this.i=mf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var pf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof fn){this.h=o.h,As(this,o.j),this.o=o.o,this.g=o.g,ws(this,o.s),this.l=o.l;var l=o.i,d=new ii;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),_f(this,d),this.m=o.m}else o&&(l=String(o).match(pf))?(this.h=!1,As(this,l[1]||"",!0),this.o=ni(l[2]||""),this.g=ni(l[3]||"",!0),ws(this,l[4]),this.l=ni(l[5]||"",!0),_f(this,l[6]||"",!0),this.m=ni(l[7]||"")):(this.h=!1,this.i=new ii(null,this.h))}function pt(o){return new fn(o)}function As(o,l,d){o.j=d?ni(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function ws(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function _f(o,l,d){l instanceof ii?(o.i=l,function Yy(o,l){l&&!o.j&&(Ut(o),o.i=null,o.g.forEach(function(d,m){var w=m.toLowerCase();m!=w&&(If(this,m),Ef(this,w,d))},o)),o.j=l}(o.i,o.h)):(d||(l=ri(l,Hy)),o.i=new ii(l,o.h))}function he(o,l,d){o.i.set(l,d)}function Rs(o){return he(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ni(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ri(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,Qy),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Qy(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}fn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(ri(l,yf,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(ri(l,yf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(ri(d,"/"==d.charAt(0)?Wy:$y,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",ri(d,Jy)),o.join("")};var yf=/[#\/\?@]/g,$y=/[#\?:]/g,Wy=/[#\?]/g,Hy=/[#\?@]/g,Jy=/#/g;function ii(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Ut(o){o.g||(o.g=new Map,o.h=0,o.i&&function jy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),w=null;if(0<=m){var S=o[d].substring(0,m);w=o[d].substring(m+1)}else S=o[d];l(S,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function If(o,l){Ut(o),l=er(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Tf(o,l){return Ut(o),l=er(o,l),o.g.has(l)}function Ef(o,l,d){If(o,l),0<d.length&&(o.i=null,o.g.set(er(o,l),k(d)),o.h+=d.length)}function er(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function qt(o,l,d,m,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),m(d)}catch{}}function eI(){this.g=new My}function tI(o,l,d){const m=d||"";try{gf(o,function(w,S){let M=w;h(w)&&(M=yu(w)),l.push(m+S+"="+encodeURIComponent(M))})}catch(w){throw l.push(m+"type="+encodeURIComponent("_badmap")),w}}function si(o){this.l=o.Ub||null,this.j=o.eb||!1}function Ps(o,l){ke.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function vf(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function oi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ai(o)}function ai(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Af(o){let l="";return $(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function bu(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Af(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):he(o,l,d))}function _e(o){ke.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ii.prototype).add=function(o,l){Ut(this),this.i=null,o=er(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){Ut(this),this.g.forEach(function(d,m){d.forEach(function(w){o.call(l,w,m,this)},this)},this)},r.na=function(){Ut(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const w=o[m];for(let S=0;S<w.length;S++)d.push(l[m])}return d},r.V=function(o){Ut(this);let l=[];if("string"==typeof o)Tf(this,o)&&(l=l.concat(this.g.get(er(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Ut(this),this.i=null,Tf(this,o=er(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const S=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var w=S;""!==M[m]&&(w+="="+encodeURIComponent(String(M[m]))),o.push(w)}}return this.i=o.join("&")},x(si,Iu),si.prototype.g=function(){return new Ps(this.l,this.j)},si.prototype.i=function(o){return function(){return o}}({}),x(Ps,ke),(r=Ps.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,ai(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,oi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ai(this)),this.g&&(this.readyState=3,ai(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;vf(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?oi(this):ai(this),3==this.readyState&&vf(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,oi(this))},r.Qa=function(o){this.g&&(this.response=o,oi(this))},r.ga=function(){this.g&&oi(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(Ps.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),x(_e,ke);var nI=/^https?$/i,rI=["POST","PUT"];function wf(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Rf(o),Vs(o)}function Rf(o){o.A||(o.A=!0,Be(o,"complete"),Be(o,"error"))}function Pf(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=_t(o)||2!=o.Z()))if(o.u&&4==_t(o))$d(o.Ea,0,o);else if(Be(o,"readystatechange"),4==_t(o)){o.h=!1;try{const M=o.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===M){var w=String(o.D).match(pf)[1]||null;!w&&u.self&&u.self.location&&(w=u.self.location.protocol.slice(0,-1)),m=!nI.test(w?w.toLowerCase():"")}d=m}if(d)Be(o,"complete"),Be(o,"success");else{o.m=6;try{var S=2<_t(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",Rf(o)}}finally{Vs(o)}}}function Vs(o,l){if(o.g){Vf(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Be(o,"ready");try{d.onreadystatechange=m}catch{}}}function Vf(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function _t(o){return o.g?o.g.readyState:0}function Sf(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ui(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function bf(o){this.Aa=0,this.i=[],this.j=new ei,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ui("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ui("baseRetryDelayMs",5e3,o),this.cb=ui("retryDelaySeedMs",1e4,o),this.Wa=ui("forwardChannelMaxRetries",2,o),this.wa=ui("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new lf(o&&o.concurrentRequestLimit),this.Da=new eI,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function xu(o){if(xf(o),3==o.G){var l=o.U++,d=pt(o.I);if(he(d,"SID",o.K),he(d,"RID",l),he(d,"TYPE","terminate"),ci(o,d),(l=new Bt(o,o.j,l)).L=2,l.v=Rs(pt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Bf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),vs(l)}Of(o)}function Ss(o){o.g&&(Du(o),o.g.cancel(),o.g=null)}function xf(o){Ss(o),o.u&&(u.clearTimeout(o.u),o.u=null),xs(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function bs(o){if(!hf(o.h)&&!o.s){o.s=!0;var l=o.Ga;Qr||qd(),$r||(Qr(),$r=!0),cu.add(l,o),o.B=0}}function Cf(o,l){var d;d=l?l.l:o.U++;const m=pt(o.I);he(m,"SID",o.K),he(m,"RID",d),he(m,"AID",o.T),ci(o,m),o.m&&o.o&&bu(m,o.m,o.o),d=new Bt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Df(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Su(o.h,d),wu(d,m,l)}function ci(o,l){o.H&&$(o.H,function(d,m){he(l,m,d)}),o.l&&gf({},function(d,m){he(l,m,d)})}function Df(o,l,d){d=Math.min(o.i.length,d);var m=o.l?_(o.l.Na,o.l,o):null;e:{var w=o.i;let S=-1;for(;;){const M=["count="+d];-1==S?0<d?(S=w[0].g,M.push("ofs="+S)):S=0:M.push("ofs="+S);let ie=!0;for(let Se=0;Se<d;Se++){let Z=w[Se].g;const Fe=w[Se].map;if(Z-=S,0>Z)S=Math.max(0,w[Se].g-100),ie=!1;else try{tI(Fe,M,"req"+Z+"_")}catch{m&&m(Fe)}}if(ie){m=M.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function Nf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Qr||qd(),$r||(Qr(),$r=!0),cu.add(l,o),o.v=0}}function Cu(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=Zr(_(o.Fa,o),Mf(o,o.v)),o.v++,0))}function Du(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function kf(o){o.g=new Bt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=pt(o.qa);he(l,"RID","rpc"),he(l,"SID",o.K),he(l,"AID",o.T),he(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&he(l,"TO",o.ja),he(l,"TYPE","xmlhttp"),ci(o,l),o.m&&o.o&&bu(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Rs(pt(l)),d.m=null,d.P=!0,af(d,o)}function xs(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Ff(o,l){var d=null;if(o.g==l){xs(o),Du(o),o.g=null;var m=2}else{if(!Vu(o.h,l))return;d=l.D,ff(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var w=o.B;Be(m=Is(),new nf(m,d)),bs(o)}else Nf(o);else if(3==(w=l.s)||0==w&&0<l.X||!(1==m&&function sI(o,l){return!(df(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=Zr(_(o.Ga,o,l),Mf(o,o.B)),o.B++,0)))}(o,l)||2==m&&Cu(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),w){case 1:mn(o,5);break;case 4:mn(o,10);break;case 3:mn(o,6);break;default:mn(o,2)}}function Mf(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function mn(o,l){if(o.j.info("Error code "+l),2==l){var d=_(o.fb,o),m=o.Xa;const w=!m;m=new fn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||As(m,"https"),Rs(m),w?function Xy(o,l){const d=new ei;if(u.Image){const m=new Image;m.onload=A(qt,d,"TestLoadImage: loaded",!0,l,m),m.onerror=A(qt,d,"TestLoadImage: error",!1,l,m),m.onabort=A(qt,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=A(qt,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function Zy(o,l){new ei;const m=new AbortController,w=setTimeout(()=>{m.abort(),qt(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(S=>{clearTimeout(w),qt(0,0,!!S.ok,l)}).catch(()=>{clearTimeout(w),qt(0,0,!1,l)})}(m.toString(),d)}else Ue(2);o.G=0,o.l&&o.l.sa(l),Of(o),xf(o)}function Of(o){if(o.G=0,o.ka=[],o.l){const l=mf(o.h);(0!=l.length||0!=o.i.length)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Lf(o,l,d){var m=d instanceof fn?pt(d):new fn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),ws(m,m.s);else{var w=u.location;m=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;var S=new fn(null);m&&As(S,m),l&&(S.g=l),w&&ws(S,w),d&&(S.l=d),m=S}return l=o.ya,(d=o.D)&&l&&he(m,d,l),he(m,"VER",o.la),ci(o,m),m}function Bf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new _e(o.Ca&&!o.pa?new si({eb:d}):o.pa)).Ha(o.J),l}function Uf(){}function Cs(){}function $e(o,l){ke.call(this),this.g=new bf(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!K(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!K(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new tr(this)}function qf(o){Tu.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Gf(){Eu.call(this),this.status=1}function tr(o){this.g=o}(r=_e.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():vu.g(),this.v=function Yd(o){return o.h||(o.h=o.i())}(this.o?this.o:vu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(S){return void wf(this,S)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var w in m)d.set(w,m[w]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const S of m.keys())d.set(S,m.get(S))}m=Array.from(d.keys()).find(S=>"content-type"==S.toLowerCase()),w=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(rI,l,void 0))||m||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,M]of d)this.g.setRequestHeader(S,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Vf(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){wf(this,S)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Be(this,"complete"),Be(this,"abort"),Vs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vs(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Pf(this):this.bb())},r.bb=function(){Pf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<_t(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),Fy(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=bf.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){Ue(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Lf(this,null,this.W),bs(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const w=new Bt(this,this.j,o);let S=this.o;if(this.S&&(S?(S=p(S),E(S,this.S)):S=this.S),null!==this.m||this.O||(w.H=S,S=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Df(this,w,l),he(d=pt(this.I),"RID",o),he(d,"CVER",22),this.D&&he(d,"X-HTTP-Session-Id",this.D),ci(this,d),S&&(this.O?l="headers="+encodeURIComponent(String(Af(S)))+"&"+l:this.m&&bu(d,this.m,S)),Su(this.h,w),this.Ua&&he(d,"TYPE","init"),this.P?(he(d,"$req",l),he(d,"SID","null"),w.T=!0,wu(w,d,null)):wu(w,d,l),this.G=2}}else 3==this.G&&(o?Cf(this,o):0==this.i.length||hf(this.h)||Cf(this))},r.Fa=function(){if(this.u=null,kf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Zr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ue(10),Ss(this),kf(this))},r.Za=function(){null!=this.C&&(this.C=null,Ss(this),Cu(this),Ue(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ue(2)):(this.j.info("Failed to ping google.com"),Ue(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Uf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Cs.prototype.g=function(o,l){return new $e(o,l)},x($e,ke),$e.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$e.prototype.close=function(){xu(this.g)},$e.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=yu(o),o=d);l.i.push(new Gy(l.Ya++,o)),3==l.G&&bs(l)},$e.prototype.N=function(){this.g.l=null,delete this.j,xu(this.g),delete this.g,$e.aa.N.call(this)},x(qf,Tu),x(Gf,Eu),x(tr,Uf),tr.prototype.ua=function(){Be(this.g,"a")},tr.prototype.ta=function(o){Be(this.g,new qf(o))},tr.prototype.sa=function(o){Be(this.g,new Gf)},tr.prototype.ra=function(){Be(this.g,"b")},Cs.prototype.createWebChannel=Cs.prototype.g,$e.prototype.send=$e.prototype.o,$e.prototype.open=$e.prototype.m,$e.prototype.close=$e.prototype.close,ju=st.createWebChannelTransport=function(){return new Cs},zu=st.getStatEventTarget=function(){return Is()},Ku=st.Event=hn,Ms=st.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ts.NO_ERROR=0,Ts.TIMEOUT=8,Ts.HTTP_ERROR=6,mi=st.ErrorCode=Ts,rf.COMPLETE="complete",Gu=st.EventType=rf,Xd.EventType=Yr,Yr.OPEN="a",Yr.CLOSE="b",Yr.ERROR="c",Yr.MESSAGE="d",ke.prototype.listen=ke.prototype.K,rr=st.WebChannel=Xd,qu=st.FetchXmlHttpFactory=si,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Uu=st.XhrIo=_e}).apply(typeof fi<"u"?fi:typeof self<"u"?self:typeof window<"u"?window:{});const Qu="@firebase/firestore";class Ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let gn="10.13.1";const It=new Ye.Vy("@firebase/firestore");function pn(){return It.logLevel}function N(r,...e){if(It.logLevel<=Ye.$b.DEBUG){const t=e.map(Os);It.debug(`Firestore (${gn}): ${r}`,...t)}}function ye(r,...e){if(It.logLevel<=Ye.$b.ERROR){const t=e.map(Os);It.error(`Firestore (${gn}): ${r}`,...t)}}function Ge(r,...e){if(It.logLevel<=Ye.$b.WARN){const t=e.map(Os);It.warn(`Firestore (${gn}): ${r}`,...t)}}function Os(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function L(r="Unexpected state"){const e=`FIRESTORE (${gn}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function q(r,e){r||L()}function F(r,e){return r}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends ee.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ee{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $u{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Zf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}}class em{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tm{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Ee;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ee,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,b.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ee)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q("string"==typeof n.accessToken),new $u(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return q(null===e||"string"==typeof e),new Ae(e)}}class nm{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rm{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new nm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Wu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class im{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q("string"==typeof t.token),this.R=t.token,new Wu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function sm(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Hu{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=sm(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function j(r,e){return r<e?-1:r>e?1:0}function _n(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Ju(r){return r+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new de(0,0))}static max(){return new G(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ir{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(),void 0===n?n=e.length-t:n>e.length-t&&L(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ir.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ir?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class J extends ir{construct(e,t,n){return new J(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new J(t)}static emptyPath(){return new J([])}}const om=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends ir{construct(e,t,n){return new ue(e,t,n)}static isValidIdentifier(e){return om.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new C(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(J.fromString(e))}static fromName(e){return new O(J.fromString(e).popFirst(5))}static empty(){return new O(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===J.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new J(e.slice()))}}class yn{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Ls(r){return r.fields.find(e=>2===e.kind)}function Kt(r){return r.fields.filter(e=>2!==e.kind)}yn.UNKNOWN_ID=-1;class zt{constructor(e,t){this.fieldPath=e,this.kind=t}}class In{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new In(0,je.min())}}function Yu(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new je(i,O.empty(),e)}function Xu(r){return new je(r.readTime,r.key,-1)}class je{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new je(G.min(),O.empty(),-1)}static max(){return new je(G.max(),O.empty(),-1)}}function Bs(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(r.documentKey,e.documentKey),0!==t?t:j(r.largestBatchId,e.largestBatchId))}const Zu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ec{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Tt(r){return Us.apply(this,arguments)}function Us(){return(Us=(0,b.A)(function*(r){if(r.code!==V.FAILED_PRECONDITION||r.message!==Zu)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,n)=>{t(e)})}static reject(e){return new R((t,n)=>{n(e)})}static waitFor(e){return new R((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=R.resolve(!1);for(const n of e)t=t.next(i=>i?R.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new R((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new R((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class gi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ee,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new sr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=qs(n.target.error);this.V.reject(new sr(e,i))}}static open(e,t,n,i){try{return new gi(t,e.transaction(i,n))}catch(s){throw new sr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new lm(t)}}class Xe{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Xe.S((0,ee.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),jt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ee.zW)())return!1;if(Xe.v())return!0;const e=(0,ee.ZQ)(),t=Xe.S(e),n=0<t&&t<10,i=tc(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,b.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new sr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new C(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new sr(e,u))},s.onupgradeneeded=a=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,b.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=gi.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),R.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function tc(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class cm{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return jt(this.B.delete())}}class sr extends C{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Et(r){return"IndexedDbTransactionError"===r.name}class lm{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),jt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),jt(this.store.add(e))}get(e){return jt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),jt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),jt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new R((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new R((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new R((n,i)=>{t.onerror=s=>{const a=qs(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new R((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new cm(u),h=t(u.primaryKey,u.value,c);if(h instanceof R){const f=h.catch(g=>(c.done(),R.reject(g)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>R.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function jt(r){return new R((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=qs(n.target.error);t(i)}})}let nc=!1;function qs(r){const e=Xe.S((0,ee.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nc||(nc=!0,setTimeout(()=>{throw n},0)),n}}return r}class hm{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){Et(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Tt(n)}yield t.X(6e4)}))}}class dm{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,b.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return R.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return N("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=Xu(s);Bs(a,n)>0&&(n=a)}),new je(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Qe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function or(r){return null==r}function ar(r){return 0===r&&1/r==-1/0}function rc(r){return"number"==typeof r&&Number.isInteger(r)&&!ar(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function be(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ic(e)),e=fm(r.get(t),e);return ic(e)}function fm(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function ic(r){return r+"\x01\x01"}function Ze(r){const e=r.length;if(q(e>=2),2===e)return q("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),J.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&L(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}const sc=["userId","batchId"];function pi(r,e){return[r,be(e)]}function oc(r,e,t){return[r,be(e),t]}const mm={},gm=["prefixPath","collectionGroup","readTime","documentId"],pm=["prefixPath","collectionGroup","documentId"],_m=["collectionGroup","readTime","prefixPath","documentId"],ym=["canonicalId","targetId"],Im=["targetId","path"],Tm=["path","targetId"],Em=["collectionId","parent"],vm=["indexId","uid"],Am=["uid","sequenceNumber"],wm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Rm=["indexId","uid","orderedDocumentKey"],Pm=["userId","collectionPath","documentId"],Vm=["userId","collectionPath","largestBatchId"],Sm=["userId","collectionGroup","largestBatchId"],ac=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],bm=[...ac,"documentOverlays"],uc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cc=uc,Gs=[...cc,"indexConfiguration","indexState","indexEntries"],xm=Gs,Cm=[...Gs,"globals"];class Ks extends ec{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ve(r,e){const t=F(r);return Xe.F(t._e,e)}function lc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function dc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class oe{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Re.RED,this.left=i??Re.EMPTY,this.right=s??Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Re(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fc(this.data.getIterator())}getIteratorFrom(e){return new fc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class fc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Tn(r){return r.hasNext()?r.getNext():void 0}class Ke{constructor(e){this.fields=e,e.sort(ue.comparator)}static empty(){return new Ke([])}unionWith(e){let t=new ne(ue.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _n(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class mc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class pe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new mc("Invalid base64 string: "+s):s}}(e);return new pe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new pe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pe.EMPTY_BYTE_STRING=new pe("");const Nm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ot(r){if(q(!!r),"string"==typeof r){let e=0;const t=Nm.exec(r);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:fe(r.seconds),nanos:fe(r.nanos)}}function fe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function at(r){return"string"==typeof r?pe.fromBase64String(r):pe.fromUint8Array(r)}function yi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ii(r){const e=r.mapValue.fields.__previous_value__;return yi(e)?Ii(e):e}function ur(r){const e=ot(r.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}class km{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class At{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new At("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof At&&e.projectId===this.projectId&&e.database===this.database}}const wt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ti={nullValue:"NULL_VALUE"};function Rt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?yi(r)?4:Ic(r)?9007199254740991:Ai(r)?10:11:L()}function et(r,e){if(r===e)return!0;const t=Rt(r);if(t!==Rt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ur(r).isEqual(ur(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=ot(i.timestampValue),u=ot(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,at(r.bytesValue).isEqual(at(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=fe(i.doubleValue),u=fe(s.doubleValue);return a===u?ar(a)===ar(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return _n(r.arrayValue.values||[],e.arrayValue.values||[],et);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(lc(a)!==lc(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!et(a[c],u[c])))return!1;return!0}(r,e);default:return L()}var s}function cr(r,e){return void 0!==(r.values||[]).find(t=>et(t,e))}function Pt(r,e){if(r===e)return 0;const t=Rt(r),n=Rt(e);if(t!==n)return j(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=fe(s.integerValue||s.doubleValue),c=fe(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return gc(r.timestampValue,e.timestampValue);case 4:return gc(ur(r),ur(e));case 5:return j(r.stringValue,e.stringValue);case 6:return function(s,a){const u=at(s),c=at(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=j(u[h],c[h]);if(0!==f)return f}return j(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=j(fe(s.latitude),fe(a.latitude));return 0!==u?u:j(fe(s.longitude),fe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return pc(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,h,f;const A=null===(u=(s.fields||{}).value)||void 0===u?void 0:u.arrayValue,x=null===(c=(a.fields||{}).value)||void 0===c?void 0:c.arrayValue,k=j((null===(h=A?.values)||void 0===h?void 0:h.length)||0,(null===(f=x?.values)||void 0===f?void 0:f.length)||0);return 0!==k?k:pc(A,x)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===wt.mapValue&&a===wt.mapValue)return 0;if(s===wt.mapValue)return 1;if(a===wt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){const _=j(c[g],f[g]);if(0!==_)return _;const A=Pt(u[c[g]],h[f[g]]);if(0!==A)return A}return j(c.length,f.length)}(r.mapValue,e.mapValue);default:throw L()}}function gc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return j(r,e);const t=ot(r),n=ot(e),i=j(t.seconds,n.seconds);return 0!==i?i:j(t.nanos,n.nanos)}function pc(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Pt(t[i],n[i]);if(s)return s}return j(t.length,n.length)}function En(r){return zs(r)}function zs(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ot(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?at(r.bytesValue).toBase64():"referenceValue"in r?O.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=zs(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${zs(t.fields[a])}`;return i+"}"}(r.mapValue):L()}function Qt(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function js(r){return!!r&&"integerValue"in r}function lr(r){return!!r&&"arrayValue"in r}function _c(r){return!!r&&"nullValue"in r}function yc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function vi(r){return!!r&&"mapValue"in r}function Ai(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function hr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return vt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=hr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Ic(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const Tc={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Fm(r){return"nullValue"in r?Ti:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Qt(At.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ai(r)?Tc:{mapValue:{}}:L()}function Mm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Qt(At.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Tc:"mapValue"in r?Ai(r)?{mapValue:{}}:wt:L()}function Ec(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function vc(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!vi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hr(t)}setAll(e){let t=ue.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=hr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());vi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];vi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){vt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Pe(hr(this.value))}}function Ac(r){const e=[];return vt(r.fields,(t,n)=>{const i=new ue([t]);if(vi(n)){const s=Ac(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Ke(e)}class ce{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new ce(e,0,G.min(),G.min(),G.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,i){return new ce(e,1,t,G.min(),n,i,0)}static newNoDocument(e,t){return new ce(e,2,t,G.min(),G.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new ce(e,3,t,G.min(),G.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vt{constructor(e,t){this.position=e,this.inclusive=t}}function wc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?O.comparator(O.fromName(a.referenceValue),t.key):Pt(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Rc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!et(r.position[t],e.position[t]))return!1;return!0}class dr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Om(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Pc{}class Y extends Pc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Lm(e,t,n):"array-contains"===t?new qm(e,n):"in"===t?new Dc(e,n):"not-in"===t?new Gm(e,n):"array-contains-any"===t?new Km(e,n):new Y(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Bm(e,n):new Um(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Pt(t,this.value)):null!==t&&Rt(this.value)===Rt(t)&&this.matchesComparison(Pt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class te extends Pc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new te(e,t)}matches(e){return vn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function vn(r){return"and"===r.op}function Qs(r){return"or"===r.op}function $s(r){return Vc(r)&&vn(r)}function Vc(r){for(const e of r.filters)if(e instanceof te)return!1;return!0}function Ws(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+En(r.value);if($s(r))return r.filters.map(e=>Ws(e)).join(",");{const e=r.filters.map(t=>Ws(t)).join(",");return`${r.op}(${e})`}}function Sc(r,e){return r instanceof Y?(n=r,(i=e)instanceof Y&&n.op===i.op&&n.field.isEqual(i.field)&&et(n.value,i.value)):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&Sc(a,i.filters[u]),!0)}(r,e):void L();var n,i}function bc(r,e){const t=r.filters.concat(e);return te.create(t,r.op)}function xc(r){return r instanceof Y?`${(t=r).field.canonicalString()} ${t.op} ${En(t.value)}`:r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(xc).join(" ,")+"}"}(r):"Filter";var t}class Lm extends Y{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class Bm extends Y{constructor(e,t){super(e,"in",t),this.keys=Cc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Um extends Y{constructor(e,t){super(e,"not-in",t),this.keys=Cc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Cc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>O.fromName(n.referenceValue))}class qm extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return lr(t)&&cr(t.arrayValue,this.value)}}class Dc extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&cr(this.value.arrayValue,t)}}class Gm extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(cr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!cr(this.value.arrayValue,t)}}class Km extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!lr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>cr(this.value.arrayValue,n))}}class zm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Hs(r,e=null,t=[],n=[],i=null,s=null,a=null){return new zm(r,e,t,n,i,s,a)}function $t(r){const e=F(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Ws(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),or(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>En(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>En(n)).join(",")),e.ue=t}return e.ue}function fr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Om(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Sc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Rc(r.startAt,e.startAt)&&Rc(r.endAt,e.endAt)}function wi(r){return O.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function Ri(r,e){return r.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function Nc(r,e,t){let n=Ti,i=!0;for(const s of Ri(r,e)){let a=Ti,u=!0;switch(s.op){case"<":case"<=":a=Fm(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ti}Ec({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Ec({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function kc(r,e,t){let n=wt,i=!0;for(const s of Ri(r,e)){let a=wt,u=!0;switch(s.op){case">=":case">":a=Mm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=wt}vc({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];vc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class ut{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function Fc(r,e,t,n,i,s,a,u){return new ut(r,e,t,n,i,s,a,u)}function An(r){return new ut(r)}function Mc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Js(r){return null!==r.collectionGroup}function wn(r){const e=F(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ne(ue.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new dr(s,n))}),t.has(ue.keyField().canonicalString())||e.ce.push(new dr(ue.keyField(),n))}return e.ce}function xe(r){const e=F(r);return e.le||(e.le=function Lc(r,e){if("F"===r.limitType)return Hs(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new dr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Vt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Vt(r.startAt.position,r.startAt.inclusive):null;return Hs(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,wn(r))),e.le}function Ys(r,e){const t=r.filters.concat([e]);return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Pi(r,e,t){return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function mr(r,e){return fr(xe(r),xe(e))&&r.limitType===e.limitType}function Bc(r){return`${$t(xe(r))}|lt:${r.limitType}`}function Rn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>xc(i)).join(", ")}]`),or(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>En(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>En(i)).join(",")),`Target(${n})`}(xe(r))}; limitType=${r.limitType})`}function gr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of wn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=wc(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,wn(n),i)||n.endAt&&!function(a,u,c){const h=wc(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,wn(n),i)));var n,i}function Uc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function qc(r){return(e,t)=>{let n=!1;for(const i of wn(r)){const s=jm(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function jm(r,e,t){const n=r.field.isKeyField()?O.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Pt(c,h):L()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}class ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return dc(this.inner)}size(){return this.innerSize}}const Qm=new oe(O.comparator);function ze(){return Qm}const Gc=new oe(O.comparator);function pr(...r){let e=Gc;for(const t of r)e=e.insert(t.key,t);return e}function Kc(r){let e=Gc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function tt(){return _r()}function zc(){return _r()}function _r(){return new ct(r=>r.toString(),(r,e)=>r.isEqual(e))}const $m=new oe(O.comparator),Wm=new ne(O.comparator);function Q(...r){let e=Wm;for(const t of r)e=e.add(t);return e}const Hm=new ne(j);function Xs(){return Hm}function Zs(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ar(e)?"-0":e}}function jc(r){return{integerValue:""+r}}function Qc(r,e){return rc(e)?jc(e):Zs(r,e)}class Vi{constructor(){this._=void 0}}function Jm(r,e,t){return r instanceof Pn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&yi(s)&&(s=Ii(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Wt?Wc(r,e):r instanceof Ht?Hc(r,e):function(i,s){const a=$c(i,s),u=Jc(a)+Jc(i.Pe);return js(a)&&js(i.Pe)?jc(u):Zs(i.serializer,u)}(r,e)}function Ym(r,e,t){return r instanceof Wt?Wc(r,e):r instanceof Ht?Hc(r,e):t}function $c(r,e){return r instanceof Vn?js(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Pn extends Vi{}class Wt extends Vi{constructor(e){super(),this.elements=e}}function Wc(r,e){const t=Yc(e);for(const n of r.elements)t.some(i=>et(i,n))||t.push(n);return{arrayValue:{values:t}}}class Ht extends Vi{constructor(e){super(),this.elements=e}}function Hc(r,e){let t=Yc(e);for(const n of r.elements)t=t.filter(i=>!et(i,n));return{arrayValue:{values:t}}}class Vn extends Vi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Jc(r){return fe(r.integerValue||r.doubleValue)}function Yc(r){return lr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class yr{constructor(e,t){this.field=e,this.transform=t}}class Zm{constructor(e,t){this.version=e,this.transformResults=t}}class me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new me}static exists(e){return new me(void 0,e)}static updateTime(e){return new me(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Si(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class bi{}function Xc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new bn(r.key,me.none()):new Sn(r.key,r.data,me.none());{const t=r.data,n=Pe.empty();let i=new ne(ue.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new lt(r.key,n,new Ke(i.toArray()),me.none())}}function eg(r,e,t){r instanceof Sn?function(i,s,a){const u=i.value.clone(),c=tl(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof lt?function(i,s,a){if(!Si(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=tl(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(el(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ir(r,e,t,n){return r instanceof Sn?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=s.value.clone(),f=nl(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof lt?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=nl(s.fieldTransforms,c,a),f=a.data;return f.setAll(el(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Si(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function tg(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=$c(n.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(n.field,s))}return t||null}function Zc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&_n(n,i,(s,a)=>function Xm(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Wt&&i instanceof Wt||n instanceof Ht&&i instanceof Ht?_n(n.elements,i.elements,et):n instanceof Vn&&i instanceof Vn?et(n.Pe,i.Pe):n instanceof Pn&&i instanceof Pn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Sn extends bi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class lt extends bi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function el(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function tl(r,e,t){const n=new Map;q(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,Ym(a,u,t[i]))}return n}function nl(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,Jm(s,a,e))}return n}class bn extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class eo extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class to{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&eg(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=zc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=Xc(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(G.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&_n(this.mutations,e.mutations,(t,n)=>Zc(t,n))&&_n(this.baseMutations,e.baseMutations,(t,n)=>Zc(t,n))}}class no{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){q(e.mutations.length===n.length);let i=function(){return $m}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new no(e,t,n,i)}}class ro{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ng{constructor(e,t){this.count=e,this.unchangedNames=t}}var Te,X;function il(r){switch(r){default:return L();case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0}}function sl(r){if(void 0===r)return ye("GRPC error has no .code"),V.UNKNOWN;switch(r){case Te.OK:return V.OK;case Te.CANCELLED:return V.CANCELLED;case Te.UNKNOWN:return V.UNKNOWN;case Te.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Te.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Te.INTERNAL:return V.INTERNAL;case Te.UNAVAILABLE:return V.UNAVAILABLE;case Te.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Te.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Te.NOT_FOUND:return V.NOT_FOUND;case Te.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Te.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Te.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Te.ABORTED:return V.ABORTED;case Te.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Te.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Te.DATA_LOSS:return V.DATA_LOSS;default:return L()}}(X=Te||(Te={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function ol(){return new TextEncoder}const rg=new Gt([4294967295,4294967295],0);function al(r){const e=ol().encode(r),t=new Bu;return t.update(e),new Uint8Array(t.digest())}function ul(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Gt([t,n],0),new Gt([i,s],0)]}class io{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Tr(`Invalid padding: ${t}`);if(n<0)throw new Tr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Tr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Tr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Gt.fromNumber(n)));return 1===i.compare(rg)&&(i=new Gt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=al(e),[n,i]=ul(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new io(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=al(e),[n,i]=ul(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Tr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Er{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,vr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Er(G.min(),i,new oe(j),ze(),Q())}}class vr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vr(n,t,Q(),Q(),Q())}}class Ci{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class cl{constructor(e,t){this.targetId=e,this.me=t}}class ll{constructor(e,t,n=pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class hl{constructor(){this.fe=0,this.ge=fl(),this.pe=pe.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Q(),t=Q(),n=Q();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:L()}}),new vr(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=fl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ig{constructor(e){this.Le=e,this.Be=new Map,this.ke=ze(),this.qe=dl(),this.Qe=new oe(j)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(wi(s))if(0===n){const a=new O(s.path);this.Ue(t,a,ce.newNoDocument(a,G.min()))}else q(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=at(n).toUint8Array()}catch(c){if(c instanceof mc)return Ge("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new io(a,i,s)}catch(c){return Ge(c instanceof Tr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&wi(u.target)){const c=new O(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,ce.newNoDocument(c,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=Q();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Er(e,t,this.Qe,this.ke,n);return this.ke=ze(),this.qe=dl(),this.Qe=new oe(j),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new hl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(j),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new hl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function dl(){return new oe(O.comparator)}function fl(){return new oe(O.comparator)}const sg={asc:"ASCENDING",desc:"DESCENDING"},og={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ag={and:"AND",or:"OR"};class ug{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function so(r,e){return r.useProto3Json||or(e)?e:{value:e}}function xn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ml(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function cg(r,e){return xn(r,e.toTimestamp())}function Ie(r){return q(!!r),G.fromTimestamp(function(t){const n=ot(t);return new de(n.seconds,n.nanos)}(r))}function oo(r,e){return ao(r,e).canonicalString()}function ao(r,e){const t=(i=r,new J(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function gl(r){const e=J.fromString(r);return q(Pl(e)),e}function Ar(r,e){return oo(r.databaseId,e.path)}function nt(r,e){const t=gl(e);if(t.get(1)!==r.databaseId.projectId)throw new C(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(yl(t))}function pl(r,e){return oo(r.databaseId,e)}function _l(r){const e=gl(r);return 4===e.length?J.emptyPath():yl(e)}function uo(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function yl(r){return q(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function Il(r,e,t){return{name:Ar(r,e),fields:t.value.mapValue.fields}}function Tl(r,e,t){const n=nt(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):G.min(),a=new Pe({mapValue:{fields:e.fields}}),u=ce.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function wr(r,e){let t;if(e instanceof Sn)t={update:Il(r,e.key,e.value)};else if(e instanceof bn)t={delete:Ar(r,e.key)};else if(e instanceof lt)t={update:Il(r,e.key,e.data),updateMask:_g(e.fieldMask)};else{if(!(e instanceof eo))return L();t={verify:Ar(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Wt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ht)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Vn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:cg(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:L()),t;var s}function co(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?me.updateTime(Ie(s.updateTime)):void 0!==s.exists?me.exists(s.exists):me.none():me.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(q("REQUEST_TIME"===u.setToServerValue),c=new Pn):"appendMissingElements"in u?c=new Wt(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Ht(u.removeAllFromArray.values||[]):"increment"in u?c=new Vn(a,u.increment):L();const h=ue.fromServerFormat(u.fieldPath);return new yr(h,c)}(r,i)):[];var s;if(e.update){const i=nt(r,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new Ke((e.updateMask.fieldPaths||[]).map(f=>ue.fromServerFormat(f)));return new lt(i,s,a,t,n)}return new Sn(i,s,t,n)}if(e.delete){const i=nt(r,e.delete);return new bn(i,t)}if(e.verify){const i=nt(r,e.verify);return new eo(i,t)}return L()}function El(r,e){return{documents:[pl(r,e.path)]}}function Di(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=pl(r,i);const s=function(h){if(0!==h.length)return Rl(te.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:St((_=f).field),direction:mg(_.dir)};var _})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=so(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Al(r){let e=_l(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){q(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const _=wl(g);return _ instanceof te&&$s(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(_=>{return new dr(Cn((x=_).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let u=null;t.limit&&(u=function(g){let _;return _="object"==typeof g?g.value:g,or(_)?null:_}(t.limit));let c=null;var g;t.startAt&&(c=new Vt((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new Vt(g.values||[],!g.before)}(t.endAt)),Fc(e,i,a,s,u,"F",c,h)}function wl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Cn(t.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Cn(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Cn(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Cn(t.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):void 0!==r.fieldFilter?Y.create(Cn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return te.create(t.compositeFilter.filters.map(n=>wl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(t.compositeFilter.op))}(r):L();var t}function mg(r){return sg[r]}function gg(r){return og[r]}function pg(r){return ag[r]}function St(r){return{fieldPath:r.canonicalString()}}function Cn(r){return ue.fromServerFormat(r.fieldPath)}function Rl(r){return r instanceof Y?function(t){if("=="===t.op){if(yc(t.value))return{unaryFilter:{field:St(t.field),op:"IS_NAN"}};if(_c(t.value))return{unaryFilter:{field:St(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(yc(t.value))return{unaryFilter:{field:St(t.field),op:"IS_NOT_NAN"}};if(_c(t.value))return{unaryFilter:{field:St(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:St(t.field),op:gg(t.op),value:t.value}}}(r):r instanceof te?function(t){const n=t.getFilters().map(i=>Rl(i));return 1===n.length?n[0]:{compositeFilter:{op:pg(t.op),filters:n}}}(r):L()}function _g(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Pl(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class ht{constructor(e,t,n,i,s=G.min(),a=G.min(),u=pe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new ht(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Vl{constructor(e){this.ct=e}}function Sl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ni(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Ar(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:xn(s,a.version.toTimestamp()),createTime:xn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Jt(e.version)};else{if(!e.isUnknownDocument())return L();n.unknownDocument={path:t.path.toArray(),version:Jt(e.version)}}var s,a;return n}function Ni(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Jt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yt(r){const e=new de(r.seconds,r.nanoseconds);return G.fromTimestamp(e)}function Xt(r,e){const t=(e.baseMutations||[]).map(s=>co(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>co(r.ct,s)),i=de.fromMillis(e.localWriteTimeMs);return new to(e.batchId,i,t,n)}function Rr(r){const e=Yt(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Yt(r.lastLimboFreeSnapshotVersion):G.min();let n;return n=void 0!==r.query.documents?(q(1===(s=r.query).documents.length),xe(An(_l(s.documents[0])))):function(s){return xe(Al(s))}(r.query),new ht(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,pe.fromBase64String(r.resumeToken));var s}function bl(r,e){const t=Jt(e.snapshotVersion),n=Jt(e.lastLimboFreeSnapshotVersion);let i;i=wi(e.target)?El(r.ct,e.target):Di(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:$t(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function lo(r){const e=Al({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Pi(e,e.limit,"L"):e}function ho(r,e){return new ro(e.largestBatchId,co(r.ct,e.overlayMutation))}function xl(r,e){const t=e.path.lastSegment();return[r,be(e.path.popLast()),t]}function Cl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Jt(n.readTime),documentKey:be(n.documentKey.path),largestBatchId:n.largestBatchId}}class Ig{getBundleMetadata(e,t){return Dl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Yt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Dl(e).put({bundleId:(i=t).id,createTime:Jt(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Nl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:lo(s.bundledQuery),readTime:Yt(s.readTime)};var s})}saveNamedQuery(e,t){return Nl(e).put({name:(i=t).name,readTime:Jt(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Dl(r){return ve(r,"bundles")}function Nl(r){return ve(r,"namedQueries")}class ki{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new ki(e,t.uid||"")}getOverlay(e,t){return Pr(e).get(xl(this.userId,t)).next(n=>n?ho(this.serializer,n):null)}getOverlays(e,t){const n=tt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new ro(t,a);i.push(this.ht(e,u))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(be(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Pr(e).j("collectionPathOverlayIndex",u))}),R.waitFor(s)}getOverlaysForCollection(e,t,n){const i=tt(),s=be(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Pr(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=ho(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=tt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const g=ho(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Pr(e).put(function(i,s,a){const[u,c,h]=xl(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:wr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function Pr(r){return ve(r,"documentOverlays")}class Tg{Pt(e){return ve(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t?.value;return n?pe.fromUint8Array(n):pe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Zt{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(fe(e.integerValue));else if("doubleValue"in e){const n=fe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ar(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=ot(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(at(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Ic(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ai(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):L()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const a="value",u=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(fe(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),O.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function Eg(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function kl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=Eg(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}Zt.vt=new Zt;class vg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=kl(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=kl(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Ag{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class wg{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Vr{constructor(){this.jt=new vg,this.Ht=new Ag(this.jt),this.Jt=new wg(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class en{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new en(this.indexId,this.documentKey,this.arrayValue,n)}}function bt(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Fl(r.arrayValue,e.arrayValue),0!==t?t:(t=Fl(r.directionalValue,e.directionalValue),0!==t?t:O.comparator(r.documentKey,e.documentKey)))}function Fl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Ml{constructor(e){this.Xt=new ne((t,n)=>ue.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(q(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Ls(e);if(void 0!==t&&!this.sn(t))return!1;const n=Kt(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.on(u,c)||!this._n(this.en[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.en.length||!this._n(this.en[a++],n[s]))return!1;return!0}an(){if(this.nn)return null;let e=new ne(ue.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new zt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new zt(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new zt(n.field,"asc"===n.dir?0:1)));return new yn(yn.UNKNOWN_ID,this.collectionId,t,In.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Ol(r){var e,t;if(q(r instanceof Y||r instanceof te),r instanceof Y){if(r instanceof Dc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}const n=r.filters.map(i=>Ol(i));return te.create(n,r.op)}function Rg(r){if(0===r.getFilters().length)return[];const e=go(Ol(r));return q(Ll(e)),fo(e)||mo(e)?[e]:e.getFilters()}function fo(r){return r instanceof Y}function mo(r){return r instanceof te&&$s(r)}function Ll(r){return fo(r)||mo(r)||function(t){if(t instanceof te&&Qs(t)){for(const n of t.getFilters())if(!fo(n)&&!mo(n))return!1;return!0}return!1}(r)}function go(r){if(q(r instanceof Y||r instanceof te),r instanceof Y)return r;if(1===r.filters.length)return go(r.filters[0]);const e=r.filters.map(n=>go(n));let t=te.create(e,r.op);return t=Fi(t),Ll(t)?t:(q(t instanceof te),q(vn(t)),q(t.filters.length>1),t.filters.reduce((n,i)=>po(n,i)))}function po(r,e){let t;return q(r instanceof Y||r instanceof te),q(e instanceof Y||e instanceof te),t=r instanceof Y?e instanceof Y?te.create([r,e],"and"):Bl(r,e):e instanceof Y?Bl(e,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),vn(i)&&vn(s))return bc(i,s.getFilters());const a=Qs(i)?i:s,u=Qs(i)?s:i,c=a.filters.map(h=>po(h,u));return te.create(c,"or")}(r,e),Fi(t)}function Bl(r,e){if(vn(e))return bc(e,r.getFilters());{const t=e.filters.map(n=>po(r,n));return te.create(t,"or")}}function Fi(r){if(q(r instanceof Y||r instanceof te),r instanceof Y)return r;const e=r.getFilters();if(1===e.length)return Fi(e[0]);if(Vc(r))return r;const t=e.map(i=>Fi(i)),n=[];return t.forEach(i=>{i instanceof Y?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:te.create(n,r.op)}class Pg{constructor(){this.un=new _o}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(je.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(je.min())}updateCollectionGroup(e,t,n){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class _o{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ne(J.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ne(J.comparator)).toArray()}}const Mi=new Uint8Array(0);class Vg{constructor(e,t){this.databaseId=t,this.cn=new _o,this.ln=new ct(n=>$t(n),(n,i)=>fr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:n,parent:be(i)};return Ul(e).put(s)}return R.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Ju(t),""],!1,!0);return Ul(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(Ze(a.parent))}return n})}addFieldIndex(e,t){const n=Sr(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Nn(e);return s.next(u=>{a.put(Cl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Sr(e),i=Nn(e),s=Dn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Sr(e),n=Dn(e),i=Nn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Ml(n).an();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Dn(e);let i=!0;const s=new Map;return R.forEach(this.hn(t),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=Q();const u=[];return R.forEach(s,(c,h)=>{var U;N("IndexedDbIndexManager",`Using index ${U=c,`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`} to execute ${$t(t)}`);const f=function(U,z){const H=Ls(z);if(void 0===H)return null;for(const $ of Ri(U,H.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(h,c),g=function(U,z){const H=new Map;for(const $ of Kt(z))for(const T of Ri(U,$.fieldPath))switch(T.op){case"==":case"in":H.set($.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return H.set($.fieldPath.canonicalString(),T.value),Array.from(H.values())}return null}(h,c),_=function(U,z){const H=[];let $=!0;for(const T of Kt(z)){const p=0===T.kind?Nc(U,T.fieldPath,U.startAt):kc(U,T.fieldPath,U.startAt);H.push(p.value),$&&($=p.inclusive)}return new Vt(H,$)}(h,c),A=function(U,z){const H=[];let $=!0;for(const T of Kt(z)){const p=0===T.kind?kc(U,T.fieldPath,U.endAt):Nc(U,T.fieldPath,U.endAt);H.push(p.value),$&&($=p.inclusive)}return new Vt(H,$)}(h,c),x=this.In(c,h,_),k=this.In(c,h,A),D=this.Tn(c,h,g),B=this.En(c.indexId,f,x,_.inclusive,k,A.inclusive,D);return R.forEach(B,K=>n.G(K,t.limit).next(U=>{U.forEach(z=>{const H=O.fromSegments(z.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Rg(te.create(e.filters,"and")).map(n=>Hs(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let g=0;g<c;++g){const _=t?this.dn(t[g/h]):Mi,A=this.An(e,_,n[g%h],i),x=this.Rn(e,_,s[g%h],a),k=u.map(D=>this.An(e,_,D,!0));f.push(...this.createRange(A,x,k))}return f}An(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new Ml(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new ne(ue.comparator),f=!1;for(const g of c.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?f=!0:h=h.add(_.field));for(const g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new Vr;for(const i of Kt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Yt(i.kind);Zt.vt.It(s,a)}return n.zt()}dn(e){const t=new Vr;return Zt.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new Vr;return Zt.vt.It(Qt(this.databaseId,t),n.Yt(function(s){const a=Kt(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new Vr);let s=0;for(const a of Kt(e)){const u=n[s++];for(const c of i)if(this.fn(t,a.fieldPath)&&lr(u))i=this.gn(i,a,u);else{const h=c.Yt(a.kind);Zt.vt.It(u,h)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new Vr;c.seed(u.zt()),Zt.vt.It(a,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof Y&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Sr(e),i=Nn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){const _=g?new In(g.sequenceNumber,new je(Yt(g.readTime),new O(Ze(g.documentKey)),g.largestBatchId)):In.empty(),A=f.fields.map(([x,k])=>new zt(ue.fromServerFormat(x),k));return new yn(f.indexId,f.collectionGroup,A,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:j(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Sr(e),s=Nn(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>R.forEach(u,c=>s.put(Cl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return R.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),R.forEach(u,c=>this.wn(e,i,c).next(h=>{const f=this.Sn(s,c);return h.isEqual(f)?R.resolve():this.bn(e,s,c,h,f)}))))})}Dn(e,t,n,i){return Dn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Dn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=Dn(e);let s=new ne(bt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,u)=>{s=s.add(new en(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new ne(bt);const i=this.Vn(t,e);if(null==i)return n;const s=Ls(t);if(null!=s){const a=e.data.field(s.fieldPath);if(lr(a))for(const u of a.arrayValue.values||[])n=n.add(new en(t.indexId,e.key,this.dn(u),i))}else n=n.add(new en(t.indexId,e.key,Mi,i));return n}bn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,g,_){const A=c.getIterator(),x=h.getIterator();let k=Tn(A),D=Tn(x);for(;k||D;){let B=!1,K=!1;if(k&&D){const U=f(k,D);U<0?K=!0:U>0&&(B=!0)}else null!=k?K=!0:B=!0;B?(g(D),D=Tn(x)):K?(_(k),k=Tn(A)):(k=Tn(A),D=Tn(x))}}(i,s,bt,u=>{a.push(this.Dn(e,t,n,u))},u=>{a.push(this.vn(e,t,n,u))}),R.waitFor(a)}yn(e){let t=1;return Nn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>bt(a,u)).filter((a,u,c)=>!u||0!==bt(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=bt(a,e),c=bt(a,t);if(0===u)i[0]=e.Zt();else if(u>0&&c<0)i.push(a),i.push(a.Zt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Mi,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Mi,[]]))}return s}Cn(e,t){return bt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ql)}getMinOffset(e,t){return R.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||L())).next(ql)}}function Ul(r){return ve(r,"collectionParents")}function Dn(r){return ve(r,"indexEntries")}function Sr(r){return ve(r,"indexConfiguration")}function Nn(r){return ve(r,"indexState")}function ql(r){q(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Bs(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new je(e.readTime,e.documentKey,t)}const Gl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Kl(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{q(1===u)}));const h=[];for(const f of t.mutations){const g=oc(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function Oi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw L();e=r.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Li{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){q(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Li(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=kn(e),a=xt(e);return a.add({}).next(u=>{q("number"==typeof u);const c=new to(u,t,n,i),h=function(A,x,k){const D=k.baseMutations.map(K=>wr(A.ct,K)),B=k.mutations.map(K=>wr(A.ct,K));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:B}}(this.serializer,this.userId,c),f=[];let g=new ne((_,A)=>j(_.canonicalString(),A.canonicalString()));for(const _ of i){const A=oc(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(h)),f.push(s.put(A,mm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return xt(e).get(t).next(n=>n?(q(n.userId===this.userId),Xt(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return xt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(q(u.batchId>=n),s=Xt(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return xt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).U("userMutationsIndex",t).next(n=>n.map(i=>Xt(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=pi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return kn(e).J({range:i},(a,u,c)=>{const[h,f,g]=a,_=Ze(f);if(h===this.userId&&t.path.isEqual(_))return xt(e).get(g).next(A=>{if(!A)throw L();q(A.userId===this.userId),s.push(Xt(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);const i=[];return t.forEach(s=>{const a=pi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=kn(e).J({range:u},(h,f,g)=>{const[_,A,x]=h,k=Ze(A);_===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(c)}),R.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=pi(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new ne(j);return kn(e).J({range:a},(c,h,f)=>{const[g,_,A]=c,x=Ze(_);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(A)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(xt(e).get(s).next(a=>{if(null===a)throw L();q(a.userId===this.userId),n.push(Xt(this.serializer,a))}))}),R.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Kl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return kn(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=Ze(s[1]);i.push(c)}else u.done()}).next(()=>{q(0===i.length)})})}containsKey(e,t){return zl(e,this.userId,t)}Nn(e){return jl(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function zl(r,e,t){const n=pi(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return kn(r).J({range:s,H:!0},(u,c,h)=>{const[f,g,_]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function xt(r){return ve(r,"mutations")}function kn(r){return ve(r,"documentMutations")}function jl(r){return ve(r,"mutationQueues")}class tn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new tn(0)}static kn(){return new tn(-1)}}class Sg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new tn(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>G.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fn(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Fn(e).J((a,u)=>{const c=Rr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Fn(e).J((n,i)=>{const s=Rr(i);t(s)})}qn(e){return Ql(e).get("targetGlobalKey").next(t=>(q(null!==t),t))}Qn(e,t){return Ql(e).put("targetGlobalKey",t)}Kn(e,t){return Fn(e).put(bl(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=$t(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Fn(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Rr(u);fr(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Ct(e);return t.forEach(a=>{const u=be(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),R.waitFor(i)}removeMatchingKeys(e,t,n){const i=Ct(e);return R.forEach(t,s=>{const a=be(s.path);return R.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Ct(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ct(e);let s=Q();return i.J({range:n,H:!0},(a,u,c)=>{const h=Ze(a[1]),f=new O(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=be(t.path),i=IDBKeyRange.bound([n],[Ju(n)],!1,!0);let s=0;return Ct(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Fn(e).get(t).next(n=>n?Rr(n):null)}}function Fn(r){return ve(r,"targets")}function Ql(r){return ve(r,"targetGlobal")}function Ct(r){return ve(r,"targetDocuments")}function $l([r,e],[t,n]){const i=j(r,t);return 0===i?j(e,n):i}class bg{constructor(e){this.Un=e,this.buffer=new ne($l),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();$l(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Wl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Et(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Tt(n)}yield t.Hn(3e5)}))}}class xg{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return R.resolve(Qe.oe);const n=new bg(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Gl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Gl):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),pn()<=Ye.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Cg{constructor(e,t){this.db=e,this.garbageCollector=function Hl(r,e){return new xg(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return Bi(e,n)}removeReference(e,t,n){return Bi(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Bi(e,t)}nr(e,t){return function(i,s){let a=!1;return jl(i).Y(u=>zl(i,u,s).next(c=>(c&&(a=!0),R.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(a,u)=>{if(u<=t){const c=this.nr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,G.min()),Ct(e).delete([0,be(a.path)])))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Bi(e,t)}tr(e,t){const n=Ct(e);let i,s=Qe.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==Qe.oe&&t(new O(Ze(i)),s),s=h,i=c):s=Qe.oe}).next(()=>{s!==Qe.oe&&t(new O(Ze(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bi(r,e){return Ct(r).put((i=r.currentSequenceNumber,{targetId:0,path:be(e.path),sequenceNumber:i}));var i}class Jl{constructor(){this.changes=new ct(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?R.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Dg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return nn(e).put(n)}removeEntry(e,t,n){return nn(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ni(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ce.newInvalidDocument(t);return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:ce.newInvalidDocument(t)};return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(t))},(i,s)=>{n={document:this.ir(t,s),size:Oi(s)}}).next(()=>n)}getEntries(e,t){let n=ze();return this._r(e,t,(i,s)=>{const a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(e,t){let n=ze(),i=new oe(O.comparator);return this._r(e,t,(s,a)=>{const u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,Oi(a))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return R.resolve();let i=new ne(eh);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(br(i.first()),br(i.last())),a=i.getIterator();let u=a.getNext();return nn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const g=O.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&eh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(br(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Ni(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=ze();for(const g of h){const _=this.ir(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(gr(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=ze();const a=Zl(t,n),u=Zl(t,je.max());return nn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const g=this.ir(O.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Ng(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Xl(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}rr(e,t){return Xl(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function yg(r,e){let t;if(e.document)t=Tl(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=O.fromSegments(e.noDocument.path),i=Yt(e.noDocument.readTime);t=ce.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return L();{const n=O.fromSegments(e.unknownDocument.path),i=Yt(e.unknownDocument.version);t=ce.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new de(i[0],i[1]);return G.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(G.min()))return n}return ce.newInvalidDocument(e)}}function Yl(r){return new Dg(r)}class Ng extends Jl{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ct(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ne((s,a)=>j(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=Sl(this.cr.serializer,a);i=i.add(s.path.popLast());const h=Oi(c);n+=h-u.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=Sl(this.cr.serializer,a.convertToNoDocument(G.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function Xl(r){return ve(r,"remoteDocumentGlobal")}function nn(r){return ve(r,"remoteDocumentsV14")}function br(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Zl(r,e){const t=e.documentKey.path.toArray();return[r,Ni(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function eh(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=j(t[s],n[s]),i)return i;return i=j(t.length,n.length),i||(i=j(t[t.length-2],n[n.length-2]),i||j(t[t.length-1],n[n.length-1]))}class kg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class th{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Ir(n.mutation,i,Ke.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Q()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Q()){const i=tt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=pr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=tt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Q()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=ze();const a=_r(),u=_r();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof lt)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Ir(f.mutation,h,f.mutation.getFieldMask(),de.now())):a.set(h.key,Ke.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new kg(f,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=_r();let i=new oe((a,u)=>a-u),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||Ke.empty();f=u.applyToLocalView(h,f),n.set(c,f);const g=(i.get(u.batchId)||Q()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,g=zc();f.forEach(_=>{if(!s.has(_)){const A=Xc(t.get(_),n.get(_));null!==A&&g.set(_,A),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return R.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return O.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Js(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):R.resolve(tt());let u=-1,c=s;return a.next(h=>R.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,Q())).next(f=>({batchId:u,changes:Kc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let i=pr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=pr();return this.indexManager.getCollectionParents(e,s).next(u=>R.forEach(u,c=>{const h=(g=t,_=c.child(s),new ut(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,ce.newInvalidDocument(f)))});let u=pr();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Ir(f.mutation,h,Ke.empty(),de.now()),gr(t,h)&&(u=u.insert(c,h))}),u})}}class Fg{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),R.resolve();var i}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:lo(i.bundledQuery),readTime:Ie(i.readTime)}),R.resolve();var i}}class Mg{constructor(){this.overlays=new oe(O.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),R.resolve()}getOverlaysForCollection(e,t,n){const i=tt(),s=t.length+1,a=new O(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new oe((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=tt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=tt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return R.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ro(t,n));let s=this.Ir.get(t);void 0===s&&(s=Q(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class Og{constructor(){this.sessionToken=pe.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class yo{constructor(){this.Tr=new ne(we.Er),this.dr=new ne(we.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new we(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new we(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1);let s=Q();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new we(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class we{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return O.comparator(e.key,t.key)||j(e.wr,t.wr)}static Ar(e,t){return j(e.wr,t.wr)||O.comparator(e.key,t.key)}}class Lg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ne(we.Er)}checkEmpty(e){return R.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++;const a=new to(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.br=this.br.add(new we(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{const u=this.Dr(a.wr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);return t.forEach(i=>{const s=new we(i,0),a=new we(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),R.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;O.isDocumentKey(s)||(s=s.child(""));const a=new we(new O(s),0);let u=new ne(j);return this.br.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.wr)),!0)},a),R.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){q(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return R.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new we(t,0),i=this.br.firstAfterOrEqual(n);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Bg{constructor(e){this.Mr=e,this.docs=new oe(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return R.resolve(n?n.document.mutableCopy():ce.newInvalidDocument(t))}getEntries(e,t){let n=ze();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ce.newInvalidDocument(i))}),R.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=ze();const a=t.path,u=new O(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Bs(Xu(f),n)<=0||(i.has(f.key)||gr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,n,i){L()}Or(e,t){return R.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Ug(this)}getSize(e){return R.resolve(this.size)}}class Ug extends Jl{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class qg{constructor(e){this.persistence=e,this.Nr=new ct(t=>$t(t),fr),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.Lr=0,this.Br=new yo,this.targetCount=0,this.kr=tn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new tn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return R.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),R.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return R.resolve(n)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}}class Io{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Qe(0),this.Kr=!1,this.Kr=!0,this.$r=new Og,this.referenceDelegate=e(this),this.Ur=new qg(this),this.indexManager=new Pg,this.remoteDocumentCache=new Bg(n=>this.referenceDelegate.Wr(n)),this.serializer=new Vl(t),this.Gr=new Fg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Mg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Lg(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new Gg(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Gg extends ec{constructor(e){super(),this.currentSequenceNumber=e}}class Ui{constructor(e){this.persistence=e,this.Jr=new yo,this.Yr=null}static Zr(e){return new Ui(e)}get Xr(){if(this.Yr)return this.Yr;throw L()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),R.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,n=>{const i=O.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Kg{constructor(e){this.serializer=e}O(e,t,n,i){const s=new gi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sc,{unique:!0}),c.createObjectStore("documentMutations"),nh(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=R.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),nh(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sc,{unique:!0});const g=h.store("mutations"),_=f.map(A=>g.put(A));return R.waitFor(_)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:Pm});h.createIndex("collectionPathOverlayIndex",Vm,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Sm,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:gm});h.createIndex("documentKeyIndex",pm),h.createIndex("collectionGroupIndex",_m)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:vm}).createIndex("sequenceNumberIndex",Am,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:wm}).createIndex("documentKeyIndex",Rm,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{!function(c){c.createObjectStore("globals",{keyPath:"name"})}(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Oi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>R.forEach(u,c=>{q(c.userId===s.userId);const h=Xt(this.serializer,c);return Kl(e,s.userId,h).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new J(a),h=[0,be(c)];s.push(t.get(h).next(f=>f?R.resolve():t.put({targetId:0,path:be(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Em});const n=t.store("collectionParents"),i=new _o,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:be(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new J(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=Ze(u);return s(f.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const s=Rr(i),a=bl(this.serializer,s);return t.put(a)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(g=a,g.document?new O(J.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>R.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=Yl(this.serializer),s=new Io(Ui.Zr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:Q();Xt(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{const f=new Ae(h),g=ki.lt(this.serializer,f),_=s.getIndexManager(f),A=Li.lt(f,this.serializer,_,s.referenceDelegate);return new th(i,A,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Ks(t,Qe.oe),c).next()})})}}function nh(r){r.createObjectStore("targetDocuments",{keyPath:Im}).createIndex("documentTargetsIndex",Tm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ym,{unique:!0}),r.createObjectStore("targetGlobal")}const To="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Eo{constructor(e,t,n,i,s,a,u,c,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=h,this.li=f,this.hi=g,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!Eo.D())throw new C(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cg(this,i),this.Ai=t+"main",this.serializer=new Vl(c),this.Ri=new Xe(this.Ai,this.hi,new Kg(this.serializer)),this.$r=new Tg,this.Ur=new Sg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Yl(this.serializer),this.Gr=new Ig,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===f&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(V.FAILED_PRECONDITION,To);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Qe(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,b.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,b.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,b.A)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Gi(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Et(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return xr(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return Gi(e).delete(this.clientId)}Fi(){var e=this;return(0,b.A)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ve(n,"clientMetadata");return i.U().next(s=>{const a=e.xi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return R.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):xr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new C(V.FAILED_PRECONDITION,To);return!1}}return!(!this.networkEnabled||!this.inForeground)||Gi(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.A)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Ks(t,Qe.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Gi(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Li.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ki.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(c=this.hi)?Cm:16===c?xm:15===c?Gs:14===c?cc:13===c?uc:12===c?bm:11===c?ac:void L();var c;let a;return this.Ri.runTransaction(e,i,s,u=>(a=new Ks(u,this.Qr?this.Qr.next():Qe.oe),"readwrite-primary"===t?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new C(V.FAILED_PRECONDITION,Zu);return n(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return xr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(V.FAILED_PRECONDITION,To)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xr(e).put("owner",t)}static D(){return Xe.D()}bi(e){const t=xr(e);return t.get("owner").next(n=>this.vi(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,ee.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function xr(r){return ve(r,"owner")}function Gi(r){return ve(r,"clientMetadata")}function vo(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Ao{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=Q(),i=Q();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ao(e,t.fromCache,n,i)}}class zg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rh{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,ee.nr)()?8:tc((0,ee.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new zg;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Rn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Query:",Rn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Rn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xe(t))):R.resolve())}Yi(e,t){if(Mc(t))return R.resolve(null);let n=xe(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Pi(t,null,"F"),n=xe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=Q(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.ts(t,u);return this.ns(t,h,a,c.readTime)?this.Yi(e,Pi(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,n,i){return Mc(t)||i.isEqual(G.min())?R.resolve(null):this.Ji.getDocuments(e,n).next(s=>{const a=this.ts(t,s);return this.ns(t,a,n,i)?R.resolve(null):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Rn(t)),this.rs(e,a,t,Yu(i,-1)).next(u=>u))})}ts(e,t){let n=new ne(qc(e));return t.forEach((i,s)=>{gr(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return pn()<=Ye.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Rn(t)),this.Ji.getDocumentsMatchingQuery(e,t,je.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class jg{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new oe(j),this._s=new ct(s=>$t(s),fr),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new th(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function ih(r,e,t,n){return new jg(r,e,t,n)}function sh(r,e){return wo.apply(this,arguments)}function wo(){return(wo=(0,b.A)(function*(r,e){const t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=Q();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({hs:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function oh(r){const e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ah(r,e,t){let n=Q(),i=Q();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=ze();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ps:a,Is:i}})}function Wg(r,e){const t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Mn(r,e){const t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(n).next(a=>(i=new ht(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function On(r,e,t){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,b.A)(function*(r,e,t){const n=F(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Et(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function Ki(r,e,t){const n=F(r);let i=G.min(),s=Q();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const g=F(c),_=g._s.get(f);return void 0!==_?R.resolve(g.os.get(_)):g.Ur.getTargetData(h,f)}(n,a,xe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?i:G.min(),t?s:Q())).next(u=>(lh(n,Uc(e),u),{documents:u,Ts:s})))}function uh(r,e){const t=F(r),n=F(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function ch(r,e){const t=F(r),n=t.us.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,Yu(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(lh(t,e,i),i))}function lh(r,e,t){let n=r.us.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function Po(){return(Po=(0,b.A)(function*(r,e,t,n){const i=F(r);let s=Q(),a=ze();for(const h of t){const f=e.Es(h.metadata.name);h.document&&(s=s.add(f));const g=e.ds(h);g.setReadTime(e.As(h.metadata.readTime)),a=a.insert(f,g)}const u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Mn(i,(f=n,xe(An(J.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>ah(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})).apply(this,arguments)}function Jg(r,e){return Vo.apply(this,arguments)}function Vo(){return(Vo=(0,b.A)(function*(r,e,t=Q()){const n=yield Mn(r,xe(lo(e.bundledQuery))),i=F(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ie(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Gr.saveNamedQuery(s,e);const u=n.withResumeToken(pe.EMPTY_BYTE_STRING,a);return i.os=i.os.insert(u.targetId,u),i.Ur.updateTargetData(s,u).next(()=>i.Ur.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Ur.addMatchingKeys(s,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})})).apply(this,arguments)}function hh(r,e){return`firestore_clients_${r}_${e}`}function dh(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function So(r,e){return`firestore_targets_${r}_${e}`}class zi{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new zi(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new Cr(e,n.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ji{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Xs();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=rc(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new ji(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class bo{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new bo(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class xo{constructor(){this.activeTargetIds=Xs()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Co{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new oe(j),this.started=!1,this.bs=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=hh(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new xo),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.A)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const s=e.getItem(hh(e.persistenceKey,i));if(s){const a=ji.Rs(i,s);a&&(e.Ss=e.Ss.insert(a.clientId,a))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(So(this.persistenceKey,e));if(n){const i=Cr.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(So(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,b.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(a){let u=Qe.oe;if(null!=a)try{const c=JSON.parse(a);q("number"==typeof c),u=c}catch(c){ye("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==Qe.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.eo(s)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new zi(this.currentUser,e,t,n),s=dh(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=dh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=So(this.persistenceKey,e),s=new Cr(e,t,n);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return ji.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return zi.Rs(new Ae(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return Cr.Rs(i,t)}Ls(e){return bo.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,b.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Xs();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class fh{constructor(){this.so=new xo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new xo,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Yg{_o(e){}shutdown(){}}class mh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Qi=null;function Do(){return null===Qi?Qi=268435456+Math.round(2147483648*Math.random()):Qi++,"0x"+Qi.toString(16)}const Xg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Zg{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const De="WebChannelConnection";class ep extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,a){const u=Do(),c=this.xo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,a),this.No(t,c,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ge("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(t,n,i,s,a,u){return this.Mo(t,n,i,s,a)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+gn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,n){return`${this.Do}/v1/${n}:${Xg[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=Do();return new Promise((a,u)=>{const c=new Uu;c.setWithCredentials(!0),c.listenOnce(Gu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case mi.NO_ERROR:const f=c.getResponseJson();N(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case mi.TIMEOUT:N(De,`RPC '${e}' ${s} timed out`),u(new C(V.DEADLINE_EXCEEDED,"Request time out"));break;case mi.HTTP_ERROR:const g=c.getStatus();if(N(De,`RPC '${e}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);const A=_?.error;if(A&&A.status&&A.message){const x=function(D){const B=D.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(B)>=0?B:V.UNKNOWN}(A.status);u(new C(x,A.message))}else u(new C(V.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new C(V.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{N(De,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(De,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Bo(e,t,n){const i=Do(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=ju(),u=zu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new qu({})),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");N(De,`Creating RPC '${e}' stream ${i}: ${f}`,c);const g=a.createWebChannel(f,c);let _=!1,A=!1;const x=new Zg({Io:D=>{A?N(De,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(N(De,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),N(De,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},To:()=>g.close()}),k=(D,B,K)=>{D.listen(B,U=>{try{K(U)}catch(z){setTimeout(()=>{throw z},0)}})};return k(g,rr.EventType.OPEN,()=>{A||(N(De,`RPC '${e}' stream ${i} transport opened.`),x.yo())}),k(g,rr.EventType.CLOSE,()=>{A||(A=!0,N(De,`RPC '${e}' stream ${i} transport closed`),x.So())}),k(g,rr.EventType.ERROR,D=>{A||(A=!0,Ge(De,`RPC '${e}' stream ${i} transport errored:`,D),x.So(new C(V.UNAVAILABLE,"The operation could not be completed")))}),k(g,rr.EventType.MESSAGE,D=>{var B;if(!A){const K=D.data[0];q(!!K);const z=K.error||(null===(B=K[0])||void 0===B?void 0:B.error);if(z){N(De,`RPC '${e}' stream ${i} received error:`,z);const H=z.status;let $=function(I){const E=Te[I];if(void 0!==E)return sl(E)}(H),T=z.message;void 0===$&&($=V.INTERNAL,T="Unknown error status: "+H+" with message "+z.message),A=!0,x.So(new C($,T)),g.close()}else N(De,`RPC '${e}' stream ${i} received:`,K),x.bo(K)}}),k(u,Ku.STAT_EVENT,D=>{D.stat===Ms.PROXY?N(De,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Ms.NOPROXY&&N(De,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}function gh(){return typeof window<"u"?window:null}function $i(){return typeof document<"u"?document:null}function Dr(r){return new ug(r,!0)}class No{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class ph{constructor(e,t,n,i,s,a,u,c){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new No(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,b.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,b.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===V.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new C(V.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,b.A)(function*(){e.state=0,e.start()}))}I_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class tp extends ph{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function hg(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:L(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(q(void 0===f||"string"==typeof f),pe.fromBase64String(f||"")):(q(void 0===f||f instanceof Buffer||f instanceof Uint8Array),pe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?V.UNKNOWN:sl(h.code);return new C(f,h.message||"")}(a);t=new ll(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=nt(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):G.min(),u=new Pe({mapValue:{fields:n.document.fields}}),c=ce.newFoundDocument(i,s,a,u);t=new Ci(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=nt(r,n.document),s=n.readTime?Ie(n.readTime):G.min(),a=ce.newNoDocument(i,s);t=new Ci([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=nt(r,n.document);t=new Ci([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return L();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new ng(i,s);t=new cl(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return G.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?Ie(a.readTime):G.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=uo(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=wi(c)?{documents:El(s,c)}:{query:Di(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ml(s,a.resumeToken);const h=so(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(G.min())>0){u.readTime=xn(s,a.snapshotVersion.toTimestamp());const h=so(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function fg(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=uo(this.serializer),t.removeTarget=e,this.a_(t)}}class np extends ph{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return q(!!e.streamToken),this.lastStreamToken=e.streamToken,q(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function dg(r,e){return r&&r.length>0?(q(void 0!==e),r.map(t=>function(i,s){let a=Ie(i.updateTime?i.updateTime:s);return a.isEqual(G.min())&&(a=Ie(s)),new Zm(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=uo(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>wr(this.serializer,n))};this.a_(t)}}class rp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new C(V.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,ao(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(V.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,ao(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(V.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ip{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ye(t),this.D_=!1):N("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class sp{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(u=>{n.enqueueAndForget((0,b.A)(function*(){var c;Dt(a)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,b.A)(function*(f){const g=F(f);g.L_.add(4),yield Ln(g),g.q_.set("Unknown"),g.L_.delete(4),yield Nr(g)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.q_=new ip(n,i)}}function Nr(r){return ko.apply(this,arguments)}function ko(){return(ko=(0,b.A)(function*(r){if(Dt(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Ln(r){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,b.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Wi(r,e){const t=F(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Lo(t)?Oo(t):qn(t).r_()&&Mo(t,e))}function Bn(r,e){const t=F(r),n=qn(t);t.N_.delete(e),n.r_()&&_h(t,e),0===t.N_.size&&(n.r_()?n.o_():Dt(t)&&t.q_.set("Unknown"))}function Mo(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qn(r).A_(e)}function _h(r,e){r.Q_.xe(e),qn(r).R_(e)}function Oo(r){r.Q_=new ig({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),qn(r).start(),r.q_.v_()}function Lo(r){return Dt(r)&&!qn(r).n_()&&r.N_.size>0}function Dt(r){return 0===F(r).L_.size}function yh(r){r.Q_=void 0}function op(r){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,b.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function ap(r){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,b.A)(function*(r){r.N_.forEach((e,t)=>{Mo(r,e)})})).apply(this,arguments)}function up(r,e){return qo.apply(this,arguments)}function qo(){return(qo=(0,b.A)(function*(r,e){yh(r),Lo(r)?(r.q_.M_(e),Oo(r)):r.q_.set("Unknown")})).apply(this,arguments)}function cp(r,e,t){return Go.apply(this,arguments)}function Go(){return Go=(0,b.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof ll&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.N_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.N_.delete(c),s.Q_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Hi(r,n)}else if(e instanceof Ci?r.Q_.Ke(e):e instanceof cl?r.Q_.He(e):r.Q_.We(e),!t.isEqual(G.min()))try{const n=yield oh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.Q_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(pe.EMPTY_BYTE_STRING,f.snapshotVersion)),_h(s,c);const g=new ht(f.target,c,h,f.sequenceNumber);Mo(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Hi(r,n)}var n}),Go.apply(this,arguments)}function Hi(r,e,t){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,b.A)(function*(r,e,t){if(!Et(e))throw e;r.L_.add(1),yield Ln(r),r.q_.set("Offline"),t||(t=()=>oh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Nr(r)}))})).apply(this,arguments)}function Ih(r,e){return e().catch(t=>Hi(r,t,e))}function Un(r){return zo.apply(this,arguments)}function zo(){return(zo=(0,b.A)(function*(r){const e=F(r),t=Nt(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;lp(e);)try{const i=yield Wg(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,hp(e,i)}catch(i){yield Hi(e,i)}Th(e)&&Eh(e)})).apply(this,arguments)}function lp(r){return Dt(r)&&r.O_.length<10}function hp(r,e){r.O_.push(e);const t=Nt(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Th(r){return Dt(r)&&!Nt(r).n_()&&r.O_.length>0}function Eh(r){Nt(r).start()}function dp(r){return jo.apply(this,arguments)}function jo(){return(jo=(0,b.A)(function*(r){Nt(r).p_()})).apply(this,arguments)}function fp(r){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,b.A)(function*(r){const e=Nt(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function mp(r,e,t){return $o.apply(this,arguments)}function $o(){return($o=(0,b.A)(function*(r,e,t){const n=r.O_.shift(),i=no.from(n,e,t);yield Ih(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Un(r)})).apply(this,arguments)}function gp(r,e){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,b.A)(function*(r,e){var t;e&&Nt(r).V_&&(yield(t=(0,b.A)(function*(i,s){if(il(u=s.code)&&u!==V.ABORTED){const a=i.O_.shift();Nt(i).s_(),yield Ih(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Un(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),Th(r)&&Eh(r)}),Wo.apply(this,arguments)}function vh(r,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,b.A)(function*(r,e){const t=F(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=Dt(t);t.L_.add(3),yield Ln(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Nr(t)})).apply(this,arguments)}function Jo(r,e){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,b.A)(function*(r,e){const t=F(r);e?(t.L_.delete(2),yield Nr(t)):e||(t.L_.add(2),yield Ln(t),t.q_.set("Unknown"))})).apply(this,arguments)}function qn(r){return r.K_||(r.K_=function(t,n,i){const s=F(t);return s.w_(),new tp(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:op.bind(null,r),Ro:ap.bind(null,r),mo:up.bind(null,r),d_:cp.bind(null,r)}),r.B_.push(function(){var e=(0,b.A)(function*(t){t?(r.K_.s_(),Lo(r)?Oo(r):r.q_.set("Unknown")):(yield r.K_.stop(),yh(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Nt(r){return r.U_||(r.U_=function(t,n,i){const s=F(t);return s.w_(),new np(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:dp.bind(null,r),mo:gp.bind(null,r),f_:fp.bind(null,r),g_:mp.bind(null,r)}),r.B_.push(function(){var e=(0,b.A)(function*(t){t?(r.U_.s_(),yield Un(r)):(yield r.U_.stop(),r.O_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Xo{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Xo(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gn(r,e){if(ye("AsyncQueue",`${e}: ${r}`),Et(r))return new C(V.UNAVAILABLE,`${e}: ${r}`);throw r}class Kn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=pr(),this.sortedSet=new oe(this.comparator)}static emptySet(e){return new Kn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Kn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Kn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ah{constructor(){this.W_=new oe(O.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):L():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class zn{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new zn(e,t,Kn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class pp{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class _p{constructor(){this.queries=wh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=F(t),s=i.queries;i.queries=wh(),s.forEach((a,u)=>{for(const c of u.j_)c.onError(n)})}(this,new C(V.ABORTED,"Firestore shutting down"))}}function wh(){return new ct(r=>Bc(r),mr)}function Zo(r,e){return ea.apply(this,arguments)}function ea(){return(ea=(0,b.A)(function*(r,e){const t=F(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new pp,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=Gn(a,`Initialization of query '${Rn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&ra(t)})).apply(this,arguments)}function ta(r,e){return na.apply(this,arguments)}function na(){return(na=(0,b.A)(function*(r,e){const t=F(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function yp(r,e){const t=F(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&ra(t)}function Ip(r,e,t){const n=F(r),i=n.queries.get(e);if(i)for(const s of i.j_)s.onError(t);n.queries.delete(e)}function ra(r){r.Y_.forEach(e=>{e.next()})}var ia,Rh;(Rh=ia||(ia={})).ea="default",Rh.Cache="cache";class sa{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new zn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=zn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ia.Cache}}class Tp{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class Ph{constructor(e){this.serializer=e}Es(e){return nt(this.serializer,e)}ds(e){return e.metadata.exists?Tl(this.serializer,e.document,!1):ce.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ie(e)}}class Ep{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Vh(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=J.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new Ph(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Es(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||Q()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,b.A)(function*(){const t=yield function Hg(r,e,t,n){return Po.apply(this,arguments)}(e.localStore,new Ph(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield Jg(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function Vh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Sh{constructor(e){this.key=e}}class bh{constructor(e){this.key=e}}class xh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Q(),this.mutatedKeys=Q(),this.Aa=qc(e),this.Ra=new Kn(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Ah,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const _=i.get(f),A=gr(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),k=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let D=!1;_&&A?_.data.isEqual(A.data)?x!==k&&(n.track({type:3,doc:A}),D=!0):this.ga(_,A)||(n.track({type:2,doc:A}),D=!0,(c&&this.Aa(A,c)>0||h&&this.Aa(A,h)<0)&&(u=!0)):!_&&A?(n.track({type:0,doc:A}),D=!0):_&&!A&&(n.track({type:1,doc:_}),D=!0,(c||h)&&(u=!0)),D&&(A?(a=a.add(A),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((f,g)=>function(A,x){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(A)-k(x)}(f.type,g.type)||this.Aa(f.doc,g.doc)),this.pa(n),i=null!=i&&i;const u=t&&!i?this.ya():[],c=0===this.da.size&&this.current&&!i?1:0,h=c!==this.Ea;return this.Ea=c,0!==a.length||h?{snapshot:new zn(this.query,e.Ra,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ah,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Q(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new bh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Sh(n))}),t}ba(e){this.Ta=e.Ts,this.da=Q();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return zn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class vp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ap{constructor(e){this.key=e,this.va=!1}}class wp{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new ct(u=>Bc(u),mr),this.Ma=new Map,this.xa=new Set,this.Oa=new oe(O.comparator),this.Na=new Map,this.La=new yo,this.Ba={},this.ka=new Map,this.qa=tn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Rp(r,e){return oa.apply(this,arguments)}function oa(){return(oa=(0,b.A)(function*(r,e,t=!0){const n=Ji(r);let i;const s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Ch(n,e,t,!0),i})).apply(this,arguments)}function Pp(r,e){return aa.apply(this,arguments)}function aa(){return(aa=(0,b.A)(function*(r,e){const t=Ji(r);yield Ch(t,e,!0,!1)})).apply(this,arguments)}function Ch(r,e,t,n){return ua.apply(this,arguments)}function ua(){return(ua=(0,b.A)(function*(r,e,t,n){const i=yield Mn(r.localStore,xe(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield ca(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Wi(r.remoteStore,i),u})).apply(this,arguments)}function ca(r,e,t,n,i){return la.apply(this,arguments)}function la(){return la=(0,b.A)(function*(r,e,t,n,i){r.Ka=(g,_,A)=>{return(x=(0,b.A)(function*(D,B,K,U){let z=B.view.ma(K);z.ns&&(z=yield Ki(D.localStore,B.query,!1).then(({documents:p})=>B.view.ma(p,z)));const H=U&&U.targetChanges.get(B.targetId),$=U&&null!=U.targetMismatches.get(B.targetId),T=B.view.applyChanges(z,D.isPrimaryClient,H,$);return Ea(D,B.targetId,T.wa),T.snapshot}),function k(D,B,K,U){return x.apply(this,arguments)})(r,g,_,A);var x};const s=yield Ki(r.localStore,e,!0),a=new xh(e,s.Ts),u=a.ma(s.documents),c=vr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);Ea(r,t,h.wa);const f=new vp(e,t,a);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}),la.apply(this,arguments)}function Vp(r,e,t){return ha.apply(this,arguments)}function ha(){return(ha=(0,b.A)(function*(r,e,t){const n=F(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!mr(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield On(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Bn(n.remoteStore,i.targetId),jn(n,i.targetId)}).catch(Tt))):(jn(n,i.targetId),yield On(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Sp(r,e){return da.apply(this,arguments)}function da(){return(da=(0,b.A)(function*(r,e){const t=F(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Bn(t.remoteStore,n.targetId))})).apply(this,arguments)}function fa(){return(fa=(0,b.A)(function*(r,e,t){const n=Da(r);try{const i=yield function(a,u){const c=F(a),h=de.now(),f=u.reduce((A,x)=>A.add(x.key),Q());let g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let x=ze(),k=Q();return c.cs.getEntries(A,f).next(D=>{x=D,x.forEach((B,K)=>{K.isValidDocument()||(k=k.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,x)).next(D=>{g=D;const B=[];for(const K of u){const U=tg(K,g.get(K.key).overlayedDocument);null!=U&&B.push(new lt(K.key,U,Ac(U.value.mapValue),me.exists(!0)))}return c.mutationQueue.addMutationBatch(A,h,B,u)}).next(D=>{_=D;const B=D.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(A,D.batchId,B)})}).then(()=>({batchId:_.batchId,changes:Kc(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.Ba[a.currentUser.toKey()];h||(h=new oe(j)),h=h.insert(u,c),a.Ba[a.currentUser.toKey()]=h}(n,i.batchId,t),yield dt(n,i.changes),yield Un(n.remoteStore)}catch(i){const s=Gn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Dh(r,e){return ma.apply(this,arguments)}function ma(){return(ma=(0,b.A)(function*(r,e){const t=F(r);try{const n=yield function $g(r,e){const t=F(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const u=[];e.targetChanges.forEach((f,g)=>{const _=i.get(g);if(!_)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,g)));let A=_.withSequenceNumber(s.currentSequenceNumber);var k,D,B;null!==e.targetMismatches.get(g)?A=A.withResumeToken(pe.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(g,A),D=A,B=f,(0===(k=_).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8||B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(s,A))});let c=ze(),h=Q();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(ah(s,a,e.documentUpdates).next(f=>{c=f.Ps,h=f.Is})),!n.isEqual(G.min())){const f=t.Ur.getLastRemoteSnapshotVersion(s).next(g=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.os=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Na.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?q(a.va):i.removedDocuments.size>0&&(q(a.va),a.va=!1))}),yield dt(t,n,e)}catch(n){yield Tt(n)}})).apply(this,arguments)}function Nh(r,e,t){const n=F(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((s,a)=>{const u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=F(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(const _ of g.j_)_.Z_(u)&&(h=!0)}),h&&ra(c)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function xp(r,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,b.A)(function*(r,e,t){const n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),s=i&&i.key;if(s){let a=new oe(O.comparator);a=a.insert(s,ce.newNoDocument(s,G.min()));const u=Q().add(s),c=new Er(G.min(),new Map,new oe(j),a,u);yield Dh(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),va(n)}else yield On(n.localStore,e,!1).then(()=>jn(n,e,t)).catch(Tt)})).apply(this,arguments)}function Cp(r,e){return pa.apply(this,arguments)}function pa(){return(pa=(0,b.A)(function*(r,e){const t=F(r),n=e.batch.batchId;try{const i=yield function Qg(r,e){const t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const g=h.batch,_=g.keys();let A=R.resolve();return _.forEach(x=>{A=A.next(()=>f.getEntry(c,x)).next(k=>{const D=h.docVersions.get(x);q(null!==D),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=Q();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Ta(t,n,null),Ia(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield dt(t,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function Dp(r,e,t){return _a.apply(this,arguments)}function _a(){return(_a=(0,b.A)(function*(r,e,t){const n=F(r);try{const i=yield function(a,u){const c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(q(null!==g),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);Ta(n,e,t),Ia(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield dt(n,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function ya(){return(ya=(0,b.A)(function*(r,e){const t=F(r);Dt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=Gn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function Ia(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Ta(r,e,t){const n=F(r);let i=n.Ba[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function jn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||kh(r,n)})}function kh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Bn(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),va(r))}function Ea(r,e,t){for(const n of t)n instanceof Sh?(r.La.addReference(n.key,e),kp(r,n)):n instanceof bh?(N("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||kh(r,n.key)):L()}function kp(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(N("SyncEngine","New document in limbo: "+t),r.xa.add(n),va(r))}function va(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new O(J.fromString(e)),n=r.qa.next();r.Na.set(n,new Ap(t)),r.Oa=r.Oa.insert(t,n),Wi(r.remoteStore,new ht(xe(An(t.path)),n,"TargetPurposeLimboResolution",Qe.oe))}}function dt(r,e,t){return Aa.apply(this,arguments)}function Aa(){return Aa=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[],a=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{a.push(n.Ka(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const g=h?!h.fromCache:null===(f=t?.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(h){i.push(h);const g=Ao.Wi(c.targetId,h);s.push(g)}}))}),yield Promise.all(a),n.Ca.d_(i),yield(u=(0,b.A)(function*(h,f){const g=F(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>R.forEach(f,A=>R.forEach(A.$i,x=>g.persistence.referenceDelegate.addReference(_,A.targetId,x)).next(()=>R.forEach(A.Ui,x=>g.persistence.referenceDelegate.removeReference(_,A.targetId,x)))))}catch(_){if(!Et(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const A=_.targetId;if(!_.fromCache){const x=g.os.get(A),D=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);g.os=g.os.insert(A,D)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Aa.apply(this,arguments)}function Fp(r,e){return wa.apply(this,arguments)}function wa(){return(wa=(0,b.A)(function*(r,e){const t=F(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield sh(t.localStore,e);t.currentUser=e,(s=t).ka.forEach(u=>{u.forEach(c=>{c.reject(new C(V.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield dt(t,n.hs)}var s})).apply(this,arguments)}function Mp(r,e){const t=F(r),n=t.Na.get(e);if(n&&n.va)return Q().add(n.key);{let i=Q();const s=t.Ma.get(e);if(!s)return i;for(const a of s){const u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function Op(r,e){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,b.A)(function*(r,e){const t=F(r),n=yield Ki(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Ea(t,e.targetId,i.wa),i})).apply(this,arguments)}function Lp(r,e){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,b.A)(function*(r,e){const t=F(r);return ch(t.localStore,e).then(n=>dt(t,n))})).apply(this,arguments)}function Bp(r,e,t,n){return Va.apply(this,arguments)}function Va(){return(Va=(0,b.A)(function*(r,e,t,n){const i=F(r),s=yield function(u,c){const h=F(u),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Mn(g,c).next(_=>_?h.localDocuments.getDocuments(g,_):R.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield Un(i.remoteStore):"acknowledged"===t||"rejected"===t?(Ta(i,e,n||null),Ia(i,e),c=e,F(F(i.localStore).mutationQueue).On(c)):L(),yield dt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r,e){const t=F(r);if(Ji(t),Da(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Fh(t,n.toArray());t.Qa=!0,yield Jo(t.remoteStore,!0);for(const s of i)Wi(t.remoteStore,s)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(jn(t,a),On(t.localStore,a,!0))),Bn(t.remoteStore,a)}),yield i,yield Fh(t,n),function(a){const u=F(a);u.Na.forEach((c,h)=>{Bn(u.remoteStore,h)}),u.La.pr(),u.Na=new Map,u.Oa=new oe(O.comparator)}(t),t.Qa=!1,yield Jo(t.remoteStore,!1)}})).apply(this,arguments)}function Fh(r,e,t){return ba.apply(this,arguments)}function ba(){return(ba=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[];for(const a of e){let u;const c=n.Ma.get(a);if(c&&0!==c.length){u=yield Mn(n.localStore,xe(c[0]));for(const h of c){const f=n.Fa.get(h),g=yield Op(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield uh(n.localStore,a);u=yield Mn(n.localStore,h),yield ca(n,Mh(h),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})).apply(this,arguments)}function Mh(r){return Fc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function qp(r){return t=F(r).localStore,F(F(t).persistence).Qi();var t}function Gp(r,e,t,n){return xa.apply(this,arguments)}function xa(){return(xa=(0,b.A)(function*(r,e,t,n){const i=F(r);if(i.Qa)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield ch(i.localStore,Uc(s[0])),u=Er.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,pe.EMPTY_BYTE_STRING);yield dt(i,a,u);break}case"rejected":yield On(i.localStore,e,!0),jn(i,e,n);break;default:L()}})).apply(this,arguments)}function Kp(r,e,t){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,b.A)(function*(r,e,t){const n=Ji(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield uh(n.localStore,i),a=yield Mn(n.localStore,s);yield ca(n,Mh(s),a.targetId,!1,a.resumeToken),Wi(n.remoteStore,a)}for(const i of t)n.Ma.has(i)&&(yield On(n.localStore,i,!1).then(()=>{Bn(n.remoteStore,i),jn(n,i)}).catch(Tt))}})).apply(this,arguments)}function Ji(r){const e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Dh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xp.bind(null,e),e.Ca.d_=yp.bind(null,e.eventManager),e.Ca.$a=Ip.bind(null,e.eventManager),e}function Da(r){const e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Cp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Dp.bind(null,e),e}class Qn{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,b.A)(function*(){t.serializer=Dr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ih(this.persistence,new rh,e.initialUser,this.serializer)}createPersistence(e){return new Io(Ui.Zr,this.serializer)}createSharedClientState(e){return new fh}terminate(){var e=this;return(0,b.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Na extends Qn{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e),yield n.Wa.initialize(n,e),yield Da(n.Wa.syncEngine),yield Un(n.Wa.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return ih(this.persistence,new rh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Wl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new dm(t,this.persistence);return new hm(e.asyncQueue,n)}createPersistence(e){const t=vo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new Eo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,gh(),$i(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new fh}}class Oh extends Na{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e);const i=n.Wa.syncEngine;n.sharedClientState instanceof Co&&(n.sharedClientState.syncEngine={no:Bp.bind(null,i),ro:Gp.bind(null,i),io:Kp.bind(null,i),Qi:qp.bind(null,i),eo:Lp.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var s=(0,b.A)(function*(a){yield function Up(r,e){return Sa.apply(this,arguments)}(n.Wa.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=gh();if(!Co.D(t))throw new C(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=vo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Co(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class $n{initialize(e,t){var n=this;return(0,b.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Nh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Fp.bind(null,n.syncEngine),yield Jo(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new _p}createDatastore(e){const t=Dr(e.databaseInfo.databaseId),n=new ep(e.databaseInfo);return new rp(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Nh(this.syncEngine,t,0),u=mh.D()?new mh:new Yg,new sp(n,i,s,a,u);var n,i,s,a,u}createSyncEngine(e,t){return function(i,s,a,u,c,h,f){const g=new wp(i,s,a,u,c,h);return f&&(g.Qa=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,b.A)(function*(){var t,n,i;yield(i=(0,b.A)(function*(a){const u=F(a);N("RemoteStore","RemoteStore shutting down."),u.L_.add(5),yield Ln(u),u.k_.shutdown(),u.q_.set("Unknown")}),function s(a){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function Lh(r,e=10240){let t=0;return{read:()=>(0,b.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,b.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Yi{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Qp{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Ee,this.buffer=new Uint8Array,this.Ha=new TextDecoder("utf-8"),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){var e=this;return(0,b.A)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,b.A)(function*(){return yield e.getMetadata(),e.Ja()})()}Ja(){var e=this;return(0,b.A)(function*(){const t=yield e.Ya();if(null===t)return null;const n=e.Ha.decode(t),i=Number(n);isNaN(i)&&e.Za(`length string (${n}) is not valid number`);const s=yield e.Xa(i);return new Tp(JSON.parse(s),t.length+i)})()}eu(){return this.buffer.findIndex(e=>123===e)}Ya(){var e=this;return(0,b.A)(function*(){for(;e.eu()<0&&!(yield e.tu()););if(0===e.buffer.length)return null;const t=e.eu();t<0&&e.Za("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Xa(e){var t=this;return(0,b.A)(function*(){for(;t.buffer.length<e;)(yield t.tu())&&t.Za("Reached the end of bundle when more is expected.");const n=t.Ha.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){var e=this;return(0,b.A)(function*(){const t=yield e.ja.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class $p{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,b.A)(function*(a,u){const c=F(a),h={documents:u.map(A=>Ar(c.serializer,A))},f=yield c.Lo("BatchGetDocuments",c.serializer.databaseId,J.emptyPath(),h,u.length),g=new Map;f.forEach(A=>{const x=function lg(r,e){return"found"in e?function(n,i){q(!!i.found);const s=nt(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):G.min(),c=new Pe({mapValue:{fields:i.found.fields}});return ce.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){q(!!i.missing),q(!!i.readTime);const s=nt(n,i.missing),a=Ie(i.readTime);return ce.newNoDocument(s,a)}(r,e):L()}(c.serializer,A);g.set(x.key.toString(),x)});const _=[];return u.forEach(A=>{const x=g.get(A.toString());q(!!x),_.push(x)}),_}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new bn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=O.fromPath(i);e.mutations.push(new eo(s,e.precondition(s)))}),yield(n=(0,b.A)(function*(s,a){const u=F(s),c={writes:a.map(h=>wr(u.serializer,h))};yield u.Mo("Commit",u.serializer.databaseId,J.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L();t=G.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?me.exists(!1):me.updateTime(t):me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new C(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(t)}return me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Wp{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.nu=n.maxAttempts,this.t_=new No(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){var e=this;this.t_.Go((0,b.A)(function*(){const t=new $p(e.datastore),n=e.su(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ou(s)}))}).catch(i=>{e.ou(i)})}))}su(e){try{const t=this.updateFunction(e);return!or(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!il(t)}return!1}}class Hp{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=Hu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var a=(0,b.A)(function*(u){N("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(n,a=>(N("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(V.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Gn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Xi(r,e){return ka.apply(this,arguments)}function ka(){return ka=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield sh(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),ka.apply(this,arguments)}function Fa(r,e){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Oa(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>vh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>vh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Bh(r){return"FirebaseError"===r.name?r.code===V.FAILED_PRECONDITION||r.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Oa(r){return La.apply(this,arguments)}function La(){return(La=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Xi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Bh(t))throw t;Ge("Error using user provided cache. Falling back to memory cache: "+t),yield Xi(r,new Qn)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield Xi(r,new Qn);return r._offlineComponents})).apply(this,arguments)}function Zi(r){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Fa(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Fa(r,new $n))),r._onlineComponents})).apply(this,arguments)}function Uh(r){return Oa(r).then(e=>e.persistence)}function Wn(r){return Oa(r).then(e=>e.localStore)}function qh(r){return Zi(r).then(e=>e.remoteStore)}function Ua(r){return Zi(r).then(e=>e.syncEngine)}function Hn(r){return qa.apply(this,arguments)}function qa(){return(qa=(0,b.A)(function*(r){const e=yield Zi(r),t=e.eventManager;return t.onListen=Rp.bind(null,e.syncEngine),t.onUnlisten=Vp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Sp.bind(null,e.syncEngine),t})).apply(this,arguments)}function Kh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new Yi({next:_=>{a.enqueueAndForget(()=>ta(s,g));const A=_.docs.has(u);!A&&_.fromCache?h.reject(new C(V.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&_.fromCache&&c&&"server"===c.source?h.reject(new C(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new sa(An(u.path),f,{includeMetadataChanges:!0,_a:!0});return Zo(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function zh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new Yi({next:_=>{a.enqueueAndForget(()=>ta(s,g)),_.fromCache&&"server"===c.source?h.reject(new C(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new sa(u,f,{includeMetadataChanges:!0,_a:!0});return Zo(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function jh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Qh=new Map;function Ga(r,e,t){if(!t)throw new C(V.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function $h(r,e,t,n){if(!0===e&&!0===n)throw new C(V.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Wh(r){if(!O.isDocumentKey(r))throw new C(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Hh(r){if(O.isDocumentKey(r))throw new C(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function es(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":L()}function W(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=es(r);throw new C(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Jh(r,e){if(e<=0)throw new C(V.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Yh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$h("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=jh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kr{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Zf;switch(n.type){case"firstParty":return new rm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Qh.get(t);n&&(N("ComponentProvider","Removing Datastore"),Qh.delete(t),n.terminate())}(this),Promise.resolve()}}class Ve{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ve(this.firestore,e,this._query)}}class le{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}}class rt extends Ve{constructor(e,t,n){super(e,t,An(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new O(e))}withConverter(e){return new rt(this.firestore,e,this._path)}}function Zh(r,e,...t){if(r=(0,ee.Ku)(r),Ga("collection","path",e),r instanceof kr){const n=J.fromString(e,...t);return Hh(n),new rt(r,null,n)}{if(!(r instanceof le||r instanceof rt))throw new C(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return Hh(n),new rt(r.firestore,null,n)}}function ts(r,e,...t){if(r=(0,ee.Ku)(r),1===arguments.length&&(e=Hu.newId()),Ga("doc","path",e),r instanceof kr){const n=J.fromString(e,...t);return Wh(n),new le(r,null,new O(n))}{if(!(r instanceof le||r instanceof rt))throw new C(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return Wh(n),new le(r.firestore,r instanceof rt?r.converter:null,new O(n))}}function ed(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),(r instanceof le||r instanceof rt)&&(e instanceof le||e instanceof rt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Ka(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),r instanceof Ve&&e instanceof Ve&&r.firestore===e.firestore&&mr(r._query,e._query)&&r.converter===e.converter}class u_{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new No(this,"async_queue_retry"),this.Eu=()=>{const t=$i();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=$i();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=$i();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new Ee;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,b.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!Et(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const i=Xo.createAndSchedule(this,e,t,n,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&L()}verifyOperationInProgress(){}mu(){var e=this;return(0,b.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function za(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class c_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class re extends kr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new u_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||td(this),this._firestoreClient.terminate()}}function ge(r){return r._firestoreClient||td(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function td(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new km(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,jh(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new Hp(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function nd(r,e,t){const n=new Ee;return r.asyncQueue.enqueue((0,b.A)(function*(){try{yield Xi(r,t),yield Fa(r,e),n.resolve()}catch(i){const s=i;if(!Bh(s))throw s;Ge("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function rd(r){if(r._initialized||r._terminated)throw new C(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class it{constructor(e){this._byteString=e}static fromBase64String(e){try{return new it(pe.fromBase64String(e))}catch(t){throw new C(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new it(pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ft{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._methodName=e}}class ns{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}class rs{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const T_=/^__.*__$/;class E_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Sn(e,this.data,t,this.fieldTransforms)}}class id{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new lt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function sd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class is{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new is(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return as(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(sd(this.wu)&&T_.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class v_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Dr(e)}Nu(e,t,n,i=!1){return new is({wu:e,methodName:t,Ou:n,path:ue.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sn(r){const e=r._freezeSettings(),t=Dr(r._databaseId);return new v_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function ss(r,e,t,n,i,s={}){const a=r.Nu(s.merge||s.mergeFields?2:0,e,t,i);Ya("Data must be an object, but it was:",a,n);const u=ud(n,a);let c,h;if(s.merge)c=new Ke(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const _=Or(e,g,t);if(!a.contains(_))throw new C(V.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);ld(f,_)||f.push(_)}c=new Ke(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new E_(new Pe(u),c,h)}class Mr extends rn{_toFieldTransform(e){if(2!==e.wu)throw e.Mu(1===e.wu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mr}}function od(r,e,t){return new is({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ja extends rn{_toFieldTransform(e){return new yr(e.path,new Pn)}isEqual(e){return e instanceof ja}}class Qa extends rn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=od(this,e,!0),n=this.Lu.map(s=>on(s,t)),i=new Wt(n);return new yr(e.path,i)}isEqual(e){return e instanceof Qa&&(0,ee.bD)(this.Lu,e.Lu)}}class $a extends rn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=od(this,e,!0),n=this.Lu.map(s=>on(s,t)),i=new Ht(n);return new yr(e.path,i)}isEqual(e){return e instanceof $a&&(0,ee.bD)(this.Lu,e.Lu)}}class Wa extends rn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=new Vn(e.serializer,Qc(e.serializer,this.Bu));return new yr(e.path,t)}isEqual(e){return e instanceof Wa&&this.Bu===e.Bu}}function Ha(r,e,t,n){const i=r.Nu(1,e,t);Ya("Data must be an object, but it was:",i,n);const s=[],a=Pe.empty();vt(n,(c,h)=>{const f=os(e,c,t);h=(0,ee.Ku)(h);const g=i.Cu(f);if(h instanceof Mr)s.push(f);else{const _=on(h,g);null!=_&&(s.push(f),a.set(f,_))}});const u=new Ke(s);return new id(a,u,i.fieldTransforms)}function Ja(r,e,t,n,i,s){const a=r.Nu(1,e,t),u=[Or(e,n,t)],c=[i];if(s.length%2!=0)throw new C(V.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Or(e,s[_])),c.push(s[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!ld(h,u[_])){const A=u[_];let x=c[_];x=(0,ee.Ku)(x);const k=a.Cu(A);if(x instanceof Mr)h.push(A);else{const D=on(x,k);null!=D&&(h.push(A),f.set(A,D))}}const g=new Ke(h);return new id(f,g,a.fieldTransforms)}function ad(r,e,t,n=!1){return on(t,r.Nu(n?4:3,e))}function on(r,e){if(cd(r=(0,ee.Ku)(r)))return Ya("Unsupported field value:",e,r),ud(r,e);if(r instanceof rn)return function(n,i){if(!sd(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=on(u,i.Fu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ee.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Qc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:xn(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:xn(i.serializer,s)}}if(n instanceof ns)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof it)return{bytesValue:ml(i.serializer,n._byteString)};if(n instanceof le){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:oo(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof rs)return u=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(c=>{if("number"!=typeof c)throw u.Mu("VectorValues must only contain numeric values.");return Zs(u.serializer,c)})}}}}};var u;throw i.Mu(`Unsupported field value: ${es(n)}`)}(r,e)}function ud(r,e){const t={};return dc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vt(r,(n,i)=>{const s=on(i,e.bu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function cd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof ns||r instanceof it||r instanceof le||r instanceof rn||r instanceof rs)}function Ya(r,e,t){if(!cd(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=es(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var i}function Or(r,e,t){if((e=(0,ee.Ku)(e))instanceof ft)return e._internalPath;if("string"==typeof e)return os(r,e);throw as("Field path arguments must be of type string or ",r,!1,void 0,t)}const A_=new RegExp("[~\\*/\\[\\]]");function os(r,e,t){if(e.search(A_)>=0)throw as(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ft(...e.split("."))._internalPath}catch{throw as(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function as(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new C(V.INVALID_ARGUMENT,u+r+c)}function ld(r,e){return r.some(t=>t.isEqual(e))}class Lr{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new w_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(us("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class w_ extends Lr{data(){return super.data()}}function us(r,e){return"string"==typeof e?os(r,e):e instanceof ft?e._internalPath:e._delegate._internalPath}function hd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xa{}class Br extends Xa{}function kt(r,e,...t){let n=[];e instanceof Xa&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Jn).length,u=s.filter(c=>c instanceof Ur).length;if(a>1||a>0&&u>0)throw new C(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Ur extends Br{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ur(e,t,n)}_apply(e){const t=this._parse(e);return gd(e._query,t),new Ve(e.firestore,e.converter,Ys(e._query,t))}_parse(e){const t=sn(e.firestore);return function(s,a,u,c,h,f,g){let _;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){md(g,f);const A=[];for(const x of g)A.push(fd(c,s,x));_={arrayValue:{values:A}}}else _=fd(c,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||md(g,f),_=ad(u,"where",g,"in"===f||"not-in"===f);return Y.create(h,f,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Jn extends Xa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)gd(a,c),a=Ys(a,c)}(e._query,t),new Ve(e.firestore,e.converter,Ys(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Za extends Br{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Za(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dr(s,a)}(e._query,this._field,this._direction);return new Ve(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new ut(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class cs extends Br{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new cs(e,t,n)}_apply(e){return new Ve(e.firestore,e.converter,Pi(e._query,this._limit,this._limitType))}}class ls extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ls(e,t,n)}_apply(e){const t=dd(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class hs extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hs(e,t,n)}_apply(e){const t=dd(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function dd(r,e,t,n){if(t[0]=(0,ee.Ku)(t[0]),t[0]instanceof Lr)return function(s,a,u,c,h){if(!c)throw new C(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of wn(s))if(g.field.isKeyField())f.push(Qt(a,c.key));else{const _=c.data.field(g.field);if(yi(_))throw new C(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const A=g.field.canonicalString();throw new C(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(_)}return new Vt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=sn(r.firestore);return function(a,u,c,h,f,g){const _=a.explicitOrderBy;if(f.length>_.length)throw new C(V.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let x=0;x<f.length;x++){const k=f[x];if(_[x].field.isKeyField()){if("string"!=typeof k)throw new C(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!Js(a)&&-1!==k.indexOf("/"))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);const D=a.path.child(J.fromString(k));if(!O.isDocumentKey(D))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const B=new O(D);A.push(Qt(u,B))}else{const D=ad(c,h,k);A.push(D)}}return new Vt(A,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function fd(r,e,t){if("string"==typeof(t=(0,ee.Ku)(t))){if(""===t)throw new C(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Js(e)&&-1!==t.indexOf("/"))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(J.fromString(t));if(!O.isDocumentKey(n))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Qt(r,new O(n))}if(t instanceof le)return Qt(r,t._key);throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${es(t)}.`)}function md(r,e){if(!Array.isArray(r)||0===r.length)throw new C(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gd(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(V.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class eu{convertValue(e,t="none"){switch(Rt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(at(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return vt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>fe(a.doubleValue));return new rs(s)}convertGeoPoint(e){return new ns(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ii(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ur(e));default:return null}}convertTimestamp(e){const t=ot(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=J.fromString(e);q(Pl(n));const i=new At(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ds(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class N_ extends eu{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}class an{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mt extends Lr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(us("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class qr extends mt{data(e={}){return super.data(e)}}class Ft{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new qr(this._firestore,this._userDataWriter,n.key,n,new an(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new qr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new qr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:F_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function F_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function _d(r,e){return r instanceof mt&&e instanceof mt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ft&&e instanceof Ft&&r._firestore===e._firestore&&Ka(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Mt extends eu{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function yd(r,e,t){r=W(r,le);const n=W(r.firestore,re),i=ds(r.converter,e,t);return Yn(n,[ss(sn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,me.none())])}function Id(r,e,t,...n){r=W(r,le);const i=W(r.firestore,re),s=sn(i);let a;return a="string"==typeof(e=(0,ee.Ku)(e))||e instanceof ft?Ja(s,"updateDoc",r._key,e,t,n):Ha(s,"updateDoc",r._key,e),Yn(i,[a.toMutation(r._key,me.exists(!0))])}function Td(r,...e){var t,n,i;r=(0,ee.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||za(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(za(e[a])){const g=e[a];e[a]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,f;if(r instanceof le)h=W(r.firestore,re),f=An(r._key.path),c={next:g=>{e[a]&&e[a](tu(h,r,g))},error:e[a+1],complete:e[a+2]};else{const g=W(r,Ve);h=W(g.firestore,re),f=g._query;const _=new Mt(h);c={next:A=>{e[a]&&e[a](new Ft(h,_,g,A))},error:e[a+1],complete:e[a+2]},hd(r._query)}return function(_,A,x,k){const D=new Yi(k),B=new sa(A,D,x);return _.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Zo(yield Hn(_),B)})),()=>{D.za(),_.asyncQueue.enqueueAndForget((0,b.A)(function*(){return ta(yield Hn(_),B)}))}}(ge(h),f,u,c)}function Yn(r,e){return function(n,i){const s=new Ee;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function bp(r,e,t){return fa.apply(this,arguments)}(yield Ua(n),i,s)})),s.promise}(ge(r),e)}function tu(r,e,t){const n=t.docs.get(e._key),i=new Mt(r);return new mt(r,i,e._key,n,new an(t.hasPendingWrites,t.fromCache),e.converter)}const Z_={maxAttempts:5};class Ed{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=sn(e)}set(e,t,n){this._verifyNotCommitted();const i=Ot(e,this._firestore),s=ds(i.converter,t,n),a=ss(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,me.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Ot(e,this._firestore);let a;return a="string"==typeof(t=(0,ee.Ku)(t))||t instanceof ft?Ja(this._dataReader,"WriteBatch.update",s._key,t,n,i):Ha(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ot(e,this._firestore);return this._mutations=this._mutations.concat(new bn(t._key,me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ot(r,e){if((r=(0,ee.Ku)(r)).firestore!==e)throw new C(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class ey extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=sn(t)}get(t){const n=Ot(t,this._firestore),i=new N_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return L();const a=s[0];if(a.isFoundDocument())return new Lr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Lr(this._firestore,i,n._key,null,n.converter);throw L()})}set(t,n,i){const s=Ot(t,this._firestore),a=ds(s.converter,n,i),u=ss(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Ot(t,this._firestore);let u;return u="string"==typeof(n=(0,ee.Ku)(n))||n instanceof ft?Ja(this._dataReader,"Transaction.update",a._key,n,i,s):Ha(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Ot(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ot(e,this._firestore),n=new Mt(this._firestore);return super.get(e).then(i=>new mt(this._firestore,n,t._key,i._document,new an(!1,!1),t.converter))}}function ru(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Rd(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Pd(){if(!function Dm(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){gn=di.SDK_VERSION,(0,di._registerComponent)(new Mu.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new re(new tm(n.getProvider("auth-internal")),new im(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new At(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,di.registerVersion)(Qu,"4.7.1",e),(0,di.registerVersion)(Qu,"4.7.1","esm2017")}();class Gr{constructor(e){this._delegate=e}static fromBase64String(e){return Pd(),new Gr(it.fromBase64String(e))}static fromUint8Array(e){return Rd(),new Gr(it.fromUint8Array(e))}toBase64(){return Pd(),this._delegate.toBase64()}toUint8Array(){return Rd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function iu(r){return function ly(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class hy{enableIndexedDbPersistence(e,t){return function h_(r,e){rd(r=W(r,re));const t=ge(r);if(t._uninitializedComponentsProvider)throw new C(V.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new $n;return nd(t,i,new Na(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function d_(r){rd(r=W(r,re));const e=ge(r);if(e._uninitializedComponentsProvider)throw new C(V.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new $n;return nd(e,n,new Oh(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function f_(r){if(r._initialized&&!r._terminated)throw new C(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ee;return r._queue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{yield(t=(0,b.A)(function*(i){if(!Xe.D())return Promise.resolve();const s=i+"main";yield Xe.delete(s)}),function n(i){return t.apply(this,arguments)})(vo(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Vd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof At||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ge("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function Xh(r,e,t,n={}){var i;const s=(r=W(r,kr))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ae.MOCK_USER;else{u=(0,ee.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new C(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ae(h)}r._authCredentials=new em(new $u(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function g_(r){return function Jp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Uh(r),t=yield qh(r);return e.setNetworkEnabled(!0),function(i){const s=F(i);return s.L_.delete(0),Nr(s)}(t)}))}(ge(r=W(r,re)))}(this._delegate)}disableNetwork(){return function p_(r){return function Yp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Uh(r),t=yield qh(r);return e.setNetworkEnabled(!1),(n=(0,b.A)(function*(s){const a=F(s);a.L_.add(0),yield Ln(a),a.q_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(ge(r=W(r,re)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,$h("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function m_(r){return function(t){const n=new Ee;return t.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Np(r,e){return ya.apply(this,arguments)}(yield Ua(t),n)})),n.promise}(ge(r=W(r,re)))}(this._delegate)}onSnapshotsInSync(e){return function z_(r,e){return function t_(r,e){const t=new Yi(e);return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Hn(r),s=t,F(i).Y_.add(s),void s.next();var i,s})),()=>{t.za(),r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Hn(r),s=t,void F(i).Y_.delete(s);var i,s}))}}(ge(r=W(r,re)),za(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Xn(this,Zh(this._delegate,e))}catch(t){throw Oe(t,"collection()","Firestore.collection()")}}doc(e){try{return new We(this,ts(this._delegate,e))}catch(t){throw Oe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Le(this,function a_(r,e){if(r=W(r,kr),Ga("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(V.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ve(r,null,(n=e,new ut(J.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Oe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function ty(r,e,t){r=W(r,re);const n=Object.assign(Object.assign({},Z_),t);return function(s){if(s.maxAttempts<1)throw new C(V.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new Ee;return s.asyncQueue.enqueueAndForget((0,b.A)(function*(){const h=yield function Gh(r){return Zi(r).then(e=>e.datastore)}(s);new Wp(s.asyncQueue,h,u,a,c).ru()})),c.promise}(ge(r),i=>e(new ey(r,i)),n)}(this._delegate,t=>e(new Sd(this,t)))}batch(){return ge(this._delegate),new bd(new Ed(this._delegate,e=>Yn(this._delegate,e)))}loadBundle(e){return function __(r,e){const t=ge(r=W(r,re)),n=new c_;return function n_(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?ol().encode(a):a,f=function(f,g){if(f instanceof Uint8Array)return Lh(f,g);if(f instanceof ArrayBuffer)return Lh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Qp(f,u);var f}(t,Dr(e));r.asyncQueue.enqueueAndForget((0,b.A)(function*(){!function zp(r,e,t){const n=F(r);var i;(i=(0,b.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(x,k){const D=F(x),B=Ie(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",K=>D.Gr.getBundleMetadata(K,k.id)).then(K=>!!K&&K.createTime.compareTo(B)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(x=h).totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}),Promise.resolve(new Set);c._updateProgress(Vh(h));const f=new Ep(h,a.localStore,u.serializer);let g=yield u.Ua();for(;g;){const A=yield f.la(g);A&&c._updateProgress(A),g=yield u.Ua()}const _=yield f.complete();return yield dt(a,_.Ia,void 0),yield function(x,k){const D=F(x);return D.persistence.runTransaction("Save bundle","readwrite",B=>D.Gr.saveBundleMetadata(B,k))}(a.localStore,h),c._completeWith(_.progress),Promise.resolve(_.Pa)}catch(h){return Ge("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var x}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield Ua(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function y_(r,e){return function r_(r,e){return r.asyncQueue.enqueue((0,b.A)(function*(){return function(n,i){const s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield Wn(r),e)}))}(ge(r=W(r,re)),e).then(t=>t?new Ve(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Le(this,t):null)}}class ms extends eu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(new it(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return We.forKey(t,this.firestore,null)}}class Sd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ms(e)}get(e){const t=cn(e);return this._delegate.get(t).then(n=>new Kr(this._firestore,new mt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=cn(e);return n?(ru("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}}class bd{constructor(e){this._delegate=e}set(e,t,n){const i=cn(e);return n?(ru("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class un{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new qr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=un.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new un(e,new ms(e),t),i.set(t,s)),s}}un.INSTANCES=new WeakMap;class We{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ms(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new We(t,new le(t._delegate,n,new O(e)))}static forKey(e,t,n){return new We(t,new le(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Xn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Xn(this.firestore,Zh(this._delegate,e))}catch(t){throw Oe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ee.Ku)(e))instanceof le&&ed(this._delegate,e)}set(e,t){t=ru("DocumentReference.set",t);try{return t?yd(this._delegate,e,t):yd(this._delegate,e)}catch(n){throw Oe(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Id(this._delegate,e):Id(this._delegate,e,t,...n)}catch(i){throw Oe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function G_(r){return Yn(W(r.firestore,re),[new bn(r._key,me.none())])}(this._delegate)}onSnapshot(...e){const t=xd(e),n=Cd(e,i=>new Kr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Td(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function O_(r){r=W(r,le);const e=W(r.firestore,re),t=ge(e),n=new Mt(e);return function Xp(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield function(f,g){const _=F(f);return _.persistence.runTransaction("read document","readonly",A=>_.localDocuments.getDocument(A,g))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new C(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=Gn(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new mt(e,n,r._key,i,new an(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function L_(r){r=W(r,le);const e=W(r.firestore,re);return Kh(ge(e),r._key,{source:"server"}).then(t=>tu(e,r,t))}(this._delegate):function M_(r){r=W(r,le);const e=W(r.firestore,re);return Kh(ge(e),r._key).then(t=>tu(e,r,t))}(this._delegate),t.then(n=>new Kr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new We(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function Oe(r,e,t){return r.message=r.message.replace(e,t),r}function xd(r){for(const e of r)if("object"==typeof e&&!iu(e))return e;return{}}function Cd(r,e){var t,n;let i;return i=iu(r[0])?r[0]:iu(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Kr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new We(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return _d(this._delegate,e._delegate)}}class zr extends Kr{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Xf(r){r||L()}(void 0!==t),t}}class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ms(e)}where(e,t,n){try{return new Le(this.firestore,kt(this._delegate,function R_(r,e,t){const n=e,i=us("where",r);return Ur._create(i,n,t)}(e,t,n)))}catch(i){throw Oe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Le(this.firestore,kt(this._delegate,function P_(r,e="asc"){const t=e,n=us("orderBy",r);return Za._create(n,t)}(e,t)))}catch(n){throw Oe(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Le(this.firestore,kt(this._delegate,function V_(r){return Jh("limit",r),cs._create("limit",r,"F")}(e)))}catch(t){throw Oe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Le(this.firestore,kt(this._delegate,function S_(r){return Jh("limitToLast",r),cs._create("limitToLast",r,"L")}(e)))}catch(t){throw Oe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Le(this.firestore,kt(this._delegate,function b_(...r){return ls._create("startAt",r,!0)}(...e)))}catch(t){throw Oe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Le(this.firestore,kt(this._delegate,function x_(...r){return ls._create("startAfter",r,!1)}(...e)))}catch(t){throw Oe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Le(this.firestore,kt(this._delegate,function C_(...r){return hs._create("endBefore",r,!1)}(...e)))}catch(t){throw Oe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Le(this.firestore,kt(this._delegate,function D_(...r){return hs._create("endAt",r,!0)}(...e)))}catch(t){throw Oe(t,"endAt()","Query.endAt()")}}isEqual(e){return Ka(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function U_(r){r=W(r,Ve);const e=W(r.firestore,re),t=ge(e),n=new Mt(e);return function Zp(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield Ki(s,a,!0),h=new xh(a,c.Ts),f=h.ma(c.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(c){const h=Gn(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate):"server"===e?.source?function q_(r){r=W(r,Ve);const e=W(r.firestore,re),t=ge(e),n=new Mt(e);return zh(t,r._query,{source:"server"}).then(i=>new Ft(e,n,r,i))}(this._delegate):function B_(r){r=W(r,Ve);const e=W(r.firestore,re),t=ge(e),n=new Mt(e);return hd(r._query),zh(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate),t.then(n=>new su(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=xd(e),n=Cd(e,i=>new su(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Td(this._delegate,t,n)}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}class fy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class su{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new fy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new zr(this._firestore,n))})}isEqual(e){return _d(this._delegate,e._delegate)}}class Xn extends Le{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new We(this.firestore,e):null}doc(e){try{return new We(this.firestore,void 0===e?ts(this._delegate):ts(this._delegate,e))}catch(t){throw Oe(t,"doc()","CollectionReference.doc()")}}add(e){return function K_(r,e){const t=W(r.firestore,re),n=ts(r),i=ds(r.converter,e);return Yn(t,[ss(sn(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,me.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new We(this.firestore,t))}isEqual(e){return ed(this._delegate,e._delegate)}withConverter(e){return new Xn(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function cn(r){return W(r,le)}class ou{constructor(...e){this._delegate=new ft(...e)}static documentId(){return new ou(ue.keyField().canonicalString())}isEqual(e){return(e=(0,ee.Ku)(e))instanceof ft&&this._delegate._internalPath.isEqual(e._internalPath)}}class ln{constructor(e){this._delegate=e}static serverTimestamp(){const e=function ry(){return new ja("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ln(e)}static delete(){const e=function ny(){return new Mr("deleteField")}();return e._methodName="FieldValue.delete",new ln(e)}static arrayUnion(...e){const t=function iy(...r){return new Qa("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ln(t)}static arrayRemove(...e){const t=function sy(...r){return new $a("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ln(t)}static increment(e){const t=function oy(r){return new Wa("increment",r)}(e);return t._methodName="FieldValue.increment",new ln(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const my={Firestore:Vd,GeoPoint:ns,Timestamp:de,Blob:Gr,Transaction:Sd,WriteBatch:bd,DocumentReference:We,DocumentSnapshot:Kr,Query:Le,QueryDocumentSnapshot:zr,QuerySnapshot:su,CollectionReference:Xn,FieldPath:ou,FieldValue:ln,setLogLevel:function dy(r){!function Yf(r){It.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};!function py(r){(function gy(r,e){r.INTERNAL.registerComponent(new Mu.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},my)))})(r,(e,t)=>new Vd(e,t,new hy)),r.registerVersion("@firebase/firestore-compat","0.3.36")}(Jf.A);var _y=ae(7935);function Dd(r,e){return function yy(r,e=jf.E){return new Qf.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function au(r,e){return Dd(r,e).pipe((0,Je.T)(t=>({payload:t,type:"query"})))}class Nd{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Bd(n,t);return new Md(i,s,this.afs)}snapshotChanges(){return function Iy(r,e){return Dd(r,e).pipe((0,Ns.Z)(void 0),ks(),(0,Je.T)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(qe.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Je.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,hi.H)(this.ref.get(e)).pipe(qe.U0)}}function gs(r,e){return au(r,e).pipe((0,Ns.Z)(void 0),ks(),(0,Je.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function kd(r,e,t){return gs(r,t).pipe((0,Fs.S)((n,i)=>function Ty(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function Ey(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return uu(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return uu(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return uu(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,Hf.F)(),(0,Je.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function uu(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Fd(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Md{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=gs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Je.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Ns.Z)(void 0),ks(),(0,Fu.p)(([n,i])=>i.length>0||!n),(0,Je.T)(([,n])=>n),qe.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Fs.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Fd(e);return kd(this.query,t,this.afs.schedulers.outsideAngular).pipe(qe.U0)}valueChanges(e={}){return au(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),qe.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(qe.U0)}add(e){return this.ref.add(e)}doc(e){return new Nd(this.ref.doc(e),this.afs)}}class vy{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?gs(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Fu.p)(t=>t.length>0),qe.U0):gs(this.query,this.afs.schedulers.outsideAngular).pipe(qe.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Fs.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Fd(e);return kd(this.query,t,this.afs.schedulers.outsideAngular).pipe(qe.U0)}valueChanges(e={}){return au(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),qe.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(qe.U0)}}const Od=new se.nKC("angularfire2.enableFirestorePersistence"),Ld=new se.nKC("angularfire2.firestore.persistenceSettings"),Ay=new se.nKC("angularfire2.firestore.settings"),wy=new se.nKC("angularfire2.firestore.use-emulator");function Bd(r,e=t=>t){return{query:e(r),ref:r}}let Ud=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,h,f,g,_,A,x,k,D,B,K){this.schedulers=c;const U=(0,li.iB)(t,u,n),z=f;g&&(0,yt.gF)(U,u,_,x,k,D,A,B),[this.firestore,this.persistenceEnabled$]=(0,li.BM)(`${U.name}.firestore`,"AngularFirestore",U.name,()=>{const H=u.runOutsideAngular(()=>U.firestore());if(s&&H.settings(s),z&&H.useEmulator(...z),i&&!(0,zf.Vy)(a)){const $=()=>{try{return(0,hi.H)(H.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),(0,ku.of)(!1)}};return[H,u.runOutsideAngular($)]}return[H,(0,ku.of)(!1)]},[s,z,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:a}=Bd(i,n),u=this.schedulers.ngZone.run(()=>s);return new Md(u,a,this)}collectionGroup(t,n){const i=n||(a=>a),s=this.firestore.collectionGroup(t);return new vy(i(s),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>n);return new Nd(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(se.KVO(li.rx),se.KVO(li.uP,8),se.KVO(Od,8),se.KVO(Ay,8),se.KVO(se.Agw),se.KVO(se.SKi),se.KVO(qe.u0),se.KVO(Ld,8),se.KVO(wy,8),se.KVO(yt.DS,8),se.KVO(yt.CP,8),se.KVO(yt.yy,8),se.KVO(yt.ZP,8),se.KVO(yt.$z,8),se.KVO(yt.AU,8),se.KVO(yt.UB,8),se.KVO(qe.Jv,8))};static \u0275prov=se.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),Ry=(()=>{class r{constructor(){_y.A.registerVersion("angularfire",qe.xv.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Od,useValue:!0},{provide:Ld,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=se.$C({type:r});static \u0275inj=se.G2t({providers:[Ud]})}return r})()}}]);