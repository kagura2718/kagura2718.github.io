"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[970],{681:(X,L,o)=>{o.d(L,{g:()=>P});var I=o(2200),a=o(3664);function _(f,e){1&f&&(a.j41(0,"span",2),a.EFF(1,"[\u524a\u9664]"),a.k0s())}function s(f,e){1&f&&a.nrm(0,"img",5),2&f&&a.Y8G("src",a.mNQ(e.$implicit),a.B4B)}function U(f,e){if(1&f&&(a.j41(0,"span",3),a.DNE(1,s,1,2,"img",4),a.EFF(2),a.k0s()),2&f){const G=e.$implicit;a.Y8G("title",a.mNQ(G.about)),a.R7$(),a.Y8G("ngIf",G.photoURL),a.R7$(),a.JRh(G.nickname)}}let P=(()=>{class f{userPublic;constructor(){}static \u0275fac=function(F){return new(F||f)};static \u0275cmp=a.VBU({type:f,selectors:[["gitfire-user-box"]],inputs:{userPublic:"userPublic"},decls:3,vars:2,consts:[["voidUser",""],["class","p-1",3,"title",4,"ngIf","ngIfElse"],["title","\u524a\u9664\u3055\u308c\u305f\u30e6\u30fc\u30b6\u3067\u3059",1,"text-warning"],[1,"p-1",3,"title"],["class","p-1","style","height: 100%; width: 2rem;",3,"src",4,"ngIf"],[1,"p-1",2,"height","100%","width","2rem",3,"src"]],template:function(F,h){if(1&F&&a.DNE(0,_,2,0,"ng-template",null,0,a.C5r)(2,U,3,4,"span",1),2&F){const C=a.sdS(1);a.R7$(2),a.Y8G("ngIf",h.userPublic)("ngIfElse",C)}},dependencies:[I.MD,I.bT],encapsulation:2})}return f})()},3371:(X,L,o)=>{o.d(L,{O:()=>h});var I=o(2200),a=o(9417),_=o(3664),s=o(8132),U=o(8531),P=o(3562),f=o(5312),e=o(2615);function G(C,g){1&C&&_.nrm(0,"span",12)}function F(C,g){if(1&C&&(_.qex(0),_.j41(1,"div",10),_.nrm(2,"div",13),_.k0s(),_.bVm()),2&C){const t=_.XpG();_.R7$(2),_.Y8G("innerHTML",t.tosJson.html,_.npT)}}let h=(()=>{class C extends U.s{confirmed=new _.bkB;inputConfirmForm;tosJson;constructor(){super()}ngOnInit(){(0,f.Oi)("TosConfirmComponent.OnInit()"),this.inputConfirmForm=new a.gE({}),this.inputConfirmForm.addControl("neverConfirmTosCheck",new a.MJ(!1))}ngAfterViewInit(){(0,f.Oi)("TosConfirmComponent.AfterViewInit()")}get neverCheckTosControl(){return this.inputConfirmForm.get("neverConfirmTosCheck")}onClickConfirm(t){if(t.preventDefault(),this.inputConfirmForm.markAllAsTouched(),this.inputConfirmForm.invalid)return;const b=new P.n,R=this.inputConfirmForm.get("neverConfirmTosCheck");b.saveNeverAsk=R.value,b.isConfirmed=!0,this.confirmed.emit(b)}static \u0275fac=function(b){return new(b||C)};static \u0275cmp=_.VBU({type:C,selectors:[["gitfire-tos-confirm"]],inputs:{tosJson:"tosJson"},outputs:{confirmed:"confirmed"},features:[_.Vt3],decls:19,vars:6,consts:[["loadingTemplate",""],[1,"container"],[4,"ngIf","ngIfElse"],[1,"text-center"],[3,"formGroup"],[1,"m-5","custom-control","custom-checkbox"],["for","appGitfireTosConfirmNeverDismissCheck",1,"visually-hidden"],["id","appGitfireTosConfirmNeverDismissCheck","name","neverConfirmTosCheck","formControlName","neverConfirmTosCheck","type","checkbox",1,"form-check-input"],[1,"text-muted","fw-light"],["routerLink","/terms.htm"],[1,"m-3"],["id","appGitfireTosConfirmButton","data-bs-dismiss","modal",1,"btn","btn-success",3,"click","disabled"],["role","status",1,"spinner-border","text-primary"],[3,"innerHTML"]],template:function(b,R){if(1&b){const N=_.RV6();_.DNE(0,G,1,0,"ng-template",null,0,_.C5r),_.j41(2,"div",1),_.DNE(3,F,3,1,"ng-container",2),_.j41(4,"div",3)(5,"form",4)(6,"div",5)(7,"label",6),_.EFF(8,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),_.k0s(),_.nrm(9,"input",7),_.EFF(10,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),_.k0s(),_.j41(11,"div",8),_.EFF(12,"\u8a73\u3057\u304f\u306f"),_.j41(13,"a",9),_.EFF(14,"[\u5229\u7528\u898f\u7d04]"),_.k0s(),_.EFF(15,"\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002 "),_.k0s(),_.j41(16,"div",10)(17,"button",11),_.bIt("click",function(k){return e.eBV(N),e.Njj(R.onClickConfirm(k))}),_.EFF(18,"\u78ba\u8a8d\u3057\u307e\u3057\u305f"),_.k0s()()()()()}if(2&b){const N=_.sdS(1);_.R7$(3),_.Y8G("ngIf",R.tosJson)("ngIfElse",N),_.R7$(2),_.Y8G("formGroup",R.inputConfirmForm),_.R7$(),_.AVh("was-validated",R.neverCheckTosControl.dirty||R.neverCheckTosControl.touched),_.R7$(11),_.Y8G("disabled",!R.inputConfirmForm.valid)}},dependencies:[I.MD,I.bT,a.X1,a.qT,a.Zm,a.BC,a.cb,a.j4,a.JD,s.Wk],encapsulation:2})}return C})()},3562:(X,L,o)=>{o.d(L,{O:()=>a,n:()=>I});class I{saveNeverAsk;isConfirmed}var a=function(_){return _[_.Ok=0]="Ok",_[_.No=1]="No",_[_.OkPermanent=2]="OkPermanent",_}(a||{})},4710:(X,L,o)=>{o.d(L,{F:()=>ht});var I=o(467),a=o(2200),_=o(6354),s=o(5558),U=o(6977),P=o(1413),f=o(7673),e=o(5371),G=o(681),F=o(619),h=o(2275),C=o(5312),g=o(2615),t=o(3664),b=o(1474),R=o(9243),N=o(8334),j=o(4871),k=o(5794);function T(i,c){1&i&&t.nrm(0,"span",3)}function x(i,c){if(1&i&&(t.j41(0,"span",21)(1,"small",7),t.nI1(2,"date"),t.EFF(3),t.nI1(4,"date"),t.k0s()()),2&i){const n=t.XpG().$implicit;t.R7$(),t.Y8G("title",t.mNQ(t.i5U(2,3,n.updatedAt,"yyyy-MM-dd HH:mm"))),t.R7$(2),t.SpI("\u66f4\u65b0\u65e5: ",t.i5U(4,6,n.updatedAt,"yyyy-MM-dd"))}}function E(i,c){if(1&i&&(t.j41(0,"span",21)(1,"small"),t.EFF(2),t.nI1(3,"date"),t.k0s()()),2&i){const n=t.XpG().$implicit;t.R7$(2),t.SpI("\u627f\u8a8d\u65e5: ",t.i5U(3,1,n.decisionAt,"yyyy-MM-dd"))}}function B(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",33),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickApprove(r,d))}),t.EFF(1,"\u627f\u8a8d"),t.k0s()}}function A(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",34),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickApprove(r,d))}),t.EFF(1,"\u7de8\u96c6\u627f\u8a8d"),t.k0s()}}function Y(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",35),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickApprove(r,d))}),t.EFF(1,"\u524a\u9664\u627f\u8a8d"),t.k0s()}}function M(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",36),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickReject(r,d))}),t.EFF(1,"\u62d2\u5426"),t.k0s()}}function W(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",37),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickReject(r,d))}),t.EFF(1,"\u7de8\u96c6\u62d2\u5426"),t.k0s()}}function l(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",38),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickReject(r,d))}),t.EFF(1,"\u7de8\u96c6\u62d2\u5426"),t.k0s()}}function $(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",39),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickProtect(r,d))}),t.EFF(1,"\u4fdd\u8b77"),t.k0s()}}function m(i,c){if(1&i){const n=t.RV6();t.j41(0,"a",40),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2).$implicit,p=t.XpG(2);return g.Njj(p.onClickUnProtect(r,d))}),t.EFF(1,"\u4fdd\u8b77\u89e3\u9664"),t.k0s()}}function v(i,c){if(1&i&&(t.j41(0,"span",22)(1,"span",23),t.EFF(2,"\ufe19"),t.k0s(),t.j41(3,"div",24),t.DNE(4,B,2,0,"a",25)(5,A,2,0,"a",26)(6,Y,2,0,"a",27)(7,M,2,0,"a",28)(8,W,2,0,"a",29)(9,l,2,0,"a",30)(10,$,2,0,"a",31)(11,m,2,0,"a",32),t.k0s()()),2&i){const n=t.XpG().$implicit;t.R7$(4),t.Y8G("ngIf","pending"===n.store.state),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&"edit-request"===n.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&"delete-request"===n.store.editedState),t.R7$(),t.Y8G("ngIf","pending"===n.store.state),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&"edit-request"===n.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&"delete-request"===n.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&!n.store.isAdminEdit),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&n.store.isAdminEdit)}}function D(i,c){1&i&&t.nrm(0,"gitfire-user-box",41),2&i&&t.Y8G("userPublic",c.$implicit)}function O(i,c){1&i&&(t.j41(0,"span",42),t.EFF(1,"\u7ba1\u7406\u4eba\u306b\u3088\u308b\u4fdd\u8b77"),t.k0s())}function w(i,c){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u5374\u4e0b\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3067\u3059\u3002"),t.k0s())}function K(i,c){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u627f\u8a8d\u5f85\u3061\u306e\u30b3\u30e1\u30f3\u30c8\u3067\u3059\u3002"),t.k0s())}function V(i,c){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function S(i,c){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u7de8\u96c6\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function J(i,c){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u524a\u9664\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function H(i,c){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u524a\u9664\u7533\u8acb\u4e2d\u3067\u3059\u3002"),t.k0s())}function Q(i,c){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u7de8\u96c6\u7533\u8acb\u4e2d\u3067\u3059\u3002"),t.k0s())}function z(i,c){if(1&i&&(t.qex(0)(1,14),t.DNE(2,S,2,0,"span",15)(3,J,2,0,"span",15)(4,H,2,0,"span",15)(5,Q,2,0,"span",16),t.bVm()()),2&i){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngSwitch",n.store.editedState),t.R7$(),t.Y8G("ngSwitchCase","edit-rejected"),t.R7$(),t.Y8G("ngSwitchCase","delete-rejected"),t.R7$(),t.Y8G("ngSwitchCase","delete-request"),t.R7$(),t.Y8G("ngSwitchCase","edit-request")}}function Z(i,c){if(1&i){const n=t.RV6();t.qex(0),t.j41(1,"gitfire-comment-editor",46),t.bIt("requestSent",function(){g.eBV(n);const r=t.XpG(3).$implicit,d=t.XpG(2);return g.Njj(d.onEditRequested(r))})("editDismiss",function(){g.eBV(n);const r=t.XpG(3).$implicit,d=t.XpG(2);return g.Njj(d.onEditDismissed(r))}),t.k0s(),t.bVm()}if(2&i){const n=c.$implicit,u=t.XpG(5);t.R7$(),t.Y8G("pageId",u.pageId)("editModel",n)("showDismiss",!0)}}function q(i,c){if(1&i&&(t.qex(0),t.DNE(1,Z,2,3,"ng-container",2),t.nI1(2,"async"),t.bVm()),2&i){const n=t.XpG(2).$implicit;t.R7$(),t.Y8G("ngIf",t.bMT(2,1,n.editor$))}}function tt(i,c){if(1&i&&t.nrm(0,"div",47),2&i){const n=t.XpG(2).$implicit;t.Y8G("innerHTML",n.store.messageHtml,t.npT)}}function nt(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,q,3,3,"ng-container",2)(2,tt,1,1,"div",45),t.k0s()),2&i){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",n.isEditing),t.R7$(),t.Y8G("ngIf","approved"===n.store.state&&!n.isEditing)}}function et(i,c){if(1&i&&t.nrm(0,"div",47),2&i){const n=t.XpG(2).$implicit;t.Y8G("innerHTML",n.store.messageHtml,t.npT)}}function it(i,c){if(1&i&&(t.qex(0),t.DNE(1,et,1,1,"div",45),t.bVm()),2&i){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","approved"===n.store.state)}}function ot(i,c){1&i&&t.nrm(0,"span",3)}function st(i,c){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",c.$implicit.messageHtml,t.npT)}function rt(i,c){if(1&i&&(t.j41(0,"div",51)(1,"span",44),t.EFF(2,"\u7533\u8acb\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,st,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG();const n=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",n)}}function ut(i,c){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",c.$implicit.messageHtml,t.npT)}function _t(i,c){if(1&i&&(t.j41(0,"div",54)(1,"span",43),t.EFF(2,"\u5374\u4e0b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,ut,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG();const n=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",n)}}function at(i,c){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",c.$implicit.messageHtml,t.npT)}function mt(i,c){if(1&i&&(t.j41(0,"div",51)(1,"span",44),t.EFF(2,"\u7de8\u96c6\u7533\u8acb\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,at,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG(2);const n=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",n)}}function ct(i,c){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",c.$implicit.messageHtml,t.npT)}function dt(i,c){if(1&i&&(t.j41(0,"div",54)(1,"span",43),t.EFF(2,"\u7de8\u96c6\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,ct,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG(2);const n=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",n)}}function lt(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,mt,5,4,"div",49)(2,dt,5,4,"div",50),t.k0s()),2&i){const n=t.XpG(2).$implicit;t.R7$(),t.Y8G("ngIf","edit-request"===n.store.editedState),t.R7$(),t.Y8G("ngIf","edit-rejected"===n.store.editedState)}}function pt(i,c){if(1&i&&(t.j41(0,"div",48),t.DNE(1,ot,1,0,"ng-template",null,0,t.C5r)(3,rt,5,4,"div",49)(4,_t,5,4,"div",50)(5,lt,3,2,"div",2),t.k0s()),2&i){const n=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf","pending"===n.store.state),t.R7$(),t.Y8G("ngIf","rejected"===n.store.state),t.R7$(),t.Y8G("ngIf","approved"===n.store.state)}}function Ct(i,c){if(1&i){const n=t.RV6();t.qex(0),t.j41(1,"button",55),t.bIt("click",function(r){g.eBV(n);const d=t.XpG().$implicit,p=t.XpG(2);return g.Njj(p.onClickReply(r,d))}),t.EFF(2,"\u8fd4\u4fe1"),t.k0s(),t.bVm()}}function gt(i,c){if(1&i){const n=t.RV6();t.qex(0),t.j41(1,"button",56),t.bIt("click",function(r){g.eBV(n);const d=t.XpG().$implicit,p=t.XpG(2);return g.Njj(p.onClickDelete(r,d))}),t.EFF(2,"\u524a\u9664"),t.k0s(),t.j41(3,"button",57),t.bIt("click",function(r){g.eBV(n);const d=t.XpG().$implicit,p=t.XpG(2);return g.Njj(p.onClickEdit(r,d))}),t.EFF(4,"\u7de8\u96c6"),t.k0s(),t.bVm()}}function Et(i,c){if(1&i){const n=t.RV6();t.j41(0,"div",19)(1,"gitfire-comment-editor",58),t.bIt("requestSent",function(){g.eBV(n);const r=t.XpG().$implicit,d=t.XpG(2);return g.Njj(d.onReplyRequested(r))})("editDismiss",function(){g.eBV(n);const r=t.XpG().$implicit,d=t.XpG(2);return g.Njj(d.onReplyDismissed(r))}),t.k0s()()}if(2&i){const n=t.XpG().$implicit,u=t.XpG(2);t.R7$(),t.Y8G("showDismiss",!0)("replyId",n.store.id)("pageId",u.pageId)}}function ft(i,c){if(1&i&&(t.j41(0,"div",6)(1,"div")(2,"div")(3,"span",7),t.nI1(4,"date"),t.EFF(5),t.nI1(6,"date"),t.k0s(),t.DNE(7,x,5,9,"span",8)(8,E,4,4,"span",8)(9,v,12,8,"span",9),t.k0s(),t.j41(10,"div",10),t.EFF(11,"\u30e6\u30fc\u30b6: "),t.DNE(12,D,1,1,"gitfire-user-box",11),t.nI1(13,"async"),t.k0s()(),t.j41(14,"div",12)(15,"div"),t.DNE(16,O,2,0,"span",13),t.qex(17,14),t.DNE(18,w,2,0,"span",15)(19,K,2,0,"span",16)(20,V,2,0,"span",16)(21,z,6,5,"ng-container",17),t.bVm(),t.k0s(),t.j41(22,"div"),t.DNE(23,nt,3,2,"div",2)(24,it,2,1,"ng-container",2),t.k0s(),t.DNE(25,pt,6,3,"div",18),t.k0s(),t.j41(26,"div",19),t.DNE(27,Ct,3,0,"ng-container",2)(28,gt,5,0,"ng-container",2),t.k0s(),t.DNE(29,Et,2,3,"div",20),t.k0s()),2&i){const n=c.$implicit,u=c.odd,r=t.XpG(2);t.xc7("background",u?r.ACCENT_COLOR:null),t.Y8G("id",t.VkB("appGitfireComment-",n.store.id)),t.R7$(3),t.Y8G("title",t.mNQ(t.i5U(4,23,n.publishAt,"yyyy-MM-dd HH:mm"))),t.R7$(2),t.SpI("\u6295\u7a3f\u65e5\u6642: ",t.i5U(6,26,n.publishAt,"yyyy-MM-dd HH:mm")),t.R7$(2),t.Y8G("ngIf",n.isEdited),t.R7$(),t.Y8G("ngIf",n.decisionAt),t.R7$(),t.Y8G("ngIf",n.isDisplayAdmin),t.R7$(3),t.Y8G("ngIf",t.bMT(13,29,n.user$)),t.R7$(4),t.Y8G("ngIf",n.store.isAdminEdit),t.R7$(),t.Y8G("ngSwitch",n.store.state),t.R7$(),t.Y8G("ngSwitchCase","rejected"),t.R7$(),t.Y8G("ngSwitchCase","pending"),t.R7$(),t.Y8G("ngSwitchCase","deleted"),t.R7$(),t.Y8G("ngSwitchCase","approved"),t.R7$(2),t.Y8G("ngIf",n.isOwn),t.R7$(),t.Y8G("ngIf",!n.isOwn),t.R7$(),t.Y8G("ngIf",n.isOwn||n.isDisplayAdmin),t.R7$(2),t.Y8G("ngIf",n.canReply),t.R7$(),t.Y8G("ngIf",n.canChange),t.R7$(),t.Y8G("ngIf",n.isReplying)}}function vt(i,c){if(1&i){const n=t.RV6();t.j41(0,"button",59),t.bIt("click",function(r){g.eBV(n);const d=t.XpG(2);return g.Njj(d.onClickMoreComment(r))}),t.EFF(1,"\u3055\u3089\u306b\u8aad\u307f\u8fbc\u3080"),t.k0s()}}function Dt(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,ft,30,31,"div",4)(2,vt,2,0,"button",5),t.k0s()),2&i){const n=t.XpG();t.R7$(),t.Y8G("ngForOf",n.comments),t.R7$(),t.Y8G("ngIf",n.maybeMoreComment)}}class It{store;updatedAt;publishAt;decisionAt;isEdited;privateMessage$;editor$;user$;isEditing;isReplying;isDisplayAdmin;canReply;canChange;isOwn}let ht=(()=>{class i{auth;user;dialog;store;funcs;toastr;ACCENT_COLOR=C.cA.themaColor.EVEN;destroy$=new P.B;pageId;isPageProtect=!1;comments$;comments=[];commentData={};maybeMoreComment=!1;isLoading=!0;constructor(n,u,r,d,p,y){this.auth=n,this.user=u,this.dialog=r,this.store=d,this.funcs=p,this.toastr=y,this.comments$=this.store.doc(`/comment/v1/page/${this.pageId}`).collection("public",Ft=>Ft.orderBy("publishAt","desc").limit(30)).valueChanges({idField:"id"})}ngOnDestroy(){(0,C.Oi)("CommentListComponent.OnDestroy()"),this.destroy$.next()}ngOnInit(){(0,C.Oi)("CommentListComponent.OnInit()"),this.comments$.pipe((0,U.Q)(this.destroy$)).subscribe(n=>{for(let u of n){let r=this.commentData[u.id];r||(r=new It,this.comments.push(r)),r.publishAt=u.publishAt.toDate(),r.updatedAt=u.updatedAt.toDate();const d=r.updatedAt.getTime()-r.publishAt.getTime();r.isEdited="none"!==u.editedState&&Math.abs(d)>5,u.decisionAt&&(r.decisionAt=u.decisionAt.toDate()),r.user$=this.user.user$(u.owner),r.store=u,this.auth.myUid===u.owner||this.auth.isAdmin?r.privateMessage$||(r.privateMessage$=(0,f.of)({pageId:this.pageId,commentId:u.id}).pipe((0,s.n)(y=>this.funcs.call("readPrivateComment",y)),(0,_.T)(y=>y)),r.editor$=r.privateMessage$.pipe((0,_.T)(y=>({id:y.id,message:y.message,images:y.images})))):r.editor$=(0,f.of)({id:u.id,message:u.message,images:u.images}),r.isDisplayAdmin=this.auth.isAdmin,r.isOwn=u.owner===this.auth.myUid,r.canReply=!this.isPageProtect&&!r.isOwn&&"approved"==u.state&&!u.isProtect,r.canChange=r.isOwn&&!u.isAdminEdit&&!u.isProtect&&"approved"===u.state,this.commentData[u.id]=r}this.comments=this.comments.sort((u,r)=>r.publishAt.getTime()-u.publishAt.getTime()),this.isLoading=!1})}onClickEdit(n,u){(0,C.Oi)("CommentListComponent.onClickEdit()"),u.isEditing=!0}doDeleteRequest(n){var u=this;return(0,I.A)(function*(){const r={pageId:u.pageId,commentId:n.store.id};try{yield u.funcs.call("deleteComment",r),u.toastr.info("\u524a\u9664\u7533\u8acb\u3057\u307e\u3057\u305f\u3002\u627f\u8a8d\u5f8c\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002")}catch(d){(0,C.sJ)("Error while delete request",d);const p=d instanceof Error?d.message:"Unknown error";u.toastr.error(`\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002 ( ${p} )`)}})()}onClickDelete(n,u){var r=this;return(0,I.A)(function*(){(0,C.Oi)("onClickDelete()",n,u);const d=r.dialog.createHtmlBuilder(),p=new h.tt("\n<div>\n\u7ba1\u7406\u4eba\u306b\u627f\u8a8d\u3055\u308c\u305f\u5f8c\u3067\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n</div>\n");d.setMessage(p).setType(F.hs.Warn).setSize(F.EV.Default).setTitle("\u78ba\u8a8d").okButton((0,I.A)(function*(){yield r.doDeleteRequest(u)})).cancelButton(()=>{}).open()})()}onClickReply(n,u){(0,C.Oi)("CommentListComponent.onClickReply()",n,u),u.isReplying=!0}onEditDismissed(n){(0,C.Oi)("CommentListComponent.onEditDismissed()"),n.isEditing=!1}onEditRequested(n){(0,C.Oi)("CommentListComponent.onEditRequested()"),n.isEditing=!1}onReplyRequested(n){(0,C.Oi)("CommentListComponent.onReplyRequested()"),n.isReplying=!1}onReplyDismissed(n){(0,C.Oi)("CommentListComponent.onReplyDismissed()"),n.isReplying=!1}onClickMoreComment(n){(0,C.Oi)("CommentListComponent.onClickMoreComment()")}onClickApprove(n,u){var r=this;return(0,I.A)(function*(){(0,C.Oi)("CommentListComponent.onClickApprove()");const d={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("approveComment",d),r.toastr.info("\u627f\u8a8d\u3057\u307e\u3057\u305f\u3002")}catch(p){(0,C.sJ)("Error while approve",p);const y=p instanceof Error?p.message:"Unknown error";r.toastr.error(`\u627f\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickReject(n,u){var r=this;return(0,I.A)(function*(){(0,C.Oi)("CommentListComponent.onClickReject()");const d={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("rejectComment",d),r.toastr.info("\u5374\u4e0b\u3057\u307e\u3057\u305f\u3002")}catch(p){(0,C.sJ)("Error while reject",p);const y=p instanceof Error?p.message:"Unknown error";r.toastr.error(`\u5374\u4e0b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickProtect(n,u){var r=this;return(0,I.A)(function*(){(0,C.Oi)("CommentListComponent.onClickProtect()");const d={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("protectComment",d),r.toastr.info("\u4fdd\u8b77\u3057\u307e\u3057\u305f\u3002")}catch(p){(0,C.sJ)("Error while protect",p);const y=p instanceof Error?p.message:"Unknown error";r.toastr.error(`\u4fdd\u8b77\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickUnProtect(n,u){var r=this;return(0,I.A)(function*(){(0,C.Oi)("CommentListComponent.onClickUnProtect()");const d={pageId:r.pageId,commentId:u.store.id,unprotect:!0};try{yield r.funcs.call("protectComment",d),r.toastr.info("\u4fdd\u8b77\u89e3\u9664\u3057\u307e\u3057\u305f\u3002")}catch(p){(0,C.sJ)("Error while unprotect",p);const y=p instanceof Error?p.message:"Unknown error";r.toastr.error(`\u4fdd\u8b77\u89e3\u9664\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}static \u0275fac=function(u){return new(u||i)(t.rXU(b.u),t.rXU(R.D),t.rXU(F.o3),t.rXU(N.Qe),t.rXU(j.Y),t.rXU(k.tw))};static \u0275cmp=t.VBU({type:i,selectors:[["gitfire-comment-list"]],inputs:{pageId:"pageId",isPageProtect:"isPageProtect"},decls:2,vars:2,consts:[["loadingMessage",""],["class","spinner-border text-primary","role","status",4,"ngIf"],[4,"ngIf"],["role","status",1,"spinner-border","text-primary"],[3,"id","background",4,"ngFor","ngForOf"],["class","btn btn-primary","title","\u53e4\u3044\u6295\u7a3f\u3092\u3055\u3089\u306b\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002",3,"click",4,"ngIf"],[3,"id"],[3,"title"],["class","mx-1",4,"ngIf"],["class","mx-2","style","position: absolute; right: 0px;","data-bs-toggle","dropdown",4,"ngIf"],[2,"height","2rem"],[3,"userPublic",4,"ngIf"],[1,"m-1"],["class","border border-danger text-danger m-1 p-1",4,"ngIf"],[3,"ngSwitch"],["class","text-warning",4,"ngSwitchCase"],["class","text-info",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","p-2",4,"ngIf"],[1,"m-2"],["class","m-2",4,"ngIf"],[1,"mx-1"],["data-bs-toggle","dropdown",1,"mx-2",2,"position","absolute","right","0px"],[1,"gitweeMenuItem"],[1,"dropdown-menu"],["class","text-info dropdown-item gitweeMenuItem","title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-info dropdown-item gitweeMenuItem","title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-info dropdown-item gitweeMenuItem","title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-danger dropdown-item gitweeMenuItem","title","\u30b3\u30e1\u30f3\u30c8\u3092\u4fdd\u8b77\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-danger dropdown-item gitweeMenuItem","title","\u30b3\u30e1\u30f3\u30c8\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u3092\u4fdd\u8b77\u3057\u307e\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],[3,"userPublic"],[1,"border","border-danger","text-danger","m-1","p-1"],[1,"text-warning"],[1,"text-info"],["class","p-2",3,"innerHTML",4,"ngIf"],[3,"requestSent","editDismiss","pageId","editModel","showDismiss"],[1,"p-2",3,"innerHTML"],[1,"p-2"],["class","border border-info",4,"ngIf"],["class","border border-warning",4,"ngIf"],[1,"border","border-info"],[3,"innerHTML",4,"ngIf","ngIfElse"],[3,"innerHTML"],[1,"border","border-warning"],["title","\u3053\u306e\u30b3\u30e1\u30f3\u30c8\u3078\u8fd4\u4fe1\u3057\u307e\u3059\u3002",1,"btn","btn-primary","m-1",3,"click"],["title","\u6295\u7a3f\u306e\u524a\u9664\u3092\u7533\u8acb\u3057\u307e\u3059\u3002",1,"btn","btn-warning","m-1",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[3,"requestSent","editDismiss","showDismiss","replyId","pageId"],["title","\u53e4\u3044\u6295\u7a3f\u3092\u3055\u3089\u306b\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002",1,"btn","btn-primary",3,"click"]],template:function(u,r){1&u&&t.DNE(0,T,1,0,"span",1)(1,Dt,3,2,"div",2),2&u&&(t.Y8G("ngIf",r.isLoading),t.R7$(),t.Y8G("ngIf",r.comments))},dependencies:[a.MD,a.Sq,a.bT,a.ux,a.e1,e.m,G.g,a.Jj,a.vh],styles:[".gitweeMenuItem[_ngcontent-%COMP%]{cursor:pointer}"]})}return i})()},5371:(X,L,o)=>{o.d(L,{m:()=>k});var I=o(467),a=o(2200),_=o(9417),s=o(3664),U=o(5964),P=o(5312),f=o(2615),e=o(9243),G=o(1474),F=o(5794),h=o(4871),C=o(7234);function g(T,x){if(1&T){const E=s.RV6();s.j41(0,"div",9)(1,"button",10),s.bIt("click",function(){f.eBV(E);const A=s.XpG();return f.Njj(A.onClickDismiss())}),s.j41(2,"span",11),s.EFF(3,"\xd7"),s.k0s()()()}}function t(T,x){1&T&&(s.j41(0,"div",12),s.EFF(1,"OK!"),s.k0s())}function b(T,x){1&T&&(s.j41(0,"div",14),s.EFF(1,"\u5165\u529b\u5fc5\u9808\u3067\u3059\u3002"),s.k0s())}function R(T,x){1&T&&(s.j41(0,"div",14),s.EFF(1,"\u9577\u3059\u304e\u307e\u3059\u3002"),s.k0s())}function N(T,x){1&T&&(s.j41(0,"div",14),s.EFF(1,"\u77ed\u3059\u304e\u307e\u3059\u3002"),s.k0s())}function j(T,x){if(1&T&&(s.qex(0),s.DNE(1,b,2,0,"div",13)(2,R,2,0,"div",13)(3,N,2,0,"div",13),s.bVm()),2&T){const E=s.XpG();s.R7$(),s.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.required),s.R7$(),s.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.maxlength),s.R7$(),s.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.minlength)}}let k=(()=>{class T{user;auth;toastr;funcs;tos;editModel;pageId;showDismiss=!1;replyId;requestSent=new s.bkB;editDismiss=new s.bkB;inputForm;constructor(E,B,A,Y,M){this.user=E,this.auth=B,this.toastr=A,this.funcs=Y,this.tos=M}get textareaControl(){return this.inputForm.get("commentText")}ngOnInit(){(0,P.Oi)("CommentEditorComponent.OnInit()"),this.inputForm=new _.gE({}),this.inputForm.addControl("commentText",new _.MJ(this.editModel?this.editModel.message:null,[_.k0.required]))}onClickDismiss(){(0,P.Oi)("CommentEditorComponent.onClickDismiss()"),this.editDismiss.emit()}doNewPost(){var E=this;return(0,I.A)(function*(){const B={message:E.textareaControl.value,pageId:E.pageId,replyId:E.replyId};return yield E.funcs.call("postComment",B)})()}doUpdatePost(E){var B=this;return(0,I.A)(function*(){const A={pageId:B.pageId,commentId:E.id,message:B.textareaControl.value};return yield B.funcs.call("editComment",A)})()}onClickPostComment(){var E=this;(0,P.Oi)("CommentEditorComponent.onClickPostComment()"),!this.inputForm.invalid&&(this.textareaControl.invalid||this.tos.confirmTos$(`${this.auth.myUid}/commentAgreement`,P.cA.CommentServiceTosUrl).pipe((0,U.p)(B=>B)).subscribe(function(){var B=(0,I.A)(function*(A){E.inputForm.disable();try{E.editModel?yield E.doUpdatePost(E.editModel):yield E.doNewPost(),E.toastr.info("\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002(\u627f\u8a8d\u3055\u308c\u308b\u307e\u3067\u4ed6\u306e\u4eba\u306b\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002)"),E.textareaControl.setValue(""),E.inputForm.markAsPristine(),E.inputForm.markAsUntouched(),E.requestSent.emit()}catch(Y){E.toastr.error("message"in Y?`\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002( ${Y.message} )`:"\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{E.inputForm.enable()}});return function(A){return B.apply(this,arguments)}}()))}static \u0275fac=function(B){return new(B||T)(s.rXU(e.D),s.rXU(G.u),s.rXU(F.tw),s.rXU(h.Y),s.rXU(C.u))};static \u0275cmp=s.VBU({type:T,selectors:[["gitfire-comment-editor"]],inputs:{editModel:"editModel",pageId:"pageId",showDismiss:"showDismiss",replyId:"replyId"},outputs:{requestSent:"requestSent",editDismiss:"editDismiss"},decls:16,vars:15,consts:[["class","text-end",4,"ngIf"],[1,"input-group",3,"formGroup"],["title","\u3053\u306e\u540d\u524d\u3067\u6295\u7a3f\u306f\u8868\u793a\u3055\u308c\u307e\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["disabled","",1,"m-3",3,"value"],[1,"m-3"],["autofocus","","name","commentText","formControlName","commentText","placeholder","\u6295\u7a3f\u3059\u308b\u30b3\u30e1\u30f3\u30c8\u3092\u3053\u3053\u306b\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u3002","required","","minlength","5","maxlength","65536",1,"p-3","form-control"],["class","valid-feedback",4,"ngIf"],[4,"ngIf"],["title","\u30b3\u30e1\u30f3\u30c8\u5185\u5bb9\u306f\u627f\u8a8d\u5f8c\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002",1,"btn","btn-primary","m-2",3,"click","disabled"],[1,"text-end"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"valid-feedback"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]],template:function(B,A){1&B&&(s.DNE(0,g,4,0,"div",0),s.j41(1,"div",1)(2,"div")(3,"label"),s.EFF(4,"\u540d\u524d"),s.nrm(5,"img",2),s.EFF(6,": "),s.k0s(),s.nrm(7,"input",3),s.nI1(8,"async"),s.k0s(),s.j41(9,"div",4),s.nrm(10,"textarea",5),s.DNE(11,t,2,0,"div",6)(12,j,4,3,"ng-container",7),s.k0s(),s.j41(13,"div")(14,"button",8),s.bIt("click",function(){return A.onClickPostComment()}),s.EFF(15,"\u6295\u7a3f\u3059\u308b"),s.k0s()()()),2&B&&(s.Y8G("ngIf",A.showDismiss),s.R7$(),s.AVh("was-validated",A.textareaControl.dirty||A.textareaControl.touched),s.Y8G("formGroup",A.inputForm),s.R7$(6),s.Y8G("value",s.mNQ(s.bMT(8,13,A.user.myNickname$()))),s.R7$(2),s.xc7("width",100,"%"),s.R7$(),s.xc7("height",8,"rem"),s.R7$(),s.Y8G("ngIf",!A.textareaControl.invalid),s.R7$(),s.Y8G("ngIf",A.textareaControl.invalid),s.R7$(2),s.Y8G("disabled",A.textareaControl.invalid||A.inputForm.disabled))},dependencies:[a.MD,a.bT,_.X1,_.me,_.BC,_.cb,_.YS,_.xh,_.tU,_.j4,_.JD,a.Jj],encapsulation:2})}return T})()},7234:(X,L,o)=>{o.d(L,{u:()=>b});var I=o(467),a=o(2615),_=o(7935),s=o(3562),U=o(3371),P=o(2275),f=o(1413),e=o(6354),G=o(5558),F=o(6697),h=o(5312),C=o(8001),g=o(619),t=o(8334);let b=(()=>{class R{http;dialog;store;privUser;env=(0,a.WQX)(a.uvJ);constructor(j,k,T){this.http=j,this.dialog=k,this.store=T,this.privUser=this.store.collection("/users/v1/protected")}constructSetupTosConfirm(j,k){return T=>{T.tosJson=k.json,T.confirmed.subscribe(x=>{if(!x.isConfirmed)throw new Error("assert");k.answer=x.saveNeverAsk?s.O.OkPermanent:s.O.Ok,j.next(k)})}}confirmTos$(j,k){var T=this;if(j.match(/\/$/))throw new Error(`Assertion. Not a supported ${j}`);const x=new f.B,B=(new f.B,new f.B),A=new f.B,Y=this.http.fetchGhJson(k).pipe((0,F.s)(1),(0,G.n)(M=>(0,a.N4e)(this.env,()=>{const W=this.privUser.doc(`${j}/${M.version}`),l={json:M,cached:!1,cacheRef:W};return W.get().pipe((0,e.T)(($,m)=>($.exists&&$.data().alwaysConfirmed&&((0,h.Oi)("TOS has already been confirmed."),l.cached=!0),l)))})));return A.pipe().subscribe({next:M=>{this.dialog.createDefaultBuilder().prepareBody(U.O).setupChild(this.constructSetupTosConfirm(B,M)).setType(P.hs.Warn).setSize(P.EV.Default).setTitle("\u5229\u7528\u898f\u7d04\u306e\u78ba\u8a8d").closeButton(()=>{M.answer=s.O.No,B.next(M)}).setFinalize(()=>{M.answer=s.O.No,B.next(M)}).open()},complete:()=>{(0,h.Oi)("completeed dialog$")},error:M=>{(0,h.sJ)("error dialog$",M)}}),Y.pipe((0,F.s)(1)).subscribe({next:M=>{M.cached?x.next(!0):A.next(M)},complete:()=>{(0,h.Oi)("Completed TOS reading")},error:M=>{(0,h.sJ)("Failed reading TOS cache",M)}}),B.pipe((0,F.s)(1)).subscribe({next:(M=(0,I.A)(function*(W){switch(W.answer){case s.O.Ok:x.next(!0);break;case s.O.No:x.next(!1);break;case s.O.OkPermanent:const l={_docClass:"User:UserAgreementStore",alwaysConfirmed:!0,createdAt:T.fieldTimestamp()};x.next(!0),yield W.cacheRef.set(l);break;default:throw new Error(`Not a valid answer ${W.answer}`)}}),function(l){return M.apply(this,arguments)}),complete:()=>{(0,h.Oi)("Completed dialog result."),x.complete()},error:M=>{(0,h.sJ)("Failed receive dialog result"),x.complete()}}),x;var M}fieldTimestamp(){return _.A.firestore.FieldValue.serverTimestamp()}static \u0275fac=function(k){return new(k||R)(a.KVO(C.kl),a.KVO(g.o3),a.KVO(t.Qe))};static \u0275prov=a.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},9243:(X,L,o)=>{o.d(L,{D:()=>f});var I=o(2615),a=o(7673),_=o(6354),s=o(9568),U=o(8334),P=o(1474);let f=(()=>{class e{store;auth;pubUser;nicknameCache={};userCache={};env=(0,I.WQX)(I.uvJ);constructor(F,h){this.store=F,this.auth=h,this.pubUser=this.store.collection("/users/v1/public")}myNickname$(){return this.auth.myUid?this.nickname$(this.auth.myUid):(0,a.of)("")}user$(F){let h=this.userCache[F];return h||(h=(0,I.N4e)(this.env,()=>this.pubUser.doc(F).valueChanges().pipe((0,s.t)(1))),this.userCache[F]=h,h)}nickname$(F){let h=this.nicknameCache[F];return h||(h=this.user$(F).pipe((0,_.T)(C=>C?C.nickname:null)),this.nicknameCache[F]=h,h)}static \u0275fac=function(h){return new(h||e)(I.KVO(U.Qe),I.KVO(P.u))};static \u0275prov=I.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},9970:(X,L,o)=>{o.r(L),o.d(L,{CommentEntryComponent:()=>W});var I=o(467),a=o(2200),_=o(9568),s=o(5371),U=o(4710),P=o(5312),f=o(2615),e=o(3664),G=o(1474),F=o(1637),h=o(4871),C=o(8334),g=o(5794);function t(l,$){1&l&&e.nrm(0,"span",3)}function b(l,$){1&l&&(e.j41(0,"div",7),e.EFF(1,"\u30b3\u30e1\u30f3\u30c8\u306f\u3042\u308a\u307e\u305b\u3093"),e.k0s())}function R(l,$){if(1&l){const m=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){f.eBV(m);const D=e.XpG(4);return f.Njj(D.onClickProtect())}),e.EFF(1,"\u30da\u30fc\u30b8\u3092\u4fdd\u8b77"),e.k0s()}}function N(l,$){if(1&l){const m=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){f.eBV(m);const D=e.XpG(4);return f.Njj(D.onClickUnProtect())}),e.EFF(1,"\u4fdd\u8b77\u3092\u89e3\u9664"),e.k0s()}}function j(l,$){if(1&l&&(e.qex(0),e.DNE(1,R,2,0,"button",9)(2,N,2,0,"button",10),e.bVm()),2&l){const m=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",!m.isProtect),e.R7$(),e.Y8G("ngIf",m.isProtect)}}function k(l,$){1&l&&(e.j41(0,"span",14)(1,"span",15),e.EFF(2,"\u30da\u30fc\u30b8\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u307e\u3059"),e.k0s()())}function T(l,$){if(1&l&&(e.qex(0),e.DNE(1,k,3,0,"span",13),e.bVm()),2&l){const m=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",m.isProtect)}}function x(l,$){if(1&l){const m=e.RV6();e.qex(0),e.j41(1,"button",16),e.bIt("click",function(D){f.eBV(m);const O=e.XpG(3);return f.Njj(O.onClickWatchPage(D,!0))}),e.EFF(2,"Watch(\u30c6\u30b9\u30c8\u4e2d)"),e.k0s(),e.j41(3,"button",17),e.bIt("click",function(D){f.eBV(m);const O=e.XpG(3);return f.Njj(O.onClickWatchPage(D,!1))}),e.EFF(4,"Unwatch(\u30c6\u30b9\u30c8\u4e2d)"),e.k0s(),e.bVm()}}function E(l,$){if(1&l&&(e.j41(0,"span",20),e.EFF(1),e.k0s()),2&l){const m=e.XpG(2).$implicit;e.R7$(),e.SpI("(\u4fdd\u7559 ",m.countPending," \u4ef6)")}}function B(l,$){if(1&l&&(e.j41(0,"div",18)(1,"span"),e.EFF(2),e.k0s(),e.DNE(3,E,2,1,"span",19),e.k0s()),2&l){const m=e.XpG().$implicit;e.R7$(2),e.SpI("",m.countAll," \u4ef6\u306e\u30b3\u30e1\u30f3\u30c8"),e.R7$(),e.Y8G("ngIf",m.countPending>0)}}function A(l,$){if(1&l&&(e.j41(0,"div")(1,"div",7),e.DNE(2,j,3,2,"ng-container",2)(3,T,2,1,"ng-container",2)(4,x,5,0,"ng-container",2),e.k0s(),e.DNE(5,B,4,2,"div",8),e.k0s()),2&l){const m=$.$implicit;e.XpG();const v=e.sdS(2),D=e.XpG();e.R7$(2),e.Y8G("ngIf",D.auth.isAdmin),e.R7$(),e.Y8G("ngIf",!D.auth.isAdmin),e.R7$(),e.Y8G("ngIf",D.auth.hasMessaging),e.R7$(),e.Y8G("ngIf",m.countAll>0)("ngIfElse",v)}}function Y(l,$){if(1&l&&e.nrm(0,"gitfire-comment-editor",21),2&l){const m=e.XpG(2);e.Y8G("pageId",m.pageId)}}function M(l,$){if(1&l&&(e.j41(0,"div"),e.DNE(1,b,2,0,"ng-template",null,0,e.C5r)(3,A,6,5,"div",4),e.nI1(4,"async"),e.j41(5,"div"),e.DNE(6,Y,1,1,"gitfire-comment-editor",5),e.nI1(7,"async"),e.nrm(8,"gitfire-comment-list",6),e.nI1(9,"async"),e.k0s()()),2&l){let m,v;const D=e.sdS(2),O=e.XpG();e.R7$(3),e.Y8G("ngIf",e.bMT(4,5,O.pageInfo$))("ngIfElse",D),e.R7$(3),e.Y8G("ngIf",!(null!=(m=e.bMT(7,7,O.pageInfo$))&&m.isProtect)),e.R7$(2),e.Y8G("pageId",O.pageId)("isPageProtect",null==(v=e.bMT(9,9,O.pageInfo$))?null:v.isProtect)}}let W=(()=>{class l{auth;router;funcs;store;toastr;pagePath;pageJson;pageInfo$;pageId;constructor(m,v,D,O,w){this.auth=m,this.router=v,this.funcs=D,this.store=O,this.toastr=w,this.pageInfo$=this.store.doc(`/comment/v1/page/${this.pageId}`).valueChanges().pipe((0,_.t)(1))}pagePath2PageKey(m){const v=`${P.cA.PAGE_DATA}/`,D=v.length,O=m.jsonPath;if(!O.startsWith(v))throw new Error(`Not a supported path ${O}`);return O.substring(D-1)}buildLeafUrl(){const m=this.pageJson;return m.anchorLink?m.anchorId?`${m.anchorLink}#${m.anchorId}`:m.anchorLink:this.router.url}ngOnInit(){var m=this;return(0,I.A)(function*(){(0,P.Oi)("CommentEntryComponent.OnInit()",m.pagePath);const O={pageKey:m.pageJson?.pageKey||m.pagePath2PageKey(m.pagePath),leafUrl:m.buildLeafUrl()};m.pageId=yield m.funcs.call("getPageId",O),(0,P.Oi)("getPageId",m.pageId,O)})()}doProtectPage(m){var v=this;return(0,I.A)(function*(){const D={pageId:v.pageId,unprotect:m};yield v.funcs.call("protectPage",D)})()}onClickUnProtect(){var m=this;return(0,I.A)(function*(){(0,P.Oi)("CommentEntryComponent.onClickUnProtect()");try{m.doProtectPage(!0),m.toastr.info("\u30da\u30fc\u30b8\u306e\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3057\u305f\u3002")}catch(v){(0,P.sJ)(v);const D=v instanceof Error?v.message:"Unknown error";m.toastr.error(`\u30da\u30fc\u30b8\u306e\u4fdd\u8b77\u3092\u89e3\u9664\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${D} )`)}})()}onClickWatchPage(m,v){var D=this;return(0,I.A)(function*(){(0,P.Oi)("CommentEntryComponent.onClickWatchPage()");try{const O={pageId:D.pageId,isWatch:v};yield D.funcs.call("watchCommentPage",O),D.toastr.info(v?"\u30da\u30fc\u30b8\u306e Watch \u3092\u958b\u59cb\u3057\u307e\u3057\u305f\u3002":"\u30da\u30fc\u30b8\u3092 Watch \u3092\u505c\u6b62\u3057\u307e\u3057\u305f\u3002")}catch(O){(0,P.sJ)(O);const w=O instanceof Error?O.message:"Unknown error";D.toastr.error(`\u30da\u30fc\u30b8\u306e Watch \u72b6\u614b\u3092\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${w} )`)}})()}onClickProtect(){var m=this;return(0,I.A)(function*(){(0,P.Oi)("CommentEntryComponent.onClickProtect()");try{m.doProtectPage(!1),m.toastr.info("\u30da\u30fc\u30b8\u3092\u4fdd\u8b77\u3057\u307e\u3057\u305f\u3002")}catch(v){(0,P.sJ)(v);const D=v instanceof Error?v.message:"Unknown error";m.toastr.error(`\u30da\u30fc\u30b8\u3092\u4fdd\u8b77\u72b6\u614b\u306b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${D} )`)}})()}static \u0275fac=function(v){return new(v||l)(e.rXU(G.u),e.rXU(F.O),e.rXU(h.Y),e.rXU(C.Qe),e.rXU(g.tw))};static \u0275cmp=e.VBU({type:l,selectors:[["gitfire-comment-entry"]],inputs:{pagePath:"pagePath",pageJson:"pageJson"},decls:3,vars:2,consts:[["commentNothing",""],["class","spinner-border text-primary","role","status",4,"ngIf"],[4,"ngIf"],["role","status",1,"spinner-border","text-primary"],[4,"ngIf","ngIfElse"],[3,"pageId",4,"ngIf"],[3,"pageId","isPageProtect"],[1,"text-end"],["class","m-1 text-end",4,"ngIf","ngIfElse"],["class","btn btn-danger m-1","title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u7981\u6b62\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","btn btn-info m-1","title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u7981\u6b62\u3057\u307e\u3059\u3002",1,"btn","btn-danger","m-1",3,"click"],["title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002",1,"btn","btn-info","m-1",3,"click"],["class","p-1 border border-danger",4,"ngIf"],[1,"p-1","border","border-danger"],[1,"text-danger"],["title","\u3053\u306e\u6a5f\u80fd\u306f\u8a66\u9a13\u904b\u7528\u4e2d\u3067\u3059\u3002\u3053\u306e\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3001\u66f4\u65b0\u3092\u901a\u77e5\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],["title","\u3053\u306e\u6a5f\u80fd\u306f\u8a66\u9a13\u904b\u7528\u4e2d\u3067\u3059\u3002\u3053\u306e\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3001\u66f4\u65b0\u901a\u77e5\u3092\u505c\u6b62\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[1,"m-1","text-end"],["class","text-warning",4,"ngIf"],[1,"text-warning"],[3,"pageId"]],template:function(v,D){1&v&&(e.nrm(0,"hr"),e.DNE(1,t,1,0,"span",1)(2,M,10,11,"div",2)),2&v&&(e.R7$(),e.Y8G("ngIf",!D.pageId),e.R7$(),e.Y8G("ngIf",D.pageId))},dependencies:[a.MD,a.bT,s.m,U.F,a.Jj],encapsulation:2})}return l})()}}]);