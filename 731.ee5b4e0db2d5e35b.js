"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[731],{731:(S,f,a)=>{a.r(f),a.d(f,{UserTrayComponent:()=>N});var d=a(5861),_=a(553),p=a(8645),x=a(5619),v=a(7328),y=a(2572),T=a(3019),m=a(9773),E=a(2181),l=a(7398),h=a(4664),C=a(3620),i=a(6825),t=a(9212),M=a(9782),A=a(5579),O=a(2413),B=a(9339),u=a(6814),P=a(5187),U=a(1601);function D(e,c){1&e&&(t.TgZ(0,"div",5)(1,"div",6)(2,"span",7),t._uU(3,"Notification is alived."),t.qZA()()())}function L(e,c){if(1&e&&(t.TgZ(0,"span",20),t._uU(1),t.qZA()),2&e){const n=c.$implicit;t.Q6J("@shakeItTrigger",void 0),t.xp6(),t.Oqu(n)}}function I(e,c){if(1&e&&(t.ynx(0),t.TgZ(1,"a",25),t._uU(2),t.qZA(),t.BQk()),2&e){const n=t.oxw().$implicit;t.xp6(),t.s9C("routerLink",n.anchorLink),t.Q6J("fragment",n.anchorId),t.xp6(),t.Oqu(n.title)}}function R(e,c){if(1&e&&(t.ynx(0),t._uU(1),t.BQk()),2&e){const n=t.oxw().$implicit;t.xp6(),t.Oqu(n.title)}}const k=e=>({id:e});function Z(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"tr",8)(1,"td",21),t.YNc(2,I,3,3,"ng-container",0)(3,R,2,1,"ng-container",0),t.qZA(),t.TgZ(4,"td",22),t.ALo(5,"date"),t.TgZ(6,"a",23),t._uU(7),t.ALo(8,"relativeTime"),t.qZA()(),t.TgZ(9,"td")(10,"input",24),t.NdJ("click",function(s){const g=t.CHM(n).$implicit,W=t.oxw(3);return t.KtG(W.onClickRead(s,g))}),t.qZA()()()}if(2&e){const n=c.$implicit;t.xp6(),t.hYB("title","Title: ",n.title,"\n\n",n.body,""),t.xp6(),t.Q6J("ngIf",n.anchorLink),t.xp6(),t.Q6J("ngIf",!n.anchorLink),t.xp6(),t.s9C("title",t.xi3(5,9,n.createdAt.toDate(),"yyyy-MM-dd HH:MM")),t.xp6(2),t.Q6J("queryParams",t.VKq(14,k,n.id)),t.xp6(),t.Oqu(t.lcZ(8,12,n.createdAt.toDate())),t.xp6(3),t.Q6J("disabled",n.hasRead)("checked",!!n.hasRead)}}function $(e,c){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"div",8)(2,"div",9)(3,"button",10),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw(2);return t.KtG(r.onClickNext(s))}),t._UZ(4,"img",11),t.qZA(),t.TgZ(5,"button",12),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw(2);return t.KtG(r.onClickPrevious(s))}),t._UZ(6,"img",13),t.qZA(),t.YNc(7,L,2,2,"span",14),t.ALo(8,"async"),t.qZA(),t.TgZ(9,"div",15)(10,"table",16),t.YNc(11,Z,11,16,"tr",17),t.qZA()(),t.TgZ(12,"div",9)(13,"button",18),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw(2);return t.KtG(r.onClickReadAll(s))}),t._uU(14,"Read All"),t._UZ(15,"img",19),t.qZA()()()()}if(2&e){const n=t.oxw(2);t.xp6(7),t.Q6J("ngIf",t.lcZ(8,3,n.pagingMessage$)),t.xp6(3),t.Q6J("@notificationItemTrigger",n.pageNavigationState),t.xp6(),t.Q6J("ngForOf",n.notifications)}}function K(e,c){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw();return t.KtG(r.onClickTraySpinner(s))}),t._UZ(2,"img",2),t.YNc(3,D,4,0,"div",3),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"div",4),t.ALo(6,"async"),t.YNc(7,$,16,5,"div",0),t.qZA(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(3),t.Q6J("ngIf",t.lcZ(4,4,n.hasMessage$)),t.xp6(2),t.Udp("left",t.lcZ(6,6,n.trayLeft$),"px"),t.xp6(2),t.Q6J("ngIf",n.isShowingList)}}let N=(()=>{class e{auth;store;funcs;router;NotificationLimit=10;destroy$=new p.x;query$=new x.X(n=>n.limit(this.NotificationLimit));pagingMessage$;message$=new p.x;clickModal$=new p.x;hasMessage$;isShowingList=!1;isActive=!1;notificationsSave=[];notifications=[];pageNavigationState;trayLeft$=new v.t;constructor(n,o,s,r){this.auth=n,this.store=o,this.funcs=s,this.router=r}ngOnInit(){this.auth.clientSideUser$.pipe((0,m.R)(this.destroy$)).subscribe(o=>{this.isActive=!!o});const n=this.auth.clientSideUser$.pipe((0,E.h)(o=>!!o),(0,l.U)(o=>`/users/v1/protected/${o.uid}/tray/`));this.hasMessage$=n.pipe((0,h.w)(o=>this.store.collection(o,r=>r.where("hasRead","==",!1)).valueChanges()),(0,l.U)(o=>o.length>0)),(0,y.a)(n,this.query$).pipe((0,h.w)(([o,s])=>this.store.collection(o,g=>s(g.orderBy("createdAt","desc"))).valueChanges({idField:"id"})),(0,m.R)(this.destroy$)).subscribe(o=>{if(0===o.length)return this.notifications=this.notificationsSave,this.pageNavigationState="nomore",void this.message$.next("\u3053\u308c\u4ee5\u4e0a\u901a\u77e5\u306f\u3042\u308a\u307e\u305b\u3093\u3002");this.pageNavigationState="enter",this.notifications=o}),this.pagingMessage$=(0,T.T)(this.message$,this.message$.pipe((0,C.b)(2e3),(0,l.U)(()=>null)),this.clickModal$.pipe((0,l.U)(()=>null)))}ngOnDestroy(){this.destroy$.next()}onClickTraySpinner(n){(0,_.eM)("onClickTraySpinner()",n),this.trayLeft$.next(n.x-300),this.isShowingList=!0}prepareToClick(n){n.stopPropagation(),this.clickModal$.next()}onClickRead(n,o){var s=this;return(0,d.Z)(function*(){(0,_.eM)("onClickRead()",n),s.prepareToClick(n);const r={id:o.id};yield s.funcs.call("setDoneTray",r)})()}onClickReadAll(n){var o=this;return(0,d.Z)(function*(){(0,_.eM)("onClickReadAll()",n),o.prepareToClick(n),yield o.funcs.call("setDoneTrayAll")})()}onClickNext(n){if((0,_.eM)("onClickNext()",n),this.prepareToClick(n),this.pageNavigationState="next",0===this.notifications.length)return void this.query$.next(s=>s);const o=this.notifications[0];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.endBefore(o.createdAt).limitToLast(this.NotificationLimit))}onClickPrevious(n){if((0,_.eM)("onClickPrevious()",n),this.prepareToClick(n),0===this.notifications.length)return;this.pageNavigationState="previous";const o=this.notifications[this.notifications.length-1];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.startAfter(o.createdAt).limit(this.NotificationLimit))}static \u0275fac=function(o){return new(o||e)(t.Y36(M.e),t.Y36(A.ST),t.Y36(O.c),t.Y36(B.Z))};static \u0275cmp=t.Xpm({type:e,selectors:[["app-user-tray"]],decls:1,vars:1,consts:[[4,"ngIf"],["data-bs-toggle","dropdown",3,"click"],["src","/assets/octicons/bell.svg",1,"",2,"width","100%","cursor","pointer"],["style","position: absolute; top: 0px;",4,"ngIf"],[1,"dropdown-menu",2,"max-height","400px","width","400px","position","fixed","top","50px"],[2,"position","absolute","top","0px"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning"],[1,"visually-hidden"],[1,"m-3"],[1,"m-2"],["title","\u65b0\u3057\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-left.svg",1,"mx-3"],["title","\u53e4\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-right.svg",1,"mx-3"],["class","text-warning mx-2",4,"ngIf"],[2,"height","250px","overflow-y","scroll","overflow-x","hidden"],[2,"width","100%"],["class","m-3",4,"ngFor","ngForOf"],["title","\u3059\u3079\u3066\u65e2\u8aad\u306b\u3057\u307e\u3059",1,"btn","btn-warning",3,"click"],["src","/assets/octicons/check.svg",1,"mx-2"],[1,"text-warning","mx-2"],[2,"overflow-x","hidden",3,"title"],[3,"title"],["routerLink","/Gitfire/tray",3,"queryParams"],["type","checkbox","title","\u65e2\u8aad\u306b\u3059\u308b\u5834\u5408\u306f check \u3057\u3066\u304f\u3060\u3055\u3044\u3002",1,"m-2",3,"disabled","checked","click"],[3,"routerLink","fragment"]],template:function(o,s){1&o&&t.YNc(0,K,8,8,"ng-container",0),2&o&&t.Q6J("ngIf",s.isActive)},dependencies:[u.sg,u.O5,P.rH,u.Ov,u.uU,U.a],styles:["[_nghost-%COMP%]{cursor:initial}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:snow}"],data:{animation:[(0,i.X$)("shakeItTrigger",[(0,i.eR)(":leave",[(0,i.oB)({transform:"none",position:"absolute"}),(0,i.jt)("300ms ease-in-out",(0,i.oB)({opacity:0,transform:"translateY(-100%)"}))]),(0,i.eR)(":enter",[(0,i.oB)({transform:"none",position:"absolute"}),(0,i.jt)("1000ms ease-in-out",(0,i.F4)([(0,i.oB)({transform:"translate3d(-4px, 0, 0)",offset:.1}),(0,i.oB)({transform:"translate3d(4px, 0, 0)",offset:.2}),(0,i.oB)({transform:"translate3d(-3px, 0, 0)",offset:.3}),(0,i.oB)({transform:"translate3d(3px, 0, 0)",offset:.4}),(0,i.oB)({transform:"translate3d(-3px, 0, 0)",offset:.5}),(0,i.oB)({transform:"translate3d(2px, 0, 0)",offset:.6}),(0,i.oB)({transform:"translate3d(-2px, 0, 0)",offset:.7}),(0,i.oB)({transform:"translate3d(1px, 0, 0)",offset:.8}),(0,i.oB)({transform:"translate3d(-1px, 0, 0)",offset:.9})]))])]),(0,i.X$)("notificationItemTrigger",[(0,i.eR)(":enter",[(0,i.IO)("tr",[(0,i.oB)({opacity:0,transform:"translateX(-100%)"}),(0,i.EY)(20,[(0,i.jt)("300ms ease-in-out",(0,i.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.eR)("* => previous",[(0,i.IO)("tr",[(0,i.oB)({}),(0,i.EY)(20,[(0,i.jt)("300ms ease-in-out",(0,i.oB)({opacity:0,transform:"translateX(-100%)"}))])],{optional:!0})]),(0,i.eR)("previous => enter",[(0,i.IO)("tr",[(0,i.oB)({opacity:0,transform:"translateX(100%)"}),(0,i.EY)(20,[(0,i.jt)("300ms 100ms ease-in-out",(0,i.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.eR)("* => next",[(0,i.IO)("tr",[(0,i.oB)({}),(0,i.EY)(20,[(0,i.jt)("300ms ease-in-out",(0,i.oB)({opacity:0,transform:"translateX(100%)"}))])],{optional:!0})]),(0,i.eR)("next => enter",[(0,i.IO)("tr",[(0,i.oB)({opacity:0,transform:"translateX(-100%)"}),(0,i.EY)(20,[(0,i.jt)("300ms 100ms ease-in-out",(0,i.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.eR)("* => nomore",[(0,i.oB)({opacity:0,backgroundColor:"red"}),(0,i.jt)("300ms 100ms ease-in-out",(0,i.oB)({opacity:1,backgroundColor:"*"}))])])]}})}return e})()}}]);