"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[905],{2905:(V,L,a)=>{a.r(L),a.d(L,{S2mapModule:()=>G});var d=a(6814),r=a(5739),h=a(5187),E=a(5861),Z=a(3010),y=a(7028),m=a(553),v=a(9773),A=a(3620),M=a(5619),x=a(8645),f=a(2572),t=a(9212),C=a(3766),b=a(9798),T=a(6448),B=a(9515);function O(l,I){if(1&l&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&l){const e=t.oxw();t.xp6(1),t.hij("Zoom: ",e.mapZoomLevel,"")}}const $=[{path:"map/index.htm",redirectTo:"map"},{path:"map",component:(()=>{class l{translate;http;cellMainScales={};cellSubScales={};googleMap;S2LEVEL_MAX=20;S2LevelRange=[1,this.S2LEVEL_MAX];S2LevelSubScaleMax=3;inputS2Level=1;inputS2LevelSubScale=0;inputS2Level$=new M.X(this.inputS2Level);inputS2LevelSubScale$=new M.X(this.inputS2LevelSubScale);mapBounds$=new x.x;isDeveloper=!m.NZ.production;mapZoomLevel;destroy$=new x.x;constructor(e,n){this.translate=e,this.http=n}ngOnInit(){var e=this;return(0,E.Z)(function*(){const o=yield new y.aN({apiKey:m.NZ.googleMapApiKey,version:"weekly",libraries:["places"]}).load();(0,m.w_)("Google API loaded",o);const s={center:{lat:m.NZ.MapDefaultLocation.lat,lng:m.NZ.MapDefaultLocation.lng},zoom:7},i=document.getElementById("toolsS2MapMain");e.googleMap=new o.maps.Map(i,s),e.googleMap.addListener("bounds_changed",e.onMapBoundsChanged.bind(e)),(0,f.a)([e.inputS2Level$,e.mapBounds$]).pipe((0,v.R)(e.destroy$)).subscribe(([c,g])=>{const p=e.googleMap.getZoom();"number"==typeof p?(e.S2LevelRange=e.getZoomLevelS2Range(p),e.S2LevelSubScaleMax=Math.min(Math.max(e.S2LEVEL_MAX-c,0),3),e.drawMainScales(c,g)):(0,m.wb)("Unexpectedly failed to get zoom",p)}),(0,f.a)([e.inputS2Level$,e.inputS2LevelSubScale$,e.mapBounds$]).pipe((0,A.b)(100),(0,v.R)(e.destroy$)).subscribe(([c,g,p])=>{e.drawSubScales(c+g,p)})})()}ngOnDestroy(){this.destroy$.next()}onChangeLevel(e){this.inputS2Level$.next(e)}clearScales(e){for(const n in e)e[n].setMap(null),delete e[n]}drawSubScales(e,n){this.clearScales(this.cellSubScales);const o=this.googleMap.getCenter();if(!o)return void(0,m.wb)("Unexpectedly failed to get map center");const s=this.toS2Cell(o,e);this.drawWithNeighbors(this.cellSubScales,n,s,.3)}drawMainScales(e,n){this.clearScales(this.cellMainScales);const o=this.googleMap.getCenter();if(!o)return;const s=this.toS2Cell(o,e);this.drawWithNeighbors(this.cellMainScales,n,s)}drawWithNeighbors(e,n,o,s=1){const i=this.toGoogleBounds(o);if(!n.intersects(i))return;const c=o.toHilbertQuadkey();if(c in e)return;const g=o.getCornerLatLngs(),p=g.map(u=>this.toGoogleLatLng(u));p.push(this.toGoogleLatLng(g[0]));const S=new google.maps.Polyline({path:p,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.8*s,strokeWeight:1*s,map:this.googleMap});e[c]=S;for(const u of o.getNeighbors()){const U=u.getLatLng();new google.maps.LatLng(this.toGoogleLatLng(U)),this.drawWithNeighbors(e,n,u,s)}}toS2Cell(e,n){return Z.S2.S2Cell.FromLatLng({lat:e.lat(),lng:e.lng()},n)}toGoogleBounds(e){const n=e.getCornerLatLngs();return new google.maps.LatLngBounds(n[0],n[1]).extend(n[2]).extend(n[3])}toGoogleLatLng(e){return{lat:e.lat,lng:e.lng}}onMapBoundsChanged(){const e=this.googleMap.getZoom();if(!e)return;this.mapZoomLevel=e;const n=this.getZoomLevelS2Range(e);if(this.inputS2Level<n[0]||n[1]<this.inputS2Level){const s=this.clamp(this.inputS2Level,n[0],n[1]);this.inputS2Level=s,this.inputS2Level$.next(s)}const o=this.googleMap.getBounds();o?this.mapBounds$.next(o):(0,m.wb)("Unexpectedly failed to get bounds.")}clamp(e,n,o){return Math.trunc(Math.min(o,Math.max(n,e)))}getZoomLevelS2Range(e){const n=this.clamp(Math.trunc(e),0,22),o=[{min:1,max:3},{min:1,max:6},{min:1,max:7},{min:1,max:7},{min:1,max:8},{min:1,max:8},{min:1,max:9},{min:1,max:9},{min:1,max:10},{min:1,max:11},{min:1,max:12},{min:1,max:12},{min:1,max:13},{min:1,max:13},{min:1,max:14},{min:8,max:15},{min:8,max:16},{min:9,max:17},{min:9,max:18},{min:10,max:19},{min:10,max:this.S2LEVEL_MAX},{min:11,max:this.S2LEVEL_MAX},{min:12,max:this.S2LEVEL_MAX}];return[o[n].min,o[n].max]}onChangeSubScale(e){this.inputS2LevelSubScale$.next(e)}static \u0275fac=function(n){return new(n||l)(t.Y36(C.xq),t.Y36(b.OE))};static \u0275cmp=t.Xpm({type:l,selectors:[["app-s2-map"]],decls:18,vars:22,consts:[["id","toolsS2MapMain",2,"width","100%","height","600px"],[4,"ngIf"],[1,"form-group","m-2"],[1,"input-group","row","m-2"],[1,"col-1","form-check-label","p-2","text-end",3,"title"],[1,"col-2"],["type","number",1,"form-control",3,"min","max","ngModel","ngModelChange"],["fill","#7878dd","src","/assets/octicons/question.svg",1,"col-1",3,"title"]],template:function(n,o){1&n&&(t._UZ(0,"div",0),t.YNc(1,O,2,1,"span",1),t.TgZ(2,"div",2)(3,"div",3)(4,"label",4),t.ALo(5,"translate"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"span",5)(9,"input",6),t.NdJ("ngModelChange",function(i){return o.inputS2Level=i})("ngModelChange",function(i){return o.onChangeLevel(i)}),t.qZA()(),t.TgZ(10,"label",4),t.ALo(11,"translate"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"span",5)(15,"input",6),t.NdJ("ngModelChange",function(i){return o.inputS2LevelSubScale=i})("ngModelChange",function(i){return o.onChangeSubScale(i)}),t.qZA()(),t._UZ(16,"app-inline-svg",7),t.ALo(17,"translate"),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("ngIf",o.isDeveloper),t.xp6(3),t.s9C("title",t.lcZ(5,12,"TOOLTIP_S2_CELL_LEVEL")),t.xp6(2),t.Oqu(t.lcZ(7,14,"LABEL_S2_CELL_LEVEL")),t.xp6(3),t.Q6J("min",o.S2LevelRange[0])("max",o.S2LevelRange[1])("ngModel",o.inputS2Level),t.xp6(1),t.s9C("title",t.lcZ(11,16,"TOOLTIP_S2_CELL_SUB_SCALE")),t.xp6(2),t.Oqu(t.lcZ(13,18,"LABEL_S2_CELL_SUB_SCALES")),t.xp6(3),t.Q6J("min",0)("max",o.S2LevelSubScaleMax)("ngModel",o.inputS2LevelSubScale),t.xp6(1),t.s9C("title",t.lcZ(17,20,"TOOLTIP_S2CELL_LEVEL")))},dependencies:[d.O5,r.Fj,r.wV,r.JJ,r.qQ,r.Fd,r.On,T.h,B.X$]})}return l})(),data:{gitweeTitle:"TITLE_TOOL_S2GEO_MAP"}}];let N=(()=>{class l{constructor(){(0,m.eM)("S2mapRoutingModule.constructor()")}static \u0275fac=function(n){return new(n||l)};static \u0275mod=t.oAB({type:l});static \u0275inj=t.cJS({imports:[h.Bz.forChild($),h.Bz]})}return l})();var R=a(8001),w=a(5101);let G=(()=>{class l{constructor(){(0,m.H_)("Dynamically loaded S2mapModule")}static \u0275fac=function(n){return new(n||l)};static \u0275mod=t.oAB({type:l});static \u0275inj=t.cJS({providers:[{provide:C.uY,useValue:"app/tools/s2map/s2map/"}],imports:[d.ez,r.u5,R.f,w.R,N]})}return l})()}}]);