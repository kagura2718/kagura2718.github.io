"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[596],{6596:(W,p,a)=>{a.r(p),a.d(p,{UserTrayComponent:()=>K});var g=a(1528),_=a(6716),m=a(5657),y=a(6700),C=a(2540),E=a(6040),v=a(3412),d=a(3616),x=a(6684),l=a(4704),h=a(7368),T=a(4680),i=a(9684),t=a(4496),O=a(4304),k=a(8472),M=a(2112),D=a(256),u=a(1368),I=a(4192),P=a(8631);function A(o,c){1&o&&(t.I0R(0,"div",5)(1,"div",6)(2,"span",7),t.OEk(3,"Notification is alived."),t.C$Y()()())}function R(o,c){if(1&o&&(t.I0R(0,"span",20),t.OEk(1),t.C$Y()),2&o){const n=c.$implicit;t.E7m("@shakeItTrigger",void 0),t.yG2(),t.cNF(n)}}function $(o,c){if(1&o&&(t.SAx(0),t.I0R(1,"a",25),t.OEk(2),t.C$Y(),t.k70()),2&o){const n=t.GaO().$implicit;t.yG2(),t._6D("routerLink",n.anchorLink),t.E7m("fragment",n.anchorId),t.yG2(),t.cNF(n.title)}}function b(o,c){if(1&o&&(t.SAx(0),t.OEk(1),t.k70()),2&o){const n=t.GaO().$implicit;t.yG2(),t.cNF(n.title)}}const G=o=>({id:o});function w(o,c){if(1&o){const n=t.KQA();t.I0R(0,"tr",8)(1,"td",21),t.yuY(2,$,3,3,"ng-container",0)(3,b,2,1,"ng-container",0),t.C$Y(),t.I0R(4,"td",22),t.wVc(5,"date"),t.I0R(6,"a",23),t.OEk(7),t.wVc(8,"relativeTime"),t.C$Y()(),t.I0R(9,"td")(10,"input",24),t.qCj("click",function(s){const f=t.usT(n).$implicit,B=t.GaO(3);return t.CGJ(B.onClickRead(s,f))}),t.C$Y()()()}if(2&o){const n=c.$implicit;t.yG2(),t.u6R("title","Title: ",n.title,"\n\n",n.body,""),t.yG2(),t.E7m("ngIf",n.anchorLink),t.yG2(),t.E7m("ngIf",!n.anchorLink),t.yG2(),t._6D("title",t.g7$(5,9,n.createdAt.toDate(),"yyyy-MM-dd HH:MM")),t.yG2(2),t.E7m("queryParams",t.S45(14,G,n.id)),t.yG2(),t.cNF(t.kDX(8,12,n.createdAt.toDate())),t.yG2(3),t.E7m("disabled",n.hasRead)("checked",!!n.hasRead)}}function U(o,c){if(1&o){const n=t.KQA();t.I0R(0,"div")(1,"div",8)(2,"div",9)(3,"button",10),t.qCj("click",function(s){t.usT(n);const r=t.GaO(2);return t.CGJ(r.onClickNext(s))}),t.wR5(4,"img",11),t.C$Y(),t.I0R(5,"button",12),t.qCj("click",function(s){t.usT(n);const r=t.GaO(2);return t.CGJ(r.onClickPrevious(s))}),t.wR5(6,"img",13),t.C$Y(),t.yuY(7,R,2,2,"span",14),t.wVc(8,"async"),t.C$Y(),t.I0R(9,"div",15)(10,"table",16),t.yuY(11,w,11,16,"tr",17),t.C$Y()(),t.I0R(12,"div",9)(13,"button",18),t.qCj("click",function(s){t.usT(n);const r=t.GaO(2);return t.CGJ(r.onClickReadAll(s))}),t.OEk(14,"Read All"),t.wR5(15,"img",19),t.C$Y()()()()}if(2&o){const n=t.GaO(2);t.yG2(7),t.E7m("ngIf",t.kDX(8,3,n.pagingMessage$)),t.yG2(3),t.E7m("@notificationItemTrigger",n.pageNavigationState),t.yG2(),t.E7m("ngForOf",n.notifications)}}function L(o,c){if(1&o){const n=t.KQA();t.SAx(0),t.I0R(1,"div",1),t.qCj("click",function(s){t.usT(n);const r=t.GaO();return t.CGJ(r.onClickTraySpinner(s))}),t.wR5(2,"img",2),t.yuY(3,A,4,0,"div",3),t.wVc(4,"async"),t.C$Y(),t.I0R(5,"div",4),t.wVc(6,"async"),t.yuY(7,U,16,5,"div",0),t.C$Y(),t.k70()}if(2&o){const n=t.GaO();t.yG2(3),t.E7m("ngIf",t.kDX(4,4,n.hasMessage$)),t.yG2(2),t.m4B("left",t.kDX(6,6,n.trayLeft$),"px"),t.yG2(2),t.E7m("ngIf",n.isShowingList)}}let K=(()=>{class o{auth;store;funcs;router;NotificationLimit=10;destroy$=new m.E;query$=new y.g(n=>n.limit(this.NotificationLimit));pagingMessage$;message$=new m.E;clickModal$=new m.E;hasMessage$;isShowingList=!1;isActive=!1;notificationsSave=[];notifications=[];pageNavigationState;trayLeft$=new C.o;constructor(n,e,s,r){this.auth=n,this.store=e,this.funcs=s,this.router=r}ngOnInit(){this.auth.clientSideUser$.pipe((0,d.a)(this.destroy$)).subscribe(e=>{this.isActive=!!e});const n=this.auth.clientSideUser$.pipe((0,x.I)(e=>!!e),(0,l.k)(e=>`/users/v1/protected/${e.uid}/tray/`));this.hasMessage$=n.pipe((0,h.G)(e=>this.store.collection(e,r=>r.where("hasRead","==",!1)).valueChanges()),(0,l.k)(e=>e.length>0)),(0,E.E)(n,this.query$).pipe((0,h.G)(([e,s])=>this.store.collection(e,f=>s(f.orderBy("createdAt","desc"))).valueChanges({idField:"id"})),(0,d.a)(this.destroy$)).subscribe(e=>{if(0===e.length)return this.notifications=this.notificationsSave,this.pageNavigationState="nomore",void this.message$.next("\u3053\u308c\u4ee5\u4e0a\u901a\u77e5\u306f\u3042\u308a\u307e\u305b\u3093\u3002");this.pageNavigationState="enter",this.notifications=e}),this.pagingMessage$=(0,v.U)(this.message$,this.message$.pipe((0,T.o)(2e3),(0,l.k)(()=>null)),this.clickModal$.pipe((0,l.k)(()=>null)))}ngOnDestroy(){this.destroy$.next()}onClickTraySpinner(n){(0,_.qe)("onClickTraySpinner()",n),this.trayLeft$.next(n.x-300),this.isShowingList=!0}prepareToClick(n){n.stopPropagation(),this.clickModal$.next()}onClickRead(n,e){var s=this;return(0,g.c)(function*(){(0,_.qe)("onClickRead()",n),s.prepareToClick(n);const r={id:e.id};yield s.funcs.call("setDoneTray",r)})()}onClickReadAll(n){var e=this;return(0,g.c)(function*(){(0,_.qe)("onClickReadAll()",n),e.prepareToClick(n),yield e.funcs.call("setDoneTrayAll")})()}onClickNext(n){if((0,_.qe)("onClickNext()",n),this.prepareToClick(n),this.pageNavigationState="next",0===this.notifications.length)return void this.query$.next(s=>s);const e=this.notifications[0];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.endBefore(e.createdAt).limitToLast(this.NotificationLimit))}onClickPrevious(n){if((0,_.qe)("onClickPrevious()",n),this.prepareToClick(n),0===this.notifications.length)return;this.pageNavigationState="previous";const e=this.notifications[this.notifications.length-1];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.startAfter(e.createdAt).limit(this.NotificationLimit))}static \u0275fac=function(e){return new(e||o)(t.GI1(O.o),t.GI1(k.i4),t.GI1(M.W),t.GI1(D.G))};static \u0275cmp=t.In1({type:o,selectors:[["app-user-tray"]],decls:1,vars:1,consts:[[4,"ngIf"],["data-bs-toggle","dropdown",3,"click"],["src","/assets/octicons/bell.svg",1,"",2,"width","100%","cursor","pointer"],["style","position: absolute; top: 0px;",4,"ngIf"],[1,"dropdown-menu",2,"max-height","400px","width","400px","position","fixed","top","50px"],[2,"position","absolute","top","0px"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning"],[1,"visually-hidden"],[1,"m-3"],[1,"m-2"],["title","\u65b0\u3057\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-left.svg",1,"mx-3"],["title","\u53e4\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-right.svg",1,"mx-3"],["class","text-warning mx-2",4,"ngIf"],[2,"height","250px","overflow-y","scroll","overflow-x","hidden"],[2,"width","100%"],["class","m-3",4,"ngFor","ngForOf"],["title","\u3059\u3079\u3066\u65e2\u8aad\u306b\u3057\u307e\u3059",1,"btn","btn-warning",3,"click"],["src","/assets/octicons/check.svg",1,"mx-2"],[1,"text-warning","mx-2"],[2,"overflow-x","hidden",3,"title"],[3,"title"],["routerLink","/Gitfire/tray",3,"queryParams"],["type","checkbox","title","\u65e2\u8aad\u306b\u3059\u308b\u5834\u5408\u306f check \u3057\u3066\u304f\u3060\u3055\u3044\u3002",1,"m-2",3,"disabled","checked","click"],[3,"routerLink","fragment"]],template:function(e,s){1&e&&t.yuY(0,L,8,8,"ng-container",0),2&e&&t.E7m("ngIf",s.isActive)},dependencies:[u.ay,u.u_,I.ER,u.a,u.y,P.o],styles:["[_nghost-%COMP%]{cursor:initial}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:snow}"],data:{animation:[(0,i.gV)("shakeItTrigger",[(0,i.aK)(":leave",[(0,i.wb)({transform:"none",position:"absolute"}),(0,i.Cs)("300ms ease-in-out",(0,i.wb)({opacity:0,transform:"translateY(-100%)"}))]),(0,i.aK)(":enter",[(0,i.wb)({transform:"none",position:"absolute"}),(0,i.Cs)("1000ms ease-in-out",(0,i.xZ)([(0,i.wb)({transform:"translate3d(-4px, 0, 0)",offset:.1}),(0,i.wb)({transform:"translate3d(4px, 0, 0)",offset:.2}),(0,i.wb)({transform:"translate3d(-3px, 0, 0)",offset:.3}),(0,i.wb)({transform:"translate3d(3px, 0, 0)",offset:.4}),(0,i.wb)({transform:"translate3d(-3px, 0, 0)",offset:.5}),(0,i.wb)({transform:"translate3d(2px, 0, 0)",offset:.6}),(0,i.wb)({transform:"translate3d(-2px, 0, 0)",offset:.7}),(0,i.wb)({transform:"translate3d(1px, 0, 0)",offset:.8}),(0,i.wb)({transform:"translate3d(-1px, 0, 0)",offset:.9})]))])]),(0,i.gV)("notificationItemTrigger",[(0,i.aK)(":enter",[(0,i.kt)("tr",[(0,i.wb)({opacity:0,transform:"translateX(-100%)"}),(0,i.W0)(20,[(0,i.Cs)("300ms ease-in-out",(0,i.wb)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.aK)("* => previous",[(0,i.kt)("tr",[(0,i.wb)({}),(0,i.W0)(20,[(0,i.Cs)("300ms ease-in-out",(0,i.wb)({opacity:0,transform:"translateX(-100%)"}))])],{optional:!0})]),(0,i.aK)("previous => enter",[(0,i.kt)("tr",[(0,i.wb)({opacity:0,transform:"translateX(100%)"}),(0,i.W0)(20,[(0,i.Cs)("300ms 100ms ease-in-out",(0,i.wb)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.aK)("* => next",[(0,i.kt)("tr",[(0,i.wb)({}),(0,i.W0)(20,[(0,i.Cs)("300ms ease-in-out",(0,i.wb)({opacity:0,transform:"translateX(100%)"}))])],{optional:!0})]),(0,i.aK)("next => enter",[(0,i.kt)("tr",[(0,i.wb)({opacity:0,transform:"translateX(-100%)"}),(0,i.W0)(20,[(0,i.Cs)("300ms 100ms ease-in-out",(0,i.wb)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,i.aK)("* => nomore",[(0,i.wb)({opacity:0,backgroundColor:"red"}),(0,i.Cs)("300ms 100ms ease-in-out",(0,i.wb)({opacity:1,backgroundColor:"*"}))])])]}})}return o})()}}]);