import{a as Fe}from"./chunk-6F4Z7ZA5.js";import{d as Ee,e as Pe}from"./chunk-2YL5NJYJ.js";import{c as je}from"./chunk-GLL427GS.js";import{a as xe,b as Re,c as We,d as Ne,e as Oe,f as Ue,g as _e,h as Me,i as L,j as Le,k as Be}from"./chunk-IZZ2VMEL.js";import{a as U,b as _,c as P,d as M,e as a,f as ye,g as De,j as we}from"./chunk-XZ7EYI2L.js";import{$ as te,Ba as u,Cb as fe,Eb as c,Fb as he,G as b,Ka as S,M as Y,Oa as de,Ob as N,P as ee,Qc as d,Tc as E,Va as v,Vc as Ce,Xa as I,Yc as ve,Z as $,Zc as Ie,_c as Ae,a as K,aa as m,ab as T,ad as be,b as g,ba as re,bb as p,ca as ne,cb as f,cd as $e,da as oe,db as k,ea as ie,eb as x,fb as R,gb as me,gd as Se,hd as Te,ia as ae,ic as ge,la as se,m as X,ma as ce,nb as W,o as l,pb as pe,ra as C,sd as ke,ya as ue,za as le}from"./chunk-WAQAKQHN.js";import{R as O}from"./chunk-LZXNU2FR.js";import{a as Q,d as Z}from"./chunk-VB56BUGO.js";var rr="auth";var F=class{constructor(){return P(rr)}};var y=function(){return y=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},y.apply(this,arguments)};var ir={includeMetadataChanges:!1};function B(r,e){return e===void 0&&(e=ir),new K(function(t){var n=L(r,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:n}})}function qe(r){return B(r,{includeMetadataChanges:!0})}function ze(r,e){return e===void 0&&(e={}),qe(r).pipe(l(function(t){return j(t,e)}))}function j(r,e){var t;e===void 0&&(e={});var n=r.data(e);return!r.exists()||typeof n!="object"||n===null||!e.idField?n:y(y({},n),(t={},t[e.idField]=r.id,t))}function Ve(r){return B(r,{includeMetadataChanges:!0}).pipe(l(function(e){return e.docs}))}function Ge(r,e){return e===void 0&&(e={}),Ve(r).pipe(l(function(t){return t.map(function(n){return j(n,e)})}))}var h=class{constructor(e){return e}},Je="firestore",q=class{constructor(){return P(Je)}};var z=new te("angularfire2.firestore-instances");function ar(r,e){let t=_(Je,r,e);return t&&new h(t)}function sr(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new h(n)}}var cr={provide:q,deps:[[new C,z]]},ur={provide:h,useFactory:ar,deps:[[new C,z],ye]};function Do(r,...e){return O("angularfire",U.full,"fst"),ne([ur,cr,{provide:z,useFactory:sr(r),multi:!0,deps:[ce,ae,M,De,[new C,F],[new C,we],...e]}])}var wo=a(Ge,!0);var He=a(ze,!0);var Qe=a(xe,!0,2);var Ze=a(Re,!0,2);var xo=a(We,!0);var Ro=a(Ue,!0,2);var Wo=a(Oe,!0,2),No=a(Ne,!0,2);var Ke=a(_e,!0,2);var Oo=a(Me,!0,2);function _o(r=[]){return{toFirestore(e){let i=e,{id:t}=i;return Z(i,["id"])},fromFirestore(e,t){let n=e.data(t);return Q({id:e.id},n)}}}function Xe(r=[]){return{toFirestore(e){return e},fromFirestore(e,t){return e.data(t)}}}var D=class{saveNeverAsk;isConfirmed};function mr(r,e){r&1&&(p(0,"div",1),k(1,"div",11),f()),r&2&&(u(),T("innerHTML",e.html,ue))}function pr(r,e){r&1&&k(0,"span",2)}var w=class r extends Ee{confirmed=new se;inputConfirmForm;tosJson=ge();constructor(){super()}ngOnInit(){d("TosConfirmComponent.OnInit()"),this.inputConfirmForm=new Ae({}),this.inputConfirmForm.addControl("neverConfirmTosCheck",new be(!1))}get neverCheckTosControl(){return this.inputConfirmForm.get("neverConfirmTosCheck")}onClickConfirm(e){if(d("TosConfirmComponent.onClickConfirm()"),e.preventDefault(),this.inputConfirmForm.markAllAsTouched(),this.inputConfirmForm.invalid)return;let t=new D,n=this.inputConfirmForm.get("neverConfirmTosCheck");t.saveNeverAsk=n.value,t.isConfirmed=!0,this.confirmed.emit(t),this.close()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["gitfire-tos-confirm"]],inputs:{tosJson:[1,"tosJson"]},outputs:{confirmed:"confirmed",tosJson:"tosJsonChange"},features:[de],decls:18,vars:5,consts:[[1,"container"],[1,"m-3"],["role","status",1,"spinner-border","text-primary"],[1,"text-center"],[3,"formGroup"],[1,"m-5","custom-control","custom-checkbox"],["for","appGitfireTosConfirmNeverDismissCheck",1,"visually-hidden"],["id","appGitfireTosConfirmNeverDismissCheck","name","neverConfirmTosCheck","formControlName","neverConfirmTosCheck","type","checkbox",1,"form-check-input"],[1,"text-muted","fw-light"],["href","/terms.htm","about","_blank"],["id","appGitfireTosConfirmButton",1,"btn","btn-success",3,"click","disabled"],[3,"innerHTML"]],template:function(t,n){if(t&1&&(p(0,"div",0),v(1,mr,2,1,"div",1)(2,pr,1,0,"span",2),p(3,"div",3)(4,"form",4)(5,"div",5)(6,"label",6),c(7,"\u518D\u5EA6\u8868\u793A\u3057\u306A\u3044"),f(),k(8,"input",7),c(9,"\u518D\u5EA6\u8868\u793A\u3057\u306A\u3044"),f(),p(10,"div",8),c(11,"\u8A73\u3057\u304F\u306F"),p(12,"a",9),c(13,"[\u5229\u7528\u898F\u7D04]"),f(),c(14,"\u3092\u3054\u78BA\u8A8D\u304F\u3060\u3055\u3044\u3002 "),f(),p(15,"div",1)(16,"button",10),pe("click",function(s){return n.onClickConfirm(s)}),c(17,"\u78BA\u8A8D\u3057\u307E\u3057\u305F"),f()()()()()),t&2){let i;u(),I((i=n.tosJson())?1:2,i),u(3),T("formGroup",n.inputConfirmForm),u(),fe("was-validated",n.neverCheckTosControl.dirty||n.neverCheckTosControl.touched),u(11),T("disabled",!n.inputConfirmForm.valid)}},dependencies:[ke,$e,Ce,ve,Ie,Te,Se],encapsulation:2})};var Ye=class r{constructor(e,t,n){this.http=e;this.dialog=t;this.firestore=n;this.privUser=Qe(this.firestore,"users/v1/protected")}privUser;UserAgreementConverter=Xe(["createdAt"]);constructSetupTosConfirm(e,t){return n=>{n.tosJson.set(t.json),n.confirmed.pipe().subscribe(i=>{if(!i.isConfirmed)throw new Error("assert");i.saveNeverAsk?t.answer=2:t.answer=0,e.next(t)})}}confirmTos$(e,t){if(e.match(/\/$/))throw new Error(`Assertion. Not a supported ${e}`);let n=new g,i=new g,s=new g,G=new g,rt=this.http.fetchGhJson(t).pipe(b(1),ee(o=>{let A=Ze(this.privUser,e,o.version).withConverter(this.UserAgreementConverter),J={json:o,cached:!1,cacheRef:A};return He(A).pipe(l(H=>(H&&H.alwaysConfirmed&&(d("TOS has already been confirmed."),J.cached=!0),J)))}));return G.pipe().subscribe({next:o=>{this.dialog.createDefaultBuilder().prepareBody(w).setupChild(this.constructSetupTosConfirm(s,o)).setType(1).setSize(1).setTitle("\u5229\u7528\u898F\u7D04\u306E\u78BA\u8A8D").closeButton(()=>{o.answer=1,s.next(o)}).setFinalize(()=>{o.answer=1,s.next(o)}).open()},complete:()=>{d("completed dialog$")},error:o=>{E("error dialog$",o)}}),rt.pipe(b(1)).subscribe({next:o=>{if(o.cached){n.next(!0);return}G.next(o)},complete:()=>{d("Completed TOS reading")},error:o=>{E("Failed reading TOS cache",o)}}),s.pipe(b(1)).subscribe({next:async o=>{switch(o.answer){case 0:n.next(!0);break;case 1:n.next(!1);break;case 2:let A={_docClass:"User:UserAgreementStore",alwaysConfirmed:!0,createdAt:Le()};n.next(!0),await Ke(o.cacheRef,A);break;default:throw new Error(`Not a valid answer ${o.answer}`)}},complete:()=>{d("Completed dialog result."),n.complete()},error:o=>{E("Failed receive dialog result"),n.complete()}}),n}static \u0275fac=function(t){return new(t||r)(m(Fe),m(Pe),m(h))};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};var et=class r{constructor(e,t){this.store=e;this.auth=t;this.pubUser=this.store.collection("/users/v1/public")}pubUser;nicknameCache={};userCache={};env=re(oe);myNickname$(){return this.auth.myUid?this.nickname$(this.auth.myUid):X("")}user$(e){let t=this.userCache[e];return t||(t=ie(this.env,()=>this.pubUser.doc(e).valueChanges().pipe(Y(1))),this.userCache[e]=t,t)}nickname$(e){let t=this.nicknameCache[e];return t||(t=this.user$(e).pipe(l(n=>n?n.nickname:null)),this.nicknameCache[e]=t,t)}static \u0275fac=function(t){return new(t||r)(m(Be),m(je))};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};function fr(r,e){r&1&&me(0,"img",2),r&2&&W("src",N(e),le)}function hr(r,e){if(r&1&&(x(0,"span",0),v(1,fr,1,2,"img",2),c(2),R()),r&2){let t,n=e;W("title",N(n.about)),u(),I((t=n.photoURL)?1:-1,t),u(),he(n.nickname)}}function gr(r,e){r&1&&(x(0,"span",1),c(1,"[\u524A\u9664]"),R())}var tt=class r{userPublic;constructor(){}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["gitfire-user-box"]],inputs:{userPublic:"userPublic"},decls:2,vars:1,consts:[[1,"p-1",3,"title"],["title","\u524A\u9664\u3055\u308C\u305F\u30E6\u30FC\u30B6\u3067\u3059",1,"text-warning"],[1,"p-1",2,"height","100%","width","2rem",3,"src"]],template:function(t,n){if(t&1&&v(0,hr,3,4,"span",0)(1,gr,2,0,"span",1),t&2){let i;I((i=n.userPublic)?0:1,i)}},encapsulation:2})};export{h as a,Do as b,wo as c,He as d,Qe as e,Ze as f,xo as g,Ro as h,Wo as i,No as j,Oo as k,_o as l,Xe as m,Ye as n,et as o,tt as p};
