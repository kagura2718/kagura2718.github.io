"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[474],{1474:(G,b,s)=>{s.d(b,{u:()=>x});var K=s(467),a=s(1413),O=s(2771),f=s(7673),y=s(3294),N=s(5964),p=s(6977),T=s(5558),g=s(8141),v=s(152),C=s(9568),$=s(6697),i=s(5312),U=s(3953),k=s(1152),F=s(4871),S=s(9182),m=s(8079),w=s(4715);class B{auth;funcs;localSession;store;dom;finalize$=new a.B;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;sourceValue$=new O.m;constructor(W,E,A,R,L){var c=this;this.auth=W,this.funcs=E,this.localSession=A,this.store=R,this.dom=L,(0,i.Oi)("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${i.cA.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${i.cA.FirebaseCloudFunctionsHost}`,"preconnect");const D=this.auth.user.pipe((0,y.F)());D.pipe((0,y.F)()).subscribe(u=>{this.sourceValue$.next()}),this.state$=D.pipe((0,N.p)(u=>null!==u)),this.localSession.markedLogout$.pipe().subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe((0,p.Q)(this.finalize$)).subscribe({error:u=>{(0,i.sJ)("AuthService.state$ error",u),this.doFinalize()},complete:()=>{(0,i.rD)("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe((0,T.n)(u=>this.store.collection(`/users/v1/protected/${u.uid}/fcm`).valueChanges().pipe((0,g.M)(_=>(0,i.Oi)("UserProtectedStore has changed.",_)))),(0,p.Q)(this.finalize$)).subscribe({next:u=>{this.sourceValue$.next()},error:u=>{(0,i.sJ)("AuthService.state$ Maybe after logout permission error. Ignore it.",u),this.doFinalize()},complete:()=>{(0,i.rD)("AuthService.state$ completed."),this.doFinalize()}});const M=this.state$.pipe((0,T.n)(function(){var u=(0,K.A)(function*(_){try{const P=yield c.funcs.call("readUserSettings"),V=_;return V.isAdmin=P.isAdmin,V.isDeveloper=P.isDeveloper,V.hasMessaging=P.hasMessaging,V}catch(P){return(0,i.sJ)("AuthService while check user settings.",P),null}});return function(_){return u.apply(this,arguments)}}()));var u;this.localUser$=this.sourceValue$.pipe((0,v.B)(100),(0,T.n)(()=>D.pipe((0,T.n)(u=>null===u?(0,f.of)(null):M))),(0,C.t)(1)),this.localUser$.pipe((0,p.Q)(this.finalize$)).subscribe({next:(u=(0,K.A)(function*(_){(0,i.Oi)("AuthService.localUser$.subscribe()",_),_?(c.loginUid=_.uid,c.isAdminUser=!!_.isAdmin,c.isDevelopUser=!!_.isDeveloper,c.hasMessagingDevice=!!_.hasMessaging,c.localSession.updateLoginPhoto(_.photoURL),c.localSession.markLogin()):(c.localSession.unmarkLogin(),c.localSession.updateLoginPhoto(null),c.loginUid=null,c.isAdminUser=!1,c.isDevelopUser=!1,c.hasMessagingDevice=!1,(0,i.rD)("Explicitly logout on client sdk."),yield c.auth.signOut())}),function(P){return u.apply(this,arguments)}),complete:()=>{(0,i.rD)("AuthService.localUser$ complete."),this.doFinalize()},error:u=>{(0,i.sJ)("AuthService.localUser$ error while retrieving.",u),this.doFinalize()}})}doFinalize(){this.finalize$.isStopped||((0,i.rD)("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}}let x=(()=>{class l{auth;funcs;localSession;store;dom;static AUTH=null;_clientSideUser$;constructor(E,A,R,L,c){this.auth=E,this.funcs=A,this.localSession=R,this.store=L,this.dom=c,(0,i.Oi)("AuthService.constructor()");const D=new O.m;null===l.AUTH&&(l.AUTH=new B(E,A,R,L,c),l.AUTH.finalize$.pipe((0,$.s)(1)).subscribe({next:()=>{(0,i.rD)("Finalize singleton auth continue..")},complete:()=>{(0,i.rD)("Finalizing singleton auth completed."),l.AUTH=null,D.next()},error:M=>{(0,i.sJ)("Finalizing singleton auth cause by error.",M),l.AUTH=null,D.next()}})),this._clientSideUser$=D.pipe((0,T.n)(()=>null===l.AUTH?(0,f.of)(null):l.AUTH.localUser$),(0,C.t)(1)),D.next()}get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return!!l.AUTH&&l.AUTH.isAdminUser}get isDeveloper(){return!!l.AUTH&&l.AUTH.isDevelopUser}get hasMessaging(){return!!l.AUTH&&l.AUTH.hasMessagingDevice}get myUid(){return l.AUTH?l.AUTH.loginUid:null}static \u0275fac=function(A){return new(A||l)(U.KVO(k.DS),U.KVO(F.Y),U.KVO(S.Q),U.KVO(m.Qe),U.KVO(w.K))};static \u0275prov=U.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},4871:(G,b,s)=>{s.d(b,{Y:()=>N});var K=s(467),a=s(6697),O=s(5312),f=s(3953),y=s(4441);let N=(()=>{class p{remote;constructor(g){this.remote=g,(0,O.Oi)("LocalFunctionsService.constructor()")}call(g,v){var C=this;return(0,K.A)(function*(){return yield C.remote.httpsCallable(g)(v).pipe((0,a.s)(1)).toPromise()})()}static \u0275fac=function(v){return new(v||p)(f.KVO(y.s))};static \u0275prov=f.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},4441:(G,b,s)=>{s.d(b,{Zg:()=>U,ab:()=>S,s:()=>F}),s(5900);var a=s(3953),O=s(1825),f=s(9253),y=s(7673),N=s(8455),p=s(941),T=s(5558),g=s(6354),v=s(9568),C=s(7935);const i=new a.nKC("angularfire2.functions.origin"),U=new a.nKC("angularfire2.functions.region"),k=new a.nKC("angularfire2.functions.use-emulator");let F=(()=>{class m{httpsCallable;constructor(B,x,l,W,E,A,R,L){const c=R,D=(0,y.of)(void 0).pipe((0,p.Q)(W.outsideAngular),(0,T.n)(()=>Promise.resolve().then(s.bind(s,5900))),(0,g.T)(()=>(0,f.iB)(B,l,x)),(0,g.T)(M=>(0,f.BM)(`${M.name}.functions.${E||A}`,"AngularFireFunctions",M.name,()=>{let u;if(E&&A)throw new Error("REGION and ORIGIN can't be used at the same time.");return u=M.functions(E||A||void 0),c&&u.useEmulator(...c),u},[E,A,c])),(0,v.t)({bufferSize:1,refCount:!1}));return this.httpsCallable=(M,u)=>_=>(0,N.H)(D).pipe((0,p.Q)(W.insideAngular),(0,T.n)(P=>P.httpsCallable(M,u)(_)),(0,g.T)(P=>P.data)),(0,f.Gt)(this,D,l)}static \u0275fac=function(x){return new(x||m)(a.KVO(f.rx),a.KVO(f.uP,8),a.KVO(a.SKi),a.KVO(O.u0),a.KVO(U,8),a.KVO(i,8),a.KVO(k,8),a.KVO(O.Jv,8))};static \u0275prov=a.jDH({token:m,factory:m.\u0275fac,providedIn:"any"})}return m})(),S=(()=>{class m{constructor(){C.A.registerVersion("angularfire",O.xv.full,"fn-compat")}static \u0275fac=function(x){return new(x||m)};static \u0275mod=a.$C({type:m});static \u0275inj=a.G2t({providers:[F]})}return m})()},5900:(G,b,s)=>{var K=s(3345),a=s(467),O=s(8742),f=s(1076),y=s(1362);const N="type.googleapis.com/google.protobuf.Int64Value",p="type.googleapis.com/google.protobuf.UInt64Value";function T(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function g(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>g(t));if("function"==typeof e||"object"==typeof e)return T(e,t=>g(t));throw new Error("Data cannot be encoded in JSON: "+e)}function v(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case N:case p:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>v(t)):"function"==typeof e||"object"==typeof e?T(e,t=>v(t)):e}const C="functions",$={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class i extends f.g{constructor(t,n,r){super(`${C}/${t}`,n||""),this.details=r}}class F{constructor(t,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(o=>this.auth=o,()=>{}),this.messaging||n.get().then(o=>this.messaging=o,()=>{}),this.appCheck||r.get().then(o=>this.appCheck=o,()=>{})}getAuthToken(){var t=this;return(0,a.A)(function*(){if(t.auth)try{const n=yield t.auth.getToken();return n?.accessToken}catch{return}})()}getMessagingToken(){var t=this;return(0,a.A)(function*(){if(t.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield t.messaging.getToken()}catch{return}})()}getAppCheckToken(t){var n=this;return(0,a.A)(function*(){if(n.appCheck){const r=t?yield n.appCheck.getLimitedUseToken():yield n.appCheck.getToken();return r.error?null:r.token}return null})()}getContext(t){var n=this;return(0,a.A)(function*(){return{authToken:yield n.getAuthToken(),messagingToken:yield n.getMessagingToken(),appCheckToken:yield n.getAppCheckToken(t)}})()}}const S="us-central1";class w{constructor(t,n,r,o,d=S,h){this.app=t,this.fetchImpl=h,this.emulatorOrigin=null,this.contextProvider=new F(n,r,o),this.cancelAllRequests=new Promise(I=>{this.deleteService=()=>Promise.resolve(I())});try{const I=new URL(d);this.customDomain=I.origin,this.region=S}catch{this.customDomain=null,this.region=d}}_delete(){return this.deleteService()}_url(t){const n=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${n}/${this.region}/${t}`:null!==this.customDomain?`${this.customDomain}/${t}`:`https://${this.region}-${n}.cloudfunctions.net/${t}`}}function W(e,t,n,r){return E.apply(this,arguments)}function E(){return(E=(0,a.A)(function*(e,t,n,r){let o;n["Content-Type"]="application/json";try{o=yield r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch{return{status:0,json:null}}let d=null;try{d=yield o.json()}catch{}return{status:o.status,json:d}})).apply(this,arguments)}function R(e,t,n,r){return L.apply(this,arguments)}function L(){return(L=(0,a.A)(function*(e,t,n,r){const o={data:n=g(n)},d={},h=yield e.contextProvider.getContext(r.limitedUseAppCheckTokens);h.authToken&&(d.Authorization="Bearer "+h.authToken),h.messagingToken&&(d["Firebase-Instance-ID-Token"]=h.messagingToken),null!==h.appCheckToken&&(d["X-Firebase-AppCheck"]=h.appCheckToken);const j=function m(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new i("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),H=yield Promise.race([W(t,o,d,e.fetchImpl),j.promise,e.cancelAllRequests]);if(j.cancel(),!H)throw new i("cancelled","Firebase Functions instance was deleted.");const Y=function k(e,t){let o,n=function U(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n;try{const d=t&&t.error;if(d){const h=d.status;if("string"==typeof h){if(!$[h])return new i("internal","internal");n=$[h],r=h}const I=d.message;"string"==typeof I&&(r=I),o=d.details,void 0!==o&&(o=v(o))}}catch{}return"ok"===n?null:new i(n,r,o)}(H.status,H.json);if(Y)throw Y;if(!H.json)throw new i("internal","Response is not valid JSON object.");let z=H.json.data;if(typeof z>"u"&&(z=H.json.result),typeof z>"u")throw new i("internal","Response is missing data field.");return{data:v(z)}})).apply(this,arguments)}const c="@firebase/functions",D="0.11.6";function J(e,t,n){!function B(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}((0,f.Ku)(e),t,n)}!function P(e,t){(0,O._registerComponent)(new y.uA(C,(r,{instanceIdentifier:o})=>{const d=r.getProvider("app").getImmediate(),h=r.getProvider("auth-internal"),I=r.getProvider("messaging-internal"),j=r.getProvider("app-check-internal");return new w(d,h,I,j,o,e)},"PUBLIC").setMultipleInstances(!0)),(0,O.registerVersion)(c,D,t),(0,O.registerVersion)(c,D,"esm2017")}(fetch.bind(self));class Q{constructor(t,n){this.app=t,this._delegate=n,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(t,n){return function X(e,t,n){return function x(e,t,n){return r=>function A(e,t,n,r){const o=e._url(t);return R(e,o,n,r)}(e,t,r,n||{})}((0,f.Ku)(e),t,n)}(this._delegate,t,n)}httpsCallableFromURL(t,n){return function Z(e,t,n){return function l(e,t,n){return r=>R(e,t,r,n||{})}((0,f.Ku)(e),t,n)}(this._delegate,t,n)}useFunctionsEmulator(t){const n=t.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==n)throw new f.g("functions","No origin provided to useFunctionsEmulator()");if(null==n[2])throw new f.g("functions","Port missing in origin provided to useFunctionsEmulator()");return J(this._delegate,n[1],Number(n[2]))}useEmulator(t,n){return J(this._delegate,t,n)}}const ne=(e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:t??"us-central1"});return new Q(n,r)};(function se(){const e={Functions:Q};K.A.INTERNAL.registerComponent(new y.uA("functions-compat",ne,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))})(),K.A.registerVersion("@firebase/functions-compat","0.3.12")}}]);