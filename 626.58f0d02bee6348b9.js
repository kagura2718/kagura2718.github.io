"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[626],{1626:(j,N,s)=>{s.d(N,{e:()=>R});var F=s(5861),a=s(8645),A=s(7328),f=s(2096),C=s(3997),$=s(2181),p=s(9773),O=s(4664),m=s(9397),P=s(3620),L=s(7081),S=s(8180),i=s(108),T=s(9212),G=s(434),b=s(3158),B=s(2423),g=s(5579),Z=s(7475);class K{auth;funcs;localSession;store;dom;finalize$=new a.x;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;sourceValue$=new A.t;constructor(H,E,v,y,x){var c=this;this.auth=H,this.funcs=E,this.localSession=v,this.store=y,this.dom=x,(0,i.eM)("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${i.NZ.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${i.NZ.FirebaseCloudFunctionsHost}`,"preconnect");const D=this.auth.user.pipe((0,C.x)());D.pipe((0,C.x)()).subscribe(u=>{this.sourceValue$.next()}),this.state$=D.pipe((0,$.h)(u=>null!==u)),this.localSession.markedLogout$.pipe().subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe((0,p.R)(this.finalize$)).subscribe({error:u=>{(0,i.wb)("AuthService.state$ error",u),this.doFinalize()},complete:()=>{(0,i.H_)("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe((0,O.w)(u=>this.store.collection(`/users/v1/protected/${u.uid}/fcm`).valueChanges().pipe((0,m.b)(h=>(0,i.eM)("UserProtectedStore has changed.",h)))),(0,p.R)(this.finalize$)).subscribe({next:u=>{this.sourceValue$.next()},error:u=>{(0,i.wb)("AuthService.state$ Maybe after logout permission error. Ignore it.",u),this.doFinalize()},complete:()=>{(0,i.H_)("AuthService.state$ completed."),this.doFinalize()}});const M=this.state$.pipe((0,O.w)(function(){var u=(0,F.Z)(function*(h){try{const U=yield c.funcs.call("readUserSettings"),w=h;return w.isAdmin=U.isAdmin,w.isDeveloper=U.isDeveloper,w.hasMessaging=U.hasMessaging,w}catch(U){return(0,i.wb)("AuthService while check user settings.",U),null}});return function(h){return u.apply(this,arguments)}}()));var u;this.localUser$=this.sourceValue$.pipe((0,P.b)(100),(0,O.w)(()=>D.pipe((0,O.w)(u=>null===u?(0,f.of)(null):M))),(0,L.d)(1)),this.localUser$.pipe((0,p.R)(this.finalize$)).subscribe({next:(u=(0,F.Z)(function*(h){(0,i.eM)("AuthService.localUser$.subscribe()",h),h?(c.loginUid=h.uid,c.isAdminUser=!!h.isAdmin,c.isDevelopUser=!!h.isDeveloper,c.hasMessagingDevice=!!h.hasMessaging,c.localSession.updateLoginPhoto(h.photoURL),c.localSession.markLogin()):(c.localSession.unmarkLogin(),c.localSession.updateLoginPhoto(null),c.loginUid=null,c.isAdminUser=!1,c.isDevelopUser=!1,c.hasMessagingDevice=!1,(0,i.H_)("Explicitly logout on client sdk."),yield c.auth.signOut())}),function(U){return u.apply(this,arguments)}),complete:()=>{(0,i.H_)("AuthService.localUser$ complete."),this.doFinalize()},error:u=>{(0,i.wb)("AuthService.localUser$ error while retrieving.",u),this.doFinalize()}})}doFinalize(){this.finalize$.isStopped||((0,i.H_)("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}}let R=(()=>{class l{auth;funcs;localSession;store;dom;static AUTH=null;_clientSideUser$;constructor(E,v,y,x,c){this.auth=E,this.funcs=v,this.localSession=y,this.store=x,this.dom=c,(0,i.eM)("AuthService.constructor()");const D=new A.t;null===l.AUTH&&(l.AUTH=new K(E,v,y,x,c),l.AUTH.finalize$.pipe((0,S.q)(1)).subscribe({next:()=>{(0,i.H_)("Finalize singleton auth continue..")},complete:()=>{(0,i.H_)("Finalizing singleton auth completed."),l.AUTH=null,D.next()},error:M=>{(0,i.wb)("Finalizing singleton auth cause by error.",M),l.AUTH=null,D.next()}})),this._clientSideUser$=D.pipe((0,O.w)(()=>null===l.AUTH?(0,f.of)(null):l.AUTH.localUser$),(0,L.d)(1)),D.next()}get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return!!l.AUTH&&l.AUTH.isAdminUser}get isDeveloper(){return!!l.AUTH&&l.AUTH.isDevelopUser}get hasMessaging(){return!!l.AUTH&&l.AUTH.hasMessagingDevice}get myUid(){return l.AUTH?l.AUTH.loginUid:null}static \u0275fac=function(v){return new(v||l)(T.LFG(G.zQ),T.LFG(b.c),T.LFG(B.m),T.LFG(g.ST),T.LFG(Z.v))};static \u0275prov=T.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},3158:(j,N,s)=>{s.d(N,{c:()=>$});var F=s(5861),a=s(8180),A=s(108),f=s(9212),C=s(5070);let $=(()=>{class p{remote;constructor(m){this.remote=m,(0,A.eM)("LocalFunctionsService.constructor()")}call(m,P){var L=this;return(0,F.Z)(function*(){return yield L.remote.httpsCallable(m)(P).pipe((0,a.q)(1)).toPromise()})()}static \u0275fac=function(P){return new(P||p)(f.LFG(C.l4))};static \u0275prov=f.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},5070:(j,N,s)=>{s.d(N,{Qv:()=>B,Xz:()=>T,l4:()=>b}),s(7068);var a=s(9212),A=s(8326),f=s(7217),C=s(2096),$=s(2459),p=s(3093),O=s(4664),m=s(7398),P=s(7081),L=s(7142);const i=new a.OlP("angularfire2.functions.origin"),T=new a.OlP("angularfire2.functions.region"),G=new a.OlP("angularfire2.functions.use-emulator");let b=(()=>{class g{httpsCallable;constructor(K,R,l,H,E,v,y,x){const c=y,D=(0,C.of)(void 0).pipe((0,p.Q)(H.outsideAngular),(0,O.w)(()=>Promise.resolve().then(s.bind(s,7068))),(0,m.U)(()=>(0,f.on)(K,l,R)),(0,m.U)(M=>(0,f.cc)(`${M.name}.functions.${E||v}`,"AngularFireFunctions",M.name,()=>{let u;if(E&&v)throw new Error("REGION and ORIGIN can't be used at the same time.");return u=M.functions(E||v||void 0),c&&u.useEmulator(...c),u},[E,v,c])),(0,P.d)({bufferSize:1,refCount:!1}));return this.httpsCallable=(M,u)=>h=>(0,$.D)(D).pipe((0,p.Q)(H.insideAngular),(0,O.w)(U=>U.httpsCallable(M,u)(h)),(0,m.U)(U=>U.data)),(0,f.pX)(this,D,l)}static \u0275fac=function(R){return new(R||g)(a.LFG(f.Dh),a.LFG(f.xv,8),a.LFG(a.R0b),a.LFG(A.HU),a.LFG(T,8),a.LFG(i,8),a.LFG(G,8),a.LFG(A.Rf,8))};static \u0275prov=a.Yz7({token:g,factory:g.\u0275fac,providedIn:"any"})}return g})(),B=(()=>{class g{constructor(){L.Z.registerVersion("angularfire",A.q4.full,"fn-compat")}static \u0275fac=function(R){return new(R||g)};static \u0275mod=a.oAB({type:g});static \u0275inj=a.cJS({providers:[b]})}return g})()},7068:(j,N,s)=>{s.r(N);var F=s(8168),a=s(5861),A=s(9032),f=s(9058),C=s(4537);const $="type.googleapis.com/google.protobuf.Int64Value",p="type.googleapis.com/google.protobuf.UInt64Value";function O(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function m(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>m(t));if("function"==typeof e||"object"==typeof e)return O(e,t=>m(t));throw new Error("Data cannot be encoded in JSON: "+e)}function P(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case $:case p:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>P(t)):"function"==typeof e||"object"==typeof e?O(e,t=>P(t)):e}const L="functions",S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class i extends f.ZR{constructor(t,n,r){super(`${L}/${t}`,n||""),this.details=r}}class b{constructor(t,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(o=>this.auth=o,()=>{}),this.messaging||n.get().then(o=>this.messaging=o,()=>{}),this.appCheck||r.get().then(o=>this.appCheck=o,()=>{})}getAuthToken(){var t=this;return(0,a.Z)(function*(){if(t.auth)try{const n=yield t.auth.getToken();return n?.accessToken}catch{return}})()}getMessagingToken(){var t=this;return(0,a.Z)(function*(){if(t.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield t.messaging.getToken()}catch{return}})()}getAppCheckToken(t){var n=this;return(0,a.Z)(function*(){if(n.appCheck){const r=t?yield n.appCheck.getLimitedUseToken():yield n.appCheck.getToken();return r.error?null:r.token}return null})()}getContext(t){var n=this;return(0,a.Z)(function*(){return{authToken:yield n.getAuthToken(),messagingToken:yield n.getMessagingToken(),appCheckToken:yield n.getAppCheckToken(t)}})()}}const B="us-central1";class Z{constructor(t,n,r,o,d=B,_){this.app=t,this.fetchImpl=_,this.emulatorOrigin=null,this.contextProvider=new b(n,r,o),this.cancelAllRequests=new Promise(I=>{this.deleteService=()=>Promise.resolve(I())});try{const I=new URL(d);this.customDomain=I.origin,this.region=B}catch{this.customDomain=null,this.region=d}}_delete(){return this.deleteService()}_url(t){const n=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${n}/${this.region}/${t}`:null!==this.customDomain?`${this.customDomain}/${t}`:`https://${this.region}-${n}.cloudfunctions.net/${t}`}}function H(e,t,n,r){return E.apply(this,arguments)}function E(){return(E=(0,a.Z)(function*(e,t,n,r){let o;n["Content-Type"]="application/json";try{o=yield r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch{return{status:0,json:null}}let d=null;try{d=yield o.json()}catch{}return{status:o.status,json:d}})).apply(this,arguments)}function y(e,t,n,r){return x.apply(this,arguments)}function x(){return(x=(0,a.Z)(function*(e,t,n,r){const o={data:n=m(n)},d={},_=yield e.contextProvider.getContext(r.limitedUseAppCheckTokens);_.authToken&&(d.Authorization="Bearer "+_.authToken),_.messagingToken&&(d["Firebase-Instance-ID-Token"]=_.messagingToken),null!==_.appCheckToken&&(d["X-Firebase-AppCheck"]=_.appCheckToken);const z=function g(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new i("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),W=yield Promise.race([H(t,o,d,e.fetchImpl),z.promise,e.cancelAllRequests]);if(z.cancel(),!W)throw new i("cancelled","Firebase Functions instance was deleted.");const Y=function G(e,t){let o,n=function T(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n;try{const d=t&&t.error;if(d){const _=d.status;if("string"==typeof _){if(!S[_])return new i("internal","internal");n=S[_],r=_}const I=d.message;"string"==typeof I&&(r=I),o=d.details,void 0!==o&&(o=P(o))}}catch{}return"ok"===n?null:new i(n,r,o)}(W.status,W.json);if(Y)throw Y;if(!W.json)throw new i("internal","Response is not valid JSON object.");let k=W.json.data;if(typeof k>"u"&&(k=W.json.result),typeof k>"u")throw new i("internal","Response is missing data field.");return{data:P(k)}})).apply(this,arguments)}const c="@firebase/functions",D="0.11.0";function V(e,t,n){!function K(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}((0,f.m9)(e),t,n)}!function U(e,t){(0,A._registerComponent)(new C.wA(L,(r,{instanceIdentifier:o})=>{const d=r.getProvider("app").getImmediate(),_=r.getProvider("auth-internal"),I=r.getProvider("messaging-internal"),z=r.getProvider("app-check-internal");return new Z(d,_,I,z,o,e)},"PUBLIC").setMultipleInstances(!0)),(0,A.registerVersion)(c,D,t),(0,A.registerVersion)(c,D,"esm2017")}(fetch.bind(self));class J{constructor(t,n){this.app=t,this._delegate=n,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(t,n){return function X(e,t,n){return function R(e,t,n){return r=>function v(e,t,n,r){const o=e._url(t);return y(e,o,n,r)}(e,t,r,n||{})}((0,f.m9)(e),t,n)}(this._delegate,t,n)}httpsCallableFromURL(t,n){return function Q(e,t,n){return function l(e,t,n){return r=>y(e,t,r,n||{})}((0,f.m9)(e),t,n)}(this._delegate,t,n)}useFunctionsEmulator(t){const n=t.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==n)throw new f.ZR("functions","No origin provided to useFunctionsEmulator()");if(null==n[2])throw new f.ZR("functions","Port missing in origin provided to useFunctionsEmulator()");return V(this._delegate,n[1],Number(n[2]))}useEmulator(t,n){return V(this._delegate,t,n)}}const ne=(e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:t??"us-central1"});return new J(n,r)};(function se(){const e={Functions:J};F.Z.INTERNAL.registerComponent(new C.wA("functions-compat",ne,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))})(),F.Z.registerVersion("@firebase/functions-compat","0.3.6")}}]);