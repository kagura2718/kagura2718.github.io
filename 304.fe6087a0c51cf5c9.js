"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[304],{4304:(w,$,s)=>{s.d($,{o:()=>x});var N=s(1528),a=s(5657),v=s(2540),f=s(2700),y=s(4e3),B=s(6684),p=s(3616),O=s(7368),g=s(9212),P=s(4680),I=s(8476),F=s(3992),o=s(6716),T=s(4496),k=s(331),S=s(2112),W=s(4848),m=s(8472),V=s(6148);class b{auth;funcs;localSession;store;dom;finalize$=new a.E;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;sourceValue$=new v.o;constructor(K,E,U,R,L){var u=this;this.auth=K,this.funcs=E,this.localSession=U,this.store=R,this.dom=L,(0,o.qe)("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${o.OU.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${o.OU.FirebaseCloudFunctionsHost}`,"preconnect");const D=this.auth.user.pipe((0,y.a)());D.pipe((0,y.a)()).subscribe(c=>{this.sourceValue$.next()}),this.state$=D.pipe((0,B.I)(c=>null!==c)),this.localSession.markedLogout$.pipe().subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe((0,p.a)(this.finalize$)).subscribe({error:c=>{(0,o.sJ)("AuthService.state$ error",c),this.doFinalize()},complete:()=>{(0,o.rD)("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe((0,O.G)(c=>this.store.collection(`/users/v1/protected/${c.uid}/fcm`).valueChanges().pipe((0,g.y)(h=>(0,o.qe)("UserProtectedStore has changed.",h)))),(0,p.a)(this.finalize$)).subscribe({next:c=>{this.sourceValue$.next()},error:c=>{(0,o.sJ)("AuthService.state$ Maybe after logout permission error. Ignore it.",c),this.doFinalize()},complete:()=>{(0,o.rD)("AuthService.state$ completed."),this.doFinalize()}});const M=this.state$.pipe((0,O.G)(function(){var c=(0,N.c)(function*(h){try{const A=yield u.funcs.call("readUserSettings"),G=h;return G.isAdmin=A.isAdmin,G.isDeveloper=A.isDeveloper,G.hasMessaging=A.hasMessaging,G}catch(A){return(0,o.sJ)("AuthService while check user settings.",A),null}});return function(h){return c.apply(this,arguments)}}()));var c;this.localUser$=this.sourceValue$.pipe((0,P.o)(100),(0,O.G)(()=>D.pipe((0,O.G)(c=>null===c?(0,f.of)(null):M))),(0,I.C)(1)),this.localUser$.pipe((0,p.a)(this.finalize$)).subscribe({next:(c=(0,N.c)(function*(h){(0,o.qe)("AuthService.localUser$.subscribe()",h),h?(u.loginUid=h.uid,u.isAdminUser=!!h.isAdmin,u.isDevelopUser=!!h.isDeveloper,u.hasMessagingDevice=!!h.hasMessaging,u.localSession.updateLoginPhoto(h.photoURL),u.localSession.markLogin()):(u.localSession.unmarkLogin(),u.localSession.updateLoginPhoto(null),u.loginUid=null,u.isAdminUser=!1,u.isDevelopUser=!1,u.hasMessagingDevice=!1,(0,o.rD)("Explicitly logout on client sdk."),yield u.auth.signOut())}),function(A){return c.apply(this,arguments)}),complete:()=>{(0,o.rD)("AuthService.localUser$ complete."),this.doFinalize()},error:c=>{(0,o.sJ)("AuthService.localUser$ error while retrieving.",c),this.doFinalize()}})}doFinalize(){this.finalize$.isStopped||((0,o.rD)("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}}let x=(()=>{class l{auth;funcs;localSession;store;dom;static AUTH=null;_clientSideUser$;constructor(E,U,R,L,u){this.auth=E,this.funcs=U,this.localSession=R,this.store=L,this.dom=u,(0,o.qe)("AuthService.constructor()");const D=new v.o;null===l.AUTH&&(l.AUTH=new b(E,U,R,L,u),l.AUTH.finalize$.pipe((0,F.U)(1)).subscribe({next:()=>{(0,o.rD)("Finalize singleton auth continue..")},complete:()=>{(0,o.rD)("Finalizing singleton auth completed."),l.AUTH=null,D.next()},error:M=>{(0,o.sJ)("Finalizing singleton auth cause by error.",M),l.AUTH=null,D.next()}})),this._clientSideUser$=D.pipe((0,O.G)(()=>null===l.AUTH?(0,f.of)(null):l.AUTH.localUser$),(0,I.C)(1)),D.next()}get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return!!l.AUTH&&l.AUTH.isAdminUser}get isDeveloper(){return!!l.AUTH&&l.AUTH.isDevelopUser}get hasMessaging(){return!!l.AUTH&&l.AUTH.hasMessagingDevice}get myUid(){return l.AUTH?l.AUTH.loginUid:null}static \u0275fac=function(U){return new(U||l)(T.CoB(k._o),T.CoB(S.W),T.CoB(W.U),T.CoB(m.i4),T.CoB(V.O))};static \u0275prov=T.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},2112:(w,$,s)=>{s.d($,{W:()=>B});var N=s(1528),a=s(3992),v=s(6716),f=s(4496),y=s(5608);let B=(()=>{class p{remote;constructor(g){this.remote=g,(0,v.qe)("LocalFunctionsService.constructor()")}call(g,P){var I=this;return(0,N.c)(function*(){return yield I.remote.httpsCallable(g)(P).pipe((0,a.U)(1)).toPromise()})()}static \u0275fac=function(P){return new(P||p)(f.CoB(y.uu))};static \u0275prov=f.wxM({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},5608:(w,$,s)=>{s.d($,{oP:()=>W,uu:()=>S,yC:()=>T}),s(3791);var a=s(4496),v=s(7900),f=s(6e3),y=s(2700),B=s(9900),p=s(3920),O=s(7368),g=s(4704),P=s(8476),I=s(9252);const o=new a.UbH("angularfire2.functions.origin"),T=new a.UbH("angularfire2.functions.region"),k=new a.UbH("angularfire2.functions.use-emulator");let S=(()=>{class m{httpsCallable;constructor(b,x,l,K,E,U,R,L){const u=R,D=(0,y.of)(void 0).pipe((0,p.y)(K.outsideAngular),(0,O.G)(()=>Promise.resolve().then(s.bind(s,3791))),(0,g.k)(()=>(0,f._G)(b,l,x)),(0,g.k)(M=>(0,f.PQ)(`${M.name}.functions.${E||U}`,"AngularFireFunctions",M.name,()=>{let c;if(E&&U)throw new Error("REGION and ORIGIN can't be used at the same time.");return c=M.functions(E||U||void 0),u&&c.useEmulator(...u),c},[E,U,u])),(0,P.C)({bufferSize:1,refCount:!1}));return this.httpsCallable=(M,c)=>h=>(0,B.Q)(D).pipe((0,p.y)(K.insideAngular),(0,O.G)(A=>A.httpsCallable(M,c)(h)),(0,g.k)(A=>A.data)),(0,f._w)(this,D,l)}static \u0275fac=function(x){return new(x||m)(a.CoB(f.E9),a.CoB(f.Ml,8),a.CoB(a.WW2),a.CoB(v.u),a.CoB(T,8),a.CoB(o,8),a.CoB(k,8),a.CoB(v.gJ,8))};static \u0275prov=a.wxM({token:m,factory:m.\u0275fac,providedIn:"any"})}return m})(),W=(()=>{class m{constructor(){I.c.registerVersion("angularfire",v.j1.full,"fn-compat")}static \u0275fac=function(x){return new(x||m)};static \u0275mod=a.a4G({type:m});static \u0275inj=a.s3X({providers:[S]})}return m})()},3791:(w,$,s)=>{s.r($);var N=s(9624),a=s(1528),v=s(8360),f=s(3584),y=s(3144);const B="type.googleapis.com/google.protobuf.Int64Value",p="type.googleapis.com/google.protobuf.UInt64Value";function O(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function g(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>g(t));if("function"==typeof e||"object"==typeof e)return O(e,t=>g(t));throw new Error("Data cannot be encoded in JSON: "+e)}function P(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case B:case p:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>P(t)):"function"==typeof e||"object"==typeof e?O(e,t=>P(t)):e}const I="functions",F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class o extends f.kx{constructor(t,n,r){super(`${I}/${t}`,n||""),this.details=r}}class S{constructor(t,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||n.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}getAuthToken(){var t=this;return(0,a.c)(function*(){if(t.auth)try{const n=yield t.auth.getToken();return n?.accessToken}catch{return}})()}getMessagingToken(){var t=this;return(0,a.c)(function*(){if(t.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield t.messaging.getToken()}catch{return}})()}getAppCheckToken(t){var n=this;return(0,a.c)(function*(){if(n.appCheck){const r=t?yield n.appCheck.getLimitedUseToken():yield n.appCheck.getToken();return r.error?null:r.token}return null})()}getContext(t){var n=this;return(0,a.c)(function*(){return{authToken:yield n.getAuthToken(),messagingToken:yield n.getMessagingToken(),appCheckToken:yield n.getAppCheckToken(t)}})()}}const W="us-central1";class V{constructor(t,n,r,i,d=W,_){this.app=t,this.fetchImpl=_,this.emulatorOrigin=null,this.contextProvider=new S(n,r,i),this.cancelAllRequests=new Promise(C=>{this.deleteService=()=>Promise.resolve(C())});try{const C=new URL(d);this.customDomain=C.origin,this.region=W}catch{this.customDomain=null,this.region=d}}_delete(){return this.deleteService()}_url(t){const n=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${n}/${this.region}/${t}`:null!==this.customDomain?`${this.customDomain}/${t}`:`https://${this.region}-${n}.cloudfunctions.net/${t}`}}function K(e,t,n,r){return E.apply(this,arguments)}function E(){return(E=(0,a.c)(function*(e,t,n,r){let i;n["Content-Type"]="application/json";try{i=yield r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch{return{status:0,json:null}}let d=null;try{d=yield i.json()}catch{}return{status:i.status,json:d}})).apply(this,arguments)}function R(e,t,n,r){return L.apply(this,arguments)}function L(){return(L=(0,a.c)(function*(e,t,n,r){const i={data:n=g(n)},d={},_=yield e.contextProvider.getContext(r.limitedUseAppCheckTokens);_.authToken&&(d.Authorization="Bearer "+_.authToken),_.messagingToken&&(d["Firebase-Instance-ID-Token"]=_.messagingToken),null!==_.appCheckToken&&(d["X-Firebase-AppCheck"]=_.appCheckToken);const j=function m(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new o("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),H=yield Promise.race([K(t,i,d,e.fetchImpl),j.promise,e.cancelAllRequests]);if(j.cancel(),!H)throw new o("cancelled","Firebase Functions instance was deleted.");const X=function k(e,t){let i,n=function T(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n;try{const d=t&&t.error;if(d){const _=d.status;if("string"==typeof _){if(!F[_])return new o("internal","internal");n=F[_],r=_}const C=d.message;"string"==typeof C&&(r=C),i=d.details,void 0!==i&&(i=P(i))}}catch{}return"ok"===n?null:new o(n,r,i)}(H.status,H.json);if(X)throw X;if(!H.json)throw new o("internal","Response is not valid JSON object.");let z=H.json.data;if(typeof z>"u"&&(z=H.json.result),typeof z>"u")throw new o("internal","Response is missing data field.");return{data:P(z)}})).apply(this,arguments)}const u="@firebase/functions",D="0.11.1";function J(e,t,n){!function b(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}((0,f.Yj)(e),t,n)}!function A(e,t){(0,v._registerComponent)(new y.Yl(I,(r,{instanceIdentifier:i})=>{const d=r.getProvider("app").getImmediate(),_=r.getProvider("auth-internal"),C=r.getProvider("messaging-internal"),j=r.getProvider("app-check-internal");return new V(d,_,C,j,i,e)},"PUBLIC").setMultipleInstances(!0)),(0,v.registerVersion)(u,D,t),(0,v.registerVersion)(u,D,"esm2017")}(fetch.bind(self));class Y{constructor(t,n){this.app=t,this._delegate=n,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(t,n){return function Q(e,t,n){return function x(e,t,n){return r=>function U(e,t,n,r){const i=e._url(t);return R(e,i,n,r)}(e,t,r,n||{})}((0,f.Yj)(e),t,n)}(this._delegate,t,n)}httpsCallableFromURL(t,n){return function Z(e,t,n){return function l(e,t,n){return r=>R(e,t,r,n||{})}((0,f.Yj)(e),t,n)}(this._delegate,t,n)}useFunctionsEmulator(t){const n=t.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==n)throw new f.kx("functions","No origin provided to useFunctionsEmulator()");if(null==n[2])throw new f.kx("functions","Port missing in origin provided to useFunctionsEmulator()");return J(this._delegate,n[1],Number(n[2]))}useEmulator(t,n){return J(this._delegate,t,n)}}const ne=(e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:t??"us-central1"});return new Y(n,r)};(function se(){const e={Functions:Y};N.c.INTERNAL.registerComponent(new y.Yl("functions-compat",ne,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))})(),N.c.registerVersion("@firebase/functions-compat","0.3.7")}}]);