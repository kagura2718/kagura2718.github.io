"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[579],{5579:(OI,Wf,j)=>{j.d(Wf,{ST:()=>$f,yb:()=>FI});var Re=j(1180),Hf=j(6814),$=j(5879),Ce=j(8326),oi=j(7217),lt=j(434),Zf=j(6321),Yf=j(5592),ai=j(2459),Gu=j(2096),Ns=j(7921),Xf=j(9360),Jf=j(8251);function ks(){return(0,Xf.e)((n,e)=>{let t,r=!1;n.subscribe((0,Jf.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var A,ze=j(7398),Fs=j(6699),em=j(3997),zu=j(2181),tm=(j(4015),j(8168)),p=j(5861),ui=j(6122),Ku=j(4537),Ke=j(7879),K=j(9058),nm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qe={},Ms=Ms||{},b=nm||self;function ci(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Wn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Os="closure_uid_"+(1e9*Math.random()>>>0),im=0;function sm(n,e,t){return n.call.apply(n.bind,arguments)}function om(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Te(n,e,t){return(Te=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?sm:om).apply(null,arguments)}function li(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function le(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function ht(){this.s=this.s,this.o=this.o}ht.prototype.s=!1,ht.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function rm(n){Object.prototype.hasOwnProperty.call(n,Os)&&n[Os]||(n[Os]=++im)}(this)},ht.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ju=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Ls(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function $u(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(ci(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ee(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var um=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{b.addEventListener("test",()=>{},e),b.removeEventListener("test",()=>{},e)}catch{}return n}();function Hn(n){return/^[\s\xa0]*$/.test(n)}function hi(){var n=b.navigator;return n&&(n=n.userAgent)?n:""}function je(n){return-1!=hi().indexOf(n)}function Bs(n){return Bs[" "](n),n}Bs[" "]=function(){};var Us,n,lm=je("Opera"),sn=je("Trident")||je("MSIE"),Qu=je("Edge"),qs=Qu||sn,Wu=je("Gecko")&&!(-1!=hi().toLowerCase().indexOf("webkit")&&!je("Edge"))&&!(je("Trident")||je("MSIE"))&&!je("Edge"),hm=-1!=hi().toLowerCase().indexOf("webkit")&&!je("Edge");function Hu(){var n=b.document;return n?n.documentMode:void 0}e:{var Gs="",zs=(n=hi(),Wu?/rv:([^\);]+)(\)|;)/.exec(n):Qu?/Edge\/([\d\.]+)/.exec(n):sn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):hm?/WebKit\/(\S+)/.exec(n):lm?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(zs&&(Gs=zs?zs[1]:""),sn){var Ks=Hu();if(null!=Ks&&Ks>parseFloat(Gs)){Us=String(Ks);break e}}Us=Gs}var dm=b.document&&sn&&(Hu()||parseInt(Us,10))||void 0;function Zn(n,e){if(Ee.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Wu){e:{try{Bs(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:fm[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Zn.$.h.call(this)}}le(Zn,Ee);var fm={2:"touch",3:"pen",4:"mouse"};Zn.prototype.h=function(){Zn.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Yn="closure_listenable_"+(1e6*Math.random()|0),mm=0;function gm(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++mm,this.fa=this.ia=!1}function di(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function $s(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Yu(n){const e={};for(const t in n)e[t]=n[t];return e}const Xu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ju(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Xu.length;s++)t=Xu[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function fi(n){this.src=n,this.g={},this.h=0}function Qs(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=ju(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(di(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Ws(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}fi.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Ws(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new gm(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Hs="closure_lm_"+(1e6*Math.random()|0),Zs={};function ec(n,e,t,r,i){if(r&&r.once)return nc(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)ec(n,e[s],t,r,i);return null}return t=eo(t),n&&n[Yn]?n.O(e,t,Wn(r)?!!r.capture:!!r,i):tc(n,e,t,!1,r,i)}function tc(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Wn(i)?!!i.capture:!!i,a=Xs(n);if(a||(n[Hs]=a=new fi(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function _m(){const e=ym;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)um||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(ic(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function nc(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)nc(n,e[s],t,r,i);return null}return t=eo(t),n&&n[Yn]?n.P(e,t,Wn(r)?!!r.capture:!!r,i):tc(n,e,t,!0,r,i)}function rc(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)rc(n,e[s],t,r,i);else r=Wn(r)?!!r.capture:!!r,t=eo(t),n&&n[Yn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Ws(s=n.g[e],t,r,i))&&(di(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Xs(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ws(e,t,r,i)),(t=-1<n?e[n]:null)&&Ys(t))}function Ys(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Yn])Qs(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ic(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Xs(e))?(Qs(t,n),0==t.h&&(t.src=null,e[Hs]=null)):di(n)}}}function ic(n){return n in Zs?Zs[n]:Zs[n]="on"+n}function ym(n,e){if(n.fa)n=!0;else{e=new Zn(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Ys(n),n=t.call(r,e)}return n}function Xs(n){return(n=n[Hs])instanceof fi?n:null}var Js="__closure_events_fn_"+(1e9*Math.random()>>>0);function eo(n){return"function"==typeof n?n:(n[Js]||(n[Js]=function(e){return n.handleEvent(e)}),n[Js])}function he(){ht.call(this),this.i=new fi(this),this.S=this,this.J=null}function ge(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Ee(e,n);else if(e instanceof Ee)e.target=e.target||n;else{var i=e;Ju(e=new Ee(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=mi(o,r,!0,e)&&i}if(i=mi(o=e.g=n,r,!0,e)&&i,i=mi(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=mi(o=e.g=t[s],r,!1,e)&&i}function mi(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&Qs(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}le(he,ht),he.prototype[Yn]=!0,he.prototype.removeEventListener=function(n,e,t,r){rc(this,n,e,t,r)},he.prototype.N=function(){if(he.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)di(t[r]);delete n.g[e],n.h--}}this.J=null},he.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},he.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var to=b.JSON.stringify;function Tm(){var n=no;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var sc=new class Im{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new vm,n=>n.reset());class vm{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function wm(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Am(n){b.setTimeout(()=>{throw n},0)}let Xn,Jn=!1,no=new class Em{constructor(){this.h=this.g=null}add(e,t){const r=sc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},oc=()=>{const n=b.Promise.resolve(void 0);Xn=()=>{n.then(Rm)}};var Rm=()=>{for(var n;n=Tm();){try{n.h.call(n.g)}catch(t){Am(t)}var e=sc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Jn=!1};function gi(n,e){he.call(this),this.h=n||1,this.g=e||b,this.j=Te(this.qb,this),this.l=Date.now()}function ro(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function io(n,e,t){if("function"==typeof n)t&&(n=Te(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Te(n.handleEvent,n)}return 2147483647<Number(e)?-1:b.setTimeout(n,e||0)}function ac(n){n.g=io(()=>{n.g=null,n.i&&(n.i=!1,ac(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}le(gi,he),(A=gi.prototype).ga=!1,A.T=null,A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ge(this,"tick"),this.ga&&(ro(this),this.start()))}},A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},A.N=function(){gi.$.N.call(this),ro(this),delete this.g};class Pm extends ht{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ac(this)}N(){super.N(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function er(n){ht.call(this),this.h=n,this.g={}}le(er,ht);var uc=[];function cc(n,e,t,r){Array.isArray(t)||(t&&(uc[0]=t.toString()),t=uc);for(var i=0;i<t.length;i++){var s=ec(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function lc(n){$s(n.g,function(e,t){this.g.hasOwnProperty(t)&&Ys(e)},n),n.g={}}function pi(){this.g=!0}function on(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Cm(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return to(t)}catch{return e}}(n,t)+(r?" "+r:"")})}er.prototype.N=function(){er.$.N.call(this),lc(this)},er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pi.prototype.Ea=function(){this.g=!1},pi.prototype.info=function(){};var Nt={},hc=null;function _i(){return hc=hc||new he}function dc(n){Ee.call(this,Nt.Ta,n)}function tr(n){const e=_i();ge(e,new dc(e))}function fc(n,e){Ee.call(this,Nt.STAT_EVENT,n),this.stat=e}function Pe(n){const e=_i();ge(e,new fc(e,n))}function mc(n,e){Ee.call(this,Nt.Ua,n),this.size=e}function nr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){n()},e)}Nt.Ta="serverreachability",le(dc,Ee),Nt.STAT_EVENT="statevent",le(fc,Ee),Nt.Ua="timingevent",le(mc,Ee);var yi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},gc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function so(){}function _c(){}so.prototype.h=null;var uo,rr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function oo(){Ee.call(this,"d")}function ao(){Ee.call(this,"c")}function Ii(){}function ir(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new er(this),this.P=Dm,this.V=new gi(n=qs?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new yc}function yc(){this.i=null,this.g="",this.h=!1}le(oo,Ee),le(ao,Ee),le(Ii,so),Ii.prototype.g=function(){return new XMLHttpRequest},Ii.prototype.i=function(){return{}},uo=new Ii;var Dm=45e3,co={},Ti={};function lo(n,e,t){n.L=1,n.v=Ai(et(e)),n.s=t,n.S=!0,Ic(n,null)}function Ic(n,e){n.G=Date.now(),sr(n),n.A=et(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),xc(t.i,"t",r),n.C=0,t=n.l.J,n.h=new yc,n.g=Jc(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Pm(Te(n.Pa,n,n.g),n.O)),cc(n.U,n.g,"readystatechange",n.nb),e=n.I?Yu(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),tr(),function Sm(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function Tc(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Ec(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=bm(n,t),i==Ti){4==e&&(n.o=4,Pe(14),r=!1),on(n.j,n.m,null,"[Incomplete Response]");break}if(i==co){n.o=4,Pe(15),on(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}on(n.j,n.m,i,null),ho(n,i)}Tc(n)&&i!=Ti&&i!=co&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Pe(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Io(e),e.M=!0,Pe(11))):(on(n.j,n.m,t,"[Invalid Chunked Response]"),kt(n),or(n))}function bm(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ti:(t=Number(e.substring(t,r)),isNaN(t)?co:(r+=1)+t>e.length?Ti:(e=e.slice(r,r+t),n.C=r+t,e))}function sr(n){n.Y=Date.now()+n.P,vc(n,n.P)}function vc(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=nr(Te(n.lb,n),e)}function Ei(n){n.B&&(b.clearTimeout(n.B),n.B=null)}function or(n){0==n.l.H||n.J||Hc(n.l,n)}function kt(n){Ei(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,ro(n.V),lc(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function ho(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||fo(t.i,n)))if(!n.K&&fo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Ci(t),Vi(t)}yo(t),Pe(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=nr(Te(t.ib,t),6e3));if(1>=bc(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Mt(t,11)}else if((n.K||t.g==n)&&Ci(t),!Hn(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.L=r=1.5*d,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const m=n.g;if(m){const I=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(I){var s=r.i;s.g||-1==I.indexOf("spdy")&&-1==I.indexOf("quic")&&-1==I.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(mo(s,s.h),s.h=null))}if(r.F){const T=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;T&&(r.Da=T,H(r.I,r.F,T))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=Xc(r,r.J?r.pa:null,r.Y),o.K){Nc(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.B&&(Ei(a),sr(a)),r.g=o}else Qc(r);0<t.j.length&&xi(t)}else"stop"!=c[0]&&"close"!=c[0]||Mt(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Mt(t,7):_o(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}tr()}catch{}}function wc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(ci(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function km(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ci(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Nm(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(ci(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(A=ir.prototype).setTimeout=function(n){this.P=n},A.nb=function(n){n=n.target;const e=this.M;e&&3==$e(n)?e.l():this.Pa(n)},A.Pa=function(n){try{if(n==this.g)e:{const l=$e(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||qs||this.g&&(this.h.h||this.g.ja()||Uc(this.g)))){this.J||4!=l||7==e||tr(),Ei(this);var t=this.g.da();this.ca=t;t:if(Tc(this)){var r=Uc(this.g);n="";var i=r.length,s=4==$e(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){kt(this),or(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Vm(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hn(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,Pe(12),kt(this),or(this);break e}on(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ho(this,t)}this.S?(Ec(this,l,o),qs&&this.i&&3==l&&(cc(this.U,this.V,"tick",this.mb),this.V.start())):(on(this.j,this.m,o,null),ho(this,o)),4==l&&kt(this),this.i&&!this.J&&(4==l?Hc(this.l,this):(this.i=!1,sr(this)))}else(function Xm(n){const e={};n=(n.g&&2<=$e(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Hn(n[r]))continue;var t=wm(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function pm(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Pe(12)):(this.o=0,Pe(13)),kt(this),or(this)}}}catch{}},A.mb=function(){if(this.g){var n=$e(this.g),e=this.g.ja();this.C<e.length&&(Ei(this),Ec(this,n,e),this.i&&4!=n&&sr(this))}},A.cancel=function(){this.J=!0,kt(this)},A.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function xm(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(tr(),Pe(17)),kt(this),this.o=2,or(this)):vc(this,this.Y-n)};var Ac=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ft(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ft){this.h=n.h,vi(this,n.j),this.s=n.s,this.g=n.g,wi(this,n.m),this.l=n.l;var e=n.i,t=new cr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Rc(this,t),this.o=n.o}else n&&(e=String(n).match(Ac))?(this.h=!1,vi(this,e[1]||"",!0),this.s=ar(e[2]||""),this.g=ar(e[3]||"",!0),wi(this,e[4]),this.l=ar(e[5]||"",!0),Rc(this,e[6]||"",!0),this.o=ar(e[7]||"")):(this.h=!1,this.i=new cr(null,this.h))}function et(n){return new Ft(n)}function vi(n,e,t){n.j=t?ar(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function wi(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Rc(n,e,t){e instanceof cr?(n.i=e,function Um(n,e){e&&!n.j&&(dt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Sc(this,r),xc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=ur(e,Bm)),n.i=new cr(e,n.h))}function H(n,e,t){n.i.set(e,t)}function Ai(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ar(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ur(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Mm),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Mm(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Ft.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ur(e,Pc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(ur(e,Pc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(ur(t,"/"==t.charAt(0)?Lm:Om,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ur(t,qm)),n.join("")};var Pc=/[#\/\?@]/g,Om=/[#\?:]/g,Lm=/[#\?]/g,Bm=/[#\?@]/g,qm=/#/g;function cr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function dt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Fm(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Sc(n,e){dt(n),e=an(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Vc(n,e){return dt(n),e=an(n,e),n.g.has(e)}function xc(n,e,t){Sc(n,e),0<t.length&&(n.i=null,n.g.set(an(n,e),Ls(t)),n.h+=t.length)}function an(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Cc(n){this.l=n||zm,n=b.PerformanceNavigationTiming?0<(n=b.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(b.g&&b.g.Ka&&b.g.Ka()&&b.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(A=cr.prototype).add=function(n,e){dt(this),this.i=null,n=an(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},A.forEach=function(n,e){dt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},A.ta=function(){dt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},A.Z=function(n){dt(this);let e=[];if("string"==typeof n)Vc(this,n)&&(e=e.concat(this.g.get(an(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},A.set=function(n,e){return dt(this),this.i=null,Vc(this,n=an(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},A.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},A.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var zm=10;function Dc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function bc(n){return n.h?1:n.g?n.g.size:0}function fo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function mo(n,e){n.g?n.g.add(e):n.h=e}function Nc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function kc(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Ls(n.i)}Cc.prototype.cancel=function(){if(this.i=kc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Km=class{stringify(n){return b.JSON.stringify(n,void 0)}parse(n){return b.JSON.parse(n,void 0)}};function jm(){this.g=new Km}function $m(n,e,t){const r=t||"";try{wc(n,function(i,s){let o=i;Wn(i)&&(o=to(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ri(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function lr(n){this.l=n.ec||null,this.j=n.ob||!1}function Pi(n,e){he.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=go,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}le(lr,so),lr.prototype.g=function(){return new Pi(this.l,this.j)},lr.prototype.i=function(n){return function(){return n}}({}),le(Pi,he);var go=0;function Fc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function hr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,dr(n)}function dr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(A=Pi.prototype).open=function(n,e){if(this.readyState!=go)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,dr(this)},A.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||b).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hr(this)),this.readyState=go},A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,dr(this)),this.g&&(this.readyState=3,dr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof b.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Fc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?hr(this):dr(this),3==this.readyState&&Fc(this)}},A.Za=function(n){this.g&&(this.response=this.responseText=n,hr(this))},A.Ya=function(n){this.g&&(this.response=n,hr(this))},A.ka=function(){this.g&&hr(this)},A.setRequestHeader=function(n,e){this.v.append(n,e)},A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},A.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Pi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Wm=b.JSON.parse;function te(n){he.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Mc,this.L=this.M=!1}le(te,he);var Mc="",Hm=/^https?$/i,Zm=["POST","PUT"];function Oc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Lc(n),Si(n)}function Lc(n){n.F||(n.F=!0,ge(n,"complete"),ge(n,"error"))}function Bc(n){if(n.h&&typeof Ms<"u"&&(!n.C[1]||4!=$e(n)||2!=n.da()))if(n.v&&4==$e(n))io(n.La,0,n);else if(ge(n,"readystatechange"),4==$e(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(Ac)[1]||null;!i&&b.self&&b.self.location&&(i=b.self.location.protocol.slice(0,-1)),r=!Hm.test(i?i.toLowerCase():"")}t=r}if(t)ge(n,"complete"),ge(n,"success");else{n.m=6;try{var s=2<$e(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Lc(n)}}finally{Si(n)}}}function Si(n,e){if(n.g){qc(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ge(n,"ready");try{t.onreadystatechange=r}catch{}}}function qc(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(b.clearTimeout(n.A),n.A=null)}function $e(n){return n.g?n.g.readyState:0}function Uc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Mc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Gc(n){let e="";return $s(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function po(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Gc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):H(n,e,t))}function fr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function zc(n){this.Ga=0,this.j=[],this.l=new pi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=fr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=fr("baseRetryDelayMs",5e3,n),this.hb=fr("retryDelaySeedMs",1e4,n),this.eb=fr("forwardChannelMaxRetries",2,n),this.xa=fr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Cc(n&&n.concurrentRequestLimit),this.Ja=new jm,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function _o(n){if(Kc(n),3==n.H){var e=n.W++,t=et(n.I);if(H(t,"SID",n.K),H(t,"RID",e),H(t,"TYPE","terminate"),mr(n,t),(e=new ir(n,n.l,e)).L=2,e.v=Ai(et(t)),t=!1,b.navigator&&b.navigator.sendBeacon)try{t=b.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&b.Image&&((new Image).src=e.v,t=!0),t||(e.g=Jc(e.l,null),e.g.ha(e.v)),e.G=Date.now(),sr(e)}Yc(n)}function Vi(n){n.g&&(Io(n),n.g.cancel(),n.g=null)}function Kc(n){Vi(n),n.u&&(b.clearTimeout(n.u),n.u=null),Ci(n),n.i.cancel(),n.m&&("number"==typeof n.m&&b.clearTimeout(n.m),n.m=null)}function xi(n){if(!Dc(n.i)&&!n.m){n.m=!0;var e=n.Na;Xn||oc(),Jn||(Xn(),Jn=!0),no.add(e,n),n.C=0}}function jc(n,e){var t;t=e?e.m:n.W++;const r=et(n.I);H(r,"SID",n.K),H(r,"RID",t),H(r,"AID",n.V),mr(n,r),n.o&&n.s&&po(r,n.o,n.s),t=new ir(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=$c(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),mo(n.i,t),lo(t,r,e)}function mr(n,e){n.na&&$s(n.na,function(t,r){H(e,r,t)}),n.h&&wc({},function(t,r){H(e,r,t)})}function $c(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Te(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{$m(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Qc(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Xn||oc(),Jn||(Xn(),Jn=!0),no.add(e,n),n.A=0}}function yo(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=nr(Te(n.Ma,n),Zc(n,n.A)),n.A++,0))}function Io(n){null!=n.B&&(b.clearTimeout(n.B),n.B=null)}function Wc(n){n.g=new ir(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=et(n.wa);H(e,"RID","rpc"),H(e,"SID",n.K),H(e,"AID",n.V),H(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(e,"TO",n.qa),H(e,"TYPE","xmlhttp"),mr(n,e),n.o&&n.s&&po(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Ai(et(e)),t.s=null,t.S=!0,Ic(t,n)}function Ci(n){null!=n.v&&(b.clearTimeout(n.v),n.v=null)}function Hc(n,e){var t=null;if(n.g==e){Ci(n),Io(n),n.g=null;var r=2}else{if(!fo(n.i,e))return;t=e.F,Nc(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;ge(r=_i(),new mc(r,t)),xi(n)}else Qc(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function Jm(n,e){return!(bc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=nr(Te(n.Na,n,e),Zc(n,n.C)),n.C++,0)))}(n,e)||2==r&&yo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Mt(n,5);break;case 4:Mt(n,10);break;case 3:Mt(n,6);break;default:Mt(n,2)}}function Zc(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Mt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Te(n.pb,n);t||(t=new Ft("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||vi(t,"https"),Ai(t)),function Qm(n,e){const t=new pi;if(b.Image){const r=new Image;r.onload=li(Ri,t,r,"TestLoadImage: loaded",!0,e),r.onerror=li(Ri,t,r,"TestLoadImage: error",!1,e),r.onabort=li(Ri,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=li(Ri,t,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Pe(2);n.H=0,n.h&&n.h.za(e),Yc(n),Kc(n)}function Yc(n){if(n.H=0,n.ma=[],n.h){const e=kc(n.i);(0!=e.length||0!=n.j.length)&&($u(n.ma,e),$u(n.ma,n.j),n.i.i.length=0,Ls(n.j),n.j.length=0),n.h.ya()}}function Xc(n,e,t){var r=t instanceof Ft?et(t):new Ft(t);if(""!=r.g)e&&(r.g=e+"."+r.g),wi(r,r.m);else{var i=b.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Ft(null);r&&vi(s,r),e&&(s.g=e),i&&wi(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&H(r,t,e),H(r,"VER",n.ra),mr(n,r),r}function Jc(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new te(t&&n.Ha&&!n.va?new lr({ob:!0}):n.va)).Oa(n.J),e}function el(){}function Di(){if(sn&&!(10<=Number(dm)))throw Error("Environmental error: no available transport.")}function ke(n,e){he.call(this),this.g=new zc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Hn(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hn(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new un(this)}function tl(n){oo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function nl(){ao.call(this),this.status=1}function un(n){this.g=n}function Ue(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function To(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function U(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(A=te.prototype).Oa=function(n){this.M=n},A.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():uo.g(),this.C=function pc(n){return n.h||(n.h=n.i())}(this.u?this.u:uo),this.g.onreadystatechange=Te(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Oc(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=b.FormData&&n instanceof b.FormData,!(0<=ju(Zm,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{qc(this),0<this.B&&((this.L=function Ym(n){return sn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Te(this.ua,this)):this.A=io(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Oc(this,s)}},A.ua=function(){typeof Ms<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ge(this,"timeout"),this.abort(8))},A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ge(this,"complete"),ge(this,"abort"),Si(this))},A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Si(this,!0)),te.$.N.call(this)},A.La=function(){this.s||(this.G||this.v||this.l?Bc(this):this.kb())},A.kb=function(){Bc(this)},A.isActive=function(){return!!this.g},A.da=function(){try{return 2<$e(this)?this.g.status:-1}catch{return-1}},A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},A.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Wm(e)}},A.Ia=function(){return this.m},A.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(A=zc.prototype).ra=8,A.H=1,A.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new ir(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Yu(s),Ju(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=$c(this,i,e),H(t=et(this.I),"RID",n),H(t,"CVER",22),this.F&&H(t,"X-HTTP-Session-Id",this.F),mr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Gc(s)))+"&"+e:this.o&&po(t,this.o,s)),mo(this.i,i),this.bb&&H(t,"TYPE","init"),this.P?(H(t,"$req",e),H(t,"SID","null"),i.aa=!0,lo(i,t,null)):lo(i,t,e),this.H=2}}else 3==this.H&&(n?jc(this,n):0==this.j.length||Dc(this.i)||jc(this))},A.Ma=function(){if(this.u=null,Wc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=nr(Te(this.jb,this),n)}},A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Pe(10),Vi(this),Wc(this))},A.ib=function(){null!=this.v&&(this.v=null,Vi(this),yo(this),Pe(19))},A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Pe(2)):(this.l.info("Failed to ping google.com"),Pe(1))},A.isActive=function(){return!!this.h&&this.h.isActive(this)},(A=el.prototype).Ba=function(){},A.Aa=function(){},A.za=function(){},A.ya=function(){},A.isActive=function(){return!0},A.Va=function(){},Di.prototype.g=function(n,e){return new ke(n,e)},le(ke,he),ke.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Pe(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Xc(n,null,n.Y),xi(n)},ke.prototype.close=function(){_o(this.g)},ke.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=to(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&xi(e)},ke.prototype.N=function(){this.g.h=null,delete this.j,_o(this.g),delete this.g,ke.$.N.call(this)},le(tl,oo),le(nl,ao),le(un,el),un.prototype.Ba=function(){ge(this.g,"a")},un.prototype.Aa=function(n){ge(this.g,new tl(n))},un.prototype.za=function(n){ge(this.g,new nl)},un.prototype.ya=function(){ge(this.g,"b")},le(Ue,function eg(){this.blockSize=-1}),Ue.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ue.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)To(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){To(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){To(this,r),i=0;break}}this.h=i,this.i+=e},Ue.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var tg={};function Eo(n){return-128<=n&&128>n?function cm(n,e){var t=tg;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new U([0|e],0>e?-1:0)}):new U([0|n],0>n?-1:0)}function Qe(n){if(isNaN(n)||!isFinite(n))return cn;if(0>n)return pe(Qe(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=vo;return new U(e,0)}var vo=4294967296,cn=Eo(0),wo=Eo(1),il=Eo(16777216);function tt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Oe(n){return-1==n.h}function pe(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new U(t,~n.h).add(wo)}function bi(n,e){return n.add(pe(e))}function Ni(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function gr(n,e){this.g=n,this.h=e}function ki(n,e){if(tt(e))throw Error("division by zero");if(tt(n))return new gr(cn,cn);if(Oe(n))return e=ki(pe(n),e),new gr(pe(e.g),pe(e.h));if(Oe(e))return e=ki(n,pe(e)),new gr(pe(e.g),e.h);if(30<n.g.length){if(Oe(n)||Oe(e))throw Error("slowDivide_ only works with positive integers.");for(var t=wo,r=e;0>=r.X(n);)t=sl(t),r=sl(r);var i=ln(t,1),s=ln(r,1);for(r=ln(r,2),t=ln(t,2);!tt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ln(r,1),t=ln(t,1)}return e=bi(n,i.R(e)),new gr(i,e)}for(i=cn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Qe(t)).R(e);Oe(o)||0<o.X(n);)o=(s=Qe(t-=r)).R(e);tt(s)&&(s=wo),i=i.add(s),n=bi(n,o)}return new gr(i,n)}function sl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new U(t,n.h)}function ln(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new U(i,n.h)}(A=U.prototype).ea=function(){if(Oe(this))return-pe(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:vo+r)*e,e*=vo}return n},A.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(tt(this))return"0";if(Oe(this))return"-"+pe(this).toString(n);for(var e=Qe(Math.pow(n,6)),t=this,r="";;){var i=ki(t,e).g,s=((0<(t=bi(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(tt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},A.X=function(n){return Oe(n=bi(this,n))?-1:tt(n)?0:1},A.abs=function(){return Oe(this)?pe(this):this},A.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new U(t,-2147483648&t[t.length-1]?-1:0)},A.R=function(n){if(tt(this)||tt(n))return cn;if(Oe(this))return Oe(n)?pe(this).R(pe(n)):pe(pe(this).R(n));if(Oe(n))return pe(this.R(pe(n)));if(0>this.X(il)&&0>n.X(il))return Qe(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,Ni(t,2*r+2*i),t[2*r+2*i+1]+=s*u,Ni(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Ni(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Ni(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new U(t,0)},A.gb=function(n){return ki(this,n).h},A.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new U(t,this.h&n.h)},A.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new U(t,this.h|n.h)},A.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new U(t,this.h^n.h)},Di.prototype.createWebChannel=Di.prototype.g,ke.prototype.send=ke.prototype.u,ke.prototype.open=ke.prototype.m,ke.prototype.close=ke.prototype.close,yi.NO_ERROR=0,yi.TIMEOUT=8,yi.HTTP_ERROR=6,gc.COMPLETE="complete",_c.EventType=rr,rr.OPEN="a",rr.CLOSE="b",rr.ERROR="c",rr.MESSAGE="d",he.prototype.listen=he.prototype.O,te.prototype.listenOnce=te.prototype.P,te.prototype.getLastError=te.prototype.Sa,te.prototype.getLastErrorCode=te.prototype.Ia,te.prototype.getStatus=te.prototype.da,te.prototype.getResponseJson=te.prototype.Wa,te.prototype.getResponseText=te.prototype.ja,te.prototype.send=te.prototype.ha,te.prototype.setWithCredentials=te.prototype.Oa,Ue.prototype.digest=Ue.prototype.l,Ue.prototype.reset=Ue.prototype.reset,Ue.prototype.update=Ue.prototype.j,U.prototype.add=U.prototype.add,U.prototype.multiply=U.prototype.R,U.prototype.modulo=U.prototype.gb,U.prototype.compare=U.prototype.X,U.prototype.toNumber=U.prototype.ea,U.prototype.toString=U.prototype.toString,U.prototype.getBits=U.prototype.D,U.fromNumber=Qe,U.fromString=function rl(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return pe(rl(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Qe(Math.pow(e,8)),r=cn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Qe(Math.pow(e,s)),r=r.R(s).add(Qe(o))):r=(r=r.R(t)).add(Qe(o))}return r};var ng=qe.createWebChannelTransport=function(){return new Di},rg=qe.getStatEventTarget=function(){return _i()},Ao=qe.ErrorCode=yi,ig=qe.EventType=gc,sg=qe.Event=Nt,ol=qe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},og=qe.FetchXmlHttpFactory=lr,Fi=qe.WebChannel=_c,ag=qe.XhrIo=te,ug=qe.Md5=Ue,hn=qe.Integer=U;const al="@firebase/firestore";class de{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}de.UNAUTHENTICATED=new de(null),de.GOOGLE_CREDENTIALS=new de("google-credentials-uid"),de.FIRST_PARTY=new de("first-party-uid"),de.MOCK_USER=new de("mock-user");let dn="10.5.2";const ft=new Ke.Yd("@firebase/firestore");function fn(){return ft.logLevel}function y(n,...e){if(ft.logLevel<=Ke.in.DEBUG){const t=e.map(Ro);ft.debug(`Firestore (${dn}): ${n}`,...t)}}function ie(n,...e){if(ft.logLevel<=Ke.in.ERROR){const t=e.map(Ro);ft.error(`Firestore (${dn}): ${n}`,...t)}}function De(n,...e){if(ft.logLevel<=Ke.in.WARN){const t=e.map(Ro);ft.warn(`Firestore (${dn}): ${n}`,...t)}}function Ro(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function R(n="Unexpected state"){const e=`FIRESTORE (${dn}) INTERNAL ASSERTION FAILED: `+n;throw ie(e),new Error(e)}function P(n,e){n||R()}function v(n,e){return n}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _ extends K.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ue{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ul{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class hg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(de.UNAUTHENTICATED))}shutdown(){}}class dg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class fg{constructor(e){this.t=e,this.currentUser=de.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new ue;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ue,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ue)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P("string"==typeof r.accessToken),new ul(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return P(null===e||"string"==typeof e),new de(e)}}class mg{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=de.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class gg{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new mg(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(de.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class cl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class pg{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(P("string"==typeof t.token),this.R=t.token,new cl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function _g(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ll{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=_g(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function D(n,e){return n<e?-1:n>e?1:0}function mn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function hl(n){return n+"\0"}class J{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return J.fromMillis(Date.now())}static fromDate(e){return J.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new J(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?D(this.nanoseconds,e.nanoseconds):D(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class S{constructor(e){this.timestamp=e}static fromTimestamp(e){return new S(e)}static min(){return new S(new J(0,0))}static max(){return new S(new J(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class pr{constructor(e,t,r){void 0===t?t=0:t>e.length&&R(),void 0===r?r=e.length-t:r>e.length-t&&R(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===pr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof pr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class L extends pr{construct(e,t,r){return new L(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new L(t)}static emptyPath(){return new L([])}}const yg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Z extends pr{construct(e,t,r){return new Z(e,t,r)}static isValidIdentifier(e){return yg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Z.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Z(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Z(t)}static emptyPath(){return new Z([])}}class w{constructor(e){this.path=e}static fromPath(e){return new w(L.fromString(e))}static fromName(e){return new w(L.fromString(e).popFirst(5))}static empty(){return new w(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===L.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return L.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new w(new L(e.slice()))}}class gn{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Po(n){return n.fields.find(e=>2===e.kind)}function Ot(n){return n.fields.filter(e=>2!==e.kind)}gn.UNKNOWN_ID=-1;class Lt{constructor(e,t){this.fieldPath=e,this.kind=t}}class pn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new pn(0,Fe.min())}}function dl(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=S.fromTimestamp(1e9===r?new J(t+1,0):new J(t,r));return new Fe(i,w.empty(),e)}function fl(n){return new Fe(n.readTime,n.key,-1)}class Fe{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Fe(S.min(),w.empty(),-1)}static max(){return new Fe(S.max(),w.empty(),-1)}}function So(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=w.comparator(n.documentKey,e.documentKey),0!==t?t:D(n.largestBatchId,e.largestBatchId))}const ml="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function mt(n){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,p.Z)(function*(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==ml)throw n;y("LocalStore","Unexpectedly lost primary lease")}),Vo.apply(this,arguments)}class f{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new f((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof f?t:f.resolve(t)}catch(t){return f.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):f.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):f.reject(t)}static resolve(e){return new f((t,r)=>{t(e)})}static reject(e){return new f((t,r)=>{r(e)})}static waitFor(e){return new f((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=f.resolve(!1);for(const r of e)t=t.next(i=>i?f.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new f((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new f((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Mi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ue,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new _r(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=xo(r.target.error);this.V.reject(new _r(e,i))}}static open(e,t,r,i){try{return new Mi(t,e.transaction(i,r))}catch(s){throw new _r(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(y("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new vg(t)}}class Ge{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===Ge.S((0,K.z$)())&&ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return y("SimpleDb","Removing database:",e),Bt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,K.hl)())return!1;if(Ge.C())return!0;const e=(0,K.z$)(),t=Ge.S(e),r=0<t&&t<10,i=Ge.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,p.Z)(function*(){return t.db||(y("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new _r(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new _r(e,a))},s.onupgradeneeded=o=>{y("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{y("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.O(e);const u=Mi.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Eg{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Bt(this.k.delete())}}class _r extends _{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function gt(n){return"IndexedDbTransactionError"===n.name}class vg{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(y("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Bt(r)}add(e){return y("SimpleDb","ADD",this.store.name,e,e),Bt(this.store.add(e))}get(e){return Bt(this.store.get(e)).next(t=>(void 0===t&&(t=null),y("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return y("SimpleDb","DELETE",this.store.name,e),Bt(this.store.delete(e))}count(){return y("SimpleDb","COUNT",this.store.name),Bt(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.G(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new f((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new f((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){y("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new f((r,i)=>{t.onerror=s=>{const o=xo(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new f((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new Eg(a),c=t(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>f.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Bt(n){return new f((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=xo(r.target.error);t(i)}})}let pl=!1;function xo(n){const e=Ge.S((0,K.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pl||(pl=!0,setTimeout(()=>{throw r},0)),r}}return n}class wg{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;y("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{y("IndexBackiller",`Documents written: ${yield t.X.te()}`)}catch(r){gt(r)?y("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield mt(r)}yield t.ee(6e4)}))}}class Ag{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return f.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return y("IndexBackiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(y("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=fl(s);So(o,r)>0&&(r=o)}),new Fe(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Me=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function yr(n){return null==n}function Ir(n){return 0===n&&1/n==-1/0}function _l(n){return"number"==typeof n&&Number.isInteger(n)&&!Ir(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function ve(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yl(e)),e=Rg(n.get(t),e);return yl(e)}function Rg(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function yl(n){return n+"\x01\x01"}function We(n){const e=n.length;if(P(e>=2),2===e)return P("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),L.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&R(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:R()}s=o+2}return new L(r)}const Il=["userId","batchId"];function Oi(n,e){return[n,ve(e)]}function Tl(n,e,t){return[n,ve(e),t]}const Pg={},Sg=["prefixPath","collectionGroup","readTime","documentId"],Vg=["prefixPath","collectionGroup","documentId"],xg=["collectionGroup","readTime","prefixPath","documentId"],Cg=["canonicalId","targetId"],Dg=["targetId","path"],bg=["path","targetId"],Ng=["collectionId","parent"],kg=["indexId","uid"],Fg=["uid","sequenceNumber"],Mg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Og=["indexId","uid","orderedDocumentKey"],Lg=["userId","collectionPath","documentId"],Bg=["userId","collectionPath","largestBatchId"],qg=["userId","collectionGroup","largestBatchId"],El=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ug=[...El,"documentOverlays"],vl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],wl=vl,Gg=[...wl,"indexConfiguration","indexState","indexEntries"];class Co extends gl{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function fe(n,e){const t=v(n);return Ge.M(t.ae,e)}function Al(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function pt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Rl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Q{constructor(e,t){this.comparator=e,this.root=t||_e.EMPTY}insert(e,t){return new Q(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_e.BLACK,null,null))}remove(e){return new Q(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Li(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Li(this.root,e,this.comparator,!1)}getReverseIterator(){return new Li(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Li(this.root,e,this.comparator,!0)}}class Li{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _e{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??_e.RED,this.left=i??_e.EMPTY,this.right=s??_e.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new _e(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _e.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return _e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_e.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw R();const e=this.left.check();if(e!==this.right.check())throw R();return e+(this.isRed()?0:1)}}_e.EMPTY=null,_e.RED=!0,_e.BLACK=!1,_e.EMPTY=new class{constructor(){this.size=0}get key(){throw R()}get value(){throw R()}get color(){throw R()}get left(){throw R()}get right(){throw R()}copy(e,t,r,i,s){return this}insert(e,t,r){return new _e(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class z{constructor(e){this.comparator=e,this.data=new Q(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Pl(this.data.getIterator())}getIteratorFrom(e){return new Pl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof z)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new z(this.comparator);return t.data=e,t}}class Pl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function _n(n){return n.hasNext()?n.getNext():void 0}class be{constructor(e){this.fields=e,e.sort(Z.comparator)}static empty(){return new be([])}unionWith(e){let t=new z(Z.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Sl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ce{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Sl("Invalid base64 string: "+s):s}}(e);return new ce(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new ce(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return D(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ce.EMPTY_BYTE_STRING=new ce("");const Kg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _t(n){if(P(!!n),"string"==typeof n){let e=0;const t=Kg.exec(n);if(P(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ne(n.seconds),nanos:ne(n.nanos)}}function ne(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function nt(n){return"string"==typeof n?ce.fromBase64String(n):ce.fromUint8Array(n)}function Bi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function qi(n){const e=n.mapValue.fields.__previous_value__;return Bi(e)?qi(e):e}function Tr(n){const e=_t(n.mapValue.fields.__local_write_time__.timestampValue);return new J(e.seconds,e.nanos)}class jg{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class yt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new yt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof yt&&e.projectId===this.projectId&&e.database===this.database}}const It={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ui={nullValue:"NULL_VALUE"};function Tt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bi(n)?4:Dl(n)?9007199254740991:10:R()}function He(n,e){if(n===e)return!0;const t=Tt(n);if(t!==Tt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Tr(n).isEqual(Tr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=_t(i.timestampValue),a=_t(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,nt(n.bytesValue).isEqual(nt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ne(i.geoPointValue.latitude)===ne(s.geoPointValue.latitude)&&ne(i.geoPointValue.longitude)===ne(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ne(i.integerValue)===ne(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ne(i.doubleValue),a=ne(s.doubleValue);return o===a?Ir(o)===Ir(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return mn(n.arrayValue.values||[],e.arrayValue.values||[],He);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Al(o)!==Al(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!He(o[u],a[u])))return!1;return!0}(n,e);default:return R()}var s}function Er(n,e){return void 0!==(n.values||[]).find(t=>He(t,e))}function Et(n,e){if(n===e)return 0;const t=Tt(n),r=Tt(e);if(t!==r)return D(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return D(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ne(s.integerValue||s.doubleValue),u=ne(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Vl(n.timestampValue,e.timestampValue);case 4:return Vl(Tr(n),Tr(e));case 5:return D(n.stringValue,e.stringValue);case 6:return function(s,o){const a=nt(s),u=nt(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=D(a[c],u[c]);if(0!==l)return l}return D(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=D(ne(s.latitude),ne(o.latitude));return 0!==a?a:D(ne(s.longitude),ne(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Et(a[c],u[c]);if(l)return l}return D(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===It.mapValue&&o===It.mapValue)return 0;if(s===It.mapValue)return 1;if(o===It.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const d=D(u[h],l[h]);if(0!==d)return d;const m=Et(a[u[h]],c[l[h]]);if(0!==m)return m}return D(u.length,l.length)}(n.mapValue,e.mapValue);default:throw R()}}function Vl(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return D(n,e);const t=_t(n),r=_t(e),i=D(t.seconds,r.seconds);return 0!==i?i:D(t.nanos,r.nanos)}function yn(n){return Do(n)}function Do(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=_t(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?nt(n.bytesValue).toBase64():"referenceValue"in n?w.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Do(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Do(t.fields[o])}`;return i+"}"}(n.mapValue):R()}function qt(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bo(n){return!!n&&"integerValue"in n}function vr(n){return!!n&&"arrayValue"in n}function xl(n){return!!n&&"nullValue"in n}function Cl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function zi(n){return!!n&&"mapValue"in n}function wr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return pt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Dl(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function $g(n){return"nullValue"in n?Ui:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?qt(yt.empty(),w.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:R()}function Qg(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?qt(yt.empty(),w.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?It:R()}function bl(n,e){const t=Et(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Nl(n,e){const t=Et(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class ye{constructor(e){this.value=e}static empty(){return new ye({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!zi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wr(t)}setAll(e){let t=Z.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=wr(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());zi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return He(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];zi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){pt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new ye(wr(this.value))}}function kl(n){const e=[];return pt(n.fields,(t,r)=>{const i=new Z([t]);if(zi(r)){const s=kl(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new be(e)}class Y{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Y(e,0,S.min(),S.min(),S.min(),ye.empty(),0)}static newFoundDocument(e,t,r,i){return new Y(e,1,t,S.min(),r,i,0)}static newNoDocument(e,t){return new Y(e,2,t,S.min(),S.min(),ye.empty(),0)}static newUnknownDocument(e,t){return new Y(e,3,t,S.min(),S.min(),ye.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(S.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ye.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ye.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=S.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Y&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Y(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vt{constructor(e,t){this.position=e,this.inclusive=t}}function Fl(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?w.comparator(w.fromName(o.referenceValue),t.key):Et(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Ml(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!He(n.position[t],e.position[t]))return!1;return!0}class Ar{constructor(e,t="asc"){this.field=e,this.dir=t}}function Wg(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ol{}class M extends Ol{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Hg(e,t,r):"array-contains"===t?new Xg(e,r):"in"===t?new zl(e,r):"not-in"===t?new Jg(e,r):"array-contains-any"===t?new ep(e,r):new M(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Zg(e,r):new Yg(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Et(t,this.value)):null!==t&&Tt(this.value)===Tt(t)&&this.matchesComparison(Et(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return R()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class G extends Ol{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new G(e,t)}matches(e){return In(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function In(n){return"and"===n.op}function No(n){return"or"===n.op}function ko(n){return Ll(n)&&In(n)}function Ll(n){for(const e of n.filters)if(e instanceof G)return!1;return!0}function Fo(n){if(n instanceof M)return n.field.canonicalString()+n.op.toString()+yn(n.value);if(ko(n))return n.filters.map(e=>Fo(e)).join(",");{const e=n.filters.map(t=>Fo(t)).join(",");return`${n.op}(${e})`}}function Bl(n,e){return n instanceof M?(r=n,(i=e)instanceof M&&r.op===i.op&&r.field.isEqual(i.field)&&He(r.value,i.value)):n instanceof G?function(r,i){return i instanceof G&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Bl(o,i.filters[a]),!0)}(n,e):void R();var r,i}function ql(n,e){const t=n.filters.concat(e);return G.create(t,n.op)}function Ul(n){return n instanceof M?`${(t=n).field.canonicalString()} ${t.op} ${yn(t.value)}`:n instanceof G?function(t){return t.op.toString()+" {"+t.getFilters().map(Ul).join(" ,")+"}"}(n):"Filter";var t}class Hg extends M{constructor(e,t,r){super(e,t,r),this.key=w.fromName(r.referenceValue)}matches(e){const t=w.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zg extends M{constructor(e,t){super(e,"in",t),this.keys=Gl(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Yg extends M{constructor(e,t){super(e,"not-in",t),this.keys=Gl(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Gl(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>w.fromName(r.referenceValue))}class Xg extends M{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vr(t)&&Er(t.arrayValue,this.value)}}class zl extends M{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Er(this.value.arrayValue,t)}}class Jg extends M{constructor(e,t){super(e,"not-in",t)}matches(e){if(Er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Er(this.value.arrayValue,t)}}class ep extends M{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Er(this.value.arrayValue,r))}}class tp{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function Mo(n,e=null,t=[],r=[],i=null,s=null,o=null){return new tp(n,e,t,r,i,s,o)}function Ut(n){const e=v(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Fo(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),yr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>yn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>yn(r)).join(",")),e.ce=t}return e.ce}function Rr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Wg(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Bl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ml(n.startAt,e.startAt)&&Ml(n.endAt,e.endAt)}function Ki(n){return w.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ji(n,e){return n.filters.filter(t=>t instanceof M&&t.field.isEqual(e))}function Kl(n,e,t){let r=Ui,i=!0;for(const s of ji(n,e)){let o=Ui,a=!0;switch(s.op){case"<":case"<=":o=$g(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ui}bl({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];bl({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function jl(n,e,t){let r=It,i=!0;for(const s of ji(n,e)){let o=It,a=!0;switch(s.op){case">=":case">":o=Qg(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=It}Nl({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Nl({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class rt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function $l(n,e,t,r,i,s,o,a){return new rt(n,e,t,r,i,s,o,a)}function Tn(n){return new rt(n)}function Ql(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Oo(n){return null!==n.collectionGroup}function En(n){const e=v(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new z(Z.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Ar(s,r))}),t.has(Z.keyField().canonicalString())||e.le.push(new Ar(Z.keyField(),r))}return e.le}function Se(n){const e=v(n);return e.he||(e.he=function Wl(n,e){if("F"===n.limitType)return Mo(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new Ar(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new vt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new vt(n.startAt.position,n.startAt.inclusive):null;return Mo(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,En(n))),e.he}function Lo(n,e){const t=n.filters.concat([e]);return new rt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function $i(n,e,t){return new rt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Pr(n,e){return Rr(Se(n),Se(e))&&n.limitType===e.limitType}function Hl(n){return`${Ut(Se(n))}|lt:${n.limitType}`}function vn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Ul(i)).join(", ")}]`),yr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>yn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>yn(i)).join(",")),`Target(${r})`}(Se(n))}; limitType=${n.limitType})`}function Sr(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):w.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of En(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Fl(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,En(r),i)||r.endAt&&!function(o,a,u){const c=Fl(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,En(r),i)));var r,i}function Zl(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Yl(n){return(e,t)=>{let r=!1;for(const i of En(n)){const s=np(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function np(n,e,t){const r=n.field.isKeyField()?w.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Et(u,c):R()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}class it{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){pt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Rl(this.inner)}size(){return this.innerSize}}const rp=new Q(w.comparator);function Ne(){return rp}const Xl=new Q(w.comparator);function Vr(...n){let e=Xl;for(const t of n)e=e.insert(t.key,t);return e}function Jl(n){let e=Xl;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ze(){return xr()}function eh(){return xr()}function xr(){return new it(n=>n.toString(),(n,e)=>n.isEqual(e))}const ip=new Q(w.comparator),sp=new z(w.comparator);function N(...n){let e=sp;for(const t of n)e=e.add(t);return e}const op=new z(D);function Bo(){return op}function th(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ir(e)?"-0":e}}function nh(n){return{integerValue:""+n}}function rh(n,e){return _l(e)?nh(e):th(n,e)}class Qi{constructor(){this._=void 0}}function ap(n,e,t){return n instanceof wn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Bi(s)&&(s=qi(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Gt?sh(n,e):n instanceof zt?oh(n,e):function(i,s){const o=ih(i,s),a=ah(o)+ah(i.Ie);return bo(o)&&bo(i.Ie)?nh(a):th(i.serializer,a)}(n,e)}function up(n,e,t){return n instanceof Gt?sh(n,e):n instanceof zt?oh(n,e):t}function ih(n,e){return n instanceof An?bo(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class wn extends Qi{}class Gt extends Qi{constructor(e){super(),this.elements=e}}function sh(n,e){const t=uh(e);for(const r of n.elements)t.some(i=>He(i,r))||t.push(r);return{arrayValue:{values:t}}}class zt extends Qi{constructor(e){super(),this.elements=e}}function oh(n,e){let t=uh(e);for(const r of n.elements)t=t.filter(i=>!He(i,r));return{arrayValue:{values:t}}}class An extends Qi{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ah(n){return ne(n.integerValue||n.doubleValue)}function uh(n){return vr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Cr{constructor(e,t){this.field=e,this.transform=t}}class lp{constructor(e,t){this.version=e,this.transformResults=t}}class ee{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ee}static exists(e){return new ee(void 0,e)}static updateTime(e){return new ee(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wi(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Hi{}function ch(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Pn(n.key,ee.none()):new Rn(n.key,n.data,ee.none());{const t=n.data,r=ye.empty();let i=new z(Z.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new st(n.key,r,new be(i.toArray()),ee.none())}}function hp(n,e,t){n instanceof Rn?function(i,s,o){const a=i.value.clone(),u=dh(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof st?function(i,s,o){if(!Wi(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=dh(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(hh(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Dr(n,e,t,r){return n instanceof Rn?function(s,o,a,u){if(!Wi(s.precondition,o))return a;const c=s.value.clone(),l=fh(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof st?function(s,o,a,u){if(!Wi(s.precondition,o))return a;const c=fh(s.fieldTransforms,u,o),l=o.data;return l.setAll(hh(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,Wi(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function dp(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=ih(r.transform,i||null);null!=s&&(null===t&&(t=ye.empty()),t.set(r.field,s))}return t||null}function lh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&mn(r,i,(s,o)=>function cp(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Gt&&i instanceof Gt||r instanceof zt&&i instanceof zt?mn(r.elements,i.elements,He):r instanceof An&&i instanceof An?He(r.Ie,i.Ie):r instanceof wn&&i instanceof wn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Rn extends Hi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class st extends Hi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function hh(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function dh(n,e,t){const r=new Map;P(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,up(o,a,t[i]))}return r}function fh(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,ap(s,o,e))}return r}class Pn extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qo extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Uo{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&hp(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=eh();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=ch(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(S.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),N())}isEqual(e){return this.batchId===e.batchId&&mn(this.mutations,e.mutations,(t,r)=>lh(t,r))&&mn(this.baseMutations,e.baseMutations,(t,r)=>lh(t,r))}}class Go{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){P(e.mutations.length===r.length);let i=ip;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Go(e,t,r,i)}}class zo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class mp{constructor(e,t){this.count=e,this.unchangedNames=t}}var oe,B;function mh(n){switch(n){default:return R();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function gh(n){if(void 0===n)return ie("GRPC error has no .code"),g.UNKNOWN;switch(n){case oe.OK:return g.OK;case oe.CANCELLED:return g.CANCELLED;case oe.UNKNOWN:return g.UNKNOWN;case oe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case oe.INTERNAL:return g.INTERNAL;case oe.UNAVAILABLE:return g.UNAVAILABLE;case oe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case oe.NOT_FOUND:return g.NOT_FOUND;case oe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case oe.ABORTED:return g.ABORTED;case oe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case oe.DATA_LOSS:return g.DATA_LOSS;default:return R()}}(B=oe||(oe={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";function ph(){return new TextEncoder}const gp=new hn([4294967295,4294967295],0);function _h(n){const e=ph().encode(n),t=new ug;return t.update(e),new Uint8Array(t.digest())}function yh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new hn([t,r],0),new hn([i,s],0)]}class Ko{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new br(`Invalid padding: ${t}`);if(r<0)throw new br(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new br(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new br(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=hn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(hn.fromNumber(r)));return 1===i.compare(gp)&&(i=new hn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=_h(e),[r,i]=yh(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Ko(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Te)return;const t=_h(e),[r,i]=yh(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class br extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Nr{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,kr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Nr(S.min(),i,new Q(D),Ne(),N())}}class kr{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new kr(r,t,N(),N(),N())}}class Yi{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class Ih{constructor(e,t){this.targetId=e,this.fe=t}}class Th{constructor(e,t,r=ce.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Eh{constructor(){this.ge=0,this.pe=wh(),this.ye=ce.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=N(),t=N(),r=N();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:R()}}),new kr(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=wh()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1}Be(){this.Se=!0,this.we=!0}}class pp{constructor(e){this.Le=e,this.ke=new Map,this.qe=Ne(),this.Qe=vh(),this.Ke=new Q(D)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:R()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(Ki(s))if(0===r){const o=new w(s.path);this.We(t,o,Y.newNoDocument(o,S.min()))}else P(1===r);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),u=a?this.et(a,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=nt(r).toUint8Array()}catch(u){if(u instanceof Sl)return De("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ko(o,i,s)}catch(u){return De(u instanceof br?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&Ki(a.target)){const u=new w(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,Y.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=N();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new Nr(e,t,this.Ke,this.qe,r);return this.qe=Ne(),this.Qe=vh(),this.Ke=new Q(D),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Eh,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new z(D),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||y("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Eh),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vh(){return new Q(w.comparator)}function wh(){return new Q(w.comparator)}const _p={asc:"ASCENDING",desc:"DESCENDING"},yp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ip={and:"AND",or:"OR"};class Tp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function jo(n,e){return n.useProto3Json||yr(e)?e:{value:e}}function Sn(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ah(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Ep(n,e){return Sn(n,e.toTimestamp())}function se(n){return P(!!n),S.fromTimestamp(function(t){const r=_t(t);return new J(r.seconds,r.nanos)}(n))}function $o(n,e){return(r=n,new L(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function Rh(n){const e=L.fromString(n);return P(kh(e)),e}function Fr(n,e){return $o(n.databaseId,e.path)}function Ye(n,e){const t=Rh(e);if(t.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new w(Sh(t))}function Qo(n,e){return $o(n.databaseId,e)}function Ph(n){const e=Rh(n);return 4===e.length?L.emptyPath():Sh(e)}function Mr(n){return new L(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Sh(n){return P(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Vh(n,e,t){return{name:Fr(n,e),fields:t.value.mapValue.fields}}function xh(n,e,t){const r=Ye(n,e.name),i=se(e.updateTime),s=e.createTime?se(e.createTime):S.min(),o=new ye({mapValue:{fields:e.fields}}),a=Y.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Or(n,e){let t;if(e instanceof Rn)t={update:Vh(n,e.key,e.value)};else if(e instanceof Pn)t={delete:Fr(n,e.key)};else if(e instanceof st)t={update:Vh(n,e.key,e.data),updateMask:xp(e.fieldMask)};else{if(!(e instanceof qo))return R();t={verify:Fr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof wn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Gt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof An)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw R()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Ep(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:R()),t;var s}function Wo(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ee.updateTime(se(s.updateTime)):void 0!==s.exists?ee.exists(s.exists):ee.none():ee.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(P("REQUEST_TIME"===a.setToServerValue),u=new wn):"appendMissingElements"in a?u=new Gt(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new zt(a.removeAllFromArray.values||[]):"increment"in a?u=new An(o,a.increment):R();const c=Z.fromServerFormat(a.fieldPath);return new Cr(c,u)}(n,i)):[];var s;if(e.update){const i=Ye(n,e.update.name),s=new ye({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new be((e.updateMask.fieldPaths||[]).map(l=>Z.fromServerFormat(l)));return new st(i,s,o,t,r)}return new Rn(i,s,t,r)}if(e.delete){const i=Ye(n,e.delete);return new Pn(i,t)}if(e.verify){const i=Ye(n,e.verify);return new qo(i,t)}return R()}function Ch(n,e){return{documents:[Qo(n,e.path)]}}function Ho(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Qo(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Qo(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(u){if(0!==u.length)return Nh(G.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(u){if(0!==u.length)return u.map(c=>{return{field:wt((h=c).field),direction:Pp(h.dir)};var h})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=jo(n,e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),t;var u}function Dh(n){let e=Ph(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){P(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const d=bh(h);return d instanceof G&&ko(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(d=>{return new Ar(Vn((I=d).field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction));var I}));let a=null;t.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,yr(d)?null:d}(t.limit));let u=null;var h;t.startAt&&(u=new vt((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new vt(h.values||[],!h.before)}(t.endAt)),$l(e,i,o,s,a,"F",u,c)}function bh(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Vn(t.unaryFilter.field);return M.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Vn(t.unaryFilter.field);return M.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Vn(t.unaryFilter.field);return M.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Vn(t.unaryFilter.field);return M.create(o,"!=",{nullValue:"NULL_VALUE"});default:return R()}}(n):void 0!==n.fieldFilter?M.create(Vn((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return G.create(t.compositeFilter.filters.map(r=>bh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return R()}}(t.compositeFilter.op))}(n):R();var t}function Pp(n){return _p[n]}function Sp(n){return yp[n]}function Vp(n){return Ip[n]}function wt(n){return{fieldPath:n.canonicalString()}}function Vn(n){return Z.fromServerFormat(n.fieldPath)}function Nh(n){return n instanceof M?function(t){if("=="===t.op){if(Cl(t.value))return{unaryFilter:{field:wt(t.field),op:"IS_NAN"}};if(xl(t.value))return{unaryFilter:{field:wt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Cl(t.value))return{unaryFilter:{field:wt(t.field),op:"IS_NOT_NAN"}};if(xl(t.value))return{unaryFilter:{field:wt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wt(t.field),op:Sp(t.op),value:t.value}}}(n):n instanceof G?function(t){const r=t.getFilters().map(i=>Nh(i));return 1===r.length?r[0]:{compositeFilter:{op:Vp(t.op),filters:r}}}(n):R()}function xp(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function kh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class ot{constructor(e,t,r,i,s=S.min(),o=S.min(),a=ce.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new ot(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fh{constructor(e){this.ut=e}}function Mh(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Xi(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Fr(s=n.ut,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Sn(s,o.version.toTimestamp()),createTime:Sn(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Kt(e.version)};else{if(!e.isUnknownDocument())return R();r.unknownDocument={path:t.path.toArray(),version:Kt(e.version)}}var s,o;return r}function Xi(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Kt(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function jt(n){const e=new J(n.seconds,n.nanoseconds);return S.fromTimestamp(e)}function $t(n,e){const t=(e.baseMutations||[]).map(s=>Wo(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Wo(n.ut,s)),i=J.fromMillis(e.localWriteTimeMs);return new Uo(e.batchId,i,t,r)}function Lr(n){const e=jt(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?jt(n.lastLimboFreeSnapshotVersion):S.min();let r;return r=void 0!==n.query.documents?(P(1===(s=n.query).documents.length),Se(Tn(Ph(s.documents[0])))):function(s){return Se(Dh(s))}(n.query),new ot(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ce.fromBase64String(n.resumeToken));var s}function Oh(n,e){const t=Kt(e.snapshotVersion),r=Kt(e.lastLimboFreeSnapshotVersion);let i;i=Ki(e.target)?Ch(n.ut,e.target):Ho(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ut(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zo(n){const e=Dh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?$i(e,e.limit,"L"):e}function Yo(n,e){return new zo(e.largestBatchId,Wo(n.ut,e.overlayMutation))}function Lh(n,e){const t=e.path.lastSegment();return[n,ve(e.path.popLast()),t]}function Bh(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Kt(r.readTime),documentKey:ve(r.documentKey.path),largestBatchId:r.largestBatchId}}class Dp{getBundleMetadata(e,t){return qh(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:jt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return qh(e).put({bundleId:(i=t).id,createTime:Kt(se(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Uh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Zo(s.bundledQuery),readTime:jt(s.readTime)};var s})}saveNamedQuery(e,t){return Uh(e).put({name:(i=t).name,readTime:Kt(se(i.readTime)),bundledQuery:i.bundledQuery});var i}}function qh(n){return fe(n,"bundles")}function Uh(n){return fe(n,"namedQueries")}class Ji{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new Ji(e,t.uid||"")}getOverlay(e,t){return Br(e).get(Lh(this.userId,t)).next(r=>r?Yo(this.serializer,r):null)}getOverlays(e,t){const r=Ze();return f.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new zo(t,o);i.push(this.lt(e,a))}),f.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(ve(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Br(e).H("collectionPathOverlayIndex",a))}),f.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Ze(),s=ve(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Br(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Yo(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Ze();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Br(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=Yo(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return Br(e).put(function(i,s,o){const[a,u,c]=Lh(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Or(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function Br(n){return fe(n,"documentOverlays")}class Qt{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(ne(e.integerValue));else if("doubleValue"in e){const r=ne(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Ir(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),"string"==typeof r?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(nt(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Dl(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):R()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),w.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function bp(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Gh(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=bp(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}Qt.St=new Qt;class Np{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=Gh(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=Gh(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class kp{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class Fp{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class qr{constructor(){this.Wt=new Np,this.Gt=new kp(this.Wt),this.zt=new Fp(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Wt{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Wt(this.indexId,this.documentKey,this.arrayValue,r)}}function At(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=zh(n.arrayValue,e.arrayValue),0!==t?t:(t=zh(n.directionalValue,e.directionalValue),0!==t?t:w.comparator(n.documentKey,e.documentKey)))}function zh(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Kh{constructor(e){this.Jt=new z((t,r)=>Z.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(P(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Po(e);if(void 0!==t&&!this.tn(t))return!1;const r=Ot(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new z(Z.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new Lt(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Lt(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Lt(r.field,"asc"===r.dir?0:1)));return new gn(gn.UNKNOWN_ID,this.collectionId,t,pn.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function jh(n){var e,t;if(P(n instanceof M||n instanceof G),n instanceof M){if(n instanceof zl){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>M.create(n.field,"==",s)))||[];return G.create(i,"or")}return n}const r=n.filters.map(i=>jh(i));return G.create(r,n.op)}function Mp(n){if(0===n.getFilters().length)return[];const e=ea(jh(n));return P($h(e)),Xo(e)||Jo(e)?[e]:e.getFilters()}function Xo(n){return n instanceof M}function Jo(n){return n instanceof G&&ko(n)}function $h(n){return Xo(n)||Jo(n)||function(t){if(t instanceof G&&No(t)){for(const r of t.getFilters())if(!Xo(r)&&!Jo(r))return!1;return!0}return!1}(n)}function ea(n){if(P(n instanceof M||n instanceof G),n instanceof M)return n;if(1===n.filters.length)return ea(n.filters[0]);const e=n.filters.map(r=>ea(r));let t=G.create(e,n.op);return t=es(t),$h(t)?t:(P(t instanceof G),P(In(t)),P(t.filters.length>1),t.filters.reduce((r,i)=>ta(r,i)))}function ta(n,e){let t;return P(n instanceof M||n instanceof G),P(e instanceof M||e instanceof G),t=n instanceof M?e instanceof M?G.create([n,e],"and"):Qh(n,e):e instanceof M?Qh(e,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),In(i)&&In(s))return ql(i,s.getFilters());const o=No(i)?i:s,a=No(i)?s:i,u=o.filters.map(c=>ta(c,a));return G.create(u,"or")}(n,e),es(t)}function Qh(n,e){if(In(e))return ql(e,n.getFilters());{const t=e.filters.map(r=>ta(n,r));return G.create(t,"or")}}function es(n){if(P(n instanceof M||n instanceof G),n instanceof M)return n;const e=n.getFilters();if(1===e.length)return es(e[0]);if(Ll(n))return n;const t=e.map(i=>es(i)),r=[];return t.forEach(i=>{i instanceof M?r.push(i):i instanceof G&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:G.create(r,n.op)}class Op{constructor(){this.on=new na}addToCollectionParentIndex(e,t){return this.on.add(t),f.resolve()}getCollectionParents(e,t){return f.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return f.resolve()}deleteFieldIndex(e,t){return f.resolve()}deleteAllFieldIndexes(e){return f.resolve()}createTargetIndexes(e,t){return f.resolve()}getDocumentsMatchingTarget(e,t){return f.resolve(null)}getIndexType(e,t){return f.resolve(0)}getFieldIndexes(e,t){return f.resolve([])}getNextCollectionGroupToUpdate(e){return f.resolve(null)}getMinOffset(e,t){return f.resolve(Fe.min())}getMinOffsetFromCollectionGroup(e,t){return f.resolve(Fe.min())}updateCollectionGroup(e,t,r){return f.resolve()}updateIndexEntries(e,t){return f.resolve()}}class na{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new z(L.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new z(L.comparator)).toArray()}}const ts=new Uint8Array(0);class Lp{constructor(e,t){this.user=e,this.databaseId=t,this._n=new na,this.an=new it(r=>Ut(r),(r,i)=>Rr(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:ve(i)};return Wh(e).put(s)}return f.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[hl(t),""],!1,!0);return Wh(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(We(o.parent))}return r})}addFieldIndex(e,t){const r=Ur(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Cn(e);return s.next(a=>{o.put(Bh(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Ur(e),i=Cn(e),s=xn(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Ur(e),r=xn(e),i=Cn(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return f.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Kh(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=xn(e);let i=!0;const s=new Map;return f.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=N();const a=[];return f.forEach(s,(u,c)=>{var x;y("IndexedDbIndexManager",`Using index ${x=u,`id=${x.indexId}|cg=${x.collectionGroup}|f=${x.fields.map(k=>`${k.fieldPath}:${k.kind}`).join(",")}`} to execute ${Ut(t)}`);const l=function(x,k){const q=Po(k);if(void 0===q)return null;for(const O of ji(x,q.fieldPath))switch(O.op){case"array-contains-any":return O.value.arrayValue.values||[];case"array-contains":return[O.value]}return null}(c,u),h=function(x,k){const q=new Map;for(const O of Ot(k))for(const ae of ji(x,O.fieldPath))switch(ae.op){case"==":case"in":q.set(O.fieldPath.canonicalString(),ae.value);break;case"not-in":case"!=":return q.set(O.fieldPath.canonicalString(),ae.value),Array.from(q.values())}return null}(c,u),d=function(x,k){const q=[];let O=!0;for(const ae of Ot(k)){const Be=0===ae.kind?Kl(x,ae.fieldPath,x.startAt):jl(x,ae.fieldPath,x.startAt);q.push(Be.value),O&&(O=Be.inclusive)}return new vt(q,O)}(c,u),m=function(x,k){const q=[];let O=!0;for(const ae of Ot(k)){const Be=0===ae.kind?jl(x,ae.fieldPath,x.endAt):Kl(x,ae.fieldPath,x.endAt);q.push(Be.value),O&&(O=Be.inclusive)}return new vt(q,O)}(c,u),I=this.ln(u,c,d),T=this.ln(u,c,m),E=this.hn(u,c,h),V=this.Pn(u.indexId,l,I,d.inclusive,T,m.inclusive,E);return f.forEach(V,C=>r.j(C,t.limit).next(x=>{x.forEach(k=>{const q=w.fromSegments(k.documentKey);o.has(q)||(o=o.add(q),a.push(q))})}))}).next(()=>a)}return f.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:Mp(G.create(e.filters,"and")).map(r=>Mo(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.In(t[h/c]):ts,m=this.Tn(e,d,r[h%c],i),I=this.En(e,d,s[h%c],o),T=a.map(E=>this.Tn(e,d,E,!0));l.push(...this.createRange(m,I,T))}return l}Tn(e,t,r,i){const s=new Wt(e,w.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Wt(e,w.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Kh(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return f.forEach(i,s=>this.cn(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new z(Z.comparator),l=!1;for(const h of u.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||("array-contains"===d.op||"array-contains-any"===d.op?l=!0:c=c.add(d.field));for(const h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new qr;for(const i of Ot(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.jt(i.kind);Qt.St.ht(s,o)}return r.Ut()}In(e){const t=new qr;return Qt.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new qr;return Qt.St.ht(qt(this.databaseId,t),r.jt(function(s){const o=Ot(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new qr);let s=0;for(const o of Ot(e)){const a=r[s++];for(const u of i)if(this.Rn(t,o.fieldPath)&&vr(a))i=this.Vn(i,o,a);else{const c=u.jt(o.kind);Qt.St.ht(a,c)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new qr;u.seed(a.Ut()),Qt.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof M&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Ur(e),i=Cn(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const o=[];return f.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){const d=h?new pn(h.sequenceNumber,new Fe(jt(h.readTime),new w(We(h.documentKey)),h.largestBatchId)):pn.empty(),m=l.fields.map(([I,T])=>new Lt(Z.fromServerFormat(I),T));return new gn(l.indexId,l.collectionGroup,m,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:D(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Ur(e),s=Cn(e);return this.fn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>f.forEach(a,u=>s.put(Bh(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return f.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),f.forEach(a,u=>this.gn(e,i,u).next(c=>{const l=this.pn(s,u);return c.isEqual(l)?f.resolve():this.yn(e,s,u,c,l)}))))})}wn(e,t,r,i){return xn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return xn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=xn(e);let s=new z(At);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new Wt(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new z(At);const i=this.dn(t,e);if(null==i)return r;const s=Po(t);if(null!=s){const o=e.data.field(s.fieldPath);if(vr(o))for(const a of o.arrayValue.values||[])r=r.add(new Wt(t.indexId,e.key,this.In(a),i))}else r=r.add(new Wt(t.indexId,e.key,ts,i));return r}yn(e,t,r,i,s){y("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,l,h,d){const m=u.getIterator(),I=c.getIterator();let T=_n(m),E=_n(I);for(;T||E;){let V=!1,C=!1;if(T&&E){const x=l(T,E);x<0?C=!0:x>0&&(V=!0)}else null!=T?C=!0:V=!0;V?(h(E),E=_n(I)):C?(d(T),T=_n(m)):(T=_n(m),E=_n(I))}}(i,s,At,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),f.waitFor(o)}fn(e){let t=1;return Cn(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>At(o,a)).filter((o,a,u)=>!a||0!==At(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=At(o,e),u=At(o,t);if(0===a)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,ts,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,ts,[]]))}return s}bn(e,t){return At(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Hh)}getMinOffset(e,t){return f.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||R())).next(Hh)}}function Wh(n){return fe(n,"collectionParents")}function xn(n){return fe(n,"indexEntries")}function Ur(n){return fe(n,"indexConfiguration")}function Cn(n){return fe(n,"indexState")}function Hh(n){P(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;So(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Fe(e.readTime,e.documentKey,t)}const Zh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class we{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new we(e,we.DEFAULT_COLLECTION_PERCENTILE,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Yh(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(1===a)}));const c=[];for(const l of t.mutations){const h=Tl(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return f.waitFor(s).next(()=>c)}function ns(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw R();e=n.noDocument}return JSON.stringify(e).length}we.DEFAULT_COLLECTION_PERCENTILE=10,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,we.DEFAULT=new we(41943040,we.DEFAULT_COLLECTION_PERCENTILE,we.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),we.DISABLED=new we(-1,0,0);class rs{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){P(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new rs(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Rt(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Dn(e),o=Rt(e);return o.add({}).next(a=>{P("number"==typeof a);const u=new Uo(a,t,r,i),c=function(m,I,T){const E=T.baseMutations.map(C=>Or(m.ut,C)),V=T.mutations.map(C=>Or(m.ut,C));return{userId:I,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:E,mutations:V}}(this.serializer,this.userId,u),l=[];let h=new z((d,m)=>D(d.canonicalString(),m.canonicalString()));for(const d of i){const m=Tl(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(m,Pg))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Rt(e).get(t).next(r=>r?(P(r.userId===this.userId),$t(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?f.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Rt(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=$t(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Rt(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Rt(e).W("userMutationsIndex",t).next(r=>r.map(i=>$t(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Oi(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Dn(e).Y({range:i},(o,a,u)=>{const[c,l,h]=o,d=We(l);if(c===this.userId&&t.path.isEqual(d))return Rt(e).get(h).next(m=>{if(!m)throw R();P(m.userId===this.userId),s.push($t(this.serializer,m))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new z(D);const i=[];return t.forEach(s=>{const o=Oi(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Dn(e).Y({range:a},(c,l,h)=>{const[d,m,I]=c,T=We(m);d===this.userId&&s.path.isEqual(T)?r=r.add(I):h.done()});i.push(u)}),f.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Oi(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new z(D);return Dn(e).Y({range:o},(u,c,l)=>{const[h,d,m]=u,I=We(d);h===this.userId&&r.isPrefixOf(I)?I.length===i&&(a=a.add(m)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Rt(e).get(s).next(o=>{if(null===o)throw R();P(o.userId===this.userId),r.push($t(this.serializer,o))}))}),f.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Yh(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),f.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return f.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Dn(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=We(s[1]);i.push(u)}else a.done()}).next(()=>{P(0===i.length)})})}containsKey(e,t){return Xh(e,this.userId,t)}Mn(e){return Jh(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Xh(n,e,t){const r=Oi(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Dn(n).Y({range:s,J:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Rt(n){return fe(n,"mutations")}function Dn(n){return fe(n,"documentMutations")}function Jh(n){return fe(n,"mutationQueues")}class Ht{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Ht(0)}static Nn(){return new Ht(-1)}}class Bp{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Ht(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>S.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>bn(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return bn(e).Y((o,a)=>{const u=Lr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>f.waitFor(s)).next(()=>i)}forEachTarget(e,t){return bn(e).Y((r,i)=>{const s=Lr(i);t(s)})}Bn(e){return ed(e).get("targetGlobalKey").next(t=>(P(null!==t),t))}Ln(e,t){return ed(e).put("targetGlobalKey",t)}kn(e,t){return bn(e).put(Oh(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ut(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return bn(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=Lr(a);Rr(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Pt(e);return t.forEach(o=>{const a=ve(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),f.waitFor(i)}removeMatchingKeys(e,t,r){const i=Pt(e);return f.forEach(t,s=>{const o=ve(s.path);return f.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Pt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Pt(e);let s=N();return i.Y({range:r,J:!0},(o,a,u)=>{const c=We(o[1]),l=new w(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=ve(t.path),i=IDBKeyRange.bound([r],[hl(r)],!1,!0);let s=0;return Pt(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return bn(e).get(t).next(r=>r?Lr(r):null)}}function bn(n){return fe(n,"targets")}function ed(n){return fe(n,"targetGlobal")}function Pt(n){return fe(n,"targetDocuments")}function td([n,e],[t,r]){const i=D(n,t);return 0===i?D(e,r):i}class qp{constructor(e){this.Qn=e,this.buffer=new z(td),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();td(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class nd{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;y("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){gt(r)?y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield mt(r)}yield t.Gn(3e5)}))}}class Up{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return f.resolve(Me._e);const r=new qp(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(Zh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zh):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),fn()<=Ke.in.DEBUG&&y("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}class Gp{constructor(e,t){this.db=e,this.garbageCollector=function rd(n,e){return new Up(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return is(e,r)}removeReference(e,t,r){return is(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return is(e,t)}Xn(e,t){return function(i,s){let o=!1;return Jh(i).Z(a=>Xh(i,a,s).next(u=>(u&&(o=!0),f.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,a)=>{if(a<=t){const u=this.Xn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,S.min()),Pt(e).delete([0,ve(o.path)])))});i.push(u)}}).next(()=>f.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return is(e,t)}Zn(e,t){const r=Pt(e);let i,s=Me._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==Me._e&&t(new w(We(i)),s),s=c,i=u):s=Me._e}).next(()=>{s!==Me._e&&t(new w(We(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function is(n,e){return Pt(n).put((i=n.currentSequenceNumber,{targetId:0,path:ve(e.path),sequenceNumber:i}));var i}class id{constructor(){this.changes=new it(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Y.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?f.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zp{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Zt(e).put(r)}removeEntry(e,t,r){return Zt(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Xi(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Y.newInvalidDocument(t);return Zt(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Gr(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Y.newInvalidDocument(t)};return Zt(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Gr(t))},(i,s)=>{r={document:this.tr(t,s),size:ns(s)}}).next(()=>r)}getEntries(e,t){let r=Ne();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Ne(),i=new Q(w.comparator);return this.rr(e,t,(s,o)=>{const a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,ns(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return f.resolve();let i=new z(ud);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Gr(i.first()),Gr(i.last())),o=i.getIterator();let a=o.getNext();return Zt(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{const h=w.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&ud(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(Gr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Xi(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Zt(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Ne();for(const h of c){const d=this.tr(w.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Sr(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Ne();const o=ad(t,r),a=ad(t,Fe.max());return Zt(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.tr(w.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new Kp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return od(e).get("remoteDocumentGlobalKey").next(t=>(P(!!t),t))}er(e,t){return od(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function Cp(n,e){let t;if(e.document)t=xh(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=w.fromSegments(e.noDocument.path),i=jt(e.noDocument.readTime);t=Y.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return R();{const r=w.fromSegments(e.unknownDocument.path),i=jt(e.unknownDocument.version);t=Y.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new J(i[0],i[1]);return S.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(S.min()))return r}return Y.newInvalidDocument(e)}}function sd(n){return new zp(n)}class Kp extends id{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new it(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new z((s,o)=>D(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Mh(this._r.serializer,o);i=i.add(s.path.popLast());const c=ns(u);r+=c-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Mh(this._r.serializer,o.convertToNoDocument(S.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),f.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function od(n){return fe(n,"remoteDocumentGlobal")}function Zt(n){return fe(n,"remoteDocumentsV14")}function Gr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ad(n,e){const t=e.documentKey.path.toArray();return[n,Xi(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ud(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=D(t[s],r[s]),i)return i;return i=D(t.length,r.length),i||(i=D(t[t.length-2],r[r.length-2]),i||D(t[t.length-1],r[r.length-1]))}class jp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class cd{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Dr(r.mutation,i,be.empty(),J.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,N()).next(()=>r))}getLocalViewOfDocuments(e,t,r=N()){const i=Ze();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Vr();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ze();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,N()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ne();const o=xr(),a=xr();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof st)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),Dr(l.mutation,c,l.mutation.getFieldMask(),J.now())):o.set(c.key,be.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new jp(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=xr();let i=new Q((o,a)=>o-a),s=N();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||be.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||N()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=eh();l.forEach(d=>{if(!s.has(d)){const m=ch(t.get(d),r.get(d));null!==m&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return w.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Oo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):f.resolve(Ze());let a=-1,u=s;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?f.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,N())).next(l=>({batchId:a,changes:Jl(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new w(t)).next(r=>{let i=Vr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Vr();return this.indexManager.getCollectionParents(e,s).next(a=>f.forEach(a,u=>{const c=(h=t,d=u.child(s),new rt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,Y.newInvalidDocument(l)))});let a=Vr();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&Dr(l.mutation,c,be.empty(),J.now()),Sr(t,c)&&(a=a.insert(u,c))}),a})}}class $p{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return f.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:se(i.createTime)}),f.resolve();var i}getNamedQuery(e,t){return f.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:Zo(i.bundledQuery),readTime:se(i.readTime)}),f.resolve();var i}}class Qp{constructor(){this.overlays=new Q(w.comparator),this.lr=new Map}getOverlay(e,t){return f.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ze();return f.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),f.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),f.resolve()}getOverlaysForCollection(e,t,r){const i=Ze(),s=t.length+1,o=new w(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return f.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Q((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=Ze(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Ze(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return f.resolve(a)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new zo(t,r));let s=this.lr.get(t);void 0===s&&(s=N(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class ra{constructor(){this.hr=new z(me.Pr),this.Ir=new z(me.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new me(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new me(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new w(new L([])),r=new me(t,e),i=new me(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new w(new L([])),r=new me(t,e),i=new me(t,e+1);let s=N();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new me(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class me{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return w.comparator(e.key,t.key)||D(e.gr,t.gr)}static Tr(e,t){return D(e.gr,t.gr)||w.comparator(e.key,t.key)}}class Wp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new z(me.Pr)}checkEmpty(e){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const o=new Uo(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.yr=this.yr.add(new me(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(e,t){return f.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return f.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new me(t,0),i=new me(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const a=this.wr(o.gr);s.push(a)}),f.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new z(D);return t.forEach(i=>{const s=new me(i,0),o=new me(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),f.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;w.isDocumentKey(s)||(s=s.child(""));const o=new me(new w(s),0);let a=new z(D);return this.yr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),f.resolve(this.br(a))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){P(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return f.forEach(t.mutations,i=>{const s=new me(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new me(t,0),i=this.yr.firstAfterOrEqual(r);return f.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return f.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Hp{constructor(e){this.Cr=e,this.docs=new Q(w.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return f.resolve(r?r.document.mutableCopy():Y.newInvalidDocument(t))}getEntries(e,t){let r=Ne();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Y.newInvalidDocument(i))}),f.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ne();const o=t.path,a=new w(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||So(fl(l),r)<=0||(i.has(l.key)||Sr(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(e,t,r,i){R()}vr(e,t){return f.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Zp(this)}getSize(e){return f.resolve(this.size)}}class Zp extends id{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),f.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class Yp{constructor(e){this.persistence=e,this.Fr=new it(t=>Ut(t),Rr),this.lastRemoteSnapshotVersion=S.min(),this.highestTargetId=0,this.Mr=0,this.Or=new ra,this.targetCount=0,this.Nr=Ht.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),f.resolve()}getLastRemoteSnapshotVersion(e){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return f.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),f.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Ht(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,f.resolve()}updateTargetData(e,t){return this.kn(t),f.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,f.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),f.waitFor(s).next(()=>i)}getTargetCount(e){return f.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return f.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),f.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),f.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),f.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return f.resolve(r)}containsKey(e,t){return f.resolve(this.Or.containsKey(t))}}class ia{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Me(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new Yp(this),this.indexManager=new Op,this.remoteDocumentCache=new Hp(r=>this.referenceDelegate.Qr(r)),this.serializer=new Fh(t),this.Kr=new $p(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new Wp(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){y("MemoryPersistence","Starting transaction:",e);const i=new Xp(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return f.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class Xp extends gl{constructor(e){super(),this.currentSequenceNumber=e}}class ss{constructor(e){this.persistence=e,this.Gr=new ra,this.zr=null}static jr(e){return new ss(e)}get Hr(){if(this.zr)return this.zr;throw R()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),f.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),f.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),f.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Hr,r=>{const i=w.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,S.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return f.or([()=>f.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class Jp{constructor(e){this.serializer=e}N(e,t,r,i){const s=new Mi("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Il,{unique:!0}),u.createObjectStore("documentMutations"),ld(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=f.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),ld(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:S.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Il,{unique:!0});const h=c.store("mutations"),d=l.map(m=>h.put(m));return f.waitFor(d)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:Lg});c.createIndex("collectionPathOverlayIndex",Bg,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",qg,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:Sg});c.createIndex("documentKeyIndex",Vg),c.createIndex("collectionGroupIndex",xg)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:kg}).createIndex("sequenceNumberIndex",Fg,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Mg}).createIndex("documentKeyIndex",Og,{unique:!1})}(e))),o}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=ns(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>f.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{P(u.userId===s.userId);const c=$t(this.serializer,u);return Yh(e,s.userId,c).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,a)=>{const u=new L(o),c=[0,ve(u)];s.push(t.get(c).next(l=>l?f.resolve():t.put({targetId:0,path:ve(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>f.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Ng});const r=t.store("collectionParents"),i=new na,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:ve(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{const u=new L(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{const l=We(a);return s(l.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=Lr(i),o=Oh(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(h=o,h.document?new w(L.fromString(h.document.name).popFirst(5)):h.noDocument?w.fromSegments(h.noDocument.path):h.unknownDocument?w.fromSegments(h.unknownDocument.path):R()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var h;i.push(a.put(c))}).next(()=>f.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=sd(this.serializer),s=new ia(ss.jr,this.serializer.ut);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:N();$t(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new de(c),h=Ji.ct(this.serializer,l),d=s.getIndexManager(l),m=rs.ct(l,this.serializer,d,s.referenceDelegate);return new cd(i,m,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Co(t,Me._e),u).next()})})}}function ld(n){n.createObjectStore("targetDocuments",{keyPath:Dg}).createIndex("documentTargetsIndex",bg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Cg,{unique:!0}),n.createObjectStore("targetGlobal")}const sa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class oa{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!oa.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gp(this,i),this.Ii=t+"main",this.serializer=new Fh(u),this.Ti=new Ge(this.Ii,this.ai,new Jp(this.serializer)),this.qr=new Bp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sd(this.serializer),this.Kr=new Dp,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===l&&ie("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,sa);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new Me(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,p.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>as(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(gt(e))return y("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return zr(e).get("owner").next(t=>f.resolve(this.wi(t)))}Si(e){return as(e).delete(this.clientId)}bi(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=fe(r,"clientMetadata");return i.W().next(s=>{const o=e.Ci(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?f.resolve(!0):zr(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,sa);return!1}}return!(!this.networkEnabled||!this.inForeground)||as(e).W().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&y("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Co(t,Me._e);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>as(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return rs.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lp(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return Ji.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){y("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.ai)?Gg:14===u?wl:13===u?vl:12===u?Ug:11===u?El:void R();var u;let o;return this.Ti.runTransaction(e,i,s,a=>(o=new Co(a,this.Lr?this.Lr.next():Me._e),"readwrite-primary"===t?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new _(g.FAILED_PRECONDITION,ml);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Li(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Li(e){return zr(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,sa)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return zr(e).put("owner",t)}static D(){return Ge.D()}pi(e){const t=zr(e);return t.get("owner").next(r=>this.wi(r)?(y("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):f.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(ie(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,K.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return y("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ie("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ie("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function zr(n){return fe(n,"owner")}function as(n){return fe(n,"clientMetadata")}function aa(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class ua{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=N(),i=N();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ua(e,t.fromCache,r,i)}}class e_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class hd{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new e_;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(fn()<=Ke.in.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",vn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),f.resolve()):(fn()<=Ke.in.DEBUG&&y("QueryEngine","Query:",vn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(fn()<=Ke.in.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",vn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Se(t))):f.resolve())}zi(e,t){if(Ql(t))return f.resolve(null);let r=Se(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=$i(t,null,"F"),r=Se(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=N(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Yi(t,a);return this.Zi(t,c,o,u.readTime)?this.zi(e,$i(t,null,"F")):this.Xi(e,c,t,u)}))})))}ji(e,t,r,i){return Ql(t)||i.isEqual(S.min())?f.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?f.resolve(null):(fn()<=Ke.in.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),vn(t)),this.Xi(e,o,t,dl(i,-1)).next(a=>a))})}Yi(e,t){let r=new z(Yl(e));return t.forEach((i,s)=>{Sr(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return fn()<=Ke.in.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",vn(t)),this.Gi.getDocumentsMatchingQuery(e,t,Fe.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class t_{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Q(D),this.ns=new it(s=>Ut(s),Rr),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cd(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function dd(n,e,t,r){return new t_(n,e,t,r)}function fd(n,e){return ca.apply(this,arguments)}function ca(){return ca=(0,p.Z)(function*(n,e){const t=v(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=N();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})}),ca.apply(this,arguments)}function md(n){const e=v(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function gd(n,e,t){let r=N(),i=N();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ne();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(S.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function i_(n,e){const t=v(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Nn(n,e){const t=v(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,f.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new ot(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function kn(n,e,t){return la.apply(this,arguments)}function la(){return la=(0,p.Z)(function*(n,e,t){const r=v(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!gt(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),la.apply(this,arguments)}function us(n,e,t){const r=v(n);let i=S.min(),s=N();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const h=v(u),d=h.ns.get(l);return void 0!==d?f.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,Se(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:S.min(),t?s:N())).next(a=>(yd(r,Zl(e),a),{documents:a,ls:s})))}function pd(n,e){const t=v(n),r=v(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function _d(n,e){const t=v(n),r=t.rs.get(e)||S.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,dl(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(yd(t,e,i),i))}function yd(n,e,t){let r=n.rs.get(e)||S.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function ha(){return ha=(0,p.Z)(function*(n,e,t,r){const i=v(n);let s=N(),o=Ne();for(const c of t){const l=e.hs(c.metadata.name);c.document&&(s=s.add(l));const h=e.Ps(c);h.setReadTime(e.Is(c.metadata.readTime)),o=o.insert(l,h)}const a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield Nn(i,(l=r,Se(Tn(L.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>gd(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))}),ha.apply(this,arguments)}function o_(n,e){return da.apply(this,arguments)}function da(){return da=(0,p.Z)(function*(n,e,t=N()){const r=yield Nn(n,Se(Zo(e.bundledQuery))),i=v(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=se(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const a=r.withResumeToken(ce.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(a.targetId,a),i.qr.updateTargetData(s,a).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),da.apply(this,arguments)}function Id(n,e){return`firestore_clients_${n}_${e}`}function Td(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function fa(n,e){return`firestore_targets_${n}_${e}`}class cs{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new _(i.error.code,i.error.message))),o?new cs(e,t,i.state,s):(ie("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new _(r.error.code,r.error.message))),s?new Kr(e,r.state,i):(ie("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ls{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Bo();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=_l(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new ls(e,s):(ie("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ma{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ma(t.clientId,t.onlineState):(ie("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ga{constructor(){this.activeTargetIds=Bo()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pa{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Q(D),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Id(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new ga),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(Id(e.persistenceKey,i));if(s){const o=ls.Ts(i,s);o&&(e.gs=e.gs.insert(o.clientId,o))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(fa(this.persistenceKey,e));if(r){const i=Kr.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fa(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return y("SharedClientState","READ",e,t),t}setItem(e,t){y("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){y("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(y("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(o){let a=Me._e;if(null!=o)try{const u=JSON.parse(o);P("number"==typeof u),a=u}catch(u){ie("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==Me._e&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new cs(this.currentUser,e,t,r),s=Td(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=Td(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=fa(this.persistenceKey,e),s=new Kr(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return ls.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return cs.Ts(new de(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Kr.Ts(i,t)}Ms(e){return ma.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);y("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Bo();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Ed{constructor(){this.eo=new ga,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new ga,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class a_{ro(e){}shutdown(){}}class vd{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let hs=null;function _a(){return null===hs?hs=268435456+Math.round(2147483648*Math.random()):hs++,"0x"+hs.toString(16)}const u_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class c_{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const Ae="WebChannelConnection";class l_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,o){const a=_a(),u=this.So(t,r);y("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(c,s,o),this.Do(t,u,c,i).then(l=>(y("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw De("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Co(t,r,i,s,o,a){return this.wo(t,r,i,s,o)}bo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+dn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}So(t,r){return`${this.mo}/v1/${r}:${u_[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=_a();return new Promise((o,a)=>{const u=new ag;u.setWithCredentials(!0),u.listenOnce(ig.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ao.NO_ERROR:const l=u.getResponseJson();y(Ae,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Ao.TIMEOUT:y(Ae,`RPC '${e}' ${s} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case Ao.HTTP_ERROR:const h=u.getStatus();if(y(Ae,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const m=d?.error;if(m&&m.status&&m.message){const I=function(E){const V=E.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(V)>=0?V:g.UNKNOWN}(m.status);a(new _(I,m.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{y(Ae,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);y(Ae,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}vo(e,t,r){const i=_a(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ng(),a=rg(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new og({})),this.bo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");y(Ae,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let d=!1,m=!1;const I=new c_({co:E=>{m?y(Ae,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(d||(y(Ae,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),y(Ae,`RPC '${e}' stream ${i} sending:`,E),h.send(E))},lo:()=>h.close()}),T=(E,V,C)=>{E.listen(V,x=>{try{C(x)}catch(k){setTimeout(()=>{throw k},0)}})};return T(h,Fi.EventType.OPEN,()=>{m||y(Ae,`RPC '${e}' stream ${i} transport opened.`)}),T(h,Fi.EventType.CLOSE,()=>{m||(m=!0,y(Ae,`RPC '${e}' stream ${i} transport closed`),I.Ro())}),T(h,Fi.EventType.ERROR,E=>{m||(m=!0,De(Ae,`RPC '${e}' stream ${i} transport errored:`,E),I.Ro(new _(g.UNAVAILABLE,"The operation could not be completed")))}),T(h,Fi.EventType.MESSAGE,E=>{var V;if(!m){const C=E.data[0];P(!!C);const k=C.error||(null===(V=C[0])||void 0===V?void 0:V.error);if(k){y(Ae,`RPC '${e}' stream ${i} received error:`,k);const q=k.status;let O=function(MI){const Qf=oe[MI];if(void 0!==Qf)return gh(Qf)}(q),ae=k.message;void 0===O&&(O=g.INTERNAL,ae="Unknown error status: "+q+" with message "+k.message),m=!0,I.Ro(new _(O,ae)),h.close()}else y(Ae,`RPC '${e}' stream ${i} received:`,C),I.Vo(C)}}),T(a,sg.STAT_EVENT,E=>{E.stat===ol.PROXY?y(Ae,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===ol.NOPROXY&&y(Ae,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{I.Ao()},0),I}}function wd(){return typeof window<"u"?window:null}function ds(){return typeof document<"u"?document:null}function jr(n){return new Tp(n,!0)}class ya{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class Ad{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new ya(e,t)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}stop(){var e=this;return(0,p.Z)(function*(){e.jo()&&(yield e.close(0))})()}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}Xo(){var e=this;return(0,p.Z)(function*(){if(e.Ho())return e.close(0)})()}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.t_(),r.n_(),r.zo.cancel(),r.Uo++,4!==e?r.zo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ie(t.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),r.zo.Lo()):t&&t.code===g.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.r_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Io(t)})()}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){var e=this;this.state=5,this.zo.ko((0,p.Z)(function*(){e.state=0,e.start()}))}o_(e){return y("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h_ extends Ad{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=function wp(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:R(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(void 0===l||"string"==typeof l),ce.fromBase64String(l||"")):(P(void 0===l||l instanceof Uint8Array),ce.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?g.UNKNOWN:gh(c.code);return new _(l,c.message||"")}(o);t=new Th(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=Ye(n,r.document.name),s=se(r.document.updateTime),o=r.document.createTime?se(r.document.createTime):S.min(),a=new ye({mapValue:{fields:r.document.fields}}),u=Y.newFoundDocument(i,s,o,a);t=new Yi(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=Ye(n,r.document),s=r.readTime?se(r.readTime):S.min(),o=Y.newNoDocument(i,s);t=new Yi([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Ye(n,r.document);t=new Yi([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return R();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new mp(i,s);t=new Ih(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return S.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?S.min():o.readTime?se(o.readTime):S.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=Mr(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=Ki(u)?{documents:Ch(s,u)}:{query:Ho(s,u)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Ah(s,o.resumeToken);const c=jo(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(S.min())>0){a.readTime=Sn(s,o.snapshotVersion.toTimestamp());const c=jo(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function Rp(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=Mr(this.serializer),t.removeTarget=e,this.e_(t)}}class d_ extends Ad{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(P(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=function Ap(n,e){return n&&n.length>0?(P(void 0!==e),n.map(t=>function(i,s){let o=se(i.updateTime?i.updateTime:s);return o.isEqual(S.min())&&(o=se(s)),new lp(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=se(e.commitTime);return this.listener.I_(r,t)}return P(!e.writeResults||0===e.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=Mr(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Or(this.serializer,r))};this.e_(t)}}class f_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new _(g.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(g.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class g_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,"Online"===e&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(ie(t),this.f_=!1):y("OnlineStateTracker",t)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class p_{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;St(o)&&(y("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(l){const h=v(l);h.C_.add(4),yield Fn(h),h.M_.set("Unknown"),h.C_.delete(4),yield $r(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.M_=new g_(r,i)}}function $r(n){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,p.Z)(function*(n){if(St(n))for(const e of n.v_)yield e(!0)}),Ta.apply(this,arguments)}function Fn(n){return Ea.apply(this,arguments)}function Ea(){return Ea=(0,p.Z)(function*(n){for(const e of n.v_)yield e(!1)}),Ea.apply(this,arguments)}function fs(n,e){const t=v(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),Aa(t)?wa(t):On(t).Ho()&&va(t,e))}function Qr(n,e){const t=v(n),r=On(t);t.D_.delete(e),r.Ho()&&Rd(t,e),0===t.D_.size&&(r.Ho()?r.Zo():St(t)&&t.M_.set("Unknown"))}function va(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(S.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}On(n).u_(e)}function Rd(n,e){n.x_.Oe(e),On(n).c_(e)}function wa(n){n.x_=new pp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),On(n).start(),n.M_.g_()}function Aa(n){return St(n)&&!On(n).jo()&&n.D_.size>0}function St(n){return 0===v(n).C_.size}function Pd(n){n.x_=void 0}function __(n){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,p.Z)(function*(n){n.D_.forEach((e,t)=>{va(n,e)})}),Ra.apply(this,arguments)}function y_(n,e){return Pa.apply(this,arguments)}function Pa(){return Pa=(0,p.Z)(function*(n,e){Pd(n),Aa(n)?(n.M_.w_(e),wa(n)):n.M_.set("Unknown")}),Pa.apply(this,arguments)}function I_(n,e,t){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,p.Z)(function*(n,e,t){if(n.M_.set("Online"),e instanceof Th&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.D_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.D_.delete(u),s.x_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ms(n,r)}else if(e instanceof Yi?n.x_.$e(e):e instanceof Ih?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(S.min()))try{const r=yield md(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.x_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.D_.get(c);l&&s.D_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.D_.get(u);if(!l)return;s.D_.set(u,l.withResumeToken(ce.EMPTY_BYTE_STRING,l.snapshotVersion)),Rd(s,u);const h=new ot(l.target,u,c,l.sequenceNumber);va(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield ms(n,r)}var r}),Sa.apply(this,arguments)}function ms(n,e,t){return Va.apply(this,arguments)}function Va(){return Va=(0,p.Z)(function*(n,e,t){if(!gt(e))throw e;n.C_.add(1),yield Fn(n),n.M_.set("Offline"),t||(t=()=>md(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){y("RemoteStore","Retrying IndexedDB access"),yield t(),n.C_.delete(1),yield $r(n)}))}),Va.apply(this,arguments)}function Sd(n,e){return e().catch(t=>ms(n,t,e))}function Mn(n){return xa.apply(this,arguments)}function xa(){return xa=(0,p.Z)(function*(n){const e=v(n),t=Vt(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;T_(e);)try{const i=yield i_(e.localStore,r);if(null===i){0===e.b_.length&&t.Zo();break}r=i.batchId,E_(e,i)}catch(i){yield ms(e,i)}Vd(e)&&xd(e)}),xa.apply(this,arguments)}function T_(n){return St(n)&&n.b_.length<10}function E_(n,e){n.b_.push(e);const t=Vt(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function Vd(n){return St(n)&&!Vt(n).jo()&&n.b_.length>0}function xd(n){Vt(n).start()}function v_(n){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,p.Z)(function*(n){Vt(n).E_()}),Ca.apply(this,arguments)}function w_(n){return Da.apply(this,arguments)}function Da(){return Da=(0,p.Z)(function*(n){const e=Vt(n);for(const t of n.b_)e.P_(t.mutations)}),Da.apply(this,arguments)}function A_(n,e,t){return ba.apply(this,arguments)}function ba(){return ba=(0,p.Z)(function*(n,e,t){const r=n.b_.shift(),i=Go.from(r,e,t);yield Sd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Mn(n)}),ba.apply(this,arguments)}function R_(n,e){return Na.apply(this,arguments)}function Na(){return Na=(0,p.Z)(function*(n,e){var t;e&&Vt(n).h_&&(yield(t=(0,p.Z)(function*(i,s){if(mh(a=s.code)&&a!==g.ABORTED){const o=i.b_.shift();Vt(i).Yo(),yield Sd(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Mn(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),Vd(n)&&xd(n)}),Na.apply(this,arguments)}function Cd(n,e){return ka.apply(this,arguments)}function ka(){return ka=(0,p.Z)(function*(n,e){const t=v(n);t.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");const r=St(t);t.C_.add(3),yield Fn(t),r&&t.M_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),yield $r(t)}),ka.apply(this,arguments)}function Fa(n,e){return Ma.apply(this,arguments)}function Ma(){return Ma=(0,p.Z)(function*(n,e){const t=v(n);e?(t.C_.delete(2),yield $r(t)):e||(t.C_.add(2),yield Fn(t),t.M_.set("Unknown"))}),Ma.apply(this,arguments)}function On(n){return n.O_||(n.O_=function(t,r,i){const s=v(t);return s.A_(),new h_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:__.bind(null,n),Io:y_.bind(null,n),a_:I_.bind(null,n)}),n.v_.push(function(){var e=(0,p.Z)(function*(t){t?(n.O_.Yo(),Aa(n)?wa(n):n.M_.set("Unknown")):(yield n.O_.stop(),Pd(n))});return function(t){return e.apply(this,arguments)}}())),n.O_}function Vt(n){return n.N_||(n.N_=function(t,r,i){const s=v(t);return s.A_(),new d_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:v_.bind(null,n),Io:R_.bind(null,n),T_:w_.bind(null,n),I_:A_.bind(null,n)}),n.v_.push(function(){var e=(0,p.Z)(function*(t){t?(n.N_.Yo(),yield Mn(n)):(yield n.N_.stop(),n.b_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))});return function(t){return e.apply(this,arguments)}}())),n.N_}class Oa{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ue,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Oa(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ln(n,e){if(ie("AsyncQueue",`${e}: ${n}`),gt(n))return new _(g.UNAVAILABLE,`${e}: ${n}`);throw n}class Bn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||w.comparator(t.key,r.key):(t,r)=>w.comparator(t.key,r.key),this.keyedMap=Vr(),this.sortedSet=new Q(this.comparator)}static emptySet(e){return new Bn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Bn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Bn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Dd{constructor(){this.B_=new Q(w.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):R():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class qn{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new qn(e,t,Bn.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class P_{constructor(){this.k_=void 0,this.listeners=[]}}class S_{constructor(){this.queries=new it(e=>Hl(e),Pr),this.onlineState="Unknown",this.q_=new Set}}function La(n,e){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,p.Z)(function*(n,e){const t=v(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new P_),i)try{s.k_=yield t.onListen(r)}catch(o){const a=Ln(o,`Initialization of query '${vn(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&Ga(t)}),Ba.apply(this,arguments)}function qa(n,e){return Ua.apply(this,arguments)}function Ua(){return Ua=(0,p.Z)(function*(n,e){const t=v(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Ua.apply(this,arguments)}function V_(n,e){const t=v(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.listeners)a.K_(i)&&(r=!0);o.k_=i}}r&&Ga(t)}function x_(n,e,t){const r=v(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Ga(n){n.q_.forEach(e=>{e.next()})}class za{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new qn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){return!e.fromCache||(!this.options.J_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}H_(e){e=qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class C_{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class bd{constructor(e){this.serializer=e}hs(e){return Ye(this.serializer,e)}Ps(e){return e.metadata.exists?xh(this.serializer,e.document,!1):Y.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return se(e)}}class D_{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Nd(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=L.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new bd(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||N()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function s_(n,e,t,r){return ha.apply(this,arguments)}(e.localStore,new bd(e.serializer),e.documents,e.X_.id),r=e.ta(e.documents);for(const i of e.queries)yield o_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,na:e.collectionGroups,ra:t}})()}}function Nd(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class kd{constructor(e){this.key=e}}class Fd{constructor(e){this.key=e}}class Md{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=N(),this.mutatedKeys=N(),this._a=Yl(e),this.aa=new Bn(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new Dd,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const d=i.get(l),m=Sr(this.query,h)?h:null,I=!!d&&this.mutatedKeys.has(d.key),T=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let E=!1;d&&m?d.data.isEqual(m.data)?I!==T&&(r.track({type:3,doc:m}),E=!0):this.ha(d,m)||(r.track({type:2,doc:m}),E=!0,(u&&this._a(m,u)>0||c&&this._a(m,c)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),E=!0):d&&!m&&(r.track({type:1,doc:d}),E=!0,(u||c)&&(a=!0)),E&&(m?(o=o.add(m),s=T?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{aa:o,la:r,Zi:a,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const s=e.la.L_();s.sort((c,l)=>function(d,m){const I=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return I(d)-I(m)}(c.type,l.type)||this._a(c.doc,l.doc)),this.Pa(r);const o=t?this.Ia():[],a=0===this.oa.size&&this.current?1:0,u=a!==this.sa;return this.sa=a,0!==s.length||u?{snapshot:new qn(this.query,e.aa,i,s,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:o}:{Ta:o}}Q_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({aa:this.aa,la:new Dd,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=N(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new Fd(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new kd(r))}),t}da(e){this.ia=e.ls,this.oa=N();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return qn.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class b_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class N_{constructor(e){this.key=e,this.Ra=!1}}class k_{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new it(a=>Hl(a),Pr),this.fa=new Map,this.ga=new Set,this.pa=new Q(w.comparator),this.ya=new Map,this.wa=new ra,this.Sa={},this.ba=new Map,this.Da=Ht.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}function F_(n,e){return Ka.apply(this,arguments)}function Ka(){return Ka=(0,p.Z)(function*(n,e){const t=fu(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const o=yield Nn(t.localStore,Se(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield ja(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&fs(t.remoteStore,o)}return i}),Ka.apply(this,arguments)}function ja(n,e,t,r,i){return $a.apply(this,arguments)}function $a(){return $a=(0,p.Z)(function*(n,e,t,r,i){n.va=(h,d,m)=>{return(I=(0,p.Z)(function*(E,V,C,x){let k=V.view.ca(C);k.Zi&&(k=yield us(E.localStore,V.query,!1).then(({documents:ae})=>V.view.ca(ae,k)));const q=x&&x.targetChanges.get(V.targetId),O=V.view.applyChanges(k,E.isPrimaryClient,q);return nu(E,V.targetId,O.Ta),O.snapshot}),function T(E,V,C,x){return I.apply(this,arguments)})(n,h,d,m);var I};const s=yield us(n.localStore,e,!0),o=new Md(e,s.ls),a=o.ca(s.documents),u=kr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);nu(n,t,c.Ta);const l=new b_(e,t,o);return n.ma.set(e,l),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),c.snapshot}),$a.apply(this,arguments)}function M_(n,e){return Qa.apply(this,arguments)}function Qa(){return Qa=(0,p.Z)(function*(n,e){const t=v(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!Pr(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield kn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Qr(t.remoteStore,r.targetId),Un(t,r.targetId)}).catch(mt))):(Un(t,r.targetId),yield kn(t.localStore,r.targetId,!0))}),Qa.apply(this,arguments)}function Wa(){return Wa=(0,p.Z)(function*(n,e,t){const r=mu(n);try{const i=yield function(o,a){const u=v(o),c=J.now(),l=a.reduce((m,I)=>m.add(I.key),N());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",m=>{let I=Ne(),T=N();return u.ss.getEntries(m,l).next(E=>{I=E,I.forEach((V,C)=>{C.isValidDocument()||(T=T.add(V))})}).next(()=>u.localDocuments.getOverlayedDocuments(m,I)).next(E=>{h=E;const V=[];for(const C of a){const x=dp(C,h.get(C.key).overlayedDocument);null!=x&&V.push(new st(C.key,x,kl(x.value.mapValue),ee.exists(!0)))}return u.mutationQueue.addMutationBatch(m,c,V,a)}).next(E=>{d=E;const V=E.applyToLocalDocumentSet(h,T);return u.documentOverlayCache.saveOverlays(m,E.batchId,V)})}).then(()=>({batchId:d.batchId,changes:Jl(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Sa[o.currentUser.toKey()];c||(c=new Q(D)),c=c.insert(a,u),o.Sa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield at(r,i.changes),yield Mn(r.remoteStore)}catch(i){const s=Ln(i,"Failed to persist write");t.reject(s)}}),Wa.apply(this,arguments)}function Od(n,e){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,p.Z)(function*(n,e){const t=v(n);try{const r=yield function r_(n,e){const t=v(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const a=[];e.targetChanges.forEach((l,h)=>{const d=i.get(h);if(!d)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);var T,E,V;null!==e.targetMismatches.get(h)?m=m.withResumeToken(ce.EMPTY_BYTE_STRING,S.min()).withLastLimboFreeSnapshotVersion(S.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),E=m,V=l,(0===(T=d).resumeToken.approximateByteSize()||E.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&a.push(t.qr.updateTargetData(s,m))});let u=Ne(),c=N();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(gd(s,o,e.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(S.min())){const l=t.qr.getLastRemoteSnapshotVersion(s).next(h=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.ya.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ra=!0:i.modifiedDocuments.size>0?P(o.Ra):i.removedDocuments.size>0&&(P(o.Ra),o.Ra=!1))}),yield at(t,r,e)}catch(r){yield mt(r)}}),Ha.apply(this,arguments)}function Ld(n,e,t){const r=v(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ma.forEach((s,o)=>{const a=o.view.Q_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=v(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const d of h.listeners)d.Q_(a)&&(c=!0)}),c&&Ga(u)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function L_(n,e,t){return Za.apply(this,arguments)}function Za(){return Za=(0,p.Z)(function*(n,e,t){const r=v(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let o=new Q(w.comparator);o=o.insert(s,Y.newNoDocument(s,S.min()));const a=N().add(s),u=new Nr(S.min(),new Map,new Q(D),o,a);yield Od(r,u),r.pa=r.pa.remove(s),r.ya.delete(e),ru(r)}else yield kn(r.localStore,e,!1).then(()=>Un(r,e,t)).catch(mt)}),Za.apply(this,arguments)}function B_(n,e){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,p.Z)(function*(n,e){const t=v(n),r=e.batch.batchId;try{const i=yield function n_(n,e){const t=v(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,d=h.keys();let m=f.resolve();return d.forEach(I=>{m=m.next(()=>l.getEntry(u,I)).next(T=>{const E=c.docVersions.get(I);P(null!==E),T.version.compareTo(E)<0&&(h.applyToRemoteDocument(T,c),T.isValidDocument()&&(T.setReadTime(c.commitVersion),l.addEntry(T)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=N();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);tu(t,r,null),eu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield at(t,i)}catch(i){yield mt(i)}}),Ya.apply(this,arguments)}function q_(n,e,t){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,p.Z)(function*(n,e,t){const r=v(n);try{const i=yield function(o,a){const u=v(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);tu(r,e,t),eu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield at(r,i)}catch(i){yield mt(i)}}),Xa.apply(this,arguments)}function Ja(){return Ja=(0,p.Z)(function*(n,e){const t=v(n);St(t.remoteStore)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=v(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=Ln(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Ja.apply(this,arguments)}function eu(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function tu(n,e,t){const r=v(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Un(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||Bd(n,r)})}function Bd(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);null!==t&&(Qr(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),ru(n))}function nu(n,e,t){for(const r of t)r instanceof kd?(n.wa.addReference(r.key,e),G_(n,r)):r instanceof Fd?(y("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||Bd(n,r.key)):R()}function G_(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(y("SyncEngine","New document in limbo: "+t),n.ga.add(r),ru(n))}function ru(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new w(L.fromString(e)),r=n.Da.next();n.ya.set(r,new N_(t)),n.pa=n.pa.insert(t,r),fs(n.remoteStore,new ot(Se(Tn(t.path)),r,"TargetPurposeLimboResolution",Me._e))}}function at(n,e,t){return iu.apply(this,arguments)}function iu(){return iu=(0,p.Z)(function*(n,e,t){const r=v(n),i=[],s=[],o=[];var a;r.ma.isEmpty()||(r.ma.forEach((a,u)=>{o.push(r.va(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=ua.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Va.a_(i),yield(a=(0,p.Z)(function*(c,l){const h=v(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>f.forEach(l,m=>f.forEach(m.ki,I=>h.persistence.referenceDelegate.addReference(d,m.targetId,I)).next(()=>f.forEach(m.qi,I=>h.persistence.referenceDelegate.removeReference(d,m.targetId,I)))))}catch(d){if(!gt(d))throw d;y("LocalStore","Failed to update sequence numbers: "+d)}for(const d of l){const m=d.targetId;if(!d.fromCache){const I=h.ts.get(m),E=I.withLastLimboFreeSnapshotVersion(I.snapshotVersion);h.ts=h.ts.insert(m,E)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),iu.apply(this,arguments)}function z_(n,e){return su.apply(this,arguments)}function su(){return su=(0,p.Z)(function*(n,e){const t=v(n);if(!t.currentUser.isEqual(e)){y("SyncEngine","User change. New user:",e.toKey());const r=yield fd(t.localStore,e);t.currentUser=e,(s=t).ba.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ba.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield at(t,r._s)}var s}),su.apply(this,arguments)}function K_(n,e){const t=v(n),r=t.ya.get(e);if(r&&r.Ra)return N().add(r.key);{let i=N();const s=t.fa.get(e);if(!s)return i;for(const o of s){const a=t.ma.get(o);i=i.unionWith(a.view.ua)}return i}}function j_(n,e){return ou.apply(this,arguments)}function ou(){return ou=(0,p.Z)(function*(n,e){const t=v(n),r=yield us(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&nu(t,e.targetId,i.Ta),i}),ou.apply(this,arguments)}function $_(n,e){return au.apply(this,arguments)}function au(){return au=(0,p.Z)(function*(n,e){const t=v(n);return _d(t.localStore,e).then(r=>at(t,r))}),au.apply(this,arguments)}function Q_(n,e,t,r){return uu.apply(this,arguments)}function uu(){return uu=(0,p.Z)(function*(n,e,t,r){const i=v(n),s=yield function(a,u){const c=v(a),l=v(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):f.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield Mn(i.remoteStore):"acknowledged"===t||"rejected"===t?(tu(i,e,r||null),eu(i,e),u=e,v(v(i.localStore).mutationQueue).Fn(u)):R(),yield at(i,s)):y("SyncEngine","Cannot apply mutation batch with id: "+e)}),uu.apply(this,arguments)}function cu(){return cu=(0,p.Z)(function*(n,e){const t=v(n);if(fu(t),mu(t),!0===e&&!0!==t.Ca){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield qd(t,r.toArray());t.Ca=!0,yield Fa(t.remoteStore,!0);for(const s of i)fs(t.remoteStore,s)}else if(!1===e&&!1!==t.Ca){const r=[];let i=Promise.resolve();t.fa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Un(t,o),kn(t.localStore,o,!0))),Qr(t.remoteStore,o)}),yield i,yield qd(t,r),function(o){const a=v(o);a.ya.forEach((u,c)=>{Qr(a.remoteStore,c)}),a.wa.Vr(),a.ya=new Map,a.pa=new Q(w.comparator)}(t),t.Ca=!1,yield Fa(t.remoteStore,!1)}}),cu.apply(this,arguments)}function qd(n,e,t){return lu.apply(this,arguments)}function lu(){return lu=(0,p.Z)(function*(n,e,t){const r=v(n),i=[],s=[];for(const o of e){let a;const u=r.fa.get(o);if(u&&0!==u.length){a=yield Nn(r.localStore,Se(u[0]));for(const c of u){const l=r.ma.get(c),h=yield j_(r,l);h.snapshot&&s.push(h.snapshot)}}else{const c=yield pd(r.localStore,o);a=yield Nn(r.localStore,c),yield ja(r,Ud(c),o,!1,a.resumeToken)}i.push(a)}return r.Va.a_(s),i}),lu.apply(this,arguments)}function Ud(n){return $l(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function H_(n){return t=v(n).localStore,v(v(t).persistence).Bi();var t}function Z_(n,e,t,r){return hu.apply(this,arguments)}function hu(){return hu=(0,p.Z)(function*(n,e,t,r){const i=v(n);if(i.Ca)return void y("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield _d(i.localStore,Zl(s[0])),a=Nr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ce.EMPTY_BYTE_STRING);yield at(i,o,a);break}case"rejected":yield kn(i.localStore,e,!0),Un(i,e,r);break;default:R()}}),hu.apply(this,arguments)}function Y_(n,e,t){return du.apply(this,arguments)}function du(){return du=(0,p.Z)(function*(n,e,t){const r=fu(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){y("SyncEngine","Adding an already active target "+i);continue}const s=yield pd(r.localStore,i),o=yield Nn(r.localStore,s);yield ja(r,Ud(s),o.targetId,!1,o.resumeToken),fs(r.remoteStore,o)}for(const i of t)r.fa.has(i)&&(yield kn(r.localStore,i,!1).then(()=>{Qr(r.remoteStore,i),Un(r,i)}).catch(mt))}}),du.apply(this,arguments)}function fu(n){const e=v(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Od.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=K_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=L_.bind(null,e),e.Va.a_=V_.bind(null,e.eventManager),e.Va.Fa=x_.bind(null,e.eventManager),e}function mu(n){const e=v(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=B_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=q_.bind(null,e),e}class Wr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.serializer=jr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return dd(this.persistence,new hd,e.initialUser,this.serializer)}createPersistence(e){return new ia(ss.jr,this.serializer)}createSharedClientState(e){return new Ed}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class gu extends Wr{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.xa.initialize(r,e),yield mu(r.xa.syncEngine),yield Mn(r.xa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return dd(this.persistence,new hd,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new nd(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Ag(t,this.persistence);return new wg(e.asyncQueue,r)}createPersistence(e){const t=aa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?we.withCacheSize(this.cacheSizeBytes):we.DEFAULT;return new oa(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,wd(),ds(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ed}}class Gd extends gu{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const i=r.xa.syncEngine;r.sharedClientState instanceof pa&&(r.sharedClientState.syncEngine={Ys:Q_.bind(null,i),Zs:Z_.bind(null,i),Xs:Y_.bind(null,i),Bi:H_.bind(null,i),Js:$_.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,p.Z)(function*(o){yield function W_(n,e){return cu.apply(this,arguments)}(r.xa.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=wd();if(!pa.D(t))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=aa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new pa(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Gn{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Ld(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=z_.bind(null,r.syncEngine),yield Fa(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new S_}createDatastore(e){const t=jr(e.databaseInfo.databaseId),r=new l_(e.databaseInfo);return new f_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Ld(this.syncEngine,t,0),a=vd.D()?new vd:new a_,new p_(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new k_(i,s,o,a,u,c);return l&&(h.Ca=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(r){const i=v(r);y("RemoteStore","RemoteStore shutting down."),i.C_.add(5),yield Fn(i),i.F_.shutdown(),i.M_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function zd(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class gs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):ie("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ey{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new ue,this.buffer=new Uint8Array,this.La=new TextDecoder("utf-8"),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}Ma(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.ka()})()}ka(){var e=this;return(0,p.Z)(function*(){const t=yield e.qa();if(null===t)return null;const r=e.La.decode(t),i=Number(r);isNaN(i)&&e.Qa(`length string (${r}) is not valid number`);const s=yield e.Ka(i);return new C_(JSON.parse(s),t.length+i)})()}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}qa(){var e=this;return(0,p.Z)(function*(){for(;e.$a()<0&&!(yield e.Ua()););if(0===e.buffer.length)return null;const t=e.$a();t<0&&e.Qa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ka(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ua())&&t.Qa("Reached the end of bundle when more is expected.");const r=t.La.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}Ua(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ba.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class ty{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,p.Z)(function*(o,a){const u=v(o),c=Mr(u.serializer)+"/documents",l={documents:a.map(I=>Fr(u.serializer,I))},h=yield u.Co("BatchGetDocuments",c,l,a.length),d=new Map;h.forEach(I=>{const T=function vp(n,e){return"found"in e?function(r,i){P(!!i.found);const s=Ye(r,i.found.name),o=se(i.found.updateTime),a=i.found.createTime?se(i.found.createTime):S.min(),u=new ye({mapValue:{fields:i.found.fields}});return Y.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){P(!!i.missing),P(!!i.readTime);const s=Ye(r,i.missing),o=se(i.readTime);return Y.newNoDocument(s,o)}(n,e):R()}(u.serializer,I);d.set(T.key.toString(),T)});const m=[];return a.forEach(I=>{const T=d.get(I.toString());P(!!T),m.push(T)}),m}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Pn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=w.fromPath(i);e.mutations.push(new qo(s,e.precondition(s)))}),yield(r=(0,p.Z)(function*(s,o){const a=v(s),u=Mr(a.serializer)+"/documents",c={writes:o.map(l=>Or(a.serializer,l))};yield a.wo("Commit",u,c)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw R();t=S.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(S.min())?ee.exists(!1):ee.updateTime(t):ee.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(S.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ee.updateTime(t)}return ee.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ny{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new ya(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){var e=this;this.zo.ko((0,p.Z)(function*(){const t=new ty(e.datastore),r=e.za(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ja(s)}))}).catch(i=>{e.ja(i)})}))}za(e){try{const t=this.updateFunction(e);return!yr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!mh(t)}return!1}}class ry{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=de.UNAUTHENTICATED,this.clientId=ll.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){y("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(y("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ue;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ln(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ps(n,e){return pu.apply(this,arguments)}function pu(){return pu=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(s){r.isEqual(s)||(yield fd(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),pu.apply(this,arguments)}function _u(n,e){return yu.apply(this,arguments)}function yu(){return yu=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Iu(n);y("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Cd(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Cd(e.remoteStore,s)),n._onlineComponents=e}),yu.apply(this,arguments)}function Kd(n){return"FirebaseError"===n.name?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Iu(n){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,p.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ps(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Kd(t))throw t;De("Error using user provided cache. Falling back to memory cache: "+t),yield ps(n,new Wr)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield ps(n,new Wr);return n._offlineComponents}),Tu.apply(this,arguments)}function _s(n){return Eu.apply(this,arguments)}function Eu(){return Eu=(0,p.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield _u(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield _u(n,new Gn))),n._onlineComponents}),Eu.apply(this,arguments)}function jd(n){return Iu(n).then(e=>e.persistence)}function zn(n){return Iu(n).then(e=>e.localStore)}function $d(n){return _s(n).then(e=>e.remoteStore)}function vu(n){return _s(n).then(e=>e.syncEngine)}function Kn(n){return wu.apply(this,arguments)}function wu(){return wu=(0,p.Z)(function*(n){const e=yield _s(n),t=e.eventManager;return t.onListen=F_.bind(null,e.syncEngine),t.onUnlisten=M_.bind(null,e.syncEngine),t}),wu.apply(this,arguments)}function Wd(n,e,t={}){const r=new ue;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new gs({next:d=>{o.enqueueAndForget(()=>qa(s,h));const m=d.docs.has(a);!m&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&u&&"server"===u.source?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new za(Tn(a.path),l,{includeMetadataChanges:!0,J_:!0});return La(s,h)}(yield Kn(n),n.asyncQueue,e,t,r)})),r.promise}function Hd(n,e,t={}){const r=new ue;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new gs({next:d=>{o.enqueueAndForget(()=>qa(s,h)),d.fromCache&&"server"===u.source?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new za(a,l,{includeMetadataChanges:!0,J_:!0});return La(s,h)}(yield Kn(n),n.asyncQueue,e,t,r)})),r.promise}function Zd(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Yd=new Map;function Au(n,e,t){if(!t)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Xd(n,e,t,r){if(!0===e&&!0===r)throw new _(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Jd(n){if(!w.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ef(n){if(w.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ys(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":R()}function F(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ys(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function tf(n,e){if(e<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class nf{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Xd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Zd(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Hr{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nf(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new hg;switch(r.type){case"firstParty":return new gg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Yd.get(t);r&&(y("ComponentProvider","Removing Datastore"),Yd.delete(t),r.terminate())}(this),Promise.resolve()}}class Ie{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ie(this.firestore,e,this._query)}}class X{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xe(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new X(this.firestore,e,this._key)}}class Xe extends Ie{constructor(e,t,r){super(e,t,Tn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new X(this.firestore,null,new w(e))}withConverter(e){return new Xe(this.firestore,e,this._path)}}function sf(n,e,...t){if(n=(0,K.m9)(n),Au("collection","path",e),n instanceof Hr){const r=L.fromString(e,...t);return ef(r),new Xe(n,null,r)}{if(!(n instanceof X||n instanceof Xe))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(L.fromString(e,...t));return ef(r),new Xe(n.firestore,null,r)}}function Is(n,e,...t){if(n=(0,K.m9)(n),1===arguments.length&&(e=ll.newId()),Au("doc","path",e),n instanceof Hr){const r=L.fromString(e,...t);return Jd(r),new X(n,null,new w(r))}{if(!(n instanceof X||n instanceof Xe))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(L.fromString(e,...t));return Jd(r),new X(n.firestore,n instanceof Xe?n.converter:null,new w(r))}}function of(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),(n instanceof X||n instanceof Xe)&&(e instanceof X||e instanceof Xe)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ru(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),n instanceof Ie&&e instanceof Ie&&n.firestore===e.firestore&&Pr(n._query,e._query)&&n.converter===e.converter}class gy{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new ya(this,"async_queue_retry"),this.iu=()=>{const t=ds();t&&y("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=ds();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=ds();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new ue;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}_u(){var e=this;return(0,p.Z)(function*(){if(0!==e.Ya.length){try{yield e.Ya[0](),e.Ya.shift(),e.zo.reset()}catch(t){if(!gt(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}e.Ya.length>0&&e.zo.ko(()=>e._u())}})()}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{throw this.eu=r,this.tu=!1,ie("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=Oa.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&R()}verifyOperationInProgress(){}uu(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Ja,yield t}while(t!==e.Ja)})()}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function Pu(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class py{constructor(){this._progressObserver={},this._taskCompletionResolver=new ue,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class W extends Hr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new gy,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||af(this),this._firestoreClient.terminate()}}function re(n){return n._firestoreClient||af(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function af(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new jg(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Zd(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new ry(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function uf(n,e,t){const r=new ue;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield ps(n,t),yield _u(n,e),r.resolve()}catch(i){const s=i;if(!Kd(s))throw s;De("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function cf(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Je{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Je(ce.fromBase64String(e))}catch(t){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Je(ce.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ut{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Z(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yt{constructor(e){this._methodName=e}}class Ts{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return D(this._lat,e._lat)||D(this._long,e._long)}}const Sy=/^__.*__$/;class Vy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new st(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rn(e,this.data,t,this.fieldTransforms)}}class lf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new st(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}class Es{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new Es(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return As(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(0===e.length)throw this.mu("Document fields must not be empty");if(hf(this.Iu)&&Sy.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class xy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jr(e)}pu(e,t,r,i=!1){return new Es({Iu:e,methodName:t,gu:r,path:Z.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xt(n){const e=n._freezeSettings(),t=jr(n._databaseId);return new xy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vs(n,e,t,r,i,s={}){const o=n.pu(s.merge||s.mergeFields?2:0,e,t,i);Cu("Data must be an object, but it was:",o,r);const a=mf(r,o);let u,c;if(s.merge)u=new be(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const d=Xr(e,h,t);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);pf(l,d)||l.push(d)}u=new be(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Vy(new ye(a),u,c)}class Yr extends Yt{_toFieldTransform(e){if(2!==e.Iu)throw e.mu(1===e.Iu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yr}}function df(n,e,t){return new Es({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Su extends Yt{_toFieldTransform(e){return new Cr(e.path,new wn)}isEqual(e){return e instanceof Su}}class Cy extends Yt{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=df(this,e,!0),r=this.yu.map(s=>Jt(s,t)),i=new Gt(r);return new Cr(e.path,i)}isEqual(e){return this===e}}class Dy extends Yt{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=df(this,e,!0),r=this.yu.map(s=>Jt(s,t)),i=new zt(r);return new Cr(e.path,i)}isEqual(e){return this===e}}class by extends Yt{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new An(e.serializer,rh(e.serializer,this.wu));return new Cr(e.path,t)}isEqual(e){return this===e}}function Vu(n,e,t,r){const i=n.pu(1,e,t);Cu("Data must be an object, but it was:",i,r);const s=[],o=ye.empty();pt(r,(u,c)=>{const l=ws(e,u,t);c=(0,K.m9)(c);const h=i.Ru(l);if(c instanceof Yr)s.push(l);else{const d=Jt(c,h);null!=d&&(s.push(l),o.set(l,d))}});const a=new be(s);return new lf(o,a,i.fieldTransforms)}function xu(n,e,t,r,i,s){const o=n.pu(1,e,t),a=[Xr(e,r,t)],u=[i];if(s.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Xr(e,s[d])),u.push(s[d+1]);const c=[],l=ye.empty();for(let d=a.length-1;d>=0;--d)if(!pf(c,a[d])){const m=a[d];let I=u[d];I=(0,K.m9)(I);const T=o.Ru(m);if(I instanceof Yr)c.push(m);else{const E=Jt(I,T);null!=E&&(c.push(m),l.set(m,E))}}const h=new be(c);return new lf(l,h,o.fieldTransforms)}function ff(n,e,t,r=!1){return Jt(t,n.pu(r?4:3,e))}function Jt(n,e){if(gf(n=(0,K.m9)(n)))return Cu("Unsupported field value:",e,n),mf(n,e);if(n instanceof Yt)return function(r,i){if(!hf(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=Jt(a,i.Vu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,K.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return rh(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=J.fromDate(r);return{timestampValue:Sn(i.serializer,s)}}if(r instanceof J){const s=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Sn(i.serializer,s)}}if(r instanceof Ts)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Je)return{bytesValue:Ah(i.serializer,r._byteString)};if(r instanceof X){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:$o(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${ys(r)}`)}(n,e)}function mf(n,e){const t={};return Rl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pt(n,(r,i)=>{const s=Jt(i,e.Eu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function gf(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof J||n instanceof Ts||n instanceof Je||n instanceof X||n instanceof Yt)}function Cu(n,e,t){if(!gf(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=ys(t);throw e.mu("an object"===r?n+" a custom object":n+" "+r)}var i}function Xr(n,e,t){if((e=(0,K.m9)(e))instanceof ut)return e._internalPath;if("string"==typeof e)return ws(n,e);throw As("Field path arguments must be of type string or ",n,!1,void 0,t)}const Ny=new RegExp("[~\\*/\\[\\]]");function ws(n,e,t){if(e.search(Ny)>=0)throw As(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ut(...e.split("."))._internalPath}catch{throw As(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function As(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function pf(n,e){return n.some(t=>t.isEqual(e))}class Jr{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new X(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ky(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Rs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ky extends Jr{data(){return super.data()}}function Rs(n,e){return"string"==typeof e?ws(n,e):e instanceof ut?e._internalPath:e._delegate._internalPath}function _f(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Du{}class ei extends Du{}function xt(n,e,...t){let r=[];e instanceof Du&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof jn).length,a=s.filter(u=>u instanceof ti).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class ti extends ei{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ti(e,t,r)}_apply(e){const t=this._parse(e);return Ef(e._query,t),new Ie(e.firestore,e.converter,Lo(e._query,t))}_parse(e){const t=Xt(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){Tf(h,l);const m=[];for(const I of h)m.push(If(u,s,I));d={arrayValue:{values:m}}}else d=If(u,s,h)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||Tf(h,l),d=ff(a,"where",h,"in"===l||"not-in"===l);return M.create(c,l,d)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class jn extends Du{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new jn(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:G.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Ef(o,u),o=Lo(o,u)}(e._query,t),new Ie(e.firestore,e.converter,Lo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class bu extends ei{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bu(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ar(s,o)}(e._query,this._field,this._direction);return new Ie(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new rt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Ps extends ei{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ps(e,t,r)}_apply(e){return new Ie(e.firestore,e.converter,$i(e._query,this._limit,this._limitType))}}class Ss extends ei{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ss(e,t,r)}_apply(e){const t=yf(e,this.type,this._docOrFields,this._inclusive);return new Ie(e.firestore,e.converter,(s=t,new rt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class Vs extends ei{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Vs(e,t,r)}_apply(e){const t=yf(e,this.type,this._docOrFields,this._inclusive);return new Ie(e.firestore,e.converter,(s=t,new rt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function yf(n,e,t,r){if(t[0]=(0,K.m9)(t[0]),t[0]instanceof Jr)return function(s,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of En(s))if(h.field.isKeyField())l.push(qt(o,u.key));else{const d=u.data.field(h.field);if(Bi(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const m=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}l.push(d)}return new vt(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Xt(n.firestore);return function(o,a,u,c,l,h){const d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let I=0;I<l.length;I++){const T=l[I];if(d[I].field.isKeyField()){if("string"!=typeof T)throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof T}`);if(!Oo(o)&&-1!==T.indexOf("/"))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${T}' contains a slash.`);const E=o.path.child(L.fromString(T));if(!w.isDocumentKey(E))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${E}' is not because it contains an odd number of segments.`);const V=new w(E);m.push(qt(a,V))}else{const E=ff(u,c,T);m.push(E)}}return new vt(m,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function If(n,e,t){if("string"==typeof(t=(0,K.m9)(t))){if(""===t)throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Oo(e)&&-1!==t.indexOf("/"))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(L.fromString(t));if(!w.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qt(n,new w(r))}if(t instanceof X)return qt(n,t._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ys(t)}.`)}function Tf(n,e){if(!Array.isArray(n)||0===n.length)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ef(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new _(g.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Nu{convertValue(e,t="none"){switch(Tt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw R()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return pt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ts(ne(e.latitude),ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=qi(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Tr(e));default:return null}}convertTimestamp(e){const t=_t(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=L.fromString(e);P(kh(r));const i=new yt(r.get(1),r.get(3)),s=new w(r.popFirst(5));return i.isEqual(t)||ie(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function xs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class zy extends Nu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}class en{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ct extends Jr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ni(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Rs("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ni extends ct{data(e={}){return super.data(e)}}class Ct{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new en(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ni(this._firestore,this._userDataWriter,r.key,r,new en(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new ni(i._firestore,i._userDataWriter,a.doc.key,a.doc,new en(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new ni(i._firestore,i._userDataWriter,a.doc.key,a.doc,new en(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:jy(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function jy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function wf(n,e){return n instanceof ct&&e instanceof ct?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ct&&e instanceof Ct&&n._firestore===e._firestore&&Ru(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Dt extends Nu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}function Af(n,e,t){n=F(n,X);const r=F(n.firestore,W),i=xs(n.converter,e,t);return $n(r,[vs(Xt(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ee.none())])}function Rf(n,e,t,...r){n=F(n,X);const i=F(n.firestore,W),s=Xt(i);let o;return o="string"==typeof(e=(0,K.m9)(e))||e instanceof ut?xu(s,"updateDoc",n._key,e,t,r):Vu(s,"updateDoc",n._key,e),$n(i,[o.toMutation(n._key,ee.exists(!0))])}function Pf(n,...e){var t,r,i;n=(0,K.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Pu(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Pu(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof X)c=F(n.firestore,W),l=Tn(n._key.path),u={next:h=>{e[o]&&e[o](ku(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=F(n,Ie);c=F(h.firestore,W),l=h._query;const d=new Dt(c);u={next:m=>{e[o]&&e[o](new Ct(c,d,h,m))},error:e[o+1],complete:e[o+2]},_f(n._query)}return function(d,m,I,T){const E=new gs(T),V=new za(m,E,I);return d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return La(yield Kn(d),V)})),()=>{E.Na(),d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return qa(yield Kn(d),V)}))}}(re(c),l,a,u)}function $n(n,e){return function(r,i){const s=new ue;return r.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function O_(n,e,t){return Wa.apply(this,arguments)}(yield vu(r),i,s)})),s.promise}(re(n),e)}function ku(n,e,t){const r=t.docs.get(e._key),i=new Dt(n);return new ct(n,i,e._key,r,new en(t.hasPendingWrites,t.fromCache),e.converter)}const cI={maxAttempts:5};class Sf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xt(e)}set(e,t,r){this._verifyNotCommitted();const i=bt(e,this._firestore),s=xs(i.converter,t,r),o=vs(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,ee.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=bt(e,this._firestore);let o;return o="string"==typeof(t=(0,K.m9)(t))||t instanceof ut?xu(this._dataReader,"WriteBatch.update",s._key,t,r,i):Vu(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ee.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=bt(e,this._firestore);return this._mutations=this._mutations.concat(new Pn(t._key,ee.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function bt(n,e){if((n=(0,K.m9)(n)).firestore!==e)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class lI extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Xt(t)}get(t){const r=bt(t,this._firestore),i=new zy(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return R();const o=s[0];if(o.isFoundDocument())return new Jr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Jr(this._firestore,i,r._key,null,r.converter);throw R()})}set(t,r,i){const s=bt(t,this._firestore),o=xs(s.converter,r,i),a=vs(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=bt(t,this._firestore);let a;return a="string"==typeof(r=(0,K.m9)(r))||r instanceof ut?xu(this._dataReader,"Transaction.update",o._key,r,i,s):Vu(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=bt(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=bt(e,this._firestore),r=new Dt(this._firestore);return super.get(e).then(i=>new ct(this._firestore,r,t._key,i._document,new en(!1,!1),t.converter))}}function Mu(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new _("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Df(){if(typeof Uint8Array>"u")throw new _("unimplemented","Uint8Arrays are not available in this environment.")}function bf(){if(!function zg(){return typeof atob<"u"}())throw new _("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){dn=ui.SDK_VERSION,(0,ui._registerComponent)(new Ku.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new W(new fg(r.getProvider("auth-internal")),new pg(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yt(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,ui.registerVersion)(al,"4.3.2",e),(0,ui.registerVersion)(al,"4.3.2","esm2017")}();class ri{constructor(e){this._delegate=e}static fromBase64String(e){return bf(),new ri(Je.fromBase64String(e))}static fromUint8Array(e){return Df(),new ri(Je.fromUint8Array(e))}toBase64(){return bf(),this._delegate.toBase64()}toUint8Array(){return Df(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ou(n){return function TI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class EI{enableIndexedDbPersistence(e,t){return function yy(n,e){cf(n=F(n,W));const t=re(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");De("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Gn;return uf(t,i,new gu(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Iy(n){cf(n=F(n,W));const e=re(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");De("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Gn;return uf(e,r,new Gd(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Ty(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ue;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(i){if(!Ge.D())return Promise.resolve();const s=i+"main";yield Ge.delete(s)}),function r(i){return t.apply(this,arguments)})(aa(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Nf{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof yt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&De("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function rf(n,e,t,r={}){var i;const s=(n=F(n,Hr))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&De("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=de.MOCK_USER;else{a=(0,K.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new de(c)}n._authCredentials=new dg(new ul(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function vy(n){return function iy(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield jd(n),t=yield $d(n);return e.setNetworkEnabled(!0),function(i){const s=v(i);return s.C_.delete(0),$r(s)}(t)}))}(re(n=F(n,W)))}(this._delegate)}disableNetwork(){return function wy(n){return function sy(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield jd(n),t=yield $d(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const o=v(s);o.C_.add(0),yield Fn(o),o.M_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(re(n=F(n,W)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Xd("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Ey(n){return function(t){const r=new ue;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function U_(n,e){return Ja.apply(this,arguments)}(yield vu(t),r)})),r.promise}(re(n=F(n,W)))}(this._delegate)}onSnapshotsInSync(e){return function eI(n,e){return function uy(n,e){const t=new gs(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield Kn(n),s=t,v(i).q_.add(s),void s.next();var i,s})),()=>{t.Na(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield Kn(n),s=t,void v(i).q_.delete(s);var i,s}))}}(re(n=F(n,W)),Pu(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new _("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Qn(this,sf(this._delegate,e))}catch(t){throw Ve(t,"collection()","Firestore.collection()")}}doc(e){try{return new Le(this,Is(this._delegate,e))}catch(t){throw Ve(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new xe(this,function my(n,e){if(n=F(n,Hr),Au("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ie(n,null,(r=e,new rt(L.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw Ve(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function hI(n,e,t){n=F(n,W);const r=Object.assign(Object.assign({},cI),t);return function(s){if(s.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new ue;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const c=yield function Qd(n){return _s(n).then(e=>e.datastore)}(s);new ny(s.asyncQueue,c,a,o,u).run()})),u.promise}(re(n),i=>e(new lI(n,i)),r)}(this._delegate,t=>e(new kf(this,t)))}batch(){return re(this._delegate),new Ff(new Sf(this._delegate,e=>$n(this._delegate,e)))}loadBundle(e){return function Ay(n,e){const t=re(n=F(n,W)),r=new py;return function cy(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?ph().encode(o):o,l=function(l,h){if(l instanceof Uint8Array)return zd(l,h);if(l instanceof ArrayBuffer)return zd(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new ey(l,a);var l}(t,jr(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function X_(n,e,t){const r=v(n);var i;(i=(0,p.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(I,T){const E=v(I),V=se(T.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",C=>E.Kr.getBundleMetadata(C,T.id)).then(C=>!!C&&C.createTime.compareTo(V)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(I=c).totalDocuments,bytesLoaded:I.totalBytes,totalDocuments:I.totalDocuments,totalBytes:I.totalBytes}),Promise.resolve(new Set);u._updateProgress(Nd(c));const l=new D_(c,o.localStore,a.serializer);let h=yield a.Ma();for(;h;){const m=yield l.ea(h);m&&u._updateProgress(m),h=yield a.Ma()}const d=yield l.complete();return yield at(o,d.ra,void 0),yield function(I,T){const E=v(I);return E.persistence.runTransaction("Save bundle","readwrite",V=>E.Kr.saveBundleMetadata(V,T))}(o.localStore,c),u._completeWith(d.progress),Promise.resolve(d.na)}catch(c){return De("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var I}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield vu(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Ry(n,e){return function ly(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(r,i){const s=v(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield zn(n),e)}))}(re(n=F(n,W)),e).then(t=>t?new Ie(n,null,t.query):null)}(this._delegate,e).then(t=>t?new xe(this,t):null)}}class Ds extends Nu{constructor(e){super(),this.firestore=e}convertBytes(e){return new ri(new Je(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Le.forKey(t,this.firestore,null)}}class kf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ds(e)}get(e){const t=nn(e);return this._delegate.get(t).then(r=>new ii(this._firestore,new ct(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=nn(e);return r?(Mu("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=nn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=nn(e);return this._delegate.delete(t),this}}class Ff{constructor(e){this._delegate=e}set(e,t,r){const i=nn(e);return r?(Mu("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=nn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=nn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class tn{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new ni(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new si(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=tn.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new tn(e,new Ds(e),t),i.set(t,s)),s}}tn.INSTANCES=new WeakMap;class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ds(e)}static forPath(e,t,r){if(e.length%2!=0)throw new _("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Le(t,new X(t._delegate,r,new w(e)))}static forKey(e,t,r){return new Le(t,new X(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Qn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Qn(this.firestore,sf(this._delegate,e))}catch(t){throw Ve(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,K.m9)(e))instanceof X&&of(this._delegate,e)}set(e,t){t=Mu("DocumentReference.set",t);try{return t?Af(this._delegate,e,t):Af(this._delegate,e)}catch(r){throw Ve(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Rf(this._delegate,e):Rf(this._delegate,e,t,...r)}catch(i){throw Ve(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Xy(n){return $n(F(n.firestore,W),[new Pn(n._key,ee.none())])}(this._delegate)}onSnapshot(...e){const t=Mf(e),r=Of(e,i=>new ii(this.firestore,new ct(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Pf(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function Qy(n){n=F(n,X);const e=F(n.firestore,W),t=re(e),r=new Dt(e);return function oy(n,e){const t=new ue;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield function(l,h){const d=v(l);return d.persistence.runTransaction("read document","readonly",m=>d.localDocuments.getDocument(m,h))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Ln(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield zn(n),e,t);var r})),t.promise}(t,n._key).then(i=>new ct(e,r,n._key,i,new en(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Wy(n){n=F(n,X);const e=F(n.firestore,W);return Wd(re(e),n._key,{source:"server"}).then(t=>ku(e,n,t))}(this._delegate):function $y(n){n=F(n,X);const e=F(n.firestore,W);return Wd(re(e),n._key).then(t=>ku(e,n,t))}(this._delegate),t.then(r=>new ii(this.firestore,new ct(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?tn.getInstance(this.firestore,e):null))}}function Ve(n,e,t){return n.message=n.message.replace(e,t),n}function Mf(n){for(const e of n)if("object"==typeof e&&!Ou(e))return e;return{}}function Of(n,e){var t,r;let i;return i=Ou(n[0])?n[0]:Ou(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ii{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Le(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return wf(this._delegate,e._delegate)}}class si extends ii{data(e){const t=this._delegate.data(e);return function lg(n,e){n||R()}(void 0!==t),t}}class xe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ds(e)}where(e,t,r){try{return new xe(this.firestore,xt(this._delegate,function Fy(n,e,t){const r=e,i=Rs("where",n);return ti._create(i,r,t)}(e,t,r)))}catch(i){throw Ve(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new xe(this.firestore,xt(this._delegate,function My(n,e="asc"){const t=e,r=Rs("orderBy",n);return bu._create(r,t)}(e,t)))}catch(r){throw Ve(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new xe(this.firestore,xt(this._delegate,function Oy(n){return tf("limit",n),Ps._create("limit",n,"F")}(e)))}catch(t){throw Ve(t,"limit()","Query.limit()")}}limitToLast(e){try{return new xe(this.firestore,xt(this._delegate,function Ly(n){return tf("limitToLast",n),Ps._create("limitToLast",n,"L")}(e)))}catch(t){throw Ve(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new xe(this.firestore,xt(this._delegate,function By(...n){return Ss._create("startAt",n,!0)}(...e)))}catch(t){throw Ve(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new xe(this.firestore,xt(this._delegate,function qy(...n){return Ss._create("startAfter",n,!1)}(...e)))}catch(t){throw Ve(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new xe(this.firestore,xt(this._delegate,function Uy(...n){return Vs._create("endBefore",n,!1)}(...e)))}catch(t){throw Ve(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new xe(this.firestore,xt(this._delegate,function Gy(...n){return Vs._create("endAt",n,!0)}(...e)))}catch(t){throw Ve(t,"endAt()","Query.endAt()")}}isEqual(e){return Ru(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function Zy(n){n=F(n,Ie);const e=F(n.firestore,W),t=re(e),r=new Dt(e);return function ay(n,e){const t=new ue;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield us(s,o,!0),c=new Md(o,u.ls),l=c.ca(u.documents),h=c.applyChanges(l,!1);a.resolve(h.snapshot)}catch(u){const c=Ln(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield zn(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ct(e,r,n,i))}(this._delegate):"server"===e?.source?function Yy(n){n=F(n,Ie);const e=F(n.firestore,W),t=re(e),r=new Dt(e);return Hd(t,n._query,{source:"server"}).then(i=>new Ct(e,r,n,i))}(this._delegate):function Hy(n){n=F(n,Ie);const e=F(n.firestore,W),t=re(e),r=new Dt(e);return _f(n._query),Hd(t,n._query).then(i=>new Ct(e,r,n,i))}(this._delegate),t.then(r=>new Lu(this.firestore,new Ct(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Mf(e),r=Of(e,i=>new Lu(this.firestore,new Ct(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Pf(this._delegate,t,r)}withConverter(e){return new xe(this.firestore,this._delegate.withConverter(e?tn.getInstance(this.firestore,e):null))}}class wI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new si(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Lu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new xe(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new si(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new wI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new si(this._firestore,r))})}isEqual(e){return wf(this._delegate,e._delegate)}}class Qn extends xe{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Le(this.firestore,e):null}doc(e){try{return new Le(this.firestore,void 0===e?Is(this._delegate):Is(this._delegate,e))}catch(t){throw Ve(t,"doc()","CollectionReference.doc()")}}add(e){return function Jy(n,e){const t=F(n.firestore,W),r=Is(n),i=xs(n.converter,e);return $n(t,[vs(Xt(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ee.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Le(this.firestore,t))}isEqual(e){return of(this._delegate,e._delegate)}withConverter(e){return new Qn(this.firestore,this._delegate.withConverter(e?tn.getInstance(this.firestore,e):null))}}function nn(n){return F(n,X)}class Bu{constructor(...e){this._delegate=new ut(...e)}static documentId(){return new Bu(Z.keyField().canonicalString())}isEqual(e){return(e=(0,K.m9)(e))instanceof ut&&this._delegate._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function fI(){return new Su("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new rn(e)}static delete(){const e=function dI(){return new Yr("deleteField")}();return e._methodName="FieldValue.delete",new rn(e)}static arrayUnion(...e){const t=function mI(...n){return new Cy("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new rn(t)}static arrayRemove(...e){const t=function gI(...n){return new Dy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new rn(t)}static increment(e){const t=function pI(n){return new by("increment",n)}(e);return t._methodName="FieldValue.increment",new rn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const AI={Firestore:Nf,GeoPoint:Ts,Timestamp:J,Blob:ri,Transaction:kf,WriteBatch:Ff,DocumentReference:Le,DocumentSnapshot:ii,Query:xe,QueryDocumentSnapshot:si,QuerySnapshot:Lu,CollectionReference:Qn,FieldPath:Bu,FieldValue:rn,setLogLevel:function vI(n){!function cg(n){ft.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function PI(n){(function RI(n,e){n.INTERNAL.registerComponent(new Ku.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},AI)))})(n,(e,t)=>new Nf(e,t,new EI)),n.registerVersion("@firebase/firestore-compat","0.3.21")}(tm.Z);var SI=j(7142);function Lf(n,e){return function VI(n,e=Zf.z){return new Yf.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function qu(n,e){return Lf(n,e).pipe((0,ze.U)(t=>({payload:t,type:"query"})))}class Bf{constructor(e,t){(0,Re.Z)(this,"ref",void 0),(0,Re.Z)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=jf(r,t);return new Gf(i,s,this.afs)}snapshotChanges(){return function xI(n,e){return Lf(n,e).pipe((0,Ns.O)(void 0),ks(),(0,ze.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ze.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,ai.D)(this.ref.get(e)).pipe(Ce.iC)}}function bs(n,e){return qu(n,e).pipe((0,Ns.O)(void 0),ks(),(0,ze.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{const c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function qf(n,e,t){return bs(n,t).pipe((0,Fs.R)((r,i)=>function CI(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function DI(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Uu(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Uu(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Uu(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,em.x)(),(0,ze.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function Uu(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Uf(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Gf{constructor(e,t,r){(0,Re.Z)(this,"ref",void 0),(0,Re.Z)(this,"query",void 0),(0,Re.Z)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=bs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ze.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Ns.O)(void 0),ks(),(0,zu.h)(([r,i])=>i.length>0||!r),(0,ze.U)(([,r])=>r),Ce.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Fs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Uf(e);return qf(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return qu(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),Ce.iC)}get(e){return(0,ai.D)(this.query.get(e)).pipe(Ce.iC)}add(e){return this.ref.add(e)}doc(e){return new Bf(this.ref.doc(e),this.afs)}}class bI{constructor(e,t){(0,Re.Z)(this,"query",void 0),(0,Re.Z)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?bs(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,zu.h)(t=>t.length>0),Ce.iC):bs(this.query,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Fs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Uf(e);return qf(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return qu(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ce.iC)}get(e){return(0,ai.D)(this.query.get(e)).pipe(Ce.iC)}}const zf=new $.OlP("angularfire2.enableFirestorePersistence"),Kf=new $.OlP("angularfire2.firestore.persistenceSettings"),NI=new $.OlP("angularfire2.firestore.settings"),kI=new $.OlP("angularfire2.firestore.use-emulator");function jf(n,e=(t=>t)){return{query:e(n),ref:n}}let $f=(()=>{var n;class e{constructor(r,i,s,o,a,u,c,l,h,d,m,I,T,E,V,C,x){(0,Re.Z)(this,"schedulers",void 0),(0,Re.Z)(this,"firestore",void 0),(0,Re.Z)(this,"persistenceEnabled$",void 0),this.schedulers=c;const k=(0,oi.on)(r,u,i),q=h;d&&(0,lt.nw)(k,u,m,T,E,V,I,C),[this.firestore,this.persistenceEnabled$]=(0,oi.cc)(`${k.name}.firestore`,"AngularFirestore",k.name,()=>{const O=u.runOutsideAngular(()=>k.firestore());if(o&&O.settings(o),q&&O.useEmulator(...q),s&&!(0,Hf.PM)(a)){const ae=()=>{try{return(0,ai.D)(O.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(Be){return typeof console<"u"&&console.warn(Be),(0,Gu.of)(!1)}};return[O,u.runOutsideAngular(ae)]}return[O,(0,Gu.of)(!1)]},[o,q,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:o,query:a}=jf(s,i),u=this.schedulers.ngZone.run(()=>o);return new Gf(u,a,this)}collectionGroup(r,i){const s=i||(a=>a),o=this.firestore.collectionGroup(r);return new bI(s(o),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new Bf(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,Re.Z)(e,"\u0275fac",function(r){return new(r||n)($.LFG(oi.Dh),$.LFG(oi.xv,8),$.LFG(zf,8),$.LFG(NI,8),$.LFG($.Lbi),$.LFG($.R0b),$.LFG(Ce.HU),$.LFG(Kf,8),$.LFG(kI,8),$.LFG(lt.zQ,8),$.LFG(lt.Qv,8),$.LFG(lt.L6,8),$.LFG(lt._Q,8),$.LFG(lt.rT,8),$.LFG(lt.lh,8),$.LFG(lt.f7,8),$.LFG(Ce.Rf,8))}),(0,Re.Z)(e,"\u0275prov",$.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})(),FI=(()=>{var n;class e{constructor(){SI.Z.registerVersion("angularfire",Ce.q4.full,"fst-compat")}static enablePersistence(r){return{ngModule:e,providers:[{provide:zf,useValue:!0},{provide:Kf,useValue:r}]}}}return n=e,(0,Re.Z)(e,"\u0275fac",function(r){return new(r||n)}),(0,Re.Z)(e,"\u0275mod",$.oAB({type:n})),(0,Re.Z)(e,"\u0275inj",$.cJS({providers:[$f]})),e})()}}]);