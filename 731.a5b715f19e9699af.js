"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[731],{731:(S,h,a)=>{a.r(h),a.d(h,{UserTrayComponent:()=>W});var m=a(5861),c=a(1180),u=a(553),f=a(8645),y=a(5619),T=a(7328),E=a(2572),C=a(3019),x=a(9773),M=a(2181),d=a(7398),v=a(4664),A=a(3620),n=a(6825),t=a(5879),O=a(9782),B=a(5579),P=a(2413),U=a(9339),g=a(6814),Z=a(5187),D=a(1601);function I(s,_){1&s&&(t.TgZ(0,"div",5)(1,"div",6)(2,"span",7),t._uU(3,"Notification is alived."),t.qZA()()())}function L(s,_){if(1&s&&(t.TgZ(0,"span",20),t._uU(1),t.qZA()),2&s){const o=_.$implicit;t.Q6J("@shakeItTrigger",void 0),t.xp6(1),t.Oqu(o)}}function R(s,_){if(1&s&&(t.ynx(0),t.TgZ(1,"a",25),t._uU(2),t.qZA(),t.BQk()),2&s){const o=t.oxw().$implicit;t.xp6(1),t.s9C("routerLink",o.anchorLink),t.Q6J("fragment",o.anchorId),t.xp6(1),t.Oqu(o.title)}}function k(s,_){if(1&s&&(t.ynx(0),t._uU(1),t.BQk()),2&s){const o=t.oxw().$implicit;t.xp6(1),t.Oqu(o.title)}}const $=function(s){return{id:s}};function K(s,_){if(1&s){const o=t.EpF();t.TgZ(0,"tr",8)(1,"td",21),t.YNc(2,R,3,3,"ng-container",0),t.YNc(3,k,2,1,"ng-container",0),t.qZA(),t.TgZ(4,"td",22),t.ALo(5,"date"),t.TgZ(6,"a",23),t._uU(7),t.ALo(8,"relativeTime"),t.qZA()(),t.TgZ(9,"td")(10,"input",24),t.NdJ("click",function(i){const l=t.CHM(o).$implicit,p=t.oxw(3);return t.KtG(p.onClickRead(i,l))}),t.qZA()()()}if(2&s){const o=_.$implicit;t.xp6(1),t.hYB("title","Title: ",o.title,"\n\n",o.body,""),t.xp6(1),t.Q6J("ngIf",o.anchorLink),t.xp6(1),t.Q6J("ngIf",!o.anchorLink),t.xp6(1),t.s9C("title",t.xi3(5,9,o.createdAt.toDate(),"yyyy-MM-dd HH:MM")),t.xp6(2),t.Q6J("queryParams",t.VKq(14,$,o.id)),t.xp6(1),t.Oqu(t.lcZ(8,12,o.createdAt.toDate())),t.xp6(3),t.Q6J("disabled",o.hasRead)("checked",!!o.hasRead)}}function N(s,_){if(1&s){const o=t.EpF();t.TgZ(0,"div")(1,"div",8)(2,"div",9)(3,"button",10),t.NdJ("click",function(i){t.CHM(o);const r=t.oxw(2);return t.KtG(r.onClickNext(i))}),t._UZ(4,"img",11),t.qZA(),t.TgZ(5,"button",12),t.NdJ("click",function(i){t.CHM(o);const r=t.oxw(2);return t.KtG(r.onClickPrevious(i))}),t._UZ(6,"img",13),t.qZA(),t.YNc(7,L,2,2,"span",14),t.ALo(8,"async"),t.qZA(),t.TgZ(9,"div",15)(10,"table",16),t.YNc(11,K,11,16,"tr",17),t.qZA()(),t.TgZ(12,"div",9)(13,"button",18),t.NdJ("click",function(i){t.CHM(o);const r=t.oxw(2);return t.KtG(r.onClickReadAll(i))}),t._uU(14,"Read All"),t._UZ(15,"img",19),t.qZA()()()()}if(2&s){const o=t.oxw(2);t.xp6(7),t.Q6J("ngIf",t.lcZ(8,3,o.pagingMessage$)),t.xp6(3),t.Q6J("@notificationItemTrigger",o.pageNavigationState),t.xp6(1),t.Q6J("ngForOf",o.notifications)}}function b(s,_){if(1&s){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t.NdJ("click",function(i){t.CHM(o);const r=t.oxw();return t.KtG(r.onClickTraySpinner(i))}),t._UZ(2,"img",2),t.YNc(3,I,4,0,"div",3),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"div",4),t.ALo(6,"async"),t.YNc(7,N,16,5,"div",0),t.qZA(),t.BQk()}if(2&s){const o=t.oxw();t.xp6(3),t.Q6J("ngIf",t.lcZ(4,4,o.hasMessage$)),t.xp6(2),t.Udp("left",t.lcZ(6,6,o.trayLeft$),"px"),t.xp6(2),t.Q6J("ngIf",o.isShowingList)}}let W=(()=>{var s;class _{constructor(e,i,r,l){(0,c.Z)(this,"auth",void 0),(0,c.Z)(this,"store",void 0),(0,c.Z)(this,"funcs",void 0),(0,c.Z)(this,"router",void 0),(0,c.Z)(this,"NotificationLimit",10),(0,c.Z)(this,"destroy$",new f.x),(0,c.Z)(this,"query$",new y.X(p=>p.limit(this.NotificationLimit))),(0,c.Z)(this,"pagingMessage$",void 0),(0,c.Z)(this,"message$",new f.x),(0,c.Z)(this,"clickModal$",new f.x),(0,c.Z)(this,"hasMessage$",void 0),(0,c.Z)(this,"isShowingList",!1),(0,c.Z)(this,"isActive",!1),(0,c.Z)(this,"notificationsSave",[]),(0,c.Z)(this,"notifications",[]),(0,c.Z)(this,"pageNavigationState",void 0),(0,c.Z)(this,"trayLeft$",new T.t),this.auth=e,this.store=i,this.funcs=r,this.router=l}ngOnInit(){this.auth.clientSideUser$.pipe((0,x.R)(this.destroy$)).subscribe(i=>{this.isActive=!!i});const e=this.auth.clientSideUser$.pipe((0,M.h)(i=>!!i),(0,d.U)(i=>`/users/v1/protected/${i.uid}/tray/`));this.hasMessage$=e.pipe((0,v.w)(i=>this.store.collection(i,l=>l.where("hasRead","==",!1)).valueChanges()),(0,d.U)(i=>i.length>0)),(0,E.a)(e,this.query$).pipe((0,v.w)(([i,r])=>this.store.collection(i,p=>r(p.orderBy("createdAt","desc"))).valueChanges({idField:"id"})),(0,x.R)(this.destroy$)).subscribe(i=>{if(0===i.length)return this.notifications=this.notificationsSave,this.pageNavigationState="nomore",void this.message$.next("\u3053\u308c\u4ee5\u4e0a\u901a\u77e5\u306f\u3042\u308a\u307e\u305b\u3093\u3002");this.pageNavigationState="enter",this.notifications=i}),this.pagingMessage$=(0,C.T)(this.message$,this.message$.pipe((0,A.b)(2e3),(0,d.U)(()=>null)),this.clickModal$.pipe((0,d.U)(()=>null)))}ngOnDestroy(){this.destroy$.next()}onClickTraySpinner(e){(0,u.eM)("onClickTraySpinner()",e),this.trayLeft$.next(e.x-300),this.isShowingList=!0}prepareToClick(e){e.stopPropagation(),this.clickModal$.next()}onClickRead(e,i){var r=this;return(0,m.Z)(function*(){(0,u.eM)("onClickRead()",e),r.prepareToClick(e);const l={id:i.id};yield r.funcs.call("setDoneTray",l)})()}onClickReadAll(e){var i=this;return(0,m.Z)(function*(){(0,u.eM)("onClickReadAll()",e),i.prepareToClick(e),yield i.funcs.call("setDoneTrayAll")})()}onClickNext(e){if((0,u.eM)("onClickNext()",e),this.prepareToClick(e),this.pageNavigationState="next",0===this.notifications.length)return void this.query$.next(r=>r);const i=this.notifications[0];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(r=>r.endBefore(i.createdAt).limitToLast(this.NotificationLimit))}onClickPrevious(e){if((0,u.eM)("onClickPrevious()",e),this.prepareToClick(e),0===this.notifications.length)return;this.pageNavigationState="previous";const i=this.notifications[this.notifications.length-1];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(r=>r.startAfter(i.createdAt).limit(this.NotificationLimit))}}return s=_,(0,c.Z)(_,"\u0275fac",function(e){return new(e||s)(t.Y36(O.e),t.Y36(B.ST),t.Y36(P.c),t.Y36(U.Z))}),(0,c.Z)(_,"\u0275cmp",t.Xpm({type:s,selectors:[["app-user-tray"]],decls:1,vars:1,consts:[[4,"ngIf"],["data-bs-toggle","dropdown",3,"click"],["src","/assets/octicons/bell.svg",1,"",2,"width","100%","cursor","pointer"],["style","position: absolute; top: 0px;",4,"ngIf"],[1,"dropdown-menu",2,"max-height","400px","width","400px","position","fixed","top","50px"],[2,"position","absolute","top","0px"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning"],[1,"visually-hidden"],[1,"m-3"],[1,"m-2"],["title","\u65b0\u3057\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-left.svg",1,"mx-3"],["title","\u53e4\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-right.svg",1,"mx-3"],["class","text-warning mx-2",4,"ngIf"],[2,"height","250px","overflow-y","scroll","overflow-x","hidden"],[2,"width","100%"],["class","m-3",4,"ngFor","ngForOf"],["title","\u3059\u3079\u3066\u65e2\u8aad\u306b\u3057\u307e\u3059",1,"btn","btn-warning",3,"click"],["src","/assets/octicons/check.svg",1,"mx-2"],[1,"text-warning","mx-2"],[2,"overflow-x","hidden",3,"title"],[3,"title"],["routerLink","/Gitfire/tray",3,"queryParams"],["type","checkbox","title","\u65e2\u8aad\u306b\u3059\u308b\u5834\u5408\u306f check \u3057\u3066\u304f\u3060\u3055\u3044\u3002",1,"m-2",3,"disabled","checked","click"],[3,"routerLink","fragment"]],template:function(e,i){1&e&&t.YNc(0,b,8,8,"ng-container",0),2&e&&t.Q6J("ngIf",i.isActive)},dependencies:[g.sg,g.O5,Z.rH,g.Ov,g.uU,D.a],styles:["[_nghost-%COMP%]{cursor:initial}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:snow}"],data:{animation:[(0,n.X$)("shakeItTrigger",[(0,n.eR)(":leave",[(0,n.oB)({transform:"none",position:"absolute"}),(0,n.jt)("300ms ease-in-out",(0,n.oB)({opacity:0,transform:"translateY(-100%)"}))]),(0,n.eR)(":enter",[(0,n.oB)({transform:"none",position:"absolute"}),(0,n.jt)("1000ms ease-in-out",(0,n.F4)([(0,n.oB)({transform:"translate3d(-4px, 0, 0)",offset:.1}),(0,n.oB)({transform:"translate3d(4px, 0, 0)",offset:.2}),(0,n.oB)({transform:"translate3d(-3px, 0, 0)",offset:.3}),(0,n.oB)({transform:"translate3d(3px, 0, 0)",offset:.4}),(0,n.oB)({transform:"translate3d(-3px, 0, 0)",offset:.5}),(0,n.oB)({transform:"translate3d(2px, 0, 0)",offset:.6}),(0,n.oB)({transform:"translate3d(-2px, 0, 0)",offset:.7}),(0,n.oB)({transform:"translate3d(1px, 0, 0)",offset:.8}),(0,n.oB)({transform:"translate3d(-1px, 0, 0)",offset:.9})]))])]),(0,n.X$)("notificationItemTrigger",[(0,n.eR)(":enter",[(0,n.IO)("tr",[(0,n.oB)({opacity:0,transform:"translateX(-100%)"}),(0,n.EY)(20,[(0,n.jt)("300ms ease-in-out",(0,n.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.eR)("* => previous",[(0,n.IO)("tr",[(0,n.oB)({}),(0,n.EY)(20,[(0,n.jt)("300ms ease-in-out",(0,n.oB)({opacity:0,transform:"translateX(-100%)"}))])],{optional:!0})]),(0,n.eR)("previous => enter",[(0,n.IO)("tr",[(0,n.oB)({opacity:0,transform:"translateX(100%)"}),(0,n.EY)(20,[(0,n.jt)("300ms 100ms ease-in-out",(0,n.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.eR)("* => next",[(0,n.IO)("tr",[(0,n.oB)({}),(0,n.EY)(20,[(0,n.jt)("300ms ease-in-out",(0,n.oB)({opacity:0,transform:"translateX(100%)"}))])],{optional:!0})]),(0,n.eR)("next => enter",[(0,n.IO)("tr",[(0,n.oB)({opacity:0,transform:"translateX(-100%)"}),(0,n.EY)(20,[(0,n.jt)("300ms 100ms ease-in-out",(0,n.oB)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.eR)("* => nomore",[(0,n.oB)({opacity:0,backgroundColor:"red"}),(0,n.jt)("300ms 100ms ease-in-out",(0,n.oB)({opacity:1,backgroundColor:"*"}))])])]}})),_})()}}]);