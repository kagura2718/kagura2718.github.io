"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[91],{5091:(Q,C,s)=>{s.r(C),s.d(C,{S2mapModule:()=>P});var h=s(177),p=s(9417),y=s(1188),T=s(467),B=s(1356),I=s(1692),r=s(5312),S=s(6977),w=s(152),$=s(4412),d=s(1413),E=s(4572),e=s(4438),x=s(1639),b=s(8001),L=s(2771),R=s(605),v=s(5558),M=s(6354),A=s(3294),G=s(5964),V=s(9568),O=s(345);const F=["hostingSpan"];let U=(()=>{class i{http;sanitizer;error=new e.bkB;src;fill;stroke;height;width;hostingSpan;contents$;svg$;destroy$=new d.B;src$=new L.m;width$=new L.m;height$=new L.m;constructor(t,n){this.http=t,this.sanitizer=n}ngOnInit(){this.contents$=this.src$.pipe((0,v.n)(t=>this.http.fetchText(t)),(0,M.T)(t=>this.sanitizer.bypassSecurityTrustHtml(t))),this.svg$=this.contents$.pipe((0,v.n)(t=>(0,R.Y)(200)),(0,M.T)(t=>this.getUniqueSvgElement()),(0,A.F)(),(0,G.p)(t=>null!==t),(0,V.t)(1)),this.connectAttribute(t=>`${t}`,"width",this.width$),this.connectAttribute(t=>`${t}`,"height",this.height$)}ngOnDestroy(){this.destroy$.next()}connectAttribute(t,n,o){o.pipe((0,v.n)(a=>this.svg$.pipe((0,M.T)(l=>[l,t(a)]))),(0,S.Q)(this.destroy$)).subscribe(([a,l])=>{a.setAttribute(n,l)})}getUniqueSvgElement(){const t=this.hostingSpan.nativeElement.getElementsByTagName("svg");return 1!==t.length?null:t[0]}validateSrc(t){if("string"!=typeof t)return!1;const n=t;if(!n.startsWith("/"))throw new Error(`Currently just support hosting inline svg ${n}`);return!0}ngOnChanges(t){if("src"in t){const n=t.src.currentValue;if(!this.validateSrc(n))return;this.src$.next(n)}if("width"in t){const n=t.width.currentValue;if("number"!=typeof n)throw new Error(`Not a number ${n}`);this.width$.next(n)}if("height"in t){const n=t.height.currentValue;if("number"!=typeof n)throw new Error(`Not a number ${n}`);this.height$.next(t.height.currentValue)}}static \u0275fac=function(n){return new(n||i)(e.rXU(b.kl),e.rXU(O.up))};static \u0275cmp=e.VBU({type:i,selectors:[["app-inline-svg"]],viewQuery:function(n,o){if(1&n&&e.GBs(F,5),2&n){let a;e.mGM(a=e.lsd())&&(o.hostingSpan=a.first)}},inputs:{src:"src",fill:"fill",stroke:"stroke",height:"height",width:"width"},outputs:{error:"error"},features:[e.OA$],decls:3,vars:7,consts:[["hostingSpan",""],[3,"innerHTML"]],template:function(n,o){1&n&&(e.nrm(0,"span",1,0),e.nI1(2,"async")),2&n&&(e.xc7("fill",o.fill)("stroke",o.stroke),e.Y8G("innerHTML",e.bMT(2,5,o.contents$),e.npT))},dependencies:[h.Jj]})}return i})();var j=s(3955);function D(i,J){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("Zoom: ",t.mapZoomLevel,"")}}const X=[{path:"map/index.htm",redirectTo:"map"},{path:"map",component:(()=>{class i{translate;http;cellMainScales={};cellSubScales={};googleMap;S2LEVEL_MAX=20;S2LevelRange=[1,this.S2LEVEL_MAX];S2LevelSubScaleMax=3;inputS2Level=1;inputS2LevelSubScale=0;inputS2Level$=new $.t(this.inputS2Level);inputS2LevelSubScale$=new $.t(this.inputS2LevelSubScale);mapBounds$=new d.B;isDeveloper=!r.cA.production;mapZoomLevel;destroy$=new d.B;constructor(t,n){this.translate=t,this.http=n}ngOnInit(){var t=this;return(0,T.A)(function*(){const o=yield new I.aH({apiKey:r.cA.googleMapApiKey,version:"weekly",libraries:["places"]}).load();(0,r.C_)("Google API loaded",o);const a={center:{lat:r.cA.MapDefaultLocation.lat,lng:r.cA.MapDefaultLocation.lng},zoom:7},l=document.getElementById("toolsS2MapMain");t.googleMap=new o.maps.Map(l,a),t.googleMap.addListener("bounds_changed",t.onMapBoundsChanged.bind(t)),(0,E.z)([t.inputS2Level$,t.mapBounds$]).pipe((0,S.Q)(t.destroy$)).subscribe(([c,u])=>{const m=t.googleMap.getZoom();"number"==typeof m?(t.S2LevelRange=t.getZoomLevelS2Range(m),t.S2LevelSubScaleMax=Math.min(Math.max(t.S2LEVEL_MAX-c,0),3),t.drawMainScales(c,u)):(0,r.sJ)("Unexpectedly failed to get zoom",m)}),(0,E.z)([t.inputS2Level$,t.inputS2LevelSubScale$,t.mapBounds$]).pipe((0,w.B)(100),(0,S.Q)(t.destroy$)).subscribe(([c,u,m])=>{t.drawSubScales(c+u,m)})})()}ngOnDestroy(){this.destroy$.next()}onChangeLevel(t){this.inputS2Level$.next(t)}clearScales(t){for(const n in t)t[n].setMap(null),delete t[n]}drawSubScales(t,n){this.clearScales(this.cellSubScales);const o=this.googleMap.getCenter();if(!o)return void(0,r.sJ)("Unexpectedly failed to get map center");const a=this.toS2Cell(o,t);this.drawWithNeighbors(this.cellSubScales,n,a,.3)}drawMainScales(t,n){this.clearScales(this.cellMainScales);const o=this.googleMap.getCenter();if(!o)return;const a=this.toS2Cell(o,t);this.drawWithNeighbors(this.cellMainScales,n,a)}drawWithNeighbors(t,n,o,a=1){const l=this.toGoogleBounds(o);if(!n.intersects(l))return;const c=o.toHilbertQuadkey();if(c in t)return;const u=o.getCornerLatLngs(),m=u.map(g=>this.toGoogleLatLng(g));m.push(this.toGoogleLatLng(u[0]));const f=new google.maps.Polyline({path:m,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.8*a,strokeWeight:1*a,map:this.googleMap});t[c]=f;for(const g of o.getNeighbors()){const H=g.getLatLng();new google.maps.LatLng(this.toGoogleLatLng(H)),this.drawWithNeighbors(t,n,g,a)}}toS2Cell(t,n){return B.S2.S2Cell.FromLatLng({lat:t.lat(),lng:t.lng()},n)}toGoogleBounds(t){const n=t.getCornerLatLngs();return new google.maps.LatLngBounds(n[0],n[1]).extend(n[2]).extend(n[3])}toGoogleLatLng(t){return{lat:t.lat,lng:t.lng}}onMapBoundsChanged(){const t=this.googleMap.getZoom();if(!t)return;this.mapZoomLevel=t;const n=this.getZoomLevelS2Range(t);if(this.inputS2Level<n[0]||n[1]<this.inputS2Level){const a=this.clamp(this.inputS2Level,n[0],n[1]);this.inputS2Level=a,this.inputS2Level$.next(a)}const o=this.googleMap.getBounds();o?this.mapBounds$.next(o):(0,r.sJ)("Unexpectedly failed to get bounds.")}clamp(t,n,o){return Math.trunc(Math.min(o,Math.max(n,t)))}getZoomLevelS2Range(t){const n=this.clamp(Math.trunc(t),0,22),o=[{min:1,max:3},{min:1,max:6},{min:1,max:7},{min:1,max:7},{min:1,max:8},{min:1,max:8},{min:1,max:9},{min:1,max:9},{min:1,max:10},{min:1,max:11},{min:1,max:12},{min:1,max:12},{min:1,max:13},{min:1,max:13},{min:1,max:14},{min:8,max:15},{min:8,max:16},{min:9,max:17},{min:9,max:18},{min:10,max:19},{min:10,max:this.S2LEVEL_MAX},{min:11,max:this.S2LEVEL_MAX},{min:12,max:this.S2LEVEL_MAX}];return[o[n].min,o[n].max]}onChangeSubScale(t){this.inputS2LevelSubScale$.next(t)}static \u0275fac=function(n){return new(n||i)(e.rXU(x.EY),e.rXU(b.kl))};static \u0275cmp=e.VBU({type:i,selectors:[["app-s2-map"]],decls:18,vars:22,consts:[["id","toolsS2MapMain",2,"width","100%","height","600px"],[4,"ngIf"],[1,"form-group","m-2"],[1,"input-group","row","m-2"],[1,"col-1","form-check-label","p-2","text-end",3,"title"],[1,"col-2"],["type","number",1,"form-control",3,"ngModelChange","min","max","ngModel"],["fill","#7878dd","src","/assets/octicons/question.svg",1,"col-1",3,"title"]],template:function(n,o){1&n&&(e.nrm(0,"div",0),e.DNE(1,D,2,1,"span",1),e.j41(2,"div",2)(3,"div",3)(4,"label",4),e.nI1(5,"translate"),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"span",5)(9,"input",6),e.mxI("ngModelChange",function(l){return e.DH7(o.inputS2Level,l)||(o.inputS2Level=l),l}),e.bIt("ngModelChange",function(l){return o.onChangeLevel(l)}),e.k0s()(),e.j41(10,"label",4),e.nI1(11,"translate"),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.j41(14,"span",5)(15,"input",6),e.mxI("ngModelChange",function(l){return e.DH7(o.inputS2LevelSubScale,l)||(o.inputS2LevelSubScale=l),l}),e.bIt("ngModelChange",function(l){return o.onChangeSubScale(l)}),e.k0s()(),e.nrm(16,"app-inline-svg",7),e.nI1(17,"translate"),e.k0s()()),2&n&&(e.R7$(),e.Y8G("ngIf",o.isDeveloper),e.R7$(3),e.FS9("title",e.bMT(5,12,"TOOLTIP_S2_CELL_LEVEL")),e.R7$(2),e.JRh(e.bMT(7,14,"LABEL_S2_CELL_LEVEL")),e.R7$(3),e.Y8G("min",o.S2LevelRange[0])("max",o.S2LevelRange[1]),e.R50("ngModel",o.inputS2Level),e.R7$(),e.FS9("title",e.bMT(11,16,"TOOLTIP_S2_CELL_SUB_SCALE")),e.R7$(2),e.JRh(e.bMT(13,18,"LABEL_S2_CELL_SUB_SCALES")),e.R7$(3),e.Y8G("min",0)("max",o.S2LevelSubScaleMax),e.R50("ngModel",o.inputS2LevelSubScale),e.R7$(),e.FS9("title",e.bMT(17,20,"TOOLTIP_S2CELL_LEVEL")))},dependencies:[h.bT,p.me,p.Q0,p.BC,p.VZ,p.zX,p.vS,U,j.D9]})}return i})(),data:{gitweeTitle:"TITLE_TOOL_S2GEO_MAP"}}];let z=(()=>{class i{constructor(){(0,r.Oi)("S2mapRoutingModule.constructor()")}static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({imports:[y.iI.forChild(X),y.iI]})}return i})();var N=s(7281),Z=s(5427);let P=(()=>{class i{constructor(){(0,r.rD)("Dynamically loaded S2mapModule")}static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({providers:[{provide:x.fm,useValue:"app/tools/s2map/s2map/"}],imports:[h.MD,p.YN,N.$,Z.j,z]})}return i})()}}]);