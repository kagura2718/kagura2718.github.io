import{b as nt,d as it,e as rt,f as ot}from"./chunk-2BCBPMCF.js";import{a as oe}from"./chunk-YG3PNK7P.js";import"./chunk-M5PFS4RI.js";import{c as tt}from"./chunk-QYQQ63RC.js";import{Ba as V,Bb as ke,Dc as je,E as Ce,Eb as te,Fb as pe,Gb as Ge,H as Ie,Ha as $,Ib as fe,Jb as me,Ka as z,Kb as de,La as ee,M as Oe,Nc as Se,Ob as ne,Oc as H,P as Q,Pc as Je,Qc as He,R as J,Rc as Xe,Tc as ie,Va as Pe,Wc as We,Xa as Ve,Xb as B,Yb as R,Yc as Ke,_ as Y,ab as k,b as j,bb as G,bd as Qe,c as ue,cb as q,d as W,db as ge,dd as Ye,gb as De,la as Ne,ld as ze,md as et,nb as Ue,o as K,p as he,pb as ce,rb as Be,rd as re,sa as Ae,sc as Ze,ub as Re,vb as qe,w as ye,wb as $e,ya as xe,z as Me}from"./chunk-WNZQYDYN.js";import"./chunk-EU2KAMEK.js";import{c as Fe,e as _e,g as pt}from"./chunk-VB56BUGO.js";var ae=_e((at,X)=>{(function(l,e){typeof define=="function"&&define.amd?define([],e):typeof Fe=="function"&&typeof X=="object"&&X&&X.exports?X.exports=e():(l.dcodeIO=l.dcodeIO||{}).Long=e()})(at,function(){"use strict";function l(r,t,g){this.low=r|0,this.high=t|0,this.unsigned=!!g}l.prototype.__isLong__,Object.defineProperty(l.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(r){return(r&&r.__isLong__)===!0}l.isLong=e;var a={},h={};function m(r,t){var g,L,E;return t?(r>>>=0,(E=0<=r&&r<256)&&(L=h[r],L)?L:(g=d(r,(r|0)<0?-1:0,!0),E&&(h[r]=g),g)):(r|=0,(E=-128<=r&&r<128)&&(L=a[r],L)?L:(g=d(r,r<0?-1:0,!1),E&&(a[r]=g),g))}l.fromInt=m;function f(r,t){if(isNaN(r)||!isFinite(r))return t?b:S;if(t){if(r<0)return b;if(r>=p)return Te}else{if(r<=-v)return N;if(r+1>=v)return Ee}return r<0?f(-r,t).neg():d(r%c|0,r/c|0,t)}l.fromNumber=f;function d(r,t,g){return new l(r,t,g)}l.fromBits=d;var I=Math.pow;function i(r,t,g){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return S;if(typeof t=="number"?(g=t,t=!1):t=!!t,g=g||10,g<2||36<g)throw RangeError("radix");var L;if((L=r.indexOf("-"))>0)throw Error("interior hyphen");if(L===0)return i(r.substring(1),t,g).neg();for(var E=f(I(g,8)),T=S,M=0;M<r.length;M+=8){var A=Math.min(8,r.length-M),_=parseInt(r.substring(M,M+A),g);if(A<8){var O=f(I(g,A));T=T.mul(O).add(f(_))}else T=T.mul(E),T=T.add(f(_))}return T.unsigned=t,T}l.fromString=i;function n(r){return r instanceof l?r:typeof r=="number"?f(r):typeof r=="string"?i(r):d(r.low,r.high,r.unsigned)}l.fromValue=n;var o=65536,s=1<<24,c=o*o,p=c*c,v=p/2,w=m(s),S=m(0);l.ZERO=S;var b=m(0,!0);l.UZERO=b;var F=m(1);l.ONE=F;var P=m(1,!0);l.UONE=P;var U=m(-1);l.NEG_ONE=U;var Ee=d(-1,2147483647,!1);l.MAX_VALUE=Ee;var Te=d(-1,-1,!0);l.MAX_UNSIGNED_VALUE=Te;var N=d(0,-2147483648,!1);l.MIN_VALUE=N;var u=l.prototype;return u.toInt=function(){return this.unsigned?this.low>>>0:this.low},u.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},u.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var g=f(t),L=this.div(g),E=L.mul(g).sub(this);return L.toString(t)+E.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var T=f(I(t,6),this.unsigned),M=this,A="";;){var _=M.div(T),O=M.sub(_.mul(T)).toInt()>>>0,C=O.toString(t);if(M=_,M.isZero())return C+A;for(;C.length<6;)C="0"+C;A=""+C+A}},u.getHighBits=function(){return this.high},u.getHighBitsUnsigned=function(){return this.high>>>0},u.getLowBits=function(){return this.low},u.getLowBitsUnsigned=function(){return this.low>>>0},u.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,g=31;g>0&&(t&1<<g)==0;g--);return this.high!=0?g+33:g+1},u.isZero=function(){return this.high===0&&this.low===0},u.isNegative=function(){return!this.unsigned&&this.high<0},u.isPositive=function(){return this.unsigned||this.high>=0},u.isOdd=function(){return(this.low&1)===1},u.isEven=function(){return(this.low&1)===0},u.equals=function(t){return e(t)||(t=n(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},u.eq=u.equals,u.notEquals=function(t){return!this.eq(t)},u.neq=u.notEquals,u.lessThan=function(t){return this.comp(t)<0},u.lt=u.lessThan,u.lessThanOrEqual=function(t){return this.comp(t)<=0},u.lte=u.lessThanOrEqual,u.greaterThan=function(t){return this.comp(t)>0},u.gt=u.greaterThan,u.greaterThanOrEqual=function(t){return this.comp(t)>=0},u.gte=u.greaterThanOrEqual,u.compare=function(t){if(e(t)||(t=n(t)),this.eq(t))return 0;var g=this.isNegative(),L=t.isNegative();return g&&!L?-1:!g&&L?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},u.comp=u.compare,u.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(F)},u.neg=u.negate,u.add=function(t){e(t)||(t=n(t));var g=this.high>>>16,L=this.high&65535,E=this.low>>>16,T=this.low&65535,M=t.high>>>16,A=t.high&65535,_=t.low>>>16,O=t.low&65535,C=0,y=0,x=0,D=0;return D+=T+O,x+=D>>>16,D&=65535,x+=E+_,y+=x>>>16,x&=65535,y+=L+A,C+=y>>>16,y&=65535,C+=g+M,C&=65535,d(x<<16|D,C<<16|y,this.unsigned)},u.subtract=function(t){return e(t)||(t=n(t)),this.add(t.neg())},u.sub=u.subtract,u.multiply=function(t){if(this.isZero()||(e(t)||(t=n(t)),t.isZero()))return S;if(this.eq(N))return t.isOdd()?N:S;if(t.eq(N))return this.isOdd()?N:S;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(w)&&t.lt(w))return f(this.toNumber()*t.toNumber(),this.unsigned);var g=this.high>>>16,L=this.high&65535,E=this.low>>>16,T=this.low&65535,M=t.high>>>16,A=t.high&65535,_=t.low>>>16,O=t.low&65535,C=0,y=0,x=0,D=0;return D+=T*O,x+=D>>>16,D&=65535,x+=E*O,y+=x>>>16,x&=65535,x+=T*_,y+=x>>>16,x&=65535,y+=L*O,C+=y>>>16,y&=65535,y+=E*_,C+=y>>>16,y&=65535,y+=T*A,C+=y>>>16,y&=65535,C+=g*O+L*_+E*A+T*M,C&=65535,d(x<<16|D,C<<16|y,this.unsigned)},u.mul=u.multiply,u.divide=function(t){if(e(t)||(t=n(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?b:S;var g,L,E;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return b;if(t.gt(this.shru(1)))return P;E=b}else{if(this.eq(N)){if(t.eq(F)||t.eq(U))return N;if(t.eq(N))return F;var T=this.shr(1);return g=T.div(t).shl(1),g.eq(S)?t.isNegative()?F:U:(L=this.sub(t.mul(g)),E=g.add(L.div(t)),E)}else if(t.eq(N))return this.unsigned?b:S;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();E=S}for(L=this;L.gte(t);){g=Math.max(1,Math.floor(L.toNumber()/t.toNumber()));for(var M=Math.ceil(Math.log(g)/Math.LN2),A=M<=48?1:I(2,M-48),_=f(g),O=_.mul(t);O.isNegative()||O.gt(L);)g-=A,_=f(g,this.unsigned),O=_.mul(t);_.isZero()&&(_=F),E=E.add(_),L=L.sub(O)}return E},u.div=u.divide,u.modulo=function(t){return e(t)||(t=n(t)),this.sub(this.div(t).mul(t))},u.mod=u.modulo,u.not=function(){return d(~this.low,~this.high,this.unsigned)},u.and=function(t){return e(t)||(t=n(t)),d(this.low&t.low,this.high&t.high,this.unsigned)},u.or=function(t){return e(t)||(t=n(t)),d(this.low|t.low,this.high|t.high,this.unsigned)},u.xor=function(t){return e(t)||(t=n(t)),d(this.low^t.low,this.high^t.high,this.unsigned)},u.shiftLeft=function(t){return e(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?d(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):d(0,this.low<<t-32,this.unsigned)},u.shl=u.shiftLeft,u.shiftRight=function(t){return e(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?d(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):d(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},u.shr=u.shiftRight,u.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),t&=63,t===0)return this;var g=this.high;if(t<32){var L=this.low;return d(L>>>t|g<<32-t,g>>>t,this.unsigned)}else return t===32?d(g,0,this.unsigned):d(g>>>t-32,0,this.unsigned)},u.shru=u.shiftRightUnsigned,u.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},u.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},u.toBytes=function(r){return r?this.toBytesLE():this.toBytesBE()},u.toBytesLE=function(){var r=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24&255,r&255,r>>>8&255,r>>>16&255,r>>>24&255]},u.toBytesBE=function(){var r=this.high,t=this.low;return[r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255]},l})});var st=_e((It,ve)=>{(function(l){"use strict";var e=l.S2={L:{}};e.L.LatLng=function(i,n,o){var s=parseFloat(i,10),c=parseFloat(n,10);if(isNaN(s)||isNaN(c))throw new Error("Invalid LatLng object: ("+i+", "+n+")");return o!==!0&&(s=Math.max(Math.min(s,90),-90),c=(c+180)%360+(c<-180||c===180?180:-180)),{lat:s,lng:c}},e.L.LatLng.DEG_TO_RAD=Math.PI/180,e.L.LatLng.RAD_TO_DEG=180/Math.PI,e.LatLngToXYZ=function(i){var n=e.L.LatLng.DEG_TO_RAD,o=i.lat*n,s=i.lng*n,c=Math.cos(o);return[Math.cos(s)*c,Math.sin(s)*c,Math.sin(o)]},e.XYZToLatLng=function(i){var n=e.L.LatLng.RAD_TO_DEG,o=Math.atan2(i[2],Math.sqrt(i[0]*i[0]+i[1]*i[1])),s=Math.atan2(i[1],i[0]);return e.L.LatLng(o*n,s*n)};var a=function(i){var n=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];return n[0]>n[1]?n[0]>n[2]?0:2:n[1]>n[2]?1:2},h=function(i,n){var o,s;switch(i){case 0:o=n[1]/n[0],s=n[2]/n[0];break;case 1:o=-n[0]/n[1],s=n[2]/n[1];break;case 2:o=-n[0]/n[2],s=-n[1]/n[2];break;case 3:o=n[2]/n[0],s=n[1]/n[0];break;case 4:o=n[2]/n[1],s=-n[0]/n[1];break;case 5:o=-n[1]/n[2],s=-n[0]/n[2];break;default:throw{error:"Invalid face"}}return[o,s]};e.XYZToFaceUV=function(i){var n=a(i);i[n]<0&&(n+=3);var o=h(n,i);return[n,o]},e.FaceUVToXYZ=function(i,n){var o=n[0],s=n[1];switch(i){case 0:return[1,o,s];case 1:return[-o,1,s];case 2:return[-o,-s,1];case 3:return[-1,-s,-o];case 4:return[s,-1,-o];case 5:return[s,o,-1];default:throw{error:"Invalid face"}}};var m=function(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))};e.STToUV=function(i){return[m(i[0]),m(i[1])]};var f=function(i){return i>=0?.5*Math.sqrt(1+3*i):1-.5*Math.sqrt(1-3*i)};e.UVToST=function(i){return[f(i[0]),f(i[1])]},e.STToIJ=function(i,n){var o=1<<n,s=function(c){var p=Math.floor(c*o);return Math.max(0,Math.min(o-1,p))};return[s(i[0]),s(i[1])]},e.IJToST=function(i,n,o){var s=1<<n;return[(i[0]+o[0])/s,(i[1]+o[1])/s]};var d=function(i,n,o,s){var c,p;if(s==0){o==1&&(n.x=i-1-n.x,n.y=i-1-n.y);var v=n.x;n.x=n.y,n.y=v}},I=function(i,n,o,s){var c={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};typeof s!="number"&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var p=s%2?"d":"a",v=[],w=o-1;w>=0;w--){var S=1<<w,b=i&S?1:0,F=n&S?1:0,P=c[p][b*2+F];v.push(P[0]),p=P[1]}return v};e.S2Cell=function(){},e.S2Cell.FromHilbertQuadKey=function(i){var n=i.split("/"),o=parseInt(n[0]),s=n[1],c=s.length,p={x:0,y:0},v,w,S,b,F,P;for(v=c-1;v>=0;v--)w=c-v,S=s[v],b=0,F=0,S==="1"?F=1:S==="2"?(b=1,F=1):S==="3"&&(b=1),P=Math.pow(2,w-1),d(P,p,b,F),p.x+=P*b,p.y+=P*F;if(o%2===1){var U=p.x;p.x=p.y,p.y=U}return e.S2Cell.FromFaceIJ(parseInt(o),[p.x,p.y],w)},e.S2Cell.FromLatLng=function(i,n){if(!i.lat&&i.lat!==0||!i.lng&&i.lng!==0)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var o=e.LatLngToXYZ(i),s=e.XYZToFaceUV(o),c=e.UVToST(s[1]),p=e.STToIJ(c,n);return e.S2Cell.FromFaceIJ(s[0],p,n)},e.S2Cell.FromFaceIJ=function(i,n,o){var s=new e.S2Cell;return s.face=i,s.ij=n,s.level=o,s},e.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},e.S2Cell.prototype.getLatLng=function(){var i=e.IJToST(this.ij,this.level,[.5,.5]),n=e.STToUV(i),o=e.FaceUVToXYZ(this.face,n);return e.XYZToLatLng(o)},e.S2Cell.prototype.getCornerLatLngs=function(){for(var i=[],n=[[0,0],[0,1],[1,1],[1,0]],o=0;o<4;o++){var s=e.IJToST(this.ij,this.level,n[o]),c=e.STToUV(s),p=e.FaceUVToXYZ(this.face,c);i.push(e.XYZToLatLng(p))}return i},e.S2Cell.prototype.getFaceAndQuads=function(){var i=I(this.ij[0],this.ij[1],this.level,this.face);return[this.face,i]},e.S2Cell.prototype.toHilbertQuadkey=function(){var i=I(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+i.join("")},e.latLngToNeighborKeys=e.S2Cell.latLngToNeighborKeys=function(i,n,o){return e.S2Cell.FromLatLng({lat:i,lng:n},o).getNeighbors().map(function(s){return s.toHilbertQuadkey()})},e.S2Cell.prototype.getNeighbors=function(){var i=function(p,v,w){var S=1<<w;if(v[0]>=0&&v[1]>=0&&v[0]<S&&v[1]<S)return e.S2Cell.FromFaceIJ(p,v,w);var b=e.IJToST(v,w,[.5,.5]),F=e.STToUV(b),P=e.FaceUVToXYZ(p,F),U=e.XYZToFaceUV(P);return p=U[0],F=U[1],b=e.UVToST(F),v=e.STToIJ(b,w),e.S2Cell.FromFaceIJ(p,v,w)},n=this.face,o=this.ij[0],s=this.ij[1],c=this.level;return[i(n,[o-1,s],c),i(n,[o,s-1],c),i(n,[o+1,s],c),i(n,[o,s+1],c)]},e.FACE_BITS=3,e.MAX_LEVEL=30,e.POS_BITS=2*e.MAX_LEVEL+1,e.facePosLevelToId=e.S2Cell.facePosLevelToId=e.fromFacePosLevel=function(i,n,o){var s=l.dcodeIO&&l.dcodeIO.Long||ae(),c,p,v;for(o||(o=n.length),n.length>o&&(n=n.substr(0,o)),c=s.fromString(i.toString(10),!0,10).toString(2);c.length<e.FACE_BITS;)c="0"+c;for(p=s.fromString(n,!0,4).toString(2);p.length<2*o;)p="0"+p;for(v=c+p,v+="1";v.length<e.FACE_BITS+e.POS_BITS;)v+="0";return s.fromString(v,!0,2).toString(10)},e.keyToId=e.S2Cell.keyToId=e.toId=e.toCellId=e.fromKey=function(i){var n=i.split("/");return e.fromFacePosLevel(n[0],n[1],n[1].length)},e.idToKey=e.S2Cell.idToKey=e.S2Cell.toKey=e.toKey=e.fromId=e.fromCellId=e.S2Cell.toHilbertQuadkey=e.toHilbertQuadkey=function(i){for(var n=l.dcodeIO&&l.dcodeIO.Long||ae(),o=n.fromString(i,!0,10).toString(2);o.length<e.FACE_BITS+e.POS_BITS;)o="0"+o;for(var s=o.lastIndexOf("1"),c=o.substring(0,3),p=o.substring(3,s),v=p.length/2,w=n.fromString(c,!0,2).toString(10),S=n.fromString(p,!0,2).toString(4);S.length<v;)S="0"+S;return w+"/"+S},e.keyToLatLng=e.S2Cell.keyToLatLng=function(i){var n=e.S2Cell.FromHilbertQuadKey(i);return n.getLatLng()},e.idToLatLng=e.S2Cell.idToLatLng=function(i){var n=e.idToKey(i);return e.keyToLatLng(n)},e.S2Cell.latLngToKey=e.latLngToKey=e.latLngToQuadkey=function(i,n,o){if(isNaN(o)||o<1||o>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return e.S2Cell.FromLatLng({lat:i,lng:n},o).toHilbertQuadkey()},e.stepKey=function(i,n){var o=l.dcodeIO&&l.dcodeIO.Long||ae(),s=i.split("/"),c=s[0],p=s[1],v=s[1].length,w=o.fromString(p,!0,4),S;n>0?S=w.add(Math.abs(n)):n<0&&(S=w.subtract(Math.abs(n)));var b=S.toString(4);for(b==="0"&&console.warning(new Error("face/position wrapping is not yet supported"));b.length<v;)b="0"+b;return c+"/"+b},e.S2Cell.prevKey=e.prevKey=function(i){return e.stepKey(i,-1)},e.S2Cell.nextKey=e.nextKey=function(i){return e.stepKey(i,1)}})(typeof ve<"u"?ve.exports:window)});var gt=pt(st());function ft(l,e){l.src=e}var mt=l=>{var e,a,h,m="The Google Maps JavaScript API",f="google",d="importLibrary",I="__ib__",i=document,n=window,o=n[f]||(n[f]={}),s=o.maps||(o.maps={}),c=new Set,p=new URLSearchParams,v=()=>e||(e=new Promise(async(w,S)=>{await(a=i.createElement("script")),p.set("libraries",[...c]+"");for(h in l)p.set(h.replace(/[A-Z]/g,b=>"_"+b[0].toLowerCase()),l[h]);p.set("callback",f+".maps."+I),ft(a,"https://maps.googleapis.com/maps/api/js?"+p),s[I]=w,a.onerror=()=>e=S(Error(m+" could not load.")),a.nonce=i.querySelector("script[nonce]")?.nonce||"",i.head.append(a)}));s[d]?console.warn(m+" only loads once. Ignoring:",l):s[d]=(w,...S)=>c.add(w)&&v().then(()=>s[d](w,...S))};var dt=l=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(l)}) will be ignored.`,St=l=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(l)}) will be ignored.`,vt="No options were set before calling importLibrary. Make sure to configure the loader using setOptions().",Lt="There already is a script loading the Google Maps JavaScript API, and no google.maps.importLibrary function is defined. @googlemaps/js-api-loader will proceed to bootstrap the API with the specified options, but the existing script might cause problems using the API. Make sure to remove the script loading the API.",lt=!1,be=lt?l=>{console.warn(`[@googlemaps/js-api-loader] ${l}`)}:()=>{},bt=lt?l=>{console.info(`[@googlemaps/js-api-loader] ${l}`)}:()=>{};var wt=!1,Le=!1;function ut(l){if(Le){be(dt(l));return}Et(l),Le=!0}async function ht(l){if(Le||be(vt),!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(l)}function Et(l){let e=!!window.google?.maps?.importLibrary;e?bt(St(l)):wt&&document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')&&be(Lt),e||mt(l)}var _t=["hostingSpan"],se=class l{constructor(e,a){this.http=e;this.sanitizer=a}error=new Ne;src;fill;stroke;height;width;hostingSpan;contents$;svg$;destroy$=new j;src$=new W;width$=new W;height$=new W;ngOnInit(){this.contents$=this.src$.pipe(Q(e=>this.http.fetchText(e)),K(e=>this.sanitizer.bypassSecurityTrustHtml(e))),this.svg$=this.contents$.pipe(Q(e=>ye(200)),K(e=>this.getUniqueSvgElement()),Ie(),Me(e=>e!==null),Oe(1)),this.connectAttribute(e=>`${e}`,"width",this.width$),this.connectAttribute(e=>`${e}`,"height",this.height$)}ngOnDestroy(){this.destroy$.next()}connectAttribute(e,a,h){h.pipe(Q(m=>this.svg$.pipe(K(f=>[f,e(m)]))),J(this.destroy$)).subscribe(([m,f])=>{m.setAttribute(a,f)})}getUniqueSvgElement(){let e=this.hostingSpan.nativeElement.getElementsByTagName("svg");return e.length!==1?null:e[0]}validateSrc(e){if(typeof e!="string")return!1;let a=e;if(!a.startsWith("/"))throw new Error(`Currently just support hosting inline svg ${a}`);return!0}ngOnChanges(e){if("src"in e){let a=e.src.currentValue;if(!this.validateSrc(a))return;this.src$.next(a)}if("width"in e){let a=e.width.currentValue;if(typeof a!="number")throw new Error(`Not a number ${a}`);this.width$.next(a)}if("height"in e){let a=e.height.currentValue;if(typeof a!="number")throw new Error(`Not a number ${a}`);this.height$.next(e.height.currentValue)}}static \u0275fac=function(a){return new(a||l)($(oe),$(je))};static \u0275cmp=z({type:l,selectors:[["app-inline-svg"]],viewQuery:function(a,h){if(a&1&&Re(_t,5),a&2){let m;qe(m=$e())&&(h.hostingSpan=m.first)}},inputs:{src:"src",fill:"fill",stroke:"stroke",height:"height",width:"width"},outputs:{error:"error"},features:[Ae],decls:3,vars:7,consts:[["hostingSpan",""],[3,"innerHTML"]],template:function(a,h){a&1&&(De(0,"span",1,0),B(2,"async")),a&2&&(ke("fill",h.fill)("stroke",h.stroke),Ue("innerHTML",R(2,5,h.contents$),xe))},dependencies:[Ze],encapsulation:2})};function yt(l,e){if(l&1&&(G(0,"span"),te(1),q()),l&2){let a=Be();V(),Ge("Zoom: ",a.mapZoomLevel)}}var Z=class l{constructor(e,a){this.translate=e;this.http=a}cellMainScales={};cellSubScales={};googleMap;S2LEVEL_MAX=20;S2LevelRange=[1,this.S2LEVEL_MAX];S2LevelSubScaleMax=3;inputS2Level=1;inputS2LevelSubScale=0;inputS2Level$=new ue(this.inputS2Level);inputS2LevelSubScale$=new ue(this.inputS2LevelSubScale);mapBounds$=new j;isDeveloper=!H.production;mapZoomLevel;destroy$=new j;async ngOnInit(){ut({key:H.googleMapApiKey,v:"weekly"});let{Place:e}=await ht("places");Je("Google API loaded",e);let a={center:{lat:H.MapDefaultLocation.lat,lng:H.MapDefaultLocation.lng},zoom:7},h=document.getElementById("toolsS2MapMain");this.googleMap=new google.maps.Map(h,a),this.googleMap.addListener("bounds_changed",this.onMapBoundsChanged.bind(this)),he([this.inputS2Level$,this.mapBounds$]).pipe(J(this.destroy$)).subscribe(([m,f])=>{let d=this.googleMap.getZoom();if(typeof d!="number"){ie("Unexpectedly failed to get zoom",d);return}this.S2LevelRange=this.getZoomLevelS2Range(d),this.S2LevelSubScaleMax=Math.min(Math.max(this.S2LEVEL_MAX-m,0),3),this.drawMainScales(m,f)}),he([this.inputS2Level$,this.inputS2LevelSubScale$,this.mapBounds$]).pipe(Ce(100),J(this.destroy$)).subscribe(([m,f,d])=>{let I=m+f;this.drawSubScales(I,d)})}ngOnDestroy(){this.destroy$.next()}onChangeLevel(e){this.inputS2Level$.next(e)}clearScales(e){for(let a in e)e[a].setMap(null),delete e[a]}drawSubScales(e,a){this.clearScales(this.cellSubScales);let h=this.googleMap.getCenter();if(!h){ie("Unexpectedly failed to get map center");return}let m=this.toS2Cell(h,e);this.drawWithNeighbors(this.cellSubScales,a,m,.3)}drawMainScales(e,a){this.clearScales(this.cellMainScales);let h=this.googleMap.getCenter();if(!h)return;let m=this.toS2Cell(h,e);this.drawWithNeighbors(this.cellMainScales,a,m)}drawWithNeighbors(e,a,h,m=1){let f=this.toGoogleBounds(h);if(!a.intersects(f))return;let d=h.toHilbertQuadkey();if(d in e)return;let I=h.getCornerLatLngs(),i=I.map(o=>this.toGoogleLatLng(o));i.push(this.toGoogleLatLng(I[0]));let n=new google.maps.Polyline({path:i,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.8*m,strokeWeight:1*m,map:this.googleMap});e[d]=n;for(let o of h.getNeighbors()){let s=o.getLatLng(),c=new google.maps.LatLng(this.toGoogleLatLng(s));this.drawWithNeighbors(e,a,o,m)}}toS2Cell(e,a){return gt.S2.S2Cell.FromLatLng({lat:e.lat(),lng:e.lng()},a)}toGoogleBounds(e){let a=e.getCornerLatLngs();return new google.maps.LatLngBounds(a[0],a[1]).extend(a[2]).extend(a[3])}toGoogleLatLng(e){return{lat:e.lat,lng:e.lng}}onMapBoundsChanged(){let e=this.googleMap.getZoom();if(!e)return;this.mapZoomLevel=e;let a=this.getZoomLevelS2Range(e);if(this.inputS2Level<a[0]||a[1]<this.inputS2Level){let m=this.clamp(this.inputS2Level,a[0],a[1]);this.inputS2Level=m,this.inputS2Level$.next(m)}let h=this.googleMap.getBounds();if(!h){ie("Unexpectedly failed to get bounds.");return}this.mapBounds$.next(h)}clamp(e,a,h){return Math.trunc(Math.min(h,Math.max(a,e)))}getZoomLevelS2Range(e){let a=this.clamp(Math.trunc(e),0,22),h=[{min:1,max:3},{min:1,max:6},{min:1,max:7},{min:1,max:7},{min:1,max:8},{min:1,max:8},{min:1,max:9},{min:1,max:9},{min:1,max:10},{min:1,max:11},{min:1,max:12},{min:1,max:12},{min:1,max:13},{min:1,max:13},{min:1,max:14},{min:8,max:15},{min:8,max:16},{min:9,max:17},{min:9,max:18},{min:10,max:19},{min:10,max:this.S2LEVEL_MAX},{min:11,max:this.S2LEVEL_MAX},{min:12,max:this.S2LEVEL_MAX}];return[h[a].min,h[a].max]}onChangeSubScale(e){this.inputS2LevelSubScale$.next(e)}static \u0275fac=function(a){return new(a||l)($(rt),$(oe))};static \u0275cmp=z({type:l,selectors:[["app-s2-map"]],decls:18,vars:25,consts:[["id","toolsS2MapMain",2,"width","100%","height","600px"],[1,"form-group","m-2"],[1,"input-group","row","m-2"],[1,"col-1","form-check-label","p-2","text-end",3,"title"],[1,"col-2"],["type","number",1,"form-control",3,"ngModelChange","min","max","ngModel"],["fill","#7878dd","src","/assets/octicons/question.svg",1,"col-1",3,"title"]],template:function(a,h){a&1&&(ge(0,"div",0),Pe(1,yt,2,1,"span"),G(2,"div",1)(3,"div",2)(4,"label",3),B(5,"translate"),te(6),B(7,"translate"),q(),G(8,"span",4)(9,"input",5),de("ngModelChange",function(f){return me(h.inputS2Level,f)||(h.inputS2Level=f),f}),ce("ngModelChange",function(f){return h.onChangeLevel(f)}),q()(),G(10,"label",3),B(11,"translate"),te(12),B(13,"translate"),q(),G(14,"span",4)(15,"input",5),de("ngModelChange",function(f){return me(h.inputS2LevelSubScale,f)||(h.inputS2LevelSubScale=f),f}),ce("ngModelChange",function(f){return h.onChangeSubScale(f)}),q()(),ge(16,"app-inline-svg",6),B(17,"translate"),q()()),a&2&&(V(),Ve(h.isDeveloper?1:-1),V(3),k("title",ne(R(5,15,"TOOLTIP_S2_CELL_LEVEL"))),V(2),pe(R(7,17,"LABEL_S2_CELL_LEVEL")),V(3),k("min",h.S2LevelRange[0])("max",h.S2LevelRange[1]),fe("ngModel",h.inputS2Level),V(),k("title",ne(R(11,19,"TOOLTIP_S2_CELL_SUB_SCALE"))),V(2),pe(R(13,21,"LABEL_S2_CELL_SUB_SCALES")),V(3),k("min",0)("max",h.S2LevelSubScaleMax),fe("ngModel",h.inputS2LevelSubScale),V(),k("title",ne(R(17,23,"TOOLTIP_S2CELL_LEVEL"))))},dependencies:[re,We,Ye,Ke,et,ze,Qe,se,nt],encapsulation:2})};var Mt=[{path:"map/index.htm",redirectTo:"map"},{path:"map",component:Z,data:{gitweeTitle:"TITLE_TOOL_S2GEO_MAP"}}],le=class l{constructor(){He("S2mapRoutingModule.constructor()")}static \u0275fac=function(a){return new(a||l)};static \u0275mod=ee({type:l});static \u0275inj=Y({imports:[Se.forChild(Mt),Se]})};var ct=class l{constructor(){Xe("Dynamically loaded S2mapModule")}static \u0275fac=function(a){return new(a||l)};static \u0275mod=ee({type:l});static \u0275inj=Y({providers:[{provide:it,useValue:"app/tools/s2map/s2map/"}],imports:[re,ot,tt,le,Z]})};export{ct as S2mapModule};
