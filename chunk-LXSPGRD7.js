import{a as Ae,c as Ee,e as ye,g as Ue}from"./chunk-PBW4FHER.js";import{a as Ne}from"./chunk-MVYKM526.js";import{a as re}from"./chunk-UFOCGCKB.js";import{g as Te}from"./chunk-ISJWRPLC.js";import{a as fe,b as me,c as he,d as ge,e as M,f as ve,g as Se,j as be}from"./chunk-VMYPE7DV.js";import{$ as m,E as J,G as W,H as P,L,O as A,Oc as x,Q as E,Qc as h,R as X,Rc as g,Tc as y,Y as k,_ as Y,aa as K,b as w,ba as Q,ca as Z,d as $,ha as ee,la as te,m as C,qa as T,z as B}from"./chunk-KNL377UP.js";import{F as O,G as ce,O as le,P as ue,Q as pe,T as de,W as N,e as ne,h as ie,i as oe,k as se,w as ae}from"./chunk-242NDBMP.js";var xe="type.googleapis.com/google.protobuf.Int64Value",Me="type.googleapis.com/google.protobuf.UInt64Value";function Oe(e,t){let r={};for(let n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function D(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>D(t));if(typeof e=="function"||typeof e=="object")return Oe(e,t=>D(t));throw new Error("Data cannot be encoded in JSON: "+e)}function U(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case xe:case Me:{let t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>U(t)):typeof e=="function"||typeof e=="object"?Oe(e,t=>U(t)):e}var z="functions";var Fe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},p=class e extends ae{constructor(t,r,n){super(`${z}/${t}`,r||""),this.details=n,Object.setPrototypeOf(this,e.prototype)}};function He(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function R(e,t){let r=He(e),n=r,i;try{let c=t&&t.error;if(c){let s=c.status;if(typeof s=="string"){if(!Fe[s])return new p("internal","internal");r=Fe[s],n=s}let a=c.message;typeof a=="string"&&(n=a),i=c.details,i!==void 0&&(i=U(i))}}catch{}return r==="ok"?null:new p(r,n,i)}var H=class{constructor(t,r,n,i){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,pe(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||r.get().then(c=>this.auth=c,()=>{}),this.messaging||n.get().then(c=>this.messaging=c,()=>{}),this.appCheck||i?.get().then(c=>this.appCheck=c,()=>{})}async getAuthToken(){if(this.auth)try{let t=await this.auth.getToken();return t?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let r=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return r.error?null:r.token}return null}async getContext(t){let r=await this.getAuthToken(),n=await this.getMessagingToken(),i=await this.getAppCheckToken(t);return{authToken:r,messagingToken:n,appCheckToken:i}}};var _="us-central1",_e=/^data: (.*?)(?:\n|$)/;function je(e){let t=null;return{promise:new Promise((r,n)=>{t=setTimeout(()=>{n(new p("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}var j=class{constructor(t,r,n,i,c=_,s=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new H(t,r,n,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{let a=new URL(c);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=_}catch{this.customDomain=null,this.region=c}}_delete(){return this.deleteService()}_url(t){let r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${r}.cloudfunctions.net/${t}`}};function ze(e,t,r){let n=ie(t);e.emulatorOrigin=`http${n?"s":""}://${t}:${r}`,n&&(oe(e.emulatorOrigin),se("Functions",!0))}function Ve(e,t,r){let n=i=>qe(e,t,i,r||{});return n.stream=(i,c)=>Je(e,t,i,c),n}async function Ge(e,t,r,n){r["Content-Type"]="application/json";let i;try{i=await n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch{return{status:0,json:null}}let c=null;try{c=await i.json()}catch{}return{status:i.status,json:c}}async function De(e,t){let r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}function qe(e,t,r,n){let i=e._url(t);return Be(e,i,r,n)}async function Be(e,t,r,n){r=D(r);let i={data:r},c=await De(e,n),s=n.timeout||7e4,a=je(s),o=await Promise.race([Ge(t,i,c,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!o)throw new p("cancelled","Firebase Functions instance was deleted.");let u=R(o.status,o.json);if(u)throw u;if(!o.json)throw new p("internal","Response is not valid JSON object.");let l=o.json.data;if(typeof l>"u"&&(l=o.json.result),typeof l>"u")throw new p("internal","Response is missing data field.");return{data:U(l)}}function Je(e,t,r,n){let i=e._url(t);return We(e,i,r,n||{})}async function We(e,t,r,n){var i;r=D(r);let c={data:r},s=await De(e,n);s["Content-Type"]="application/json",s.Accept="text/event-stream";let a;try{a=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(c),headers:s,signal:n?.signal})}catch(d){if(d instanceof Error&&d.name==="AbortError"){let F=new p("cancelled","Request was cancelled.");return{data:Promise.reject(F),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(F)}}}}}}let b=R(0,null);return{data:Promise.reject(b),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(b)}}}}}}let o,u,l=new Promise((d,b)=>{o=d,u=b});(i=n?.signal)===null||i===void 0||i.addEventListener("abort",()=>{let d=new p("cancelled","Request was cancelled.");u(d)});let f=a.body.getReader(),v=Xe(f,o,u,n?.signal);return{stream:{[Symbol.asyncIterator](){let d=v.getReader();return{async next(){let{value:b,done:F}=await d.read();return{value:b,done:F}},async return(){return await d.cancel(),{done:!0,value:void 0}}}}},data:l}}function Xe(e,t,r,n){let i=(s,a)=>{let o=s.match(_e);if(!o)return;let u=o[1];try{let l=JSON.parse(u);if("result"in l){t(U(l.result));return}if("message"in l){a.enqueue(U(l.message));return}if("error"in l){let f=R(0,l);a.error(f),r(f);return}}catch(l){if(l instanceof p){a.error(l),r(l);return}}},c=new TextDecoder;return new ReadableStream({start(s){let a="";return o();async function o(){if(n?.aborted){let u=new p("cancelled","Request was cancelled");return s.error(u),r(u),Promise.resolve()}try{let{value:u,done:l}=await e.read();if(l){a.trim()&&i(a.trim(),s),s.close();return}if(n?.aborted){let v=new p("cancelled","Request was cancelled");s.error(v),r(v),await e.cancel();return}a+=c.decode(u,{stream:!0});let f=a.split(`
`);a=f.pop()||"";for(let v of f)v.trim()&&i(v.trim(),s);return o()}catch(u){let l=u instanceof p?u:R(0,null);s.error(l),r(l)}}},cancel(){return e.cancel()}})}var we="@firebase/functions",ke="0.12.9";var Ye="auth-internal",Ke="app-check-internal",Qe="messaging-internal";function Ze(e){let t=(r,{instanceIdentifier:n})=>{let i=r.getProvider("app").getImmediate(),c=r.getProvider(Ye),s=r.getProvider(Qe),a=r.getProvider(Ke);return new j(i,c,s,a,n)};le(new ce(z,t,"PUBLIC").setMultipleInstances(!0)),N(we,ke,e),N(we,ke,"esm2017")}function Re(e=de(),t=_){let n=ue(O(e),z).getImmediate({identifier:t}),i=ne("functions");return i&&Ie(n,...i),n}function Ie(e,t,r){ze(O(e),t,r)}function $e(e,t,r){return Ve(O(e),t,r)}Ze();var S=class{constructor(t){return t}},Ce="functions",V=class{constructor(){return he(Ce)}};var G=new Y("angularfire2.functions-instances");function et(e,t){let r=me(Ce,e,t);return r&&new S(r)}function tt(e){return(t,r)=>{let n=t.runOutsideAngular(()=>e(r));return new S(n)}}var rt={provide:V,deps:[[new T,G]]},nt={provide:S,useFactory:et,deps:[[new T,G],ve]};function yt(e,...t){return N("angularfire",fe.full,"fn"),Q([nt,rt,{provide:G,useFactory:tt(e),multi:!0,deps:[te,ee,ge,Se,[new T,Ae],[new T,be],...t]}])}var Ut=M(Re,!0),Pe=M($e,!0);var I=class e{constructor(t){this.remote=t;h("LocalFunctionsService.constructor()")}destroy$=new w;ngOnDestroy(){h("LocalFunctionsService.OnDestroy()"),this.destroy$.next()}async action(t){this.call(t,void 0)}async read(t){return this.call(t,void 0)}async call(t,r){return this.execute(t,r)}async execute(t,r){return(await Pe(this.remote,t)(r)).data}static \u0275fac=function(r){return new(r||e)(m(S))};static \u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})};var q=class{constructor(t,r,n,i,c){this.auth=t;this.funcs=r;this.localSession=n;this.firestore=i;this.dom=c;h("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${x.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${x.FirebaseCloudFunctionsHost}`,"preconnect");let s=this.auth.user.pipe(P());s.pipe(P(),E(this.finalize$)).subscribe(o=>{this.sourceValue$.next()}),this.state$=s.pipe(B(o=>o!==null)),this.localSession.markedLogout$.pipe(E(this.finalize$)).subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe(E(this.finalize$)).subscribe({error:o=>{y("AuthService.state$ error",o),this.doFinalize()},complete:()=>{g("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe(A(o=>{let u=Ue(this.firestore,"users/v1/protected",o.uid,"fcm");return ye(u).pipe(X(l=>h("UserProtectedStore has changed.",l)))}),E(this.finalize$)).subscribe({next:o=>{this.sourceValue$.next()},error:o=>{y("AuthService.state$ Maybe after logout permission error. Ignore it.",o),this.doFinalize()},complete:()=>{g("AuthService.state$ completed."),this.doFinalize()}});let a=this.state$.pipe(A(async o=>{try{let u=await this.funcs.read("readUserSettings"),l=o;return l.isAdmin=u.isAdmin,l.isDeveloper=u.isDeveloper,l.hasMessaging=u.hasMessaging,l}catch(u){return y("AuthService while check user settings.",u),null}}));this.localUser$=this.sourceValue$.pipe(J(100),A(()=>s.pipe(A(o=>o===null?C(null):a))),L(1)),this.localUser$.pipe(E(this.finalize$)).subscribe({next:async o=>{h("AuthService.localUser$.subscribe()",o),o?(this.loginUid=o.uid,this.isAdminUser=!!o.isAdmin,this.isDevelopUser=!!o.isDeveloper,this.hasMessagingDevice=!!o.hasMessaging,this.localSession.updateLoginPhoto(o.photoURL),this.localSession.markLogin()):(this.localSession.unmarkLogin(),this.localSession.updateLoginPhoto(null),this.loginUid=null,this.isAdminUser=!1,this.isDevelopUser=!1,this.hasMessagingDevice=!1,g("Explicitly logout on client sdk."),await this.auth.signOut())},complete:()=>{g("AuthService.localUser$ complete."),this.doFinalize()},error:o=>{y("AuthService.localUser$ error while retrieving.",o),this.doFinalize()}})}finalize$=new w;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;env=K(Z);sourceValue$=new $;doFinalize(){this.finalize$.isStopped||(g("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}},Le=class e{constructor(t,r,n,i,c){this.auth=t;this.funcs=r;this.localSession=n;this.firestore=i;this.dom=c;h("AuthService.constructor()");let s=new $;e.AUTH===null&&(e.AUTH=new q(t,r,n,i,c),e.AUTH.finalize$.pipe(W(1)).subscribe({next:()=>{g("Finalize singleton auth continue..")},complete:()=>{g("Finalizing singleton auth completed."),e.AUTH=null,s.next()},error:a=>{y("Finalizing singleton auth cause by error.",a),e.AUTH=null,s.next()}})),this._clientSideUser$=s.pipe(A(()=>e.AUTH===null?C(null):e.AUTH.localUser$),L(1)),s.next()}static AUTH=null;_clientSideUser$;get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return e.AUTH?e.AUTH.isAdminUser:!1}get isDeveloper(){return e.AUTH?e.AUTH.isDevelopUser:!1}get hasMessaging(){return e.AUTH?e.AUTH.hasMessagingDevice:!1}get myUid(){return e.AUTH?e.AUTH.loginUid:null}static \u0275fac=function(r){return new(r||e)(m(Te),m(I),m(re),m(Ee),m(Ne))};static \u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})};export{yt as a,Ut as b,I as c,Le as d};
