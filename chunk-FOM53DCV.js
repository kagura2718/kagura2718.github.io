import{b as Ue,d as Ee,f as Te}from"./chunk-ZEO462RY.js";import{a as Ne}from"./chunk-WF3I3F4I.js";import{C as ye,a as pe,b as de,c as me,d as fe,e as H,f as he,g as ge,j as ve,p as Ae,q as Se,s as be}from"./chunk-MKIW25J4.js";import{a as ee}from"./chunk-VHKBHLCR.js";import{$ as h,A as B,F as J,H as W,I as P,L as x,O as b,Oc as L,Q as y,Qc as m,R as X,Rc as g,Tc as U,Y as O,_ as Y,b as T,ba as K,d as I,ha as Q,la as Z,n as C,qa as N}from"./chunk-L2QDK5DF.js";import{F as D,G as se,O as ae,P as ce,Q as le,T as ue,W as w,f as te,i as re,j as ne,l as ie,w as oe}from"./chunk-LRFDAHTL.js";var Le="type.googleapis.com/google.protobuf.Int64Value",He="type.googleapis.com/google.protobuf.UInt64Value";function De(e,t){let r={};for(let n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function k(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>k(t));if(typeof e=="function"||typeof e=="object")return De(e,t=>k(t));throw new Error("Data cannot be encoded in JSON: "+e)}function E(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Le:case He:{let t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>E(t)):typeof e=="function"||typeof e=="object"?De(e,t=>E(t)):e}var j="functions";var we={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},p=class e extends oe{constructor(t,r,n){super(`${j}/${t}`,r||""),this.details=n,Object.setPrototypeOf(this,e.prototype)}};function Me(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function R(e,t){let r=Me(e),n=r,i;try{let c=t&&t.error;if(c){let s=c.status;if(typeof s=="string"){if(!we[s])return new p("internal","internal");r=we[s],n=s}let a=c.message;typeof a=="string"&&(n=a),i=c.details,i!==void 0&&(i=E(i))}}catch{}return r==="ok"?null:new p(r,n,i)}var M=class{constructor(t,r,n,i){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,le(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||r.get().then(c=>this.auth=c,()=>{}),this.messaging||n.get().then(c=>this.messaging=c,()=>{}),this.appCheck||i?.get().then(c=>this.appCheck=c,()=>{})}async getAuthToken(){if(this.auth)try{let t=await this.auth.getToken();return t?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let r=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return r.error?null:r.token}return null}async getContext(t){let r=await this.getAuthToken(),n=await this.getMessagingToken(),i=await this.getAppCheckToken(t);return{authToken:r,messagingToken:n,appCheckToken:i}}};var z="us-central1",ze=/^data: (.*?)(?:\n|$)/;function _e(e){let t=null;return{promise:new Promise((r,n)=>{t=setTimeout(()=>{n(new p("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}var _=class{constructor(t,r,n,i,c=z,s=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new M(t,r,n,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{let a=new URL(c);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=z}catch{this.customDomain=null,this.region=c}}_delete(){return this.deleteService()}_url(t){let r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${r}.cloudfunctions.net/${t}`}};function je(e,t,r){let n=re(t);e.emulatorOrigin=`http${n?"s":""}://${t}:${r}`,n&&(ne(e.emulatorOrigin),ie("Functions",!0))}function Ve(e,t,r){let n=i=>qe(e,t,i,r||{});return n.stream=(i,c)=>Je(e,t,i,c),n}async function Ge(e,t,r,n){r["Content-Type"]="application/json";let i;try{i=await n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch{return{status:0,json:null}}let c=null;try{c=await i.json()}catch{}return{status:i.status,json:c}}async function ke(e,t){let r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}function qe(e,t,r,n){let i=e._url(t);return Be(e,i,r,n)}async function Be(e,t,r,n){r=k(r);let i={data:r},c=await ke(e,n),s=n.timeout||7e4,a=_e(s),o=await Promise.race([Ge(t,i,c,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!o)throw new p("cancelled","Firebase Functions instance was deleted.");let u=R(o.status,o.json);if(u)throw u;if(!o.json)throw new p("internal","Response is not valid JSON object.");let l=o.json.data;if(typeof l>"u"&&(l=o.json.result),typeof l>"u")throw new p("internal","Response is missing data field.");return{data:E(l)}}function Je(e,t,r,n){let i=e._url(t);return We(e,i,r,n||{})}async function We(e,t,r,n){var i;r=k(r);let c={data:r},s=await ke(e,n);s["Content-Type"]="application/json",s.Accept="text/event-stream";let a;try{a=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(c),headers:s,signal:n?.signal})}catch(d){if(d instanceof Error&&d.name==="AbortError"){let F=new p("cancelled","Request was cancelled.");return{data:Promise.reject(F),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(F)}}}}}}let S=R(0,null);return{data:Promise.reject(S),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(S)}}}}}}let o,u,l=new Promise((d,S)=>{o=d,u=S});(i=n?.signal)===null||i===void 0||i.addEventListener("abort",()=>{let d=new p("cancelled","Request was cancelled.");u(d)});let f=a.body.getReader(),v=Xe(f,o,u,n?.signal);return{stream:{[Symbol.asyncIterator](){let d=v.getReader();return{async next(){let{value:S,done:F}=await d.read();return{value:S,done:F}},async return(){return await d.cancel(),{done:!0,value:void 0}}}}},data:l}}function Xe(e,t,r,n){let i=(s,a)=>{let o=s.match(ze);if(!o)return;let u=o[1];try{let l=JSON.parse(u);if("result"in l){t(E(l.result));return}if("message"in l){a.enqueue(E(l.message));return}if("error"in l){let f=R(0,l);a.error(f),r(f);return}}catch(l){if(l instanceof p){a.error(l),r(l);return}}},c=new TextDecoder;return new ReadableStream({start(s){let a="";return o();async function o(){if(n?.aborted){let u=new p("cancelled","Request was cancelled");return s.error(u),r(u),Promise.resolve()}try{let{value:u,done:l}=await e.read();if(l){a.trim()&&i(a.trim(),s),s.close();return}if(n?.aborted){let v=new p("cancelled","Request was cancelled");s.error(v),r(v),await e.cancel();return}a+=c.decode(u,{stream:!0});let f=a.split(`
`);a=f.pop()||"";for(let v of f)v.trim()&&i(v.trim(),s);return o()}catch(u){let l=u instanceof p?u:R(0,null);s.error(l),r(l)}}},cancel(){return e.cancel()}})}var Fe="@firebase/functions",Oe="0.12.9";var Ye="auth-internal",Ke="app-check-internal",Qe="messaging-internal";function Ze(e){let t=(r,{instanceIdentifier:n})=>{let i=r.getProvider("app").getImmediate(),c=r.getProvider(Ye),s=r.getProvider(Qe),a=r.getProvider(Ke);return new _(i,c,s,a,n)};ae(new se(j,t,"PUBLIC").setMultipleInstances(!0)),w(Fe,Oe,e),w(Fe,Oe,"esm2017")}function Re(e=ue(),t=z){let n=ce(D(e),j).getImmediate({identifier:t}),i=te("functions");return i&&$e(n,...i),n}function $e(e,t,r){je(D(e),t,r)}function Ie(e,t,r){return Ve(D(e),t,r)}Ze();var A=class{constructor(t){return t}},Ce="functions",V=class{constructor(){return me(Ce)}};var G=new Y("angularfire2.functions-instances");function et(e,t){let r=de(Ce,e,t);return r&&new A(r)}function tt(e){return(t,r)=>{let n=t.runOutsideAngular(()=>e(r));return new A(n)}}var rt={provide:V,deps:[[new N,G]]},nt={provide:A,useFactory:et,deps:[[new N,G],he]};function Ut(e,...t){return w("angularfire",pe.full,"fn"),K([nt,rt,{provide:G,useFactory:tt(e),multi:!0,deps:[Z,Q,fe,ge,[new N,Se],[new N,ve],...t]}])}var Et=H(Re,!0),Pe=H(Ie,!0);var $=class e{constructor(t){this.remote=t;m("LocalFunctionsService.constructor()")}destroy$=new T;ngOnDestroy(){m("LocalFunctionsService.OnDestroy()"),this.destroy$.next()}async action(t){this.call(t,void 0)}async read(t){return this.call(t,void 0)}async call(t,r){return this.execute(t,r)}async execute(t,r){return(await Pe(this.remote,t)(r)).data}static \u0275fac=function(r){return new(r||e)(h(A))};static \u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"})};var q=class{constructor(t,r,n,i,c){this.auth=t;this.funcs=r;this.localSession=n;this.firestore=i;this.dom=c;m("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${L.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${L.FirebaseCloudFunctionsHost}`,"preconnect");let s=be(this.auth).pipe(P());s.pipe(P(),y(this.finalize$)).subscribe(o=>{this.sourceValue$.next()}),this.state$=s.pipe(B(o=>o!==null)),this.localSession.markedLogout$.pipe(y(this.finalize$)).subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe(y(this.finalize$)).subscribe({error:o=>{U("AuthService.state$ error",o),this.doFinalize()},complete:()=>{g("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe(b(o=>{let u=Te(this.firestore,"users/v1/protected",o.uid,"fcm");return Ee(u).pipe(X(l=>m("UserProtectedStore has changed.",l)))}),y(this.finalize$)).subscribe({next:o=>{this.sourceValue$.next()},error:o=>{U("AuthService.state$ Maybe after logout permission error. Ignore it.",o),this.doFinalize()},complete:()=>{g("AuthService.state$ completed."),this.doFinalize()}});let a=this.state$.pipe(b(async o=>{try{let u=await this.funcs.read("readUserSettings"),l=o;return l.isAdmin=u.isAdmin,l.isDeveloper=u.isDeveloper,l.hasMessaging=u.hasMessaging,l}catch(u){return U("AuthService while check user settings.",u),null}}));this.localUser$=this.sourceValue$.pipe(J(100),b(()=>s.pipe(b(o=>o===null?C(null):a))),x(1)),this.localUser$.pipe(y(this.finalize$)).subscribe({next:async o=>{m("AuthService.localUser$.subscribe()",o),o?(this.loginUid=o.uid,this.isAdminUser=!!o.isAdmin,this.isDevelopUser=!!o.isDeveloper,this.hasMessagingDevice=!!o.hasMessaging,this.localSession.updateLoginPhoto(o.photoURL),this.localSession.markLogin()):(this.localSession.unmarkLogin(),this.localSession.updateLoginPhoto(null),this.loginUid=null,this.isAdminUser=!1,this.isDevelopUser=!1,this.hasMessagingDevice=!1,g("Explicitly logout on client sdk."),await ye(this.auth))},complete:()=>{g("AuthService.localUser$ complete."),this.doFinalize()},error:o=>{U("AuthService.localUser$ error while retrieving.",o),this.doFinalize()}})}finalize$=new T;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;sourceValue$=new I;doFinalize(){this.finalize$.isStopped||(g("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}},xe=class e{constructor(t,r,n,i,c){this.auth=t;this.funcs=r;this.localSession=n;this.firestore=i;this.dom=c;m("AuthService.constructor()");let s=new I;e.AUTH===null&&(e.AUTH=new q(t,r,n,i,c),e.AUTH.finalize$.pipe(W(1)).subscribe({next:()=>{g("Finalize singleton auth continue..")},complete:()=>{g("Finalizing singleton auth completed."),e.AUTH=null,s.next()},error:a=>{U("Finalizing singleton auth cause by error.",a),e.AUTH=null,s.next()}})),this._clientSideUser$=s.pipe(b(()=>e.AUTH===null?C(null):e.AUTH.localUser$),x(1)),s.next()}destroy$=new T;static AUTH=null;_clientSideUser$;ngOnDestroy(){m("AuthService.OnDestroy()"),e.AUTH&&(e.AUTH.finalize$.next(),e.AUTH=null),this.destroy$.next()}get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return e.AUTH?e.AUTH.isAdminUser:!1}get isDeveloper(){return e.AUTH?e.AUTH.isDevelopUser:!1}get hasMessaging(){return e.AUTH?e.AUTH.hasMessagingDevice:!1}get myUid(){return e.AUTH?e.AUTH.loginUid:null}static \u0275fac=function(r){return new(r||e)(h(Ae),h($),h(ee),h(Ue),h(Ne))};static \u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"})};export{Ut as a,Et as b,$ as c,xe as d};
