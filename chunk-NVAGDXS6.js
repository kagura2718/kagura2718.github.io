import{d as ut}from"./chunk-FOM53DCV.js";import{a as at}from"./chunk-DDVJSPRY.js";import{A as rt,k as J,o as Y,p as Z,s as tt,t as et,v as it,x as nt,z as ot}from"./chunk-MKIW25J4.js";import{a as N}from"./chunk-FOS6V2PY.js";import{$a as p,Aa as u,Bb as A,Db as a,Fc as R,Ga as _,H as P,Ic as L,Ja as k,Q as E,Qc as S,Tc as x,Ua as l,Vc as U,Wa as s,Wc as G,Yc as M,Zc as O,_c as q,ab as r,ad as F,b as I,bb as o,c as y,cb as C,cc as B,cd as $,dc as v,ea as h,ec as b,fa as f,gd as j,hd as z,lb as g,m as T,nd as Q,ob as w,od as W,pd as K,qb as c,qd as X,sd as H,xb as D,yb as V}from"./chunk-L2QDK5DF.js";var st=["mainForm"],dt=["confirmPasswordInput"];function ct(e,i){e&1&&(r(0,"div",6),a(1,"OK!"),o())}function mt(e,i){e&1&&(r(0,"div",12),a(1,"E \u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function pt(e,i){e&1&&(r(0,"div",12),a(1,"E \u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),o())}function Ct(e,i){if(e&1&&(l(0,mt,2,0,"div",12),l(1,pt,2,0,"div",12)),e&2){let t=c();s(t.emailControl.errors!=null&&t.emailControl.errors.required?0:-1),u(),s(t.emailControl.errors!=null&&t.emailControl.errors.minlength?1:-1)}}function ht(e,i){e&1&&(r(0,"div",6),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u5F37\u5EA6\u306F\u5145\u5206\u306B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),o())}function ft(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function _t(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u9577\u3055\u304C\u8DB3\u308A\u307E\u305B\u3093\u3002"),o())}function vt(e,i){if(e&1&&(l(0,ft,2,0,"div",12),l(1,_t,2,0,"div",12)),e&2){let t=c();s(t.passwordControl.errors!=null&&t.passwordControl.errors.required?0:-1),u(),s(t.passwordControl.errors!=null&&t.passwordControl.errors.minlength?1:-1)}}function gt(e,i){e&1&&(r(0,"div",6),a(1,"\u4E00\u81F4\u3057\u307E\u3057\u305F\uFF01"),o())}function wt(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function At(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u304C\u4E00\u81F4\u3057\u307E\u305B\u3093\u3002"),o())}function Ft(e,i){if(e&1&&(l(0,wt,2,0,"div",12),l(1,At,2,0,"div",12)),e&2){let t=c(2);s(t.confirmPasswordControl.errors!=null&&t.confirmPasswordControl.errors.required?0:-1),u(),s(t.confirmPasswordControl.errors!=null&&t.confirmPasswordControl.errors.passwordMisMatch?1:-1)}}function xt(e,i){if(e&1&&(r(0,"div",3)(1,"label",13),a(2,"Confirm Password"),o(),C(3,"input",14,1),l(5,gt,2,0,"div",6)(6,Ft,2,2),o()),e&2){let t=c();A("was-validated",t.confirmPasswordControl.dirty||t.confirmPasswordControl.touched),u(3),p("autocomplete",t.passwordAutocomplete),u(2),s(t.confirmPasswordControl.invalid?6:5)}}function Et(e,i){e&1&&(r(0,"div",20),a(1,"OK!"),o())}function bt(e,i){e&1&&(r(0,"div",21),a(1,"\u898F\u7D04\u306B\u540C\u610F\u3057\u3066\u3044\u305F\u3060\u304F\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002"),o())}function St(e,i){if(e&1&&l(0,bt,2,0,"div",21),e&2){let t=c(2);s(t.agreeTosControl.errors!=null&&t.agreeTosControl.errors.required?0:-1)}}function It(e,i){if(e&1&&(r(0,"div",15)(1,"label",16),a(2,"\u898F\u7D04\u306B\u540C\u610F\u3059\u308B"),o(),C(3,"input",17),r(4,"a",18),a(5," [\u5229\u7528\u898F\u7D04] "),o(),r(6,"span",19),a(7,"\u306B\u540C\u610F\u3057\u307E\u3059\u3002"),o(),l(8,Et,2,0,"div",20)(9,St,1,1),o()),e&2){let t=c();A("was-validated",t.agreeTosControl.dirty||t.agreeTosControl.touched),u(8),s(t.agreeTosControl.invalid?9:8)}}function yt(e,i){if(e&1){let t=g();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickSignup(d))}),a(1,"\u30A2\u30AB\u30A6\u30F3\u30C8\u4F5C\u6210"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function Tt(e,i){if(e&1){let t=g();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickLogin(d))}),C(1,"img",23),a(2,"\u30ED\u30B0\u30A4\u30F3"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function Pt(e,i){if(e&1){let t=g();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickReauth(d))}),C(1,"img",23),a(2,"\u518D\u8A8D\u8A3C"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function kt(e,i){if(e&1){let t=g();r(0,"app-oauth-federations",24),w("loginSucceeded",function(d){h(t);let m=c();return f(m.onOauthLoginSucceeded(d))})("loginFailed",function(d){h(t);let m=c();return f(m.onOauthLoginFailed(d))}),o()}}var lt=class e{constructor(i,t,n,d,m){this.auth=i;this.serv=t;this.toastr=n;this.router=d;this.route=m}isLogin=v(!1);isReauth=v(!1);reauthUser=v(null);isSignup=v(!1);showFederations=v(!0);reauthed=B();destroy$=new I;inputAuthForm;loginUser$=new y(null);passwordAutocomplete;mainForm=b.required("mainForm");confirmPasswordInput=b("confirmPasswordInput");ngOnInit(){this.passwordAutocomplete=this.isSignup()?"new-password":"current-password",this.inputAuthForm=new q({}),this.inputAuthForm.addControl("email",new F("")),this.inputAuthForm.addControl("password",new F("")),this.isSignup()&&(this.inputAuthForm.addControl("retypePassword",new F("")),this.inputAuthForm.addControl("agreeTosCheck",new F(!1)),this.inputAuthForm.setValidators([this.validateXFPassword.bind(this)])),this.inputAuthForm.disable(),this.initializeAuthForm()}ngOnDestroy(){this.destroy$.next()}ngAfterViewInit(){tt(this.auth).pipe(E(this.destroy$)).subscribe(i=>{this.loginUser$.next(i)})}navigateAfterSucceeded(){let t=this.route.snapshot.queryParams.redirectPath;t?(S("InputAuthComponent redirect is detected",t),this.router.navigate([t])):(S("InputAuthComponent redirect to top"),this.router.navigate(["/"]))}erroredConnected(i){x("error while connecting account",i);let t=i instanceof Error?i.message:"Unknown error";this.toastr.error(`Login \u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 
 ( ${t} )`)}loginSucceeded(i){this.toastr.success(`${i.displayName} \u3068\u3057\u3066 Login \u3057\u307E\u3057\u305F\u3002`),this.navigateAfterSucceeded()}connectSucceeded(i){this.toastr.success(`${i.displayName} \u3068\u3057\u3066 Sign-up \u3057\u307E\u3057\u305F\u3002`),this.navigateAfterSucceeded()}get emailControl(){return this.inputAuthForm.get("email")}get passwordControl(){return this.inputAuthForm.get("password")}get confirmPasswordControl(){return this.inputAuthForm.get("retypePassword")}get agreeTosControl(){return this.inputAuthForm.get("agreeTosCheck")}validateXFPassword(i){let t=i.get("password"),n=i.get("retypePassword"),d=this.confirmPasswordInput();return t.value!==n.value?(n.setErrors({passwordMisMatch:!0}),d&&d.nativeElement.setCustomValidity("create error state"),null):(d&&d.nativeElement.setCustomValidity(""),n.setErrors(null),null)}validateAuthForm(){return this.inputAuthForm.markAllAsTouched(),this.inputAuthForm.invalid?(x("Assert! Button should be disabled."),!1):!0}initializeAuthForm(){T(ot(this.auth,Y)).pipe(P(1),E(this.destroy$)).subscribe({next:()=>{this.inputAuthForm.enable()},error:i=>{this.toastr.error("\u8A8D\u8A3C Server \u3092\u521D\u671F\u5316\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}})}async onClickSignup(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=await et(this.auth,this.emailControl.value,this.passwordControl.value);this.toastr.info("\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F\u3002\u30E1\u30FC\u30EB\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),await nt(t.user),this.navigateAfterSucceeded()}catch(t){x("Error while reject",t);let n=t instanceof Error?t.message:"Unknown error";this.toastr.error(`\u30A2\u30AB\u30A6\u30F3\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u6700\u521D\u304B\u3089\u3084\u308A\u76F4\u3057\u3066\u304F\u3060\u3055\u3044\u3002
 ( ${n} )`)}}async onClickLogin(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=await rt(this.auth,this.emailControl.value,this.passwordControl.value);this.loginSucceeded(t.user)}catch(t){this.erroredConnected(t)}}async onClickReauth(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=J.credential(this.emailControl.value,this.passwordControl.value);await it(this.reauthUser(),t),this.reauthed.emit()}catch(t){this.erroredConnected(t)}}onOauthLoginFailed(i){this.erroredConnected(i)}onOauthLoginSucceeded(i){this.loginSucceeded(i)}static \u0275fac=function(t){return new(t||e)(_(Z),_(ut),_(N),_(L),_(R))};static \u0275cmp=k({type:e,selectors:[["gitfire-login-input-auth"]],viewQuery:function(t,n){t&1&&D(n.mainForm,st,5)(n.confirmPasswordInput,dt,5),t&2&&V(2)},inputs:{isLogin:[1,"isLogin"],isReauth:[1,"isReauth"],reauthUser:[1,"reauthUser"],isSignup:[1,"isSignup"],showFederations:[1,"showFederations"]},outputs:{reauthed:"reauthed"},decls:21,vars:15,consts:[["mainForm",""],["confirmPasswordInput",""],[3,"formGroup"],[1,"row","m-3"],["for","appGitfireLoginEmailInput",1,"visually-hidden"],["id","appGitfireLoginEmailInput","name","email","formControlName","email","placeholder","email@example.com","autocomplete","email","type","email","required","","autofill","","autofocus","","maxlength","1024","minlength","5",1,"form-control","col-12"],[1,"valid-feedback"],["for","appGitfireLoginPasswordInput",1,"visually-hidden"],["id","appGitfireLoginPasswordInput","type","password","name","password","formControlName","password","placeholder","Password","required","","autofill","","maxlength","256","minlength","6",1,"form-control","col-12",3,"autocomplete"],[1,"row","m-3",3,"was-validated"],[1,"row","custom-control","custom-checkbox","m-5","text-center",3,"was-validated"],[1,"btn","btn-lg","btn-primary","btn-block",3,"disabled"],[1,"invalid-feedback"],["for","appGitfireSignupPasswordConfirmInput",1,"visually-hidden"],["id","appGitfireSignupPasswordConfirmInput","type","password","name","password_confirm","formControlName","retypePassword","placeholder","Confirm password","required","",1,"form-control","col-12",3,"autocomplete"],[1,"row","custom-control","custom-checkbox","m-5","text-center"],["for","appGitfireAgreeTosCheck",1,"col-auto","visually-hidden"],["id","col-auto appGitfireAgreeTosCheck","formControlName","agreeTosCheck","type","checkbox","required","",1,"form-check-input"],["tabindex","-1","about","_blank","href","/terms.htm",1,"col-auto"],[1,"col-auto"],[1,"valid-feedback","col-auto"],[1,"invalid-feedback","col-auto"],[1,"btn","btn-lg","btn-primary","btn-block",3,"click","disabled"],["src","/assets/octicons/sign-in.svg",1,"m-1","gitfire-link-icon","octicon-info"],[3,"loginSucceeded","loginFailed"]],template:function(t,n){t&1&&(r(0,"form",2,0)(2,"div",3)(3,"label",4),a(4,"Email"),o(),C(5,"input",5),l(6,ct,2,0,"div",6)(7,Ct,2,2),o(),r(8,"div",3)(9,"label",7),a(10,"Password"),o(),C(11,"input",8),l(12,ht,2,0,"div",6),l(13,vt,2,2),o(),l(14,xt,7,4,"div",9),l(15,It,10,3,"div",10),r(16,"div",3),l(17,yt,2,1,"button",11),l(18,Tt,3,1,"button",11),l(19,Pt,3,1,"button",11),o(),l(20,kt,1,0,"app-oauth-federations"),o()),t&2&&(p("formGroup",n.inputAuthForm),u(2),A("was-validated",n.emailControl.dirty||n.emailControl.touched),u(4),s(n.emailControl.invalid?7:6),u(2),A("was-validated",n.passwordControl.dirty||n.passwordControl.touched),u(3),p("autocomplete",n.passwordAutocomplete),u(),s(n.isSignup()&&!n.passwordControl.invalid?12:-1),u(),s(n.passwordControl.invalid?13:-1),u(),s(n.isSignup()?14:-1),u(),s(n.isSignup()?15:-1),u(2),s(n.isSignup()?17:-1),u(),s(n.isLogin()?18:-1),u(),s(n.isReauth()?19:-1),u(),s(n.showFederations()?20:-1))},dependencies:[H,$,G,U,M,O,Q,K,X,W,z,j,at],encapsulation:2})};export{lt as a};
