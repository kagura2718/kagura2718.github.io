"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[79],{8079:(nI,Bf,ae)=>{ae.d(Bf,{Qe:()=>Md,cM:()=>Ey});var qf=ae(177),se=ae(3953),Ue=ae(1825),li=ae(9253),yt=ae(1152),Uf=ae(3236),Gf=ae(1985),hi=ae(8455),Cu=ae(7673),Cs=ae(9172),zf=ae(9974),Kf=ae(4360);function Ds(){return(0,zf.N)((r,e)=>{let t,n=!1;r.subscribe((0,Kf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var Gt,Mu,Je=ae(6354),Ns=ae(2816),jf=ae(3294),Du=ae(5964),$f=(ae(2438),ae(3345)),x=ae(467),di=ae(8742),Nu=ae(1362),Ye=ae(8041),ee=ae(1076),ku=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fu={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,p,I){I||(I=0);var E=Array(16);if("string"==typeof p)for(var v=0;16>v;++v)E[v]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;var P=T.g[3],y=(p=T.g[0])+(P^(I=T.g[1])&((v=T.g[2])^P))+E[0]+3614090360&4294967295;y=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=I+(y<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=p+(v^P&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=p+(I^v^P)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=p+(v^(I|~P))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((P=(p=I+((y=p+(v^(I|~P))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=P+((y=v+(p^(P|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+P&4294967295}function a(T,p){this.h=p;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var P=0|T[v];E&&P==p||(I[v]=P,E=!1)}this.g=I}(function e(T,p){function I(){}I.prototype=p.prototype,T.D=p.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,P){for(var y=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)y[gt-2]=arguments[gt];return p.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,p){void 0===p&&(p=T.length);for(var I=p-this.blockSize,E=this.B,v=this.h,P=0;P<p;){if(0==v)for(;P<=I;)i(this,T,P),P+=this.blockSize;if("string"==typeof T){for(;P<p;)if(E[v++]=T.charCodeAt(P++),v==this.blockSize){i(this,E),v=0;break}}else for(;P<p;)if(E[v++]=T[P++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=p},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var I=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=255&I,I/=256;for(this.u(T),T=Array(16),p=I=0;4>p;++p)for(var E=0;32>E;E+=8)T[I++]=this.g[p]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,p){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=p(T)}(T,function(p){return new a([0|p],0>p?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return D(h(-T));for(var p=[],I=1,E=0;T>=I;E++)p[E]=T/I|0,I*=4294967296;return new a(p,0)}var g=c(0),_=c(1),R=c(16777216);function b(T){if(0!=T.h)return!1;for(var p=0;p<T.g.length;p++)if(0!=T.g[p])return!1;return!0}function k(T){return-1==T.h}function D(T){for(var p=T.g.length,I=[],E=0;E<p;E++)I[E]=~T.g[E];return new a(I,~T.h).add(_)}function B(T,p){return T.add(D(p))}function z(T,p){for(;(65535&T[p])!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function q(T,p){this.g=T,this.h=p}function K(T,p){if(b(p))throw Error("division by zero");if(b(T))return new q(g,g);if(k(T))return p=K(D(T),p),new q(D(p.g),D(p.h));if(k(p))return p=K(T,D(p)),new q(D(p.g),p.h);if(30<T.g.length){if(k(T)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=p;0>=E.l(T);)I=H(I),E=H(E);var v=Q(I,1),P=Q(E,1);for(E=Q(E,2),I=Q(I,2);!b(E);){var y=P.add(E);0>=y.l(T)&&(v=v.add(I),P=y),E=Q(E,1),I=Q(I,1)}return p=B(T,v.j(p)),new q(v,p)}for(v=g;0<=T.l(p);){for(I=Math.max(1,Math.floor(T.m()/p.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(P=h(I)).j(p);k(y)||0<y.l(T);)y=(P=h(I-=E)).j(p);b(P)&&(P=_),v=v.add(P),T=B(T,y)}return new q(v,T)}function H(T){for(var p=T.g.length+1,I=[],E=0;E<p;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(I,T.h)}function Q(T,p){var I=p>>5;p%=32;for(var E=T.g.length-I,v=[],P=0;P<E;P++)v[P]=0<p?T.i(P+I)>>>p|T.i(P+I+1)<<32-p:T.i(P+I);return new a(v,T.h)}(r=a.prototype).m=function(){if(k(this))return-D(this).m();for(var T=0,p=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(k(this))return"-"+D(this).toString(T);for(var p=h(Math.pow(T,6)),I=this,E="";;){var v=K(I,p).g,P=((0<(I=B(I,v.j(p))).g.length?I.g[0]:I.h)>>>0).toString(T);if(b(I=v))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return k(T=B(this,T))?-1:b(T)?0:1},r.abs=function(){return k(this)?D(this):this},r.add=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=p;v++){var P=E+(65535&this.i(v))+(65535&T.i(v)),y=(P>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(P&=65535)}return new a(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(b(this)||b(T))return g;if(k(this))return k(T)?D(this).j(D(T)):D(D(this).j(T));if(k(T))return D(this.j(D(T)));if(0>this.l(R)&&0>T.l(R))return h(this.m()*T.m());for(var p=this.g.length+T.g.length,I=[],E=0;E<2*p;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var P=this.i(E)>>>16,y=65535&this.i(E),gt=T.i(v)>>>16,jr=65535&T.i(v);I[2*E+2*v]+=y*jr,z(I,2*E+2*v),I[2*E+2*v+1]+=P*jr,z(I,2*E+2*v+1),I[2*E+2*v+1]+=y*gt,z(I,2*E+2*v+1),I[2*E+2*v+2]+=P*gt,z(I,2*E+2*v+2)}for(E=0;E<p;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=p;E<2*p;E++)I[E]=0;return new a(I,0)},r.A=function(T){return K(this,T).h},r.and=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)&T.i(E);return new a(I,this.h&T.h)},r.or=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)|T.i(E);return new a(I,this.h|T.h)},r.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)^T.i(E);return new a(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Mu=Fu.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,p){if(0==T.length)throw Error("number format error: empty string");if(2>(p=p||10)||36<p)throw Error("radix out of range: "+p);if("-"==T.charAt(0))return D(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(p,8)),E=g,v=0;v<T.length;v+=8){var P=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+P),p);8>P?(P=h(Math.pow(p,P)),E=E.j(P).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},Gt=Fu.Integer=a}).apply(typeof ku<"u"?ku:typeof self<"u"?self:typeof window<"u"?window:{});var Ou,Lu,rr,Bu,mi,ks,qu,Uu,Gu,fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof fi&&fi];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var A=o[m];if(!(A in d))break e;d=d[A]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,A={next:function(){if(!m&&d<o.length){var V=d++;return{value:l(V,o[V]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),o.apply(l,A)}}return function(){return o.apply(l,arguments)}}function _(o,l,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function R(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function b(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,A,V){for(var M=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)M[ie-2]=arguments[ie];return l.prototype[A].apply(m,M)}}function k(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function D(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const A=o.length||0,V=m.length||0;o.length=A+V;for(let M=0;M<V;M++)o[A+M]=m[M]}else o.push(m)}}function z(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function K(o){return K[" "](o),o}K[" "]=function(){};var H=!(-1==q().indexOf("Gecko")||-1!=q().toLowerCase().indexOf("webkit")&&-1==q().indexOf("Edge")||-1!=q().indexOf("Trident")||-1!=q().indexOf("MSIE")||-1!=q().indexOf("Edge"));function Q(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function p(o){const l={};for(const d in o)l[d]=o[d];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let d,m;for(let A=1;A<arguments.length;A++){for(d in m=arguments[A],m)o[d]=m[d];for(let V=0;V<I.length;V++)d=I[V],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function v(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function P(o){u.setTimeout(()=>{throw o},0)}function y(){var o=ou;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var jr=new class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new vy,o=>o.reset());class vy{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let $r,Qr=!1,ou=new class gt{constructor(){this.h=this.g=null}add(l,d){const m=jr.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},Od=()=>{const o=u.Promise.resolve(void 0);$r=()=>{o.then(Ay)}};var Ay=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){P(d)}var l=jr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Qr=!1};function Lt(){this.s=this.s,this.C=this.C}function Ne(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Lt.prototype.s=!1,Lt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Lt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ne.prototype.h=function(){this.defaultPrevented=!0};var wy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Wr(o,l){if(Ne.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(H){e:{try{K(l.nodeName);var A=!0;break e}catch{}A=!1}A||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:Ry[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Wr.aa.h.call(this)}}b(Wr,Ne);var Ry={2:"touch",3:"pen",4:"mouse"};Wr.prototype.h=function(){Wr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Hr="closure_listenable_"+(1e6*Math.random()|0),Py=0;function Sy(o,l,d,m,A){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=A,this.key=++Py,this.da=this.fa=!1}function ms(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function gs(o){this.src=o,this.g={},this.h=0}function au(o,l){var d=l.type;if(d in o.g){var V,m=o.g[d],A=Array.prototype.indexOf.call(m,l,void 0);(V=0<=A)&&Array.prototype.splice.call(m,A,1),V&&(ms(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function uu(o,l,d,m){for(var A=0;A<o.length;++A){var V=o[A];if(!V.da&&V.listener==l&&V.capture==!!d&&V.ha==m)return A}return-1}gs.prototype.add=function(o,l,d,m,A){var V=o.toString();(o=this.g[V])||(o=this.g[V]=[],this.h++);var M=uu(o,l,m,A);return-1<M?(l=o[M],d||(l.fa=!1)):((l=new Sy(l,this.src,V,!!m,A)).fa=d,o.push(l)),l};var cu="closure_lm_"+(1e6*Math.random()|0),lu={};function Ld(o,l,d,m,A){if(m&&m.once)return qd(o,l,d,m,A);if(Array.isArray(l)){for(var V=0;V<l.length;V++)Ld(o,l[V],d,m,A);return null}return d=mu(d),o&&o[Hr]?o.K(l,d,h(m)?!!m.capture:!!m,A):Bd(o,l,d,!1,m,A)}function Bd(o,l,d,m,A,V){if(!l)throw Error("Invalid event type");var M=h(A)?!!A.capture:!!A,ie=du(o);if(ie||(o[cu]=ie=new gs(o)),(d=ie.add(l,d,m,M,V)).proxy)return d;if(m=function Vy(){const l=xy;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)wy||(A=M),void 0===A&&(A=!1),o.addEventListener(l.toString(),m,A);else if(o.attachEvent)o.attachEvent(Gd(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function qd(o,l,d,m,A){if(Array.isArray(l)){for(var V=0;V<l.length;V++)qd(o,l[V],d,m,A);return null}return d=mu(d),o&&o[Hr]?o.L(l,d,h(m)?!!m.capture:!!m,A):Bd(o,l,d,!0,m,A)}function Ud(o,l,d,m,A){if(Array.isArray(l))for(var V=0;V<l.length;V++)Ud(o,l[V],d,m,A);else m=h(m)?!!m.capture:!!m,d=mu(d),o&&o[Hr]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=uu(V=o.g[l],d,m,A))&&(ms(V[d]),Array.prototype.splice.call(V,d,1),0==V.length&&(delete o.g[l],o.h--))):o&&(o=du(o))&&(l=o.g[l.toString()],o=-1,l&&(o=uu(l,d,m,A)),(d=-1<o?l[o]:null)&&hu(d))}function hu(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Hr])au(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(Gd(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=du(l))?(au(d,o),0==d.h&&(d.src=null,l[cu]=null)):ms(o)}}}function Gd(o){return o in lu?lu[o]:lu[o]="on"+o}function xy(o,l){if(o.da)o=!0;else{l=new Wr(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&hu(o),o=d.call(m,l)}return o}function du(o){return(o=o[cu])instanceof gs?o:null}var fu="__closure_events_fn_"+(1e9*Math.random()>>>0);function mu(o){return"function"==typeof o?o:(o[fu]||(o[fu]=function(l){return o.handleEvent(l)}),o[fu])}function ke(){Lt.call(this),this.i=new gs(this),this.M=this,this.F=null}function Be(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new Ne(l,o);else if(l instanceof Ne)l.target=l.target||o;else{var A=l;E(l=new Ne(m,o),A)}if(A=!0,d)for(var V=d.length-1;0<=V;V--){var M=l.g=d[V];A=ps(M,m,!0,l)&&A}if(A=ps(M=l.g=o,m,!0,l)&&A,A=ps(M,m,!1,l)&&A,d)for(V=0;V<d.length;V++)A=ps(M=l.g=d[V],m,!1,l)&&A}function ps(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var A=!0,V=0;V<l.length;++V){var M=l[V];if(M&&!M.da&&M.capture==d){var ie=M.listener,Ve=M.ha||M.src;M.fa&&au(o.i,M),A=!1!==ie.call(Ve,m)&&A}}return A&&!m.defaultPrevented}function zd(o,l,d){if("function"==typeof o)d&&(o=_(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=_(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Kd(o){o.g=zd(()=>{o.g=null,o.i&&(o.i=!1,Kd(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}b(ke,Lt),ke.prototype[Hr]=!0,ke.prototype.removeEventListener=function(o,l,d,m){Ud(this,o,l,d,m)},ke.prototype.N=function(){if(ke.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)ms(d[m]);delete o.g[l],o.h--}}this.F=null},ke.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},ke.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class by extends Lt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Kd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jr(o){Lt.call(this),this.h=o,this.g={}}b(Jr,Lt);var jd=[];function $d(o){Q(o.g,function(l,d){this.g.hasOwnProperty(d)&&hu(l)},o),o.g={}}Jr.prototype.N=function(){Jr.aa.N.call(this),$d(this)},Jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gu=u.JSON.stringify,Cy=u.JSON.parse,Dy=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function pu(){}function Wd(){}pu.prototype.h=null;var Yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function _u(){Ne.call(this,"d")}function yu(){Ne.call(this,"c")}b(_u,Ne),b(yu,Ne);var hn={},Hd=null;function _s(){return Hd=Hd||new ke}function Jd(o){Ne.call(this,hn.La,o)}function Xr(o){const l=_s();Be(l,new Jd(l))}function Yd(o,l){Ne.call(this,hn.STAT_EVENT,o),this.stat=l}function qe(o){const l=_s();Be(l,new Yd(l,o))}function Xd(o,l){Ne.call(this,hn.Ma,o),this.size=l}function Zr(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function ei(){this.g=!0}function Zn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function My(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var V=A[0];if("noop"!=V&&"stop"!=V&&"close"!=V)for(var M=1;M<A.length;M++)A[M]=""}}}return gu(d)}catch{return l}}(o,d)+(m?" "+m:"")})}hn.La="serverreachability",b(Jd,Ne),hn.STAT_EVENT="statevent",b(Yd,Ne),hn.Ma="timingevent",b(Xd,Ne),ei.prototype.xa=function(){this.g=!1},ei.prototype.info=function(){};var Iu,ys={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Is(){}function Bt(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new Jr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ef}function ef(){this.i=null,this.g="",this.h=!1}b(Is,pu),Is.prototype.g=function(){return new XMLHttpRequest},Is.prototype.i=function(){return{}},Iu=new Is;var tf={},Tu={};function Eu(o,l,d){o.L=1,o.v=As(pt(l)),o.m=d,o.P=!0,nf(o,null)}function nf(o,l){o.F=Date.now(),Ts(o),o.A=pt(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),_f(d.i,"t",m),o.C=0,d=o.j.J,o.h=new ef,o.g=Ff(o.j,d?l:null,!o.m),0<o.O&&(o.M=new by(_(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(jd[0]=A.toString()),A=jd);for(var V=0;V<A.length;V++){var M=Ld(d,A[V],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Xr(),function Ny(o,l,d,m,A,V){o.info(function(){if(o.g)if(V)for(var M="",ie=V.split("&"),Ve=0;Ve<ie.length;Ve++){var Z=ie[Ve].split("=");if(1<Z.length){var Fe=Z[0];Z=Z[1];var Me=Fe.split("_");M=2<=Me.length&&"type"==Me[1]?M+(Fe+"=")+Z+"&":M+(Fe+"=redacted&")}}else M=null;else M=V;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+l+"\n"+d+"\n"+M})}(o.i,o.u,o.A,o.l,o.R,o.m)}function rf(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function Oy(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?Tu:(d=Number(l.substring(d,m)),isNaN(d)?tf:(m+=1)+d>l.length?Tu:(l=l.slice(m,m+d),o.C=m+d,l))}function Ts(o){o.S=Date.now()+o.I,sf(o,o.I)}function sf(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=Zr(_(o.ba,o),l)}function vu(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function ti(o){0==o.j.G||o.J||Cf(o.j,o)}function dn(o){vu(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,$d(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Au(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||wu(d.h,o)))if(!o.K&&wu(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var A=m;if(0==A[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;Vs(d),Ps(d)}Vu(d),qe(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&0==d.v&&!d.C&&(d.C=Zr(_(d.Za,d),6e3));if(1>=uf(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else mn(d,11)}else if((o.K||d.g==o)&&Vs(d),!z(l))for(A=d.Da.g.parse(l),l=0;l<A.length;l++){let Z=A[l];if(d.T=Z[0],Z=Z[1],2==d.G)if("c"==Z[0]){d.K=Z[1],d.ia=Z[2];const Fe=Z[3];null!=Fe&&(d.la=Fe,d.j.info("VER="+d.la));const Me=Z[4];null!=Me&&(d.Aa=Me,d.j.info("SVER="+d.Aa));const nr=Z[5];null!=nr&&"number"==typeof nr&&0<nr&&(d.L=m=1.5*nr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const He=o.g;if(He){const bs=He.g?He.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bs){var V=m.h;V.g||-1==bs.indexOf("spdy")&&-1==bs.indexOf("quic")&&-1==bs.indexOf("h2")||(V.j=V.l,V.g=new Set,V.h&&(Ru(V,V.h),V.h=null))}if(m.D){const bu=He.g?He.g.getResponseHeader("X-HTTP-Session-Id"):null;bu&&(m.ya=bu,he(m.I,m.D,bu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var M=o;if((m=d).qa=kf(m,m.J?m.ia:null,m.W),M.K){cf(m.h,M);var ie=M,Ve=m.L;Ve&&(ie.I=Ve),ie.B&&(vu(ie),Ts(ie)),m.g=M}else xf(m);0<d.i.length&&Ss(d)}else"stop"!=Z[0]&&"close"!=Z[0]||mn(d,7);else 3==d.G&&("stop"==Z[0]||"close"==Z[0]?"stop"==Z[0]?mn(d,7):Su(d):"noop"!=Z[0]&&d.l&&d.l.ta(Z),d.v=0)}Xr()}catch{}}Bt.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==_t(o)?l.j():this.Y(o)},Bt.prototype.Y=function(o){try{if(o==this.g)e:{const Me=_t(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Me)&&(3!=Me||this.g&&(this.h.h||this.g.oa()||wf(this.g)))){this.J||4!=Me||7==l||Xr(),vu(this);var d=this.g.Z();this.X=d;t:if(rf(this)){var m=wf(this.g);o="";var A=m.length,V=4==_t(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){dn(this),ti(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<A;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(V&&l==A-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=200==d,function ky(o,l,d,m,A,V,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+l+"\n"+d+"\n"+V+" "+M})}(this.i,this.u,this.A,this.l,this.R,Me,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Ve=this.g;if((ie=Ve.g?Ve.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(ie)){var Z=ie;break t}}Z=null}if(!(d=Z)){this.o=!1,this.s=3,qe(12),dn(this),ti(this);break e}Zn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Au(this,d)}if(this.P){let He;for(d=!0;!this.J&&this.C<M.length;){if(He=Oy(this,M),He==Tu){4==Me&&(this.s=4,qe(14),d=!1),Zn(this.i,this.l,null,"[Incomplete Response]");break}if(He==tf){this.s=4,qe(15),Zn(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}Zn(this.i,this.l,He,null),Au(this,He)}if(rf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Me||0!=M.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<M.length&&!this.W){this.W=!0;var Fe=this.j;Fe.g==this&&Fe.ba&&!Fe.M&&(Fe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),xu(Fe),Fe.M=!0,qe(11))}}else Zn(this.i,this.l,M,"[Invalid Chunked Response]"),dn(this),ti(this)}else Zn(this.i,this.l,M,null),Au(this,M);4==Me&&dn(this),this.o&&!this.J&&(4==Me?Cf(this.j,this):(this.o=!1,Ts(this)))}else(function eI(o){const l={};o=(o.g&&2<=_t(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(z(o[m]))continue;var d=v(o[m]);const A=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const V=l[A]||[];l[A]=V,V.push(d)}!function T(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<M.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),dn(this),ti(this)}}}catch{}},Bt.prototype.cancel=function(){this.J=!0,dn(this)},Bt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function Fy(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Xr(),qe(17)),dn(this),this.s=2,ti(this)):sf(this,this.S-o)};var Ly=class{constructor(o,l){this.g=o,this.map=l}};function of(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function af(o){return!!o.h||!!o.g&&o.g.size>=o.j}function uf(o){return o.h?1:o.g?o.g.size:0}function wu(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function Ru(o,l){o.g?o.g.add(l):o.h=l}function cf(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function lf(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return k(o.i)}function hf(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function qy(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function By(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),A=m.length,V=0;V<A;V++)l.call(void 0,m[V],d&&d[V],o)}of.prototype.cancel=function(){if(this.i=lf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var df=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof fn){this.h=o.h,Es(this,o.j),this.o=o.o,this.g=o.g,vs(this,o.s),this.l=o.l;var l=o.i,d=new ii;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),ff(this,d),this.m=o.m}else o&&(l=String(o).match(df))?(this.h=!1,Es(this,l[1]||"",!0),this.o=ni(l[2]||""),this.g=ni(l[3]||"",!0),vs(this,l[4]),this.l=ni(l[5]||"",!0),ff(this,l[6]||"",!0),this.m=ni(l[7]||"")):(this.h=!1,this.i=new ii(null,this.h))}function pt(o){return new fn(o)}function Es(o,l,d){o.j=d?ni(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function vs(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function ff(o,l,d){l instanceof ii?(o.i=l,function Qy(o,l){l&&!o.j&&(qt(o),o.i=null,o.g.forEach(function(d,m){var A=m.toLowerCase();m!=A&&(gf(this,m),_f(this,A,d))},o)),o.j=l}(o.i,o.h)):(d||(l=ri(l,jy)),o.i=new ii(l,o.h))}function he(o,l,d){o.i.set(l,d)}function As(o){return he(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ni(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ri(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,Gy),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Gy(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}fn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(ri(l,mf,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(ri(l,mf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(ri(d,"/"==d.charAt(0)?Ky:zy,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",ri(d,$y)),o.join("")};var mf=/[#\/\?@]/g,zy=/[#\?:]/g,Ky=/[#\?]/g,jy=/[#\?@]/g,$y=/#/g;function ii(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function qt(o){o.g||(o.g=new Map,o.h=0,o.i&&function Uy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),A=null;if(0<=m){var V=o[d].substring(0,m);A=o[d].substring(m+1)}else V=o[d];l(V,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function gf(o,l){qt(o),l=er(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function pf(o,l){return qt(o),l=er(o,l),o.g.has(l)}function _f(o,l,d){gf(o,l),0<d.length&&(o.i=null,o.g.set(er(o,l),k(d)),o.h+=d.length)}function er(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Ut(o,l,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function Jy(){this.g=new Dy}function Yy(o,l,d){const m=d||"";try{hf(o,function(A,V){let M=A;h(A)&&(M=gu(A)),l.push(m+V+"="+encodeURIComponent(M))})}catch(A){throw l.push(m+"type="+encodeURIComponent("_badmap")),A}}function si(o){this.l=o.Ub||null,this.j=o.eb||!1}function ws(o,l){ke.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function yf(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function oi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ai(o)}function ai(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function If(o){let l="";return Q(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function Pu(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=If(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):he(o,l,d))}function _e(o){ke.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ii.prototype).add=function(o,l){qt(this),this.i=null,o=er(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){qt(this),this.g.forEach(function(d,m){d.forEach(function(A){o.call(l,A,m,this)},this)},this)},r.na=function(){qt(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const A=o[m];for(let V=0;V<A.length;V++)d.push(l[m])}return d},r.V=function(o){qt(this);let l=[];if("string"==typeof o)pf(this,o)&&(l=l.concat(this.g.get(er(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return qt(this),this.i=null,pf(this,o=er(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const V=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var A=V;""!==M[m]&&(A+="="+encodeURIComponent(String(M[m]))),o.push(A)}}return this.i=o.join("&")},b(si,pu),si.prototype.g=function(){return new ws(this.l,this.j)},si.prototype.i=function(o){return function(){return o}}({}),b(ws,ke),(r=ws.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,ai(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,oi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ai(this)),this.g&&(this.readyState=3,ai(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yf(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?oi(this):ai(this),3==this.readyState&&yf(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,oi(this))},r.Qa=function(o){this.g&&(this.response=o,oi(this))},r.ga=function(){this.g&&oi(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(ws.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),b(_e,ke);var Xy=/^https?$/i,Zy=["POST","PUT"];function Tf(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Ef(o),Rs(o)}function Ef(o){o.A||(o.A=!0,Be(o,"complete"),Be(o,"error"))}function vf(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=_t(o)||2!=o.Z()))if(o.u&&4==_t(o))zd(o.Ea,0,o);else if(Be(o,"readystatechange"),4==_t(o)){o.h=!1;try{const M=o.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===M){var A=String(o.D).match(df)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),m=!Xy.test(A?A.toLowerCase():"")}d=m}if(d)Be(o,"complete"),Be(o,"success");else{o.m=6;try{var V=2<_t(o)?o.g.statusText:""}catch{V=""}o.l=V+" ["+o.Z()+"]",Ef(o)}}finally{Rs(o)}}}function Rs(o,l){if(o.g){Af(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Be(o,"ready");try{d.onreadystatechange=m}catch{}}}function Af(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function _t(o){return o.g?o.g.readyState:0}function wf(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ui(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Rf(o){this.Aa=0,this.i=[],this.j=new ei,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ui("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ui("baseRetryDelayMs",5e3,o),this.cb=ui("retryDelaySeedMs",1e4,o),this.Wa=ui("forwardChannelMaxRetries",2,o),this.wa=ui("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new of(o&&o.concurrentRequestLimit),this.Da=new Jy,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Su(o){if(Pf(o),3==o.G){var l=o.U++,d=pt(o.I);if(he(d,"SID",o.K),he(d,"RID",l),he(d,"TYPE","terminate"),ci(o,d),(l=new Bt(o,o.j,l)).L=2,l.v=As(pt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Ff(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ts(l)}Nf(o)}function Ps(o){o.g&&(xu(o),o.g.cancel(),o.g=null)}function Pf(o){Ps(o),o.u&&(u.clearTimeout(o.u),o.u=null),Vs(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function Ss(o){if(!af(o.h)&&!o.s){o.s=!0;var l=o.Ga;$r||Od(),Qr||($r(),Qr=!0),ou.add(l,o),o.B=0}}function Sf(o,l){var d;d=l?l.l:o.U++;const m=pt(o.I);he(m,"SID",o.K),he(m,"RID",d),he(m,"AID",o.T),ci(o,m),o.m&&o.o&&Pu(m,o.m,o.o),d=new Bt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Vf(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ru(o.h,d),Eu(d,m,l)}function ci(o,l){o.H&&Q(o.H,function(d,m){he(l,m,d)}),o.l&&hf({},function(d,m){he(l,m,d)})}function Vf(o,l,d){d=Math.min(o.i.length,d);var m=o.l?_(o.l.Na,o.l,o):null;e:{var A=o.i;let V=-1;for(;;){const M=["count="+d];-1==V?0<d?(V=A[0].g,M.push("ofs="+V)):V=0:M.push("ofs="+V);let ie=!0;for(let Ve=0;Ve<d;Ve++){let Z=A[Ve].g;const Fe=A[Ve].map;if(Z-=V,0>Z)V=Math.max(0,A[Ve].g-100),ie=!1;else try{Yy(Fe,M,"req"+Z+"_")}catch{m&&m(Fe)}}if(ie){m=M.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function xf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;$r||Od(),Qr||($r(),Qr=!0),ou.add(l,o),o.v=0}}function Vu(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=Zr(_(o.Fa,o),Df(o,o.v)),o.v++,0))}function xu(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function bf(o){o.g=new Bt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=pt(o.qa);he(l,"RID","rpc"),he(l,"SID",o.K),he(l,"AID",o.T),he(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&he(l,"TO",o.ja),he(l,"TYPE","xmlhttp"),ci(o,l),o.m&&o.o&&Pu(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=As(pt(l)),d.m=null,d.P=!0,nf(d,o)}function Vs(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Cf(o,l){var d=null;if(o.g==l){Vs(o),xu(o),o.g=null;var m=2}else{if(!wu(o.h,l))return;d=l.D,cf(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var A=o.B;Be(m=_s(),new Xd(m,d)),Ss(o)}else xf(o);else if(3==(A=l.s)||0==A&&0<l.X||!(1==m&&function tI(o,l){return!(uf(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=Zr(_(o.Ga,o,l),Df(o,o.B)),o.B++,0)))}(o,l)||2==m&&Vu(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),A){case 1:mn(o,5);break;case 4:mn(o,10);break;case 3:mn(o,6);break;default:mn(o,2)}}function Df(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function mn(o,l){if(o.j.info("Error code "+l),2==l){var d=_(o.fb,o),m=o.Xa;const A=!m;m=new fn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Es(m,"https"),As(m),A?function Wy(o,l){const d=new ei;if(u.Image){const m=new Image;m.onload=R(Ut,d,"TestLoadImage: loaded",!0,l,m),m.onerror=R(Ut,d,"TestLoadImage: error",!1,l,m),m.onabort=R(Ut,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(Ut,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function Hy(o,l){new ei;const m=new AbortController,A=setTimeout(()=>{m.abort(),Ut(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(V=>{clearTimeout(A),Ut(0,0,!!V.ok,l)}).catch(()=>{clearTimeout(A),Ut(0,0,!1,l)})}(m.toString(),d)}else qe(2);o.G=0,o.l&&o.l.sa(l),Nf(o),Pf(o)}function Nf(o){if(o.G=0,o.ka=[],o.l){const l=lf(o.h);(0!=l.length||0!=o.i.length)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function kf(o,l,d){var m=d instanceof fn?pt(d):new fn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),vs(m,m.s);else{var A=u.location;m=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;var V=new fn(null);m&&Es(V,m),l&&(V.g=l),A&&vs(V,A),d&&(V.l=d),m=V}return l=o.ya,(d=o.D)&&l&&he(m,d,l),he(m,"VER",o.la),ci(o,m),m}function Ff(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new _e(o.Ca&&!o.pa?new si({eb:d}):o.pa)).Ha(o.J),l}function Mf(){}function xs(){}function Qe(o,l){ke.call(this),this.g=new Rf(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!z(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new tr(this)}function Of(o){_u.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Lf(){yu.call(this),this.status=1}function tr(o){this.g=o}(r=_e.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Iu.g(),this.v=function Qd(o){return o.h||(o.h=o.i())}(this.o?this.o:Iu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(V){return void Tf(this,V)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const V of m.keys())d.set(V,m.get(V))}m=Array.from(d.keys()).find(V=>"content-type"==V.toLowerCase()),A=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Zy,l,void 0))||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,M]of d)this.g.setRequestHeader(V,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Af(this),this.u=!0,this.g.send(o),this.u=!1}catch(V){Tf(this,V)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Be(this,"complete"),Be(this,"abort"),Rs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Rs(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?vf(this):this.bb())},r.bb=function(){vf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<_t(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),Cy(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Rf.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){qe(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=kf(this,null,this.W),Ss(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const A=new Bt(this,this.j,o);let V=this.o;if(this.S&&(V?(V=p(V),E(V,this.S)):V=this.S),null!==this.m||this.O||(A.H=V,V=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Vf(this,A,l),he(d=pt(this.I),"RID",o),he(d,"CVER",22),this.D&&he(d,"X-HTTP-Session-Id",this.D),ci(this,d),V&&(this.O?l="headers="+encodeURIComponent(String(If(V)))+"&"+l:this.m&&Pu(d,this.m,V)),Ru(this.h,A),this.Ua&&he(d,"TYPE","init"),this.P?(he(d,"$req",l),he(d,"SID","null"),A.T=!0,Eu(A,d,null)):Eu(A,d,l),this.G=2}}else 3==this.G&&(o?Sf(this,o):0==this.i.length||af(this.h)||Sf(this))},r.Fa=function(){if(this.u=null,bf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Zr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Ps(this),bf(this))},r.Za=function(){null!=this.C&&(this.C=null,Ps(this),Vu(this),qe(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Mf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},xs.prototype.g=function(o,l){return new Qe(o,l)},b(Qe,ke),Qe.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Qe.prototype.close=function(){Su(this.g)},Qe.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=gu(o),o=d);l.i.push(new Ly(l.Ya++,o)),3==l.G&&Ss(l)},Qe.prototype.N=function(){this.g.l=null,delete this.j,Su(this.g),delete this.g,Qe.aa.N.call(this)},b(Of,_u),b(Lf,yu),b(tr,Mf),tr.prototype.ua=function(){Be(this.g,"a")},tr.prototype.ta=function(o){Be(this.g,new Of(o))},tr.prototype.sa=function(o){Be(this.g,new Lf)},tr.prototype.ra=function(){Be(this.g,"b")},xs.prototype.createWebChannel=xs.prototype.g,Qe.prototype.send=Qe.prototype.o,Qe.prototype.open=Qe.prototype.m,Qe.prototype.close=Qe.prototype.close,Gu=st.createWebChannelTransport=function(){return new xs},Uu=st.getStatEventTarget=function(){return _s()},qu=st.Event=hn,ks=st.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ys.NO_ERROR=0,ys.TIMEOUT=8,ys.HTTP_ERROR=6,mi=st.ErrorCode=ys,Zd.COMPLETE="complete",Bu=st.EventType=Zd,Wd.EventType=Yr,Yr.OPEN="a",Yr.CLOSE="b",Yr.ERROR="c",Yr.MESSAGE="d",ke.prototype.listen=ke.prototype.K,rr=st.WebChannel=Wd,Lu=st.FetchXmlHttpFactory=si,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Ou=st.XhrIo=_e}).apply(typeof fi<"u"?fi:typeof self<"u"?self:typeof window<"u"?window:{});const zu="@firebase/firestore";class Ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let gn="10.12.5";const It=new Ye.Vy("@firebase/firestore");function pn(){return It.logLevel}function N(r,...e){if(It.logLevel<=Ye.$b.DEBUG){const t=e.map(Fs);It.debug(`Firestore (${gn}): ${r}`,...t)}}function ye(r,...e){if(It.logLevel<=Ye.$b.ERROR){const t=e.map(Fs);It.error(`Firestore (${gn}): ${r}`,...t)}}function Ge(r,...e){if(It.logLevel<=Ye.$b.WARN){const t=e.map(Fs);It.warn(`Firestore (${gn}): ${r}`,...t)}}function Fs(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function L(r="Unexpected state"){const e=`FIRESTORE (${gn}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function U(r,e){r||L()}function F(r,e){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends ee.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ee{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ku{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Hf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}}class Jf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yf{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Ee;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ee,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,x.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ee)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U("string"==typeof n.accessToken),new Ku(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e),new Ae(e)}}class Xf{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zf{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Xf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ju{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class em{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U("string"==typeof t.token),this.R=t.token,new ju(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function tm(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class $u{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=tm(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function j(r,e){return r<e?-1:r>e?1:0}function _n(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Qu(r){return r+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new de(0,0))}static max(){return new G(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ir{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(),void 0===n?n=e.length-t:n>e.length-t&&L(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ir.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ir?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class J extends ir{construct(e,t,n){return new J(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new J(t)}static emptyPath(){return new J([])}}const nm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends ir{construct(e,t,n){return new ue(e,t,n)}static isValidIdentifier(e){return nm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new C(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(J.fromString(e))}static fromName(e){return new O(J.fromString(e).popFirst(5))}static empty(){return new O(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===J.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new J(e.slice()))}}class yn{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Ms(r){return r.fields.find(e=>2===e.kind)}function zt(r){return r.fields.filter(e=>2!==e.kind)}yn.UNKNOWN_ID=-1;class Kt{constructor(e,t){this.fieldPath=e,this.kind=t}}class In{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new In(0,je.min())}}function Wu(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new je(i,O.empty(),e)}function Hu(r){return new je(r.readTime,r.key,-1)}class je{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new je(G.min(),O.empty(),-1)}static max(){return new je(G.max(),O.empty(),-1)}}function Os(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(r.documentKey,e.documentKey),0!==t?t:j(r.largestBatchId,e.largestBatchId))}const Ju="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Yu{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Tt(r){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,x.A)(function*(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==Ju)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,n)=>{t(e)})}static reject(e){return new w((t,n)=>{n(e)})}static waitFor(e){return new w((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const n of e)t=t.next(i=>i?w.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new w((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new w((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class gi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ee,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new sr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=Bs(n.target.error);this.V.reject(new sr(e,i))}}static open(e,t,n,i){try{return new gi(t,e.transaction(i,n))}catch(s){throw new sr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new om(t)}}class Xe{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Xe.S((0,ee.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),jt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ee.zW)())return!1;if(Xe.C())return!0;const e=(0,ee.ZQ)(),t=Xe.S(e),n=0<t&&t<10,i=Xu(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,x.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new sr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new C(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new sr(e,u))},s.onupgradeneeded=a=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,x.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=gi.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),w.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Xu(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class sm{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return jt(this.B.delete())}}class sr extends C{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Et(r){return"IndexedDbTransactionError"===r.name}class om{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),jt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),jt(this.store.add(e))}get(e){return jt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),jt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),jt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new w((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new w((n,i)=>{t.onerror=s=>{const a=Bs(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new w((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new sm(u),h=t(u.primaryKey,u.value,c);if(h instanceof w){const f=h.catch(g=>(c.done(),w.reject(g)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>w.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function jt(r){return new w((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=Bs(n.target.error);t(i)}})}let Zu=!1;function Bs(r){const e=Xe.S((0,ee.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Zu||(Zu=!0,setTimeout(()=>{throw n},0)),n}}return r}class am{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,x.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){Et(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Tt(n)}yield t.X(6e4)}))}}class um{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,x.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return N("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=Hu(s);Os(a,n)>0&&(n=a)}),new je(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let $e=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function or(r){return null==r}function ar(r){return 0===r&&1/r==-1/0}function ec(r){return"number"==typeof r&&Number.isInteger(r)&&!ar(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function xe(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=tc(e)),e=cm(r.get(t),e);return tc(e)}function cm(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function tc(r){return r+"\x01\x01"}function Ze(r){const e=r.length;if(U(e>=2),2===e)return U("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),J.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&L(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}const nc=["userId","batchId"];function pi(r,e){return[r,xe(e)]}function rc(r,e,t){return[r,xe(e),t]}const lm={},hm=["prefixPath","collectionGroup","readTime","documentId"],dm=["prefixPath","collectionGroup","documentId"],fm=["collectionGroup","readTime","prefixPath","documentId"],mm=["canonicalId","targetId"],gm=["targetId","path"],pm=["path","targetId"],_m=["collectionId","parent"],ym=["indexId","uid"],Im=["uid","sequenceNumber"],Tm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Em=["indexId","uid","orderedDocumentKey"],vm=["userId","collectionPath","documentId"],Am=["userId","collectionPath","largestBatchId"],wm=["userId","collectionGroup","largestBatchId"],ic=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Rm=[...ic,"documentOverlays"],sc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],oc=sc,qs=[...oc,"indexConfiguration","indexState","indexEntries"],Pm=qs,Sm=[...qs,"globals"];class Us extends Yu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function ve(r,e){const t=F(r);return Xe.F(t._e,e)}function ac(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function cc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class oe{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Re.RED,this.left=i??Re.EMPTY,this.right=s??Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Re(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lc(this.data.getIterator())}getIteratorFrom(e){return new lc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class lc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Tn(r){return r.hasNext()?r.getNext():void 0}class ze{constructor(e){this.fields=e,e.sort(ue.comparator)}static empty(){return new ze([])}unionWith(e){let t=new ne(ue.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ze(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _n(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class hc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ge{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new hc("Invalid base64 string: "+s):s}}(e);return new ge(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new ge(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ge.EMPTY_BYTE_STRING=new ge("");const xm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ot(r){if(U(!!r),"string"==typeof r){let e=0;const t=xm.exec(r);if(U(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:pe(r.seconds),nanos:pe(r.nanos)}}function pe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function at(r){return"string"==typeof r?ge.fromBase64String(r):ge.fromUint8Array(r)}function yi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ii(r){const e=r.mapValue.fields.__previous_value__;return yi(e)?Ii(e):e}function ur(r){const e=ot(r.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}class bm{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class At{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new At("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof At&&e.projectId===this.projectId&&e.database===this.database}}const wt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ti={nullValue:"NULL_VALUE"};function Rt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?yi(r)?4:gc(r)?9007199254740991:10:L()}function et(r,e){if(r===e)return!0;const t=Rt(r);if(t!==Rt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ur(r).isEqual(ur(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=ot(i.timestampValue),u=ot(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,at(r.bytesValue).isEqual(at(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return pe(i.geoPointValue.latitude)===pe(s.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return pe(i.integerValue)===pe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=pe(i.doubleValue),u=pe(s.doubleValue);return a===u?ar(a)===ar(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return _n(r.arrayValue.values||[],e.arrayValue.values||[],et);case 10:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(ac(a)!==ac(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!et(a[c],u[c])))return!1;return!0}(r,e);default:return L()}var s}function cr(r,e){return void 0!==(r.values||[]).find(t=>et(t,e))}function Pt(r,e){if(r===e)return 0;const t=Rt(r),n=Rt(e);if(t!==n)return j(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=pe(s.integerValue||s.doubleValue),c=pe(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return dc(r.timestampValue,e.timestampValue);case 4:return dc(ur(r),ur(e));case 5:return j(r.stringValue,e.stringValue);case 6:return function(s,a){const u=at(s),c=at(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=j(u[h],c[h]);if(0!==f)return f}return j(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=j(pe(s.latitude),pe(a.latitude));return 0!==u?u:j(pe(s.longitude),pe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,a){const u=s.values||[],c=a.values||[];for(let h=0;h<u.length&&h<c.length;++h){const f=Pt(u[h],c[h]);if(f)return f}return j(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===wt.mapValue&&a===wt.mapValue)return 0;if(s===wt.mapValue)return 1;if(a===wt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){const _=j(c[g],f[g]);if(0!==_)return _;const R=Pt(u[c[g]],h[f[g]]);if(0!==R)return R}return j(c.length,f.length)}(r.mapValue,e.mapValue);default:throw L()}}function dc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return j(r,e);const t=ot(r),n=ot(e),i=j(t.seconds,n.seconds);return 0!==i?i:j(t.nanos,n.nanos)}function En(r){return Gs(r)}function Gs(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ot(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?at(r.bytesValue).toBase64():"referenceValue"in r?O.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Gs(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${Gs(t.fields[a])}`;return i+"}"}(r.mapValue):L()}function $t(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function zs(r){return!!r&&"integerValue"in r}function lr(r){return!!r&&"arrayValue"in r}function fc(r){return!!r&&"nullValue"in r}function mc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function vi(r){return!!r&&"mapValue"in r}function hr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return vt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=hr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function gc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}function Cm(r){return"nullValue"in r?Ti:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?$t(At.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:L()}function Dm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?$t(At.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?wt:L()}function pc(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function _c(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!vi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hr(t)}setAll(e){let t=ue.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=hr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());vi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];vi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){vt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Pe(hr(this.value))}}function yc(r){const e=[];return vt(r.fields,(t,n)=>{const i=new ue([t]);if(vi(n)){const s=yc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new ze(e)}class ce{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new ce(e,0,G.min(),G.min(),G.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,i){return new ce(e,1,t,G.min(),n,i,0)}static newNoDocument(e,t){return new ce(e,2,t,G.min(),G.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new ce(e,3,t,G.min(),G.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class St{constructor(e,t){this.position=e,this.inclusive=t}}function Ic(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?O.comparator(O.fromName(a.referenceValue),t.key):Pt(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Tc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!et(r.position[t],e.position[t]))return!1;return!0}class dr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Nm(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Ec{}class Y extends Ec{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new km(e,t,n):"array-contains"===t?new Om(e,n):"in"===t?new Sc(e,n):"not-in"===t?new Lm(e,n):"array-contains-any"===t?new Bm(e,n):new Y(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Fm(e,n):new Mm(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Pt(t,this.value)):null!==t&&Rt(this.value)===Rt(t)&&this.matchesComparison(Pt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class te extends Ec{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new te(e,t)}matches(e){return vn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function vn(r){return"and"===r.op}function Ks(r){return"or"===r.op}function js(r){return vc(r)&&vn(r)}function vc(r){for(const e of r.filters)if(e instanceof te)return!1;return!0}function $s(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+En(r.value);if(js(r))return r.filters.map(e=>$s(e)).join(",");{const e=r.filters.map(t=>$s(t)).join(",");return`${r.op}(${e})`}}function Ac(r,e){return r instanceof Y?(n=r,(i=e)instanceof Y&&n.op===i.op&&n.field.isEqual(i.field)&&et(n.value,i.value)):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&Ac(a,i.filters[u]),!0)}(r,e):void L();var n,i}function wc(r,e){const t=r.filters.concat(e);return te.create(t,r.op)}function Rc(r){return r instanceof Y?`${(t=r).field.canonicalString()} ${t.op} ${En(t.value)}`:r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(Rc).join(" ,")+"}"}(r):"Filter";var t}class km extends Y{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class Fm extends Y{constructor(e,t){super(e,"in",t),this.keys=Pc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mm extends Y{constructor(e,t){super(e,"not-in",t),this.keys=Pc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Pc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>O.fromName(n.referenceValue))}class Om extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return lr(t)&&cr(t.arrayValue,this.value)}}class Sc extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&cr(this.value.arrayValue,t)}}class Lm extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(cr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!cr(this.value.arrayValue,t)}}class Bm extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!lr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>cr(this.value.arrayValue,n))}}class qm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Qs(r,e=null,t=[],n=[],i=null,s=null,a=null){return new qm(r,e,t,n,i,s,a)}function Qt(r){const e=F(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>$s(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),or(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>En(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>En(n)).join(",")),e.ue=t}return e.ue}function fr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Nm(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Ac(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Tc(r.startAt,e.startAt)&&Tc(r.endAt,e.endAt)}function Ai(r){return O.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function wi(r,e){return r.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function Vc(r,e,t){let n=Ti,i=!0;for(const s of wi(r,e)){let a=Ti,u=!0;switch(s.op){case"<":case"<=":a=Cm(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ti}pc({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];pc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function xc(r,e,t){let n=wt,i=!0;for(const s of wi(r,e)){let a=wt,u=!0;switch(s.op){case">=":case">":a=Dm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=wt}_c({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];_c({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class ut{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function bc(r,e,t,n,i,s,a,u){return new ut(r,e,t,n,i,s,a,u)}function An(r){return new ut(r)}function Cc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Ws(r){return null!==r.collectionGroup}function wn(r){const e=F(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ne(ue.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new dr(s,n))}),t.has(ue.keyField().canonicalString())||e.ce.push(new dr(ue.keyField(),n))}return e.ce}function be(r){const e=F(r);return e.le||(e.le=function Nc(r,e){if("F"===r.limitType)return Qs(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new dr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new St(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new St(r.startAt.position,r.startAt.inclusive):null;return Qs(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,wn(r))),e.le}function Hs(r,e){const t=r.filters.concat([e]);return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ri(r,e,t){return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function mr(r,e){return fr(be(r),be(e))&&r.limitType===e.limitType}function kc(r){return`${Qt(be(r))}|lt:${r.limitType}`}function Rn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Rc(i)).join(", ")}]`),or(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>En(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>En(i)).join(",")),`Target(${n})`}(be(r))}; limitType=${r.limitType})`}function gr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of wn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=Ic(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,wn(n),i)||n.endAt&&!function(a,u,c){const h=Ic(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,wn(n),i)));var n,i}function Fc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Mc(r){return(e,t)=>{let n=!1;for(const i of wn(r)){const s=Um(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Um(r,e,t){const n=r.field.isKeyField()?O.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Pt(c,h):L()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}class ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return cc(this.inner)}size(){return this.innerSize}}const Gm=new oe(O.comparator);function Ke(){return Gm}const Oc=new oe(O.comparator);function pr(...r){let e=Oc;for(const t of r)e=e.insert(t.key,t);return e}function Lc(r){let e=Oc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function tt(){return _r()}function Bc(){return _r()}function _r(){return new ct(r=>r.toString(),(r,e)=>r.isEqual(e))}const zm=new oe(O.comparator),Km=new ne(O.comparator);function $(...r){let e=Km;for(const t of r)e=e.add(t);return e}const jm=new ne(j);function Js(){return jm}function qc(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ar(e)?"-0":e}}function Uc(r){return{integerValue:""+r}}function Gc(r,e){return ec(e)?Uc(e):qc(r,e)}class Pi{constructor(){this._=void 0}}function $m(r,e,t){return r instanceof Pn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&yi(s)&&(s=Ii(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Wt?Kc(r,e):r instanceof Ht?jc(r,e):function(i,s){const a=zc(i,s),u=$c(a)+$c(i.Pe);return zs(a)&&zs(i.Pe)?Uc(u):qc(i.serializer,u)}(r,e)}function Qm(r,e,t){return r instanceof Wt?Kc(r,e):r instanceof Ht?jc(r,e):t}function zc(r,e){return r instanceof Sn?zs(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Pn extends Pi{}class Wt extends Pi{constructor(e){super(),this.elements=e}}function Kc(r,e){const t=Qc(e);for(const n of r.elements)t.some(i=>et(i,n))||t.push(n);return{arrayValue:{values:t}}}class Ht extends Pi{constructor(e){super(),this.elements=e}}function jc(r,e){let t=Qc(e);for(const n of r.elements)t=t.filter(i=>!et(i,n));return{arrayValue:{values:t}}}class Sn extends Pi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function $c(r){return pe(r.integerValue||r.doubleValue)}function Qc(r){return lr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class yr{constructor(e,t){this.field=e,this.transform=t}}class Hm{constructor(e,t){this.version=e,this.transformResults=t}}class fe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fe}static exists(e){return new fe(void 0,e)}static updateTime(e){return new fe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Si(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Vi{}function Wc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new xn(r.key,fe.none()):new Vn(r.key,r.data,fe.none());{const t=r.data,n=Pe.empty();let i=new ne(ue.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new lt(r.key,n,new ze(i.toArray()),fe.none())}}function Jm(r,e,t){r instanceof Vn?function(i,s,a){const u=i.value.clone(),c=Yc(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof lt?function(i,s,a){if(!Si(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=Yc(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Jc(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ir(r,e,t,n){return r instanceof Vn?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=s.value.clone(),f=Xc(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof lt?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=Xc(s.fieldTransforms,c,a),f=a.data;return f.setAll(Jc(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Si(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Ym(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=zc(n.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(n.field,s))}return t||null}function Hc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&_n(n,i,(s,a)=>function Wm(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Wt&&i instanceof Wt||n instanceof Ht&&i instanceof Ht?_n(n.elements,i.elements,et):n instanceof Sn&&i instanceof Sn?et(n.Pe,i.Pe):n instanceof Pn&&i instanceof Pn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Vn extends Vi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class lt extends Vi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Jc(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Yc(r,e,t){const n=new Map;U(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,Qm(a,u,t[i]))}return n}function Xc(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,$m(s,a,e))}return n}class xn extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ys extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Xs{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Jm(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Bc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=Wc(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(G.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&_n(this.mutations,e.mutations,(t,n)=>Hc(t,n))&&_n(this.baseMutations,e.baseMutations,(t,n)=>Hc(t,n))}}class Zs{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length);let i=function(){return zm}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Zs(e,t,n,i)}}class eo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Xm{constructor(e,t){this.count=e,this.unchangedNames=t}}var Te,X;function el(r){switch(r){default:return L();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function tl(r){if(void 0===r)return ye("GRPC error has no .code"),S.UNKNOWN;switch(r){case Te.OK:return S.OK;case Te.CANCELLED:return S.CANCELLED;case Te.UNKNOWN:return S.UNKNOWN;case Te.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Te.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Te.INTERNAL:return S.INTERNAL;case Te.UNAVAILABLE:return S.UNAVAILABLE;case Te.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Te.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Te.NOT_FOUND:return S.NOT_FOUND;case Te.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Te.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Te.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Te.ABORTED:return S.ABORTED;case Te.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Te.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Te.DATA_LOSS:return S.DATA_LOSS;default:return L()}}(X=Te||(Te={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function nl(){return new TextEncoder}const Zm=new Gt([4294967295,4294967295],0);function rl(r){const e=nl().encode(r),t=new Mu;return t.update(e),new Uint8Array(t.digest())}function il(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Gt([t,n],0),new Gt([i,s],0)]}class to{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Tr(`Invalid padding: ${t}`);if(n<0)throw new Tr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Tr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Tr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Gt.fromNumber(n)));return 1===i.compare(Zm)&&(i=new Gt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=rl(e),[n,i]=il(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new to(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=rl(e),[n,i]=il(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Tr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Er{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,vr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Er(G.min(),i,new oe(j),Ke(),$())}}class vr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vr(n,t,$(),$(),$())}}class bi{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class sl{constructor(e,t){this.targetId=e,this.me=t}}class ol{constructor(e,t,n=ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class al{constructor(){this.fe=0,this.ge=cl(),this.pe=ge.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=$(),t=$(),n=$();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:L()}}),new vr(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=cl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class eg{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ke(),this.qe=ul(),this.Qe=new oe(j)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Ai(s))if(0===n){const a=new O(s.path);this.Ue(t,a,ce.newNoDocument(a,G.min()))}else U(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=at(n).toUint8Array()}catch(c){if(c instanceof hc)return Ge("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new to(a,i,s)}catch(c){return Ge(c instanceof Tr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Ai(u.target)){const c=new O(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,ce.newNoDocument(c,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let n=$();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Er(e,t,this.Qe,this.ke,n);return this.ke=Ke(),this.qe=ul(),this.Qe=new oe(j),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new al,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(j),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new al),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ul(){return new oe(O.comparator)}function cl(){return new oe(O.comparator)}const tg={asc:"ASCENDING",desc:"DESCENDING"},ng={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rg={and:"AND",or:"OR"};class ig{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function no(r,e){return r.useProto3Json||or(e)?e:{value:e}}function bn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ll(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function sg(r,e){return bn(r,e.toTimestamp())}function Ie(r){return U(!!r),G.fromTimestamp(function(t){const n=ot(t);return new de(n.seconds,n.nanos)}(r))}function ro(r,e){return io(r,e).canonicalString()}function io(r,e){const t=(i=r,new J(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function hl(r){const e=J.fromString(r);return U(vl(e)),e}function Ar(r,e){return ro(r.databaseId,e.path)}function nt(r,e){const t=hl(e);if(t.get(1)!==r.databaseId.projectId)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(ml(t))}function dl(r,e){return ro(r.databaseId,e)}function fl(r){const e=hl(r);return 4===e.length?J.emptyPath():ml(e)}function so(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ml(r){return U(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function gl(r,e,t){return{name:Ar(r,e),fields:t.value.mapValue.fields}}function pl(r,e,t){const n=nt(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):G.min(),a=new Pe({mapValue:{fields:e.fields}}),u=ce.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function wr(r,e){let t;if(e instanceof Vn)t={update:gl(r,e.key,e.value)};else if(e instanceof xn)t={delete:Ar(r,e.key)};else if(e instanceof lt)t={update:gl(r,e.key,e.data),updateMask:fg(e.fieldMask)};else{if(!(e instanceof Ys))return L();t={verify:Ar(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Wt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ht)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Sn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:sg(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:L()),t;var s}function oo(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?fe.updateTime(Ie(s.updateTime)):void 0!==s.exists?fe.exists(s.exists):fe.none():fe.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(U("REQUEST_TIME"===u.setToServerValue),c=new Pn):"appendMissingElements"in u?c=new Wt(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Ht(u.removeAllFromArray.values||[]):"increment"in u?c=new Sn(a,u.increment):L();const h=ue.fromServerFormat(u.fieldPath);return new yr(h,c)}(r,i)):[];var s;if(e.update){const i=nt(r,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new ze((e.updateMask.fieldPaths||[]).map(f=>ue.fromServerFormat(f)));return new lt(i,s,a,t,n)}return new Vn(i,s,t,n)}if(e.delete){const i=nt(r,e.delete);return new xn(i,t)}if(e.verify){const i=nt(r,e.verify);return new Ys(i,t)}return L()}function _l(r,e){return{documents:[dl(r,e.path)]}}function Ci(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=dl(r,i);const s=function(h){if(0!==h.length)return El(te.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:Vt((_=f).field),direction:lg(_.dir)};var _})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=no(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Il(r){let e=fl(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){U(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const _=Tl(g);return _ instanceof te&&js(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(_=>{return new dr(Cn((b=_).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction));var b}));let u=null;t.limit&&(u=function(g){let _;return _="object"==typeof g?g.value:g,or(_)?null:_}(t.limit));let c=null;var g;t.startAt&&(c=new St((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new St(g.values||[],!g.before)}(t.endAt)),bc(e,i,a,s,u,"F",c,h)}function Tl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Cn(t.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Cn(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Cn(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Cn(t.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):void 0!==r.fieldFilter?Y.create(Cn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return te.create(t.compositeFilter.filters.map(n=>Tl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(t.compositeFilter.op))}(r):L();var t}function lg(r){return tg[r]}function hg(r){return ng[r]}function dg(r){return rg[r]}function Vt(r){return{fieldPath:r.canonicalString()}}function Cn(r){return ue.fromServerFormat(r.fieldPath)}function El(r){return r instanceof Y?function(t){if("=="===t.op){if(mc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NAN"}};if(fc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(mc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NAN"}};if(fc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vt(t.field),op:hg(t.op),value:t.value}}}(r):r instanceof te?function(t){const n=t.getFilters().map(i=>El(i));return 1===n.length?n[0]:{compositeFilter:{op:dg(t.op),filters:n}}}(r):L()}function fg(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vl(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class ht{constructor(e,t,n,i,s=G.min(),a=G.min(),u=ge.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new ht(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Al{constructor(e){this.ct=e}}function wl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Di(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Ar(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:bn(s,a.version.toTimestamp()),createTime:bn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Jt(e.version)};else{if(!e.isUnknownDocument())return L();n.unknownDocument={path:t.path.toArray(),version:Jt(e.version)}}var s,a;return n}function Di(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Jt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yt(r){const e=new de(r.seconds,r.nanoseconds);return G.fromTimestamp(e)}function Xt(r,e){const t=(e.baseMutations||[]).map(s=>oo(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>oo(r.ct,s)),i=de.fromMillis(e.localWriteTimeMs);return new Xs(e.batchId,i,t,n)}function Rr(r){const e=Yt(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Yt(r.lastLimboFreeSnapshotVersion):G.min();let n;return n=void 0!==r.query.documents?(U(1===(s=r.query).documents.length),be(An(fl(s.documents[0])))):function(s){return be(Il(s))}(r.query),new ht(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,ge.fromBase64String(r.resumeToken));var s}function Rl(r,e){const t=Jt(e.snapshotVersion),n=Jt(e.lastLimboFreeSnapshotVersion);let i;i=Ai(e.target)?_l(r.ct,e.target):Ci(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Qt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function ao(r){const e=Il({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ri(e,e.limit,"L"):e}function uo(r,e){return new eo(e.largestBatchId,oo(r.ct,e.overlayMutation))}function Pl(r,e){const t=e.path.lastSegment();return[r,xe(e.path.popLast()),t]}function Sl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Jt(n.readTime),documentKey:xe(n.documentKey.path),largestBatchId:n.largestBatchId}}class gg{getBundleMetadata(e,t){return Vl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Yt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Vl(e).put({bundleId:(i=t).id,createTime:Jt(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return xl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:ao(s.bundledQuery),readTime:Yt(s.readTime)};var s})}saveNamedQuery(e,t){return xl(e).put({name:(i=t).name,readTime:Jt(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Vl(r){return ve(r,"bundles")}function xl(r){return ve(r,"namedQueries")}class Ni{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Ni(e,t.uid||"")}getOverlay(e,t){return Pr(e).get(Pl(this.userId,t)).next(n=>n?uo(this.serializer,n):null)}getOverlays(e,t){const n=tt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new eo(t,a);i.push(this.ht(e,u))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(xe(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Pr(e).j("collectionPathOverlayIndex",u))}),w.waitFor(s)}getOverlaysForCollection(e,t,n){const i=tt(),s=xe(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Pr(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=uo(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=tt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const g=uo(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Pr(e).put(function(i,s,a){const[u,c,h]=Pl(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:wr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function Pr(r){return ve(r,"documentOverlays")}class pg{Pt(e){return ve(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t?.value;return n?ge.fromUint8Array(n):ge.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Zt{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(pe(e.integerValue));else if("doubleValue"in e){const n=pe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ar(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=ot(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(at(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?gc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):(this.wt(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.St(e.arrayValue,t),this.ft(t)):L()}Vt(e,t){this.dt(t,25),this.bt(e,t)}bt(e,t){t.Rt(e)}wt(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}St(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),O.fromName(e).path.forEach(n=>{this.dt(t,60),this.bt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function _g(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function bl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=_g(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}Zt.Dt=new Zt;class yg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.vt(n.value),n=t.next();this.Ft()}Mt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.xt(n.value),n=t.next();this.Ot()}Nt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.vt(n);else if(n<2048)this.vt(960|n>>>6),this.vt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.vt(480|n>>>12),this.vt(128|63&n>>>6),this.vt(128|63&n);else{const i=t.codePointAt(0);this.vt(240|i>>>18),this.vt(128|63&i>>>12),this.vt(128|63&i>>>6),this.vt(128|63&i)}}this.Ft()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.xt(n);else if(n<2048)this.xt(960|n>>>6),this.xt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.xt(480|n>>>12),this.xt(128|63&n>>>6),this.xt(128|63&n);else{const i=t.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}Bt(e){const t=this.kt(e),n=bl(t);this.qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Qt(e){const t=this.kt(e),n=bl(t);this.qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Kt(){this.$t(255),this.$t(255)}Ut(){this.Wt(255),this.Wt(255)}reset(){this.position=0}seed(e){this.qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Gt(){return this.buffer.slice(0,this.position)}kt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}vt(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(t)}xt(e){const t=255&e;0===t?(this.Wt(0),this.Wt(255)):255===t?(this.Wt(255),this.Wt(0)):this.Wt(e)}Ft(){this.$t(0),this.$t(1)}Ot(){this.Wt(0),this.Wt(1)}$t(e){this.qt(1),this.buffer[this.position++]=e}Wt(e){this.qt(1),this.buffer[this.position++]=~e}qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Ig{constructor(e){this.zt=e}gt(e){this.zt.Ct(e)}Rt(e){this.zt.Nt(e)}At(e){this.zt.Bt(e)}Et(){this.zt.Kt()}}class Tg{constructor(e){this.zt=e}gt(e){this.zt.Mt(e)}Rt(e){this.zt.Lt(e)}At(e){this.zt.Qt(e)}Et(){this.zt.Ut()}}class Sr{constructor(){this.zt=new yg,this.jt=new Ig(this.zt),this.Ht=new Tg(this.zt)}seed(e){this.zt.seed(e)}Jt(e){return 0===e?this.jt:this.Ht}Gt(){return this.zt.Gt()}reset(){this.zt.reset()}}class en{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Yt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new en(this.indexId,this.documentKey,this.arrayValue,n)}}function xt(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Cl(r.arrayValue,e.arrayValue),0!==t?t:(t=Cl(r.directionalValue,e.directionalValue),0!==t?t:O.comparator(r.documentKey,e.documentKey)))}function Cl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Dl{constructor(e){this.Zt=new ne((t,n)=>ue.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Xt=e.orderBy,this.en=[];for(const t of e.filters){const n=t;n.isInequality()?this.Zt=this.Zt.add(n):this.en.push(n)}}get tn(){return this.Zt.size>1}nn(e){if(U(e.collectionGroup===this.collectionId),this.tn)return!1;const t=Ms(e);if(void 0!==t&&!this.rn(t))return!1;const n=zt(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.rn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Zt.size>0){const u=this.Zt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.sn(u,c)||!this.on(this.Xt[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.Xt.length||!this.on(this.Xt[a++],n[s]))return!1;return!0}_n(){if(this.tn)return null;let e=new ne(ue.comparator);const t=[];for(const n of this.en)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Kt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Kt(n.field,0))}for(const n of this.Xt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Kt(n.field,"asc"===n.dir?0:1)));return new yn(yn.UNKNOWN_ID,this.collectionId,t,In.empty())}rn(e){for(const t of this.en)if(this.sn(t,e))return!0;return!1}sn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}on(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Nl(r){var e,t;if(U(r instanceof Y||r instanceof te),r instanceof Y){if(r instanceof Sc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}const n=r.filters.map(i=>Nl(i));return te.create(n,r.op)}function Eg(r){if(0===r.getFilters().length)return[];const e=ho(Nl(r));return U(kl(e)),co(e)||lo(e)?[e]:e.getFilters()}function co(r){return r instanceof Y}function lo(r){return r instanceof te&&js(r)}function kl(r){return co(r)||lo(r)||function(t){if(t instanceof te&&Ks(t)){for(const n of t.getFilters())if(!co(n)&&!lo(n))return!1;return!0}return!1}(r)}function ho(r){if(U(r instanceof Y||r instanceof te),r instanceof Y)return r;if(1===r.filters.length)return ho(r.filters[0]);const e=r.filters.map(n=>ho(n));let t=te.create(e,r.op);return t=ki(t),kl(t)?t:(U(t instanceof te),U(vn(t)),U(t.filters.length>1),t.filters.reduce((n,i)=>fo(n,i)))}function fo(r,e){let t;return U(r instanceof Y||r instanceof te),U(e instanceof Y||e instanceof te),t=r instanceof Y?e instanceof Y?te.create([r,e],"and"):Fl(r,e):e instanceof Y?Fl(e,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0),vn(i)&&vn(s))return wc(i,s.getFilters());const a=Ks(i)?i:s,u=Ks(i)?s:i,c=a.filters.map(h=>fo(h,u));return te.create(c,"or")}(r,e),ki(t)}function Fl(r,e){if(vn(e))return wc(e,r.getFilters());{const t=e.filters.map(n=>fo(r,n));return te.create(t,"or")}}function ki(r){if(U(r instanceof Y||r instanceof te),r instanceof Y)return r;const e=r.getFilters();if(1===e.length)return ki(e[0]);if(vc(r))return r;const t=e.map(i=>ki(i)),n=[];return t.forEach(i=>{i instanceof Y?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:te.create(n,r.op)}class vg{constructor(){this.an=new mo}addToCollectionParentIndex(e,t){return this.an.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.an.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(je.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(je.min())}updateCollectionGroup(e,t,n){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class mo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ne(J.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ne(J.comparator)).toArray()}}const Fi=new Uint8Array(0);class Ag{constructor(e,t){this.databaseId=t,this.un=new mo,this.cn=new ct(n=>Qt(n),(n,i)=>fr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.un.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.un.add(t)});const s={collectionId:n,parent:xe(i)};return Ml(e).put(s)}return w.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Qu(t),""],!1,!0);return Ml(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(Ze(a.parent))}return n})}addFieldIndex(e,t){const n=Vr(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Nn(e);return s.next(u=>{a.put(Sl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Vr(e),i=Nn(e),s=Dn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Vr(e),n=Dn(e),i=Nn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return w.forEach(this.ln(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Dl(n)._n();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Dn(e);let i=!0;const s=new Map;return w.forEach(this.ln(t),a=>this.hn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=$();const u=[];return w.forEach(s,(c,h)=>{var q;N("IndexedDbIndexManager",`Using index ${q=c,`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`} to execute ${Qt(t)}`);const f=function(q,K){const H=Ms(K);if(void 0===H)return null;for(const Q of wi(q,H.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,c),g=function(q,K){const H=new Map;for(const Q of zt(K))for(const T of wi(q,Q.fieldPath))switch(T.op){case"==":case"in":H.set(Q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return H.set(Q.fieldPath.canonicalString(),T.value),Array.from(H.values())}return null}(h,c),_=function(q,K){const H=[];let Q=!0;for(const T of zt(K)){const p=0===T.kind?Vc(q,T.fieldPath,q.startAt):xc(q,T.fieldPath,q.startAt);H.push(p.value),Q&&(Q=p.inclusive)}return new St(H,Q)}(h,c),R=function(q,K){const H=[];let Q=!0;for(const T of zt(K)){const p=0===T.kind?xc(q,T.fieldPath,q.endAt):Vc(q,T.fieldPath,q.endAt);H.push(p.value),Q&&(Q=p.inclusive)}return new St(H,Q)}(h,c),b=this.Pn(c,h,_),k=this.Pn(c,h,R),D=this.In(c,h,g),B=this.Tn(c.indexId,f,b,_.inclusive,k,R.inclusive,D);return w.forEach(B,z=>n.G(z,t.limit).next(q=>{q.forEach(K=>{const H=O.fromSegments(K.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return w.resolve(null)})}ln(e){let t=this.cn.get(e);return t||(t=0===e.filters.length?[e]:Eg(te.create(e.filters,"and")).map(n=>Qs(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.cn.set(e,t),t)}Tn(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let g=0;g<c;++g){const _=t?this.En(t[g/h]):Fi,R=this.dn(e,_,n[g%h],i),b=this.An(e,_,s[g%h],a),k=u.map(D=>this.dn(e,_,D,!0));f.push(...this.createRange(R,b,k))}return f}dn(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s:s.Yt()}An(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s.Yt():s}hn(e,t){const n=new Dl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.nn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.ln(t);return w.forEach(i,s=>this.hn(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new ne(ue.comparator),f=!1;for(const g of c.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?f=!0:h=h.add(_.field));for(const g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Rn(e,t){const n=new Sr;for(const i of zt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Jt(i.kind);Zt.Dt.It(s,a)}return n.Gt()}En(e){const t=new Sr;return Zt.Dt.It(e,t.Jt(0)),t.Gt()}Vn(e,t){const n=new Sr;return Zt.Dt.It($t(this.databaseId,t),n.Jt(function(s){const a=zt(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.Gt()}In(e,t,n){if(null===n)return[];let i=[];i.push(new Sr);let s=0;for(const a of zt(e)){const u=n[s++];for(const c of i)if(this.mn(t,a.fieldPath)&&lr(u))i=this.fn(i,a,u);else{const h=c.Jt(a.kind);Zt.Dt.It(u,h)}}return this.gn(i)}Pn(e,t,n){return this.In(e,t,n.position)}gn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Gt();return t}fn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new Sr;c.seed(u.Gt()),Zt.Dt.It(a,c.Jt(t.kind)),s.push(c)}return s}mn(e,t){return!!e.filters.find(n=>n instanceof Y&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Vr(e),i=Nn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return w.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){const _=g?new In(g.sequenceNumber,new je(Yt(g.readTime),new O(Ze(g.documentKey)),g.largestBatchId)):In.empty(),R=f.fields.map(([b,k])=>new Kt(ue.fromServerFormat(b),k));return new yn(f.indexId,f.collectionGroup,R,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:j(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Vr(e),s=Nn(e);return this.pn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>w.forEach(u,c=>s.put(Sl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return w.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?w.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),w.forEach(u,c=>this.yn(e,i,c).next(h=>{const f=this.wn(s,c);return h.isEqual(f)?w.resolve():this.Sn(e,s,c,h,f)}))))})}bn(e,t,n,i){return Dn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Vn(n,t.key),documentKey:t.key.path.toArray()})}Dn(e,t,n,i){return Dn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Vn(n,t.key),t.key.path.toArray()])}yn(e,t,n){const i=Dn(e);let s=new ne(xt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Vn(n,t)])},(a,u)=>{s=s.add(new en(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}wn(e,t){let n=new ne(xt);const i=this.Rn(t,e);if(null==i)return n;const s=Ms(t);if(null!=s){const a=e.data.field(s.fieldPath);if(lr(a))for(const u of a.arrayValue.values||[])n=n.add(new en(t.indexId,e.key,this.En(u),i))}else n=n.add(new en(t.indexId,e.key,Fi,i));return n}Sn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,g,_){const R=c.getIterator(),b=h.getIterator();let k=Tn(R),D=Tn(b);for(;k||D;){let B=!1,z=!1;if(k&&D){const q=f(k,D);q<0?z=!0:q>0&&(B=!0)}else null!=k?z=!0:B=!0;B?(g(D),D=Tn(b)):z?(_(k),k=Tn(R)):(k=Tn(R),D=Tn(b))}}(i,s,xt,u=>{a.push(this.bn(e,t,n,u))},u=>{a.push(this.Dn(e,t,n,u))}),w.waitFor(a)}pn(e){let t=1;return Nn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>xt(a,u)).filter((a,u,c)=>!u||0!==xt(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=xt(a,e),c=xt(a,t);if(0===u)i[0]=e.Yt();else if(u>0&&c<0)i.push(a),i.push(a.Yt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Fi,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Fi,[]]))}return s}Cn(e,t){return xt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ol)}getMinOffset(e,t){return w.mapArray(this.ln(t),n=>this.hn(e,n).next(i=>i||L())).next(Ol)}}function Ml(r){return ve(r,"collectionParents")}function Dn(r){return ve(r,"indexEntries")}function Vr(r){return ve(r,"indexConfiguration")}function Nn(r){return ve(r,"indexState")}function Ol(r){U(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Os(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new je(e.readTime,e.documentKey,t)}const Ll={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Bl(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{U(1===u)}));const h=[];for(const f of t.mutations){const g=rc(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return w.waitFor(s).next(()=>h)}function Mi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw L();e=r.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Oi{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.vn={}}static lt(e,t,n,i){U(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Oi(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=kn(e),a=bt(e);return a.add({}).next(u=>{U("number"==typeof u);const c=new Xs(u,t,n,i),h=function(R,b,k){const D=k.baseMutations.map(z=>wr(R.ct,z)),B=k.mutations.map(z=>wr(R.ct,z));return{userId:b,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:B}}(this.serializer,this.userId,c),f=[];let g=new ne((_,R)=>j(_.canonicalString(),R.canonicalString()));for(const _ of i){const R=rc(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(h)),f.push(s.put(R,lm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.vn[u]=c.keys()}),w.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return bt(e).get(t).next(n=>n?(U(n.userId===this.userId),Xt(this.serializer,n)):null)}Fn(e,t){return this.vn[t]?w.resolve(this.vn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return bt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n),s=Xt(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return bt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bt(e).U("userMutationsIndex",t).next(n=>n.map(i=>Xt(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=pi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return kn(e).J({range:i},(a,u,c)=>{const[h,f,g]=a,_=Ze(f);if(h===this.userId&&t.path.isEqual(_))return bt(e).get(g).next(R=>{if(!R)throw L();U(R.userId===this.userId),s.push(Xt(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);const i=[];return t.forEach(s=>{const a=pi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=kn(e).J({range:u},(h,f,g)=>{const[_,R,b]=h,k=Ze(R);_===this.userId&&s.path.isEqual(k)?n=n.add(b):g.done()});i.push(c)}),w.waitFor(i).next(()=>this.Mn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=pi(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new ne(j);return kn(e).J({range:a},(c,h,f)=>{const[g,_,R]=c,b=Ze(_);g===this.userId&&n.isPrefixOf(b)?b.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Mn(e,u))}Mn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(bt(e).get(s).next(a=>{if(null===a)throw L();U(a.userId===this.userId),n.push(Xt(this.serializer,a))}))}),w.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Bl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.xn(t.batchId)}),w.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}xn(e){delete this.vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return kn(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=Ze(s[1]);i.push(c)}else u.done()}).next(()=>{U(0===i.length)})})}containsKey(e,t){return ql(e,this.userId,t)}On(e){return Ul(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ql(r,e,t){const n=pi(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return kn(r).J({range:s,H:!0},(u,c,h)=>{const[f,g,_]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function bt(r){return ve(r,"mutations")}function kn(r){return ve(r,"documentMutations")}function Ul(r){return ve(r,"mutationQueues")}class tn{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static Ln(){return new tn(0)}static Bn(){return new tn(-1)}}class wg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.kn(e).next(t=>{const n=new tn(t.highestTargetId);return t.highestTargetId=n.next(),this.qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.kn(e).next(t=>G.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.kn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.kn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.qn(e,i)))}addTargetData(e,t){return this.Qn(e,t).next(()=>this.kn(e).next(n=>(n.targetCount+=1,this.Kn(t,n),this.qn(e,n))))}updateTargetData(e,t){return this.Qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fn(e).delete(t.targetId)).next(()=>this.kn(e)).next(n=>(U(n.targetCount>0),n.targetCount-=1,this.qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Fn(e).J((a,u)=>{const c=Rr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Fn(e).J((n,i)=>{const s=Rr(i);t(s)})}kn(e){return Gl(e).get("targetGlobalKey").next(t=>(U(null!==t),t))}qn(e,t){return Gl(e).put("targetGlobalKey",t)}Qn(e,t){return Fn(e).put(Rl(this.serializer,t))}Kn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.kn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Qt(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Fn(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Rr(u);fr(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Ct(e);return t.forEach(a=>{const u=xe(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),w.waitFor(i)}removeMatchingKeys(e,t,n){const i=Ct(e);return w.forEach(t,s=>{const a=xe(s.path);return w.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Ct(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ct(e);let s=$();return i.J({range:n,H:!0},(a,u,c)=>{const h=Ze(a[1]),f=new O(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=xe(t.path),i=IDBKeyRange.bound([n],[Qu(n)],!1,!0);let s=0;return Ct(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Fn(e).get(t).next(n=>n?Rr(n):null)}}function Fn(r){return ve(r,"targets")}function Gl(r){return ve(r,"targetGlobal")}function Ct(r){return ve(r,"targetDocuments")}function zl([r,e],[t,n]){const i=j(r,t);return 0===i?j(e,n):i}class Rg{constructor(e){this.$n=e,this.buffer=new ne(zl),this.Un=0}Wn(){return++this.Un}Gn(e){const t=[e,this.Wn()];if(this.buffer.size<this.$n)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();zl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Kl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.zn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.jn(6e4)}stop(){this.zn&&(this.zn.cancel(),this.zn=null)}get started(){return null!==this.zn}jn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.zn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,x.A)(function*(){t.zn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Et(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Tt(n)}yield t.jn(3e5)}))}}class Pg{constructor(e,t){this.Hn=e,this.params=t}calculateTargetCount(e,t){return this.Hn.Jn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return w.resolve($e.oe);const n=new Rg(t);return this.Hn.forEachTarget(e,i=>n.Gn(i.sequenceNumber)).next(()=>this.Hn.Yn(e,i=>n.Gn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Hn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Hn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(Ll)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ll):this.Zn(e,t))}getCacheSize(e){return this.Hn.getCacheSize(e)}Zn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),pn()<=Ye.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Sg{constructor(e,t){this.db=e,this.garbageCollector=function jl(r,e){return new Pg(r,e)}(this,t)}Jn(e){const t=this.Xn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Xn(e){let t=0;return this.Yn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Yn(e,t){return this.er(e,(n,i)=>t(i))}addReference(e,t,n){return Li(e,n)}removeReference(e,t,n){return Li(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Li(e,t)}tr(e,t){return function(i,s){let a=!1;return Ul(i).Y(u=>ql(i,u,s).next(c=>(c&&(a=!0),w.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.er(e,(a,u)=>{if(u<=t){const c=this.tr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,G.min()),Ct(e).delete([0,xe(a.path)])))});i.push(c)}}).next(()=>w.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Li(e,t)}er(e,t){const n=Ct(e);let i,s=$e.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==$e.oe&&t(new O(Ze(i)),s),s=h,i=c):s=$e.oe}).next(()=>{s!==$e.oe&&t(new O(Ze(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Li(r,e){return Ct(r).put((i=r.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:i}));var i}class $l{constructor(){this.changes=new ct(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?w.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Vg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return nn(e).put(n)}removeEntry(e,t,n){return nn(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Di(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.nr(e,n)))}getEntry(e,t){let n=ce.newInvalidDocument(t);return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xr(t))},(i,s)=>{n=this.rr(t,s)}).next(()=>n)}ir(e,t){let n={size:0,document:ce.newInvalidDocument(t)};return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xr(t))},(i,s)=>{n={document:this.rr(t,s),size:Mi(s)}}).next(()=>n)}getEntries(e,t){let n=Ke();return this.sr(e,t,(i,s)=>{const a=this.rr(i,s);n=n.insert(i,a)}).next(()=>n)}_r(e,t){let n=Ke(),i=new oe(O.comparator);return this.sr(e,t,(s,a)=>{const u=this.rr(s,a);n=n.insert(s,u),i=i.insert(s,Mi(a))}).next(()=>({documents:n,ar:i}))}sr(e,t,n){if(t.isEmpty())return w.resolve();let i=new ne(Jl);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(xr(i.first()),xr(i.last())),a=i.getIterator();let u=a.getNext();return nn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const g=O.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Jl(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(xr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Di(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Ke();for(const g of h){const _=this.rr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(gr(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=Ke();const a=Hl(t,n),u=Hl(t,je.max());return nn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const g=this.rr(O.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new xg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Wl(e).get("remoteDocumentGlobalKey").next(t=>(U(!!t),t))}nr(e,t){return Wl(e).put("remoteDocumentGlobalKey",t)}rr(e,t){if(t){const n=function mg(r,e){let t;if(e.document)t=pl(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=O.fromSegments(e.noDocument.path),i=Yt(e.noDocument.readTime);t=ce.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return L();{const n=O.fromSegments(e.unknownDocument.path),i=Yt(e.unknownDocument.version);t=ce.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new de(i[0],i[1]);return G.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(G.min()))return n}return ce.newInvalidDocument(e)}}function Ql(r){return new Vg(r)}class xg extends $l{constructor(e,t){super(),this.ur=e,this.trackRemovals=t,this.cr=new ct(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ne((s,a)=>j(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.cr.get(s);if(t.push(this.ur.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=wl(this.ur.serializer,a);i=i.add(s.path.popLast());const h=Mi(c);n+=h-u.size,t.push(this.ur.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=wl(this.ur.serializer,a.convertToNoDocument(G.min()));t.push(this.ur.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ur.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ur.updateMetadata(e,n)),w.waitFor(t)}getFromCache(e,t){return this.ur.ir(e,t).next(n=>(this.cr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ur._r(e,t).next(({documents:n,ar:i})=>(i.forEach((s,a)=>{this.cr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function Wl(r){return ve(r,"remoteDocumentGlobal")}function nn(r){return ve(r,"remoteDocumentsV14")}function xr(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Hl(r,e){const t=e.documentKey.path.toArray();return[r,Di(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Jl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=j(t[s],n[s]),i)return i;return i=j(t.length,n.length),i||(i=j(t[t.length-2],n[n.length-2]),i||j(t[t.length-1],n[n.length-1]))}class bg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Yl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Ir(n.mutation,i,ze.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,$()).next(()=>n))}getLocalViewOfDocuments(e,t,n=$()){const i=tt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=pr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=tt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,$()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=Ke();const a=_r(),u=_r();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof lt)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Ir(f.mutation,h,f.mutation.getFieldMask(),de.now())):a.set(h.key,ze.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new bg(f,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=_r();let i=new oe((a,u)=>a-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||ze.empty();f=u.applyToLocalView(h,f),n.set(c,f);const g=(i.get(u.batchId)||$()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,g=Bc();f.forEach(_=>{if(!s.has(_)){const R=Wc(t.get(_),n.get(_));null!==R&&g.set(_,R),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return w.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return O.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ws(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):w.resolve(tt());let u=-1,c=s;return a.next(h=>w.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?w.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,$())).next(f=>({batchId:u,changes:Lc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let i=pr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=pr();return this.indexManager.getCollectionParents(e,s).next(u=>w.forEach(u,c=>{const h=(g=t,_=c.child(s),new ut(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,ce.newInvalidDocument(f)))});let u=pr();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Ir(f.mutation,h,ze.empty(),de.now()),gr(t,h)&&(u=u.insert(c,h))}),u})}}class Cg{constructor(e){this.serializer=e,this.lr=new Map,this.hr=new Map}getBundleMetadata(e,t){return w.resolve(this.lr.get(t))}saveBundleMetadata(e,t){return this.lr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),w.resolve();var i}getNamedQuery(e,t){return w.resolve(this.hr.get(t))}saveNamedQuery(e,t){return this.hr.set(t.name,{name:(i=t).name,query:ao(i.bundledQuery),readTime:Ie(i.readTime)}),w.resolve();var i}}class Dg{constructor(){this.overlays=new oe(O.comparator),this.Pr=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Pr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Pr.delete(n)),w.resolve()}getOverlaysForCollection(e,t,n){const i=tt(),s=t.length+1,a=new O(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new oe((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=tt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=tt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return w.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Pr.get(i.largestBatchId).delete(n.key);this.Pr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new eo(t,n));let s=this.Pr.get(t);void 0===s&&(s=$(),this.Pr.set(t,s)),this.Pr.set(t,s.add(n.key))}}class Ng{constructor(){this.sessionToken=ge.EMPTY_BYTE_STRING}getSessionToken(e){return w.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,w.resolve()}}class go{constructor(){this.Ir=new ne(we.Tr),this.Er=new ne(we.dr)}isEmpty(){return this.Ir.isEmpty()}addReference(e,t){const n=new we(e,t);this.Ir=this.Ir.add(n),this.Er=this.Er.add(n)}Ar(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Rr(new we(e,t))}Vr(e,t){e.forEach(n=>this.removeReference(n,t))}mr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.Er.forEachInRange([n,i],a=>{this.Rr(a),s.push(a.key)}),s}gr(){this.Ir.forEach(e=>this.Rr(e))}Rr(e){this.Ir=this.Ir.delete(e),this.Er=this.Er.delete(e)}pr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1);let s=$();return this.Er.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new we(e,0),n=this.Ir.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class we{constructor(e,t){this.key=e,this.yr=t}static Tr(e,t){return O.comparator(e.key,t.key)||j(e.yr,t.yr)}static dr(e,t){return j(e.yr,t.yr)||O.comparator(e.key,t.key)}}class kg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.wr=1,this.Sr=new ne(we.Tr)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.wr;this.wr++;const a=new Xs(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.Sr=this.Sr.add(new we(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return w.resolve(a)}lookupMutationBatch(e,t){return w.resolve(this.br(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Dr(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.wr-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.Sr.forEachInRange([n,i],a=>{const u=this.br(a.yr);s.push(u)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);return t.forEach(i=>{const s=new we(i,0),a=new we(i,Number.POSITIVE_INFINITY);this.Sr.forEachInRange([s,a],u=>{n=n.add(u.yr)})}),w.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;O.isDocumentKey(s)||(s=s.child(""));const a=new we(new O(s),0);let u=new ne(j);return this.Sr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.yr)),!0)},a),w.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const i=this.br(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){U(0===this.vr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Sr;return w.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Sr=n})}xn(e){}containsKey(e,t){const n=new we(t,0),i=this.Sr.firstAfterOrEqual(n);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}vr(e,t){return this.Dr(e)}Dr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}br(e){const t=this.Dr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Fg{constructor(e){this.Fr=e,this.docs=new oe(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Fr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return w.resolve(n?n.document.mutableCopy():ce.newInvalidDocument(t))}getEntries(e,t){let n=Ke();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ce.newInvalidDocument(i))}),w.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Ke();const a=t.path,u=new O(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Os(Hu(f),n)<=0||(i.has(f.key)||gr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,n,i){L()}Mr(e,t){return w.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Mg(this)}getSize(e){return w.resolve(this.size)}}class Mg extends $l{constructor(e){super(),this.ur=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ur.addEntry(e,i)):this.ur.removeEntry(n)}),w.waitFor(t)}getFromCache(e,t){return this.ur.getEntry(e,t)}getAllFromCache(e,t){return this.ur.getEntries(e,t)}}class Og{constructor(e){this.persistence=e,this.Or=new ct(t=>Qt(t),fr),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.Nr=0,this.Lr=new go,this.targetCount=0,this.Br=tn.Ln()}forEachTarget(e,t){return this.Or.forEach((n,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Nr)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Nr&&(this.Nr=t),w.resolve()}Qn(e){this.Or.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new tn(t),this.highestTargetId=t),e.sequenceNumber>this.Nr&&(this.Nr=e.sequenceNumber)}addTargetData(e,t){return this.Qn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.Qn(t),w.resolve()}removeTargetData(e,t){return this.Or.delete(t.target),this.Lr.mr(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Or.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Or.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const n=this.Or.get(t)||null;return w.resolve(n)}addMatchingKeys(e,t,n){return this.Lr.Ar(t,n),w.resolve()}removeMatchingKeys(e,t,n){this.Lr.Vr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Lr.mr(t),w.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Lr.pr(t);return w.resolve(n)}containsKey(e,t){return w.resolve(this.Lr.containsKey(t))}}class po{constructor(e,t){this.kr={},this.overlays={},this.qr=new $e(0),this.Qr=!1,this.Qr=!0,this.Kr=new Ng,this.referenceDelegate=e(this),this.$r=new Og(this),this.indexManager=new vg,this.remoteDocumentCache=new Fg(n=>this.referenceDelegate.Ur(n)),this.serializer=new Al(t),this.Wr=new Cg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Qr=!1,Promise.resolve()}get started(){return this.Qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Dg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.kr[e.toKey()];return n||(n=new kg(t,this.referenceDelegate),this.kr[e.toKey()]=n),n}getGlobalsCache(){return this.Kr}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Wr}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new Lg(this.qr.next());return this.referenceDelegate.Gr(),n(i).next(s=>this.referenceDelegate.zr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}jr(e,t){return w.or(Object.values(this.kr).map(n=>()=>n.containsKey(e,t)))}}class Lg extends Yu{constructor(e){super(),this.currentSequenceNumber=e}}class Bi{constructor(e){this.persistence=e,this.Hr=new go,this.Jr=null}static Yr(e){return new Bi(e)}get Zr(){if(this.Jr)return this.Jr;throw L()}addReference(e,t,n){return this.Hr.addReference(n,t),this.Zr.delete(n.toString()),w.resolve()}removeReference(e,t,n){return this.Hr.removeReference(n,t),this.Zr.add(n.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Zr.add(t.toString()),w.resolve()}removeTarget(e,t){this.Hr.mr(t.targetId).forEach(i=>this.Zr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Zr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Gr(){this.Jr=new Set}zr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Zr,n=>{const i=O.fromPath(n);return this.Xr(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.Jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Xr(e,t).next(n=>{n?this.Zr.delete(t.toString()):this.Zr.add(t.toString())})}Ur(e){return 0}Xr(e,t){return w.or([()=>w.resolve(this.Hr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.jr(e,t)])}}class Bg{constructor(e){this.serializer=e}O(e,t,n,i){const s=new gi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nc,{unique:!0}),c.createObjectStore("documentMutations"),Xl(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=w.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Xl(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nc,{unique:!0});const g=h.store("mutations"),_=f.map(R=>g.put(R));return w.waitFor(_)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.ti(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ni(s)))),n<7&&i>=7&&(a=a.next(()=>this.ri(s))),n<8&&i>=8&&(a=a.next(()=>this.ii(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.si(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:vm});h.createIndex("collectionPathOverlayIndex",Am,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",wm,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:hm});h.createIndex("documentKeyIndex",dm),h.createIndex("collectionGroupIndex",fm)}(e)).next(()=>this.oi(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this._i(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:ym}).createIndex("sequenceNumberIndex",Im,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Tm}).createIndex("documentKeyIndex",Em,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{!function(c){c.createObjectStore("globals",{keyPath:"name"})}(e)})),a}ni(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Mi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ti(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>w.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>w.forEach(u,c=>{U(c.userId===s.userId);const h=Xt(this.serializer,c);return Bl(e,s.userId,h).next(()=>{})}))}))}ri(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new J(a),h=[0,xe(c)];s.push(t.get(h).next(f=>f?w.resolve():t.put({targetId:0,path:xe(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}ii(e,t){e.createObjectStore("collectionParents",{keyPath:_m});const n=t.store("collectionParents"),i=new mo,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:xe(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new J(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=Ze(u);return s(f.popLast())}))}si(e){const t=e.store("targets");return t.J((n,i)=>{const s=Rr(i),a=Rl(this.serializer,s);return t.put(a)})}oi(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(g=a,g.document?new O(J.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>w.waitFor(i))}_i(e,t){const n=t.store("mutations"),i=Ql(this.serializer),s=new po(Bi.Yr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:$();Xt(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),w.forEach(u,(c,h)=>{const f=new Ae(h),g=Ni.lt(this.serializer,f),_=s.getIndexManager(f),R=Oi.lt(f,this.serializer,_,s.referenceDelegate);return new Yl(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Us(t,$e.oe),c).next()})})}}function Xl(r){r.createObjectStore("targetDocuments",{keyPath:gm}).createIndex("documentTargetsIndex",pm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mm,{unique:!0}),r.createObjectStore("targetGlobal")}const _o="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yo{constructor(e,t,n,i,s,a,u,c,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ai=s,this.window=a,this.document=u,this.ui=h,this.ci=f,this.li=g,this.qr=null,this.Qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.hi=null,this.inForeground=!1,this.Pi=null,this.Ii=null,this.Ti=Number.NEGATIVE_INFINITY,this.Ei=_=>Promise.resolve(),!yo.D())throw new C(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Sg(this,i),this.di=t+"main",this.serializer=new Al(c),this.Ai=new Xe(this.di,this.li,new Bg(this.serializer)),this.Kr=new pg,this.$r=new wg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ql(this.serializer),this.Wr=new gg,this.window&&this.window.localStorage?this.Ri=this.window.localStorage:(this.Ri=null,!1===f&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Vi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,_o);return this.mi(),this.fi(),this.gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.$r.getHighestSequenceNumber(e))}).then(e=>{this.qr=new $e(e,this.ui)}).then(()=>{this.Qr=!0}).catch(e=>(this.Ai&&this.Ai.close(),Promise.reject(e)))}pi(e){var t=this;return this.Ei=function(){var n=(0,x.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ai.L(function(){var t=(0,x.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ai.enqueueAndForget((0,x.A)(function*(){t.started&&(yield t.Vi())})))}Vi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ui(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.yi(e).next(t=>{t||(this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)))})}).next(()=>this.wi(e)).next(t=>this.isPrimary&&!t?this.Si(e).next(()=>!1):!!t&&this.bi(e).next(()=>!0))).catch(e=>{if(Et(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ai.enqueueRetryable(()=>this.Ei(e)),this.isPrimary=e})}yi(e){return br(e).get("owner").next(t=>w.resolve(this.Di(t)))}Ci(e){return Ui(e).delete(this.clientId)}vi(){var e=this;return(0,x.A)(function*(){if(e.isPrimary&&!e.Fi(e.Ti,18e5)){e.Ti=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ve(n,"clientMetadata");return i.U().next(s=>{const a=e.Mi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return w.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Ri)for(const n of t)e.Ri.removeItem(e.xi(n.clientId))}})()}gi(){this.Ii=this.ai.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Vi().then(()=>this.vi()).then(()=>this.gi()))}Di(e){return!!e&&e.ownerId===this.clientId}wi(e){return this.ci?w.resolve(!0):br(e).get("owner").next(t=>{if(null!==t&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)){if(this.Di(t)&&this.networkEnabled)return!0;if(!this.Di(t)){if(!t.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,_o);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ui(e).U().next(n=>void 0===this.Mi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,x.A)(function*(){e.Qr=!1,e.Ni(),e.Ii&&(e.Ii.cancel(),e.Ii=null),e.Li(),e.Bi(),yield e.Ai.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Us(t,$e.oe);return e.Si(n).next(()=>e.Ci(n))}),e.Ai.close(),e.ki()})()}Mi(e,t){return e.filter(n=>this.Fi(n.updateTimeMs,t)&&!this.Oi(n.clientId))}qi(){return this.runTransaction("getActiveClients","readonly",e=>Ui(e).U().next(t=>this.Mi(t,18e5).map(n=>n.clientId)))}get started(){return this.Qr}getGlobalsCache(){return this.Kr}getMutationQueue(e,t){return Oi.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ag(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ni.lt(this.serializer,e)}getBundleCache(){return this.Wr}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(c=this.li)?Sm:16===c?Pm:15===c?qs:14===c?oc:13===c?sc:12===c?Rm:11===c?ic:void L();var c;let a;return this.Ai.runTransaction(e,i,s,u=>(a=new Us(u,this.qr?this.qr.next():$e.oe),"readwrite-primary"===t?this.yi(a).next(c=>!!c||this.wi(a)).next(c=>{if(!c)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)),new C(S.FAILED_PRECONDITION,Ju);return n(a)}).next(c=>this.bi(a).next(()=>c)):this.Qi(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Qi(e){return br(e).get("owner").next(t=>{if(null!==t&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)&&!this.Di(t)&&!(this.ci||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(S.FAILED_PRECONDITION,_o)})}bi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return br(e).put("owner",t)}static D(){return Xe.D()}Si(e){const t=br(e);return t.get("owner").next(n=>this.Di(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}Fi(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}mi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Pi=()=>{this.ai.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Vi()))},this.document.addEventListener("visibilitychange",this.Pi),this.inForeground="visible"===this.document.visibilityState)}Li(){this.Pi&&(this.document.removeEventListener("visibilitychange",this.Pi),this.Pi=null)}fi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.hi=()=>{this.Ni();const t=/(?:Version|Mobile)\/1[456]/;(0,ee.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ai.enterRestrictedMode(!0),this.ai.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.hi))}Bi(){this.hi&&(this.window.removeEventListener("pagehide",this.hi),this.hi=null)}Oi(e){var t;try{const n=null!==(null===(t=this.Ri)||void 0===t?void 0:t.getItem(this.xi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Ni(){if(this.Ri)try{this.Ri.setItem(this.xi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}ki(){if(this.Ri)try{this.Ri.removeItem(this.xi(this.clientId))}catch{}}xi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function br(r){return ve(r,"owner")}function Ui(r){return ve(r,"clientMetadata")}function Io(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class To{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Ki=n,this.$i=i}static Ui(e,t){let n=$(),i=$();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new To(e,t.fromCache,n,i)}}class qg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Zl{constructor(){this.Wi=!1,this.Gi=!1,this.zi=100,this.ji=(0,ee.nr)()?8:Xu((0,ee.ZQ)())>0?6:4}initialize(e,t){this.Hi=e,this.indexManager=t,this.Wi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Ji(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Yi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new qg;return this.Zi(e,t,a).next(u=>{if(s.result=u,this.Gi)return this.Xi(e,t,a,u.size)})}).next(()=>s.result)}Xi(e,t,n,i){return n.documentReadCount<this.zi?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Rn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.zi,"documents"),w.resolve()):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Query:",Rn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ji*i?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Rn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,be(t))):w.resolve())}Ji(e,t){if(Cc(t))return w.resolve(null);let n=be(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ri(t,null,"F"),n=be(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=$(...s);return this.Hi.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.es(t,u);return this.ts(t,h,a,c.readTime)?this.Ji(e,Ri(t,null,"F")):this.ns(e,h,t,c)}))})))}Yi(e,t,n,i){return Cc(t)||i.isEqual(G.min())?w.resolve(null):this.Hi.getDocuments(e,n).next(s=>{const a=this.es(t,s);return this.ts(t,a,n,i)?w.resolve(null):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Rn(t)),this.ns(e,a,t,Wu(i,-1)).next(u=>u))})}es(e,t){let n=new ne(Mc(e));return t.forEach((i,s)=>{gr(e,s)&&(n=n.add(s))}),n}ts(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Zi(e,t,n){return pn()<=Ye.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Rn(t)),this.Hi.getDocumentsMatchingQuery(e,t,je.min(),n)}ns(e,t,n,i){return this.Hi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class Ug{constructor(e,t,n,i){this.persistence=e,this.rs=t,this.serializer=i,this.ss=new oe(j),this.os=new ct(s=>Qt(s),fr),this._s=new Map,this.us=e.getRemoteDocumentCache(),this.$r=e.getTargetCache(),this.Wr=e.getBundleCache(),this.cs(n)}cs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yl(this.us,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.us.setIndexManager(this.indexManager),this.rs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ss))}}function eh(r,e,t,n){return new Ug(r,e,t,n)}function th(r,e){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,x.A)(function*(r,e){const t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.cs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=$();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({ls:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function nh(r){const e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.$r.getLastRemoteSnapshotVersion(t))}function rh(r,e,t){let n=$(),i=$();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Ke();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{hs:a,Ps:i}})}function Kg(r,e){const t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Mn(r,e){const t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.$r.getTargetData(n,e).next(s=>s?(i=s,w.resolve(i)):t.$r.allocateTargetId(n).next(a=>(i=new ht(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.$r.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ss.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ss=t.ss.insert(n.targetId,n),t.os.set(e,n.targetId)),n})}function On(r,e,t){return vo.apply(this,arguments)}function vo(){return(vo=(0,x.A)(function*(r,e,t){const n=F(r),i=n.ss.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Et(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.ss=n.ss.remove(e),n.os.delete(i.target)})).apply(this,arguments)}function Gi(r,e,t){const n=F(r);let i=G.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const g=F(c),_=g.os.get(f);return void 0!==_?w.resolve(g.ss.get(_)):g.$r.getTargetData(h,f)}(n,a,be(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.$r.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.rs.getDocumentsMatchingQuery(a,e,t?i:G.min(),t?s:$())).next(u=>(oh(n,Fc(e),u),{documents:u,Is:s})))}function ih(r,e){const t=F(r),n=F(t.$r),i=t.ss.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function sh(r,e){const t=F(r),n=t._s.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.us.getAllFromCollectionGroup(i,e,Wu(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(oh(t,e,i),i))}function oh(r,e,t){let n=r._s.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r._s.set(e,n)}function Ao(){return(Ao=(0,x.A)(function*(r,e,t,n){const i=F(r);let s=$(),a=Ke();for(const h of t){const f=e.Ts(h.metadata.name);h.document&&(s=s.add(f));const g=e.Es(h);g.setReadTime(e.ds(h.metadata.readTime)),a=a.insert(f,g)}const u=i.us.newChangeBuffer({trackRemovals:!0}),c=yield Mn(i,(f=n,be(An(J.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>rh(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.$r.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.$r.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.hs,f.Ps)).next(()=>f.hs)))})).apply(this,arguments)}function $g(r,e){return wo.apply(this,arguments)}function wo(){return(wo=(0,x.A)(function*(r,e,t=$()){const n=yield Mn(r,be(ao(e.bundledQuery))),i=F(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ie(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Wr.saveNamedQuery(s,e);const u=n.withResumeToken(ge.EMPTY_BYTE_STRING,a);return i.ss=i.ss.insert(u.targetId,u),i.$r.updateTargetData(s,u).next(()=>i.$r.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.$r.addMatchingKeys(s,t,n.targetId)).next(()=>i.Wr.saveNamedQuery(s,e))})})).apply(this,arguments)}function ah(r,e){return`firestore_clients_${r}_${e}`}function uh(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Ro(r,e){return`firestore_targets_${r}_${e}`}class zi{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static As(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new zi(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Rs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static As(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new Cr(e,n.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Rs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ki{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static As(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Js();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=ec(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new Ki(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Po{constructor(e,t){this.clientId=e,this.onlineState=t}static As(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Po(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class So{constructor(){this.activeTargetIds=Js()}Vs(e){this.activeTargetIds=this.activeTargetIds.add(e)}fs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Rs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vo{constructor(e,t,n,i,s){this.window=e,this.ai=t,this.persistenceKey=n,this.gs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ps=this.ys.bind(this),this.ws=new oe(j),this.started=!1,this.Ss=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.bs=ah(this.persistenceKey,this.gs),this.Ds=`firestore_sequence_number_${this.persistenceKey}`,this.ws=this.ws.insert(this.gs,new So),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.vs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Fs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Ms=`firestore_online_state_${this.persistenceKey}`,this.xs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ps)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,x.A)(function*(){const t=yield e.syncEngine.qi();for(const i of t){if(i===e.gs)continue;const s=e.getItem(ah(e.persistenceKey,i));if(s){const a=Ki.As(i,s);a&&(e.ws=e.ws.insert(a.clientId,a))}}e.Os();const n=e.storage.getItem(e.Ms);if(n){const i=e.Ns(n);i&&e.Ls(i)}for(const i of e.Ss)e.ys(i);e.Ss=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ds,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Bs(this.ws)}isActiveQueryTarget(e){let t=!1;return this.ws.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ks(e,"pending")}updateMutationState(e,t,n){this.ks(e,t,n),this.qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Ro(this.persistenceKey,e));if(n){const i=Cr.As(e,n);i&&(t=i.state)}}return this.Qs.Vs(e),this.Os(),t}removeLocalQueryTarget(e){this.Qs.fs(e),this.Os()}isLocalQueryTarget(e){return this.Qs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ro(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ks(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.$s(e)}notifyBundleLoaded(e){this.Us(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ps),this.removeItem(this.bs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ys(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.bs)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ai.enqueueRetryable((0,x.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Ws(n.key);return t.Gs(i,null)}{const i=t.zs(n.key,n.newValue);if(i)return t.Gs(i.clientId,i)}}else if(t.vs.test(n.key)){if(null!==n.newValue){const i=t.js(n.key,n.newValue);if(i)return t.Hs(i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Js(n.key,n.newValue);if(i)return t.Ys(i)}}else if(n.key===t.Ms){if(null!==n.newValue){const i=t.Ns(n.newValue);if(i)return t.Ls(i)}}else if(n.key===t.Ds){const i=function(a){let u=$e.oe;if(null!=a)try{const c=JSON.parse(a);U("number"==typeof c),u=c}catch(c){ye("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==$e.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.xs){const i=t.Zs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.Xs(s)))}}else t.Ss.push(n)}))}}get Qs(){return this.ws.get(this.gs)}Os(){this.setItem(this.bs,this.Qs.Rs())}ks(e,t,n){const i=new zi(this.currentUser,e,t,n),s=uh(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Rs())}qs(e){const t=uh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}$s(e){this.storage.setItem(this.Ms,JSON.stringify({clientId:this.gs,onlineState:e}))}Ks(e,t,n){const i=Ro(this.persistenceKey,e),s=new Cr(e,t,n);this.setItem(i,s.Rs())}Us(e){const t=JSON.stringify(Array.from(e));this.setItem(this.xs,t)}Ws(e){const t=this.Cs.exec(e);return t?t[1]:null}zs(e,t){const n=this.Ws(e);return Ki.As(n,t)}js(e,t){const n=this.vs.exec(e),i=Number(n[1]);return zi.As(new Ae(void 0!==n[2]?n[2]:null),i,t)}Js(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return Cr.As(i,t)}Ns(e){return Po.As(e)}Zs(e){return JSON.parse(e)}Hs(e){var t=this;return(0,x.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.eo(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Ys(e){return this.syncEngine.no(e.targetId,e.state,e.error)}Gs(e,t){const n=t?this.ws.insert(e,t):this.ws.remove(e),i=this.Bs(this.ws),s=this.Bs(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.ro(a,u).then(()=>{this.ws=n})}Ls(e){this.ws.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Bs(e){let t=Js();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class ch{constructor(){this.io=new So,this.so={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.io.Vs(e),this.so[e]||"not-current"}updateQueryState(e,t,n){this.so[e]=t}removeLocalQueryTarget(e){this.io.fs(e)}isLocalQueryTarget(e){return this.io.activeTargetIds.has(e)}clearQueryState(e){delete this.so[e]}getAllActiveQueryTargets(){return this.io.activeTargetIds}isActiveQueryTarget(e){return this.io.activeTargetIds.has(e)}start(){return this.io=new So,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Qg{oo(e){}shutdown(){}}class lh{constructor(){this._o=()=>this.ao(),this.uo=()=>this.co(),this.lo=[],this.ho()}oo(e){this.lo.push(e)}shutdown(){window.removeEventListener("online",this._o),window.removeEventListener("offline",this.uo)}ho(){window.addEventListener("online",this._o),window.addEventListener("offline",this.uo)}ao(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.lo)e(0)}co(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.lo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ji=null;function xo(){return null===ji?ji=268435456+Math.round(2147483648*Math.random()):ji++,"0x"+ji.toString(16)}const Wg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Hg{constructor(e){this.Po=e.Po,this.Io=e.Io}To(e){this.Eo=e}Ao(e){this.Ro=e}Vo(e){this.mo=e}onMessage(e){this.fo=e}close(){this.Io()}send(e){this.Po(e)}po(){this.Eo()}yo(){this.Ro()}wo(e){this.mo(e)}So(e){this.fo(e)}}const De="WebChannelConnection";class Jg extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.bo=n+"://"+t.host,this.Do=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get vo(){return!1}Fo(t,n,i,s,a){const u=xo(),c=this.Mo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.Do,"x-goog-request-params":this.Co};return this.xo(h,s,a),this.Oo(t,c,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ge("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}No(t,n,i,s,a,u){return this.Fo(t,n,i,s,a)}xo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+gn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}Mo(t,n){return`${this.bo}/v1/${n}:${Wg[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Oo(e,t,n,i){const s=xo();return new Promise((a,u)=>{const c=new Ou;c.setWithCredentials(!0),c.listenOnce(Bu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case mi.NO_ERROR:const f=c.getResponseJson();N(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case mi.TIMEOUT:N(De,`RPC '${e}' ${s} timed out`),u(new C(S.DEADLINE_EXCEEDED,"Request time out"));break;case mi.HTTP_ERROR:const g=c.getStatus();if(N(De,`RPC '${e}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=_?.error;if(R&&R.status&&R.message){const b=function(D){const B=D.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(B)>=0?B:S.UNKNOWN}(R.status);u(new C(b,R.message))}else u(new C(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new C(S.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{N(De,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(De,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Lo(e,t,n){const i=xo(),s=[this.bo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Gu(),u=Uu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new Lu({})),this.xo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");N(De,`Creating RPC '${e}' stream ${i}: ${f}`,c);const g=a.createWebChannel(f,c);let _=!1,R=!1;const b=new Hg({Po:D=>{R?N(De,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(N(De,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),N(De,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},Io:()=>g.close()}),k=(D,B,z)=>{D.listen(B,q=>{try{z(q)}catch(K){setTimeout(()=>{throw K},0)}})};return k(g,rr.EventType.OPEN,()=>{R||(N(De,`RPC '${e}' stream ${i} transport opened.`),b.po())}),k(g,rr.EventType.CLOSE,()=>{R||(R=!0,N(De,`RPC '${e}' stream ${i} transport closed`),b.wo())}),k(g,rr.EventType.ERROR,D=>{R||(R=!0,Ge(De,`RPC '${e}' stream ${i} transport errored:`,D),b.wo(new C(S.UNAVAILABLE,"The operation could not be completed")))}),k(g,rr.EventType.MESSAGE,D=>{var B;if(!R){const z=D.data[0];U(!!z);const K=z.error||(null===(B=z[0])||void 0===B?void 0:B.error);if(K){N(De,`RPC '${e}' stream ${i} received error:`,K);const H=K.status;let Q=function(I){const E=Te[I];if(void 0!==E)return tl(E)}(H),T=K.message;void 0===Q&&(Q=S.INTERNAL,T="Unknown error status: "+H+" with message "+K.message),R=!0,b.wo(new C(Q,T)),g.close()}else N(De,`RPC '${e}' stream ${i} received:`,z),b.So(z)}}),k(u,qu.STAT_EVENT,D=>{D.stat===ks.PROXY?N(De,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===ks.NOPROXY&&N(De,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{b.yo()},0),b}}function hh(){return typeof window<"u"?window:null}function $i(){return typeof document<"u"?document:null}function Dr(r){return new ig(r,!0)}class bo{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ai=e,this.timerId=t,this.Bo=n,this.ko=i,this.qo=s,this.Qo=0,this.Ko=null,this.$o=Date.now(),this.reset()}reset(){this.Qo=0}Uo(){this.Qo=this.qo}Wo(e){this.cancel();const t=Math.floor(this.Qo+this.Go()),n=Math.max(0,Date.now()-this.$o),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Qo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ko=this.ai.enqueueAfterDelay(this.timerId,i,()=>(this.$o=Date.now(),e())),this.Qo*=this.ko,this.Qo<this.Bo&&(this.Qo=this.Bo),this.Qo>this.qo&&(this.Qo=this.qo)}zo(){null!==this.Ko&&(this.Ko.skipDelay(),this.Ko=null)}cancel(){null!==this.Ko&&(this.Ko.cancel(),this.Ko=null)}Go(){return(Math.random()-.5)*this.Qo}}class dh{constructor(e,t,n,i,s,a,u,c){this.ai=e,this.jo=n,this.Ho=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Jo=0,this.Yo=null,this.Zo=null,this.stream=null,this.Xo=0,this.e_=new bo(e,t)}t_(){return 1===this.state||5===this.state||this.n_()}n_(){return 2===this.state||3===this.state}start(){this.Xo=0,4!==this.state?this.auth():this.r_()}stop(){var e=this;return(0,x.A)(function*(){e.t_()&&(yield e.close(0))})()}i_(){this.state=0,this.e_.reset()}s_(){this.n_()&&null===this.Yo&&(this.Yo=this.ai.enqueueAfterDelay(this.jo,6e4,()=>this.o_()))}__(e){this.a_(),this.stream.send(e)}o_(){var e=this;return(0,x.A)(function*(){if(e.n_())return e.close(0)})()}a_(){this.Yo&&(this.Yo.cancel(),this.Yo=null)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}close(e,t){var n=this;return(0,x.A)(function*(){n.a_(),n.u_(),n.e_.cancel(),n.Jo++,4!==e?n.e_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.e_.Uo()):t&&t.code===S.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.c_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Vo(t)})()}c_(){}auth(){this.state=1;const e=this.l_(this.Jo),t=this.Jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Jo===t&&this.h_(n,i)},n=>{e(()=>{const i=new C(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.P_(i)})})}h_(e,t){const n=this.l_(this.Jo);this.stream=this.I_(e,t),this.stream.To(()=>{n(()=>this.listener.To())}),this.stream.Ao(()=>{n(()=>(this.state=2,this.Zo=this.ai.enqueueAfterDelay(this.Ho,1e4,()=>(this.n_()&&(this.state=3),Promise.resolve())),this.listener.Ao()))}),this.stream.Vo(i=>{n(()=>this.P_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.Xo?this.T_(i):this.onNext(i))})}r_(){var e=this;this.state=5,this.e_.Wo((0,x.A)(function*(){e.state=0,e.start()}))}P_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}l_(e){return t=>{this.ai.enqueueAndForget(()=>this.Jo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Yg extends dh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}I_(e,t){return this.connection.Lo("Listen",e,t)}T_(e){return this.onNext(e)}onNext(e){this.e_.reset();const t=function ag(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:L(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(U(void 0===f||"string"==typeof f),ge.fromBase64String(f||"")):(U(void 0===f||f instanceof Buffer||f instanceof Uint8Array),ge.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?S.UNKNOWN:tl(h.code);return new C(f,h.message||"")}(a);t=new ol(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=nt(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):G.min(),u=new Pe({mapValue:{fields:n.document.fields}}),c=ce.newFoundDocument(i,s,a,u);t=new bi(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=nt(r,n.document),s=n.readTime?Ie(n.readTime):G.min(),a=ce.newNoDocument(i,s);t=new bi([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=nt(r,n.document);t=new bi([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return L();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new Xm(i,s);t=new sl(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return G.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?Ie(a.readTime):G.min()}(e);return this.listener.E_(t,n)}d_(e){const t={};t.database=so(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=Ai(c)?{documents:_l(s,c)}:{query:Ci(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ll(s,a.resumeToken);const h=no(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(G.min())>0){u.readTime=bn(s,a.snapshotVersion.toTimestamp());const h=no(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function cg(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.__(t)}A_(e){const t={};t.database=so(this.serializer),t.removeTarget=e,this.__(t)}}class Xg extends dh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get R_(){return this.Xo>0}start(){this.lastStreamToken=void 0,super.start()}c_(){this.R_&&this.V_([])}I_(e,t){return this.connection.Lo("Write",e,t)}T_(e){return U(!!e.streamToken),this.lastStreamToken=e.streamToken,U(!e.writeResults||0===e.writeResults.length),this.listener.m_()}onNext(e){U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.e_.reset();const t=function ug(r,e){return r&&r.length>0?(U(void 0!==e),r.map(t=>function(i,s){let a=Ie(i.updateTime?i.updateTime:s);return a.isEqual(G.min())&&(a=Ie(s)),new Hm(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.f_(n,t)}g_(){const e={};e.database=so(this.serializer),this.__(e)}V_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>wr(this.serializer,n))};this.__(t)}}class Zg extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.p_=!1}y_(){if(this.p_)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}Fo(e,t,n,i){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Fo(e,io(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(S.UNKNOWN,s.toString())})}No(e,t,n,i,s){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.No(e,io(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(S.UNKNOWN,a.toString())})}terminate(){this.p_=!0,this.connection.terminate()}}class ep{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.w_=0,this.S_=null,this.b_=!0}D_(){0===this.w_&&(this.C_("Unknown"),this.S_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.S_=null,this.v_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}F_(e){"Online"===this.state?this.C_("Unknown"):(this.w_++,this.w_>=1&&(this.M_(),this.v_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.M_(),this.w_=0,"Online"===e&&(this.b_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}v_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.b_?(ye(t),this.b_=!1):N("OnlineStateTracker",t)}M_(){null!==this.S_&&(this.S_.cancel(),this.S_=null)}}class tp{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.x_=[],this.O_=new Map,this.N_=new Set,this.L_=[],this.B_=s,this.B_.oo(u=>{n.enqueueAndForget((0,x.A)(function*(){var c;Dt(a)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,x.A)(function*(f){const g=F(f);g.N_.add(4),yield Ln(g),g.k_.set("Unknown"),g.N_.delete(4),yield Nr(g)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.k_=new ep(n,i)}}function Nr(r){return Co.apply(this,arguments)}function Co(){return(Co=(0,x.A)(function*(r){if(Dt(r))for(const e of r.L_)yield e(!0)})).apply(this,arguments)}function Ln(r){return Do.apply(this,arguments)}function Do(){return(Do=(0,x.A)(function*(r){for(const e of r.L_)yield e(!1)})).apply(this,arguments)}function Qi(r,e){const t=F(r);t.O_.has(e.targetId)||(t.O_.set(e.targetId,e),Fo(t)?ko(t):Un(t).n_()&&No(t,e))}function Bn(r,e){const t=F(r),n=Un(t);t.O_.delete(e),n.n_()&&fh(t,e),0===t.O_.size&&(n.n_()?n.s_():Dt(t)&&t.k_.set("Unknown"))}function No(r,e){if(r.q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Un(r).d_(e)}function fh(r,e){r.q_.xe(e),Un(r).A_(e)}function ko(r){r.q_=new eg({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.O_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Un(r).start(),r.k_.D_()}function Fo(r){return Dt(r)&&!Un(r).t_()&&r.O_.size>0}function Dt(r){return 0===F(r).N_.size}function mh(r){r.q_=void 0}function np(r){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,x.A)(function*(r){r.k_.set("Online")})).apply(this,arguments)}function rp(r){return Oo.apply(this,arguments)}function Oo(){return(Oo=(0,x.A)(function*(r){r.O_.forEach((e,t)=>{No(r,e)})})).apply(this,arguments)}function ip(r,e){return Lo.apply(this,arguments)}function Lo(){return(Lo=(0,x.A)(function*(r,e){mh(r),Fo(r)?(r.k_.F_(e),ko(r)):r.k_.set("Unknown")})).apply(this,arguments)}function sp(r,e,t){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,x.A)(function*(r,e,t){if(r.k_.set("Online"),e instanceof ol&&2===e.state&&e.cause)try{yield(n=(0,x.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.O_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.O_.delete(c),s.q_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Wi(r,n)}else if(e instanceof bi?r.q_.Ke(e):e instanceof sl?r.q_.He(e):r.q_.We(e),!t.isEqual(G.min()))try{const n=yield nh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.q_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.O_.get(h);f&&s.O_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.O_.get(c);if(!f)return;s.O_.set(c,f.withResumeToken(ge.EMPTY_BYTE_STRING,f.snapshotVersion)),fh(s,c);const g=new ht(f.target,c,h,f.sequenceNumber);No(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Wi(r,n)}var n}),Bo.apply(this,arguments)}function Wi(r,e,t){return qo.apply(this,arguments)}function qo(){return(qo=(0,x.A)(function*(r,e,t){if(!Et(e))throw e;r.N_.add(1),yield Ln(r),r.k_.set("Offline"),t||(t=()=>nh(r.localStore)),r.asyncQueue.enqueueRetryable((0,x.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.N_.delete(1),yield Nr(r)}))})).apply(this,arguments)}function gh(r,e){return e().catch(t=>Wi(r,t,e))}function qn(r){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,x.A)(function*(r){const e=F(r),t=Nt(e);let n=e.x_.length>0?e.x_[e.x_.length-1].batchId:-1;for(;op(e);)try{const i=yield Kg(e.localStore,n);if(null===i){0===e.x_.length&&t.s_();break}n=i.batchId,ap(e,i)}catch(i){yield Wi(e,i)}ph(e)&&_h(e)})).apply(this,arguments)}function op(r){return Dt(r)&&r.x_.length<10}function ap(r,e){r.x_.push(e);const t=Nt(r);t.n_()&&t.R_&&t.V_(e.mutations)}function ph(r){return Dt(r)&&!Nt(r).t_()&&r.x_.length>0}function _h(r){Nt(r).start()}function up(r){return Go.apply(this,arguments)}function Go(){return(Go=(0,x.A)(function*(r){Nt(r).g_()})).apply(this,arguments)}function cp(r){return zo.apply(this,arguments)}function zo(){return(zo=(0,x.A)(function*(r){const e=Nt(r);for(const t of r.x_)e.V_(t.mutations)})).apply(this,arguments)}function lp(r,e,t){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,x.A)(function*(r,e,t){const n=r.x_.shift(),i=Zs.from(n,e,t);yield gh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield qn(r)})).apply(this,arguments)}function hp(r,e){return jo.apply(this,arguments)}function jo(){return jo=(0,x.A)(function*(r,e){var t;e&&Nt(r).R_&&(yield(t=(0,x.A)(function*(i,s){if(el(u=s.code)&&u!==S.ABORTED){const a=i.x_.shift();Nt(i).i_(),yield gh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield qn(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),ph(r)&&_h(r)}),jo.apply(this,arguments)}function yh(r,e){return $o.apply(this,arguments)}function $o(){return($o=(0,x.A)(function*(r,e){const t=F(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=Dt(t);t.N_.add(3),yield Ln(t),n&&t.k_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.N_.delete(3),yield Nr(t)})).apply(this,arguments)}function Qo(r,e){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,x.A)(function*(r,e){const t=F(r);e?(t.N_.delete(2),yield Nr(t)):e||(t.N_.add(2),yield Ln(t),t.k_.set("Unknown"))})).apply(this,arguments)}function Un(r){return r.Q_||(r.Q_=function(t,n,i){const s=F(t);return s.y_(),new Yg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{To:np.bind(null,r),Ao:rp.bind(null,r),Vo:ip.bind(null,r),E_:sp.bind(null,r)}),r.L_.push(function(){var e=(0,x.A)(function*(t){t?(r.Q_.i_(),Fo(r)?ko(r):r.k_.set("Unknown")):(yield r.Q_.stop(),mh(r))});return function(t){return e.apply(this,arguments)}}())),r.Q_}function Nt(r){return r.K_||(r.K_=function(t,n,i){const s=F(t);return s.y_(),new Xg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{To:()=>Promise.resolve(),Ao:up.bind(null,r),Vo:hp.bind(null,r),m_:cp.bind(null,r),f_:lp.bind(null,r)}),r.L_.push(function(){var e=(0,x.A)(function*(t){t?(r.K_.i_(),yield qn(r)):(yield r.K_.stop(),r.x_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.x_.length} pending writes`),r.x_=[]))});return function(t){return e.apply(this,arguments)}}())),r.K_}class Ho{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Ho(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gn(r,e){if(ye("AsyncQueue",`${e}: ${r}`),Et(r))return new C(S.UNAVAILABLE,`${e}: ${r}`);throw r}class zn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=pr(),this.sortedSet=new oe(this.comparator)}static emptySet(e){return new zn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new zn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ih{constructor(){this.U_=new oe(O.comparator)}track(e){const t=e.doc.key,n=this.U_.get(t);n?0!==e.type&&3===n.type?this.U_=this.U_.insert(t,e):3===e.type&&1!==n.type?this.U_=this.U_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.U_=this.U_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.U_=this.U_.remove(t):1===e.type&&2===n.type?this.U_=this.U_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):L():this.U_=this.U_.insert(t,e)}W_(){const e=[];return this.U_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Kn{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new Kn(e,t,zn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class dp{constructor(){this.G_=void 0,this.z_=[]}j_(){return this.z_.some(e=>e.H_())}}class fp{constructor(){this.queries=Th(),this.onlineState="Unknown",this.J_=new Set}terminate(){!function(t,n){const i=F(t),s=i.queries;i.queries=Th(),s.forEach((a,u)=>{for(const c of u.z_)c.onError(n)})}(this,new C(S.ABORTED,"Firestore shutting down"))}}function Th(){return new ct(r=>kc(r),mr)}function Jo(r,e){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,x.A)(function*(r,e){const t=F(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.j_()&&e.H_()&&(n=2):(s=new dp,n=e.H_()?0:1);try{switch(n){case 0:s.G_=yield t.onListen(i,!0);break;case 1:s.G_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=Gn(a,`Initialization of query '${Rn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.z_.push(e),e.Y_(t.onlineState),s.G_&&e.Z_(s.G_)&&ea(t)})).apply(this,arguments)}function Xo(r,e){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,x.A)(function*(r,e){const t=F(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.z_.indexOf(e);a>=0&&(s.z_.splice(a,1),0===s.z_.length?i=e.H_()?0:1:!s.j_()&&e.H_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function mp(r,e){const t=F(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.z_)u.Z_(i)&&(n=!0);a.G_=i}}n&&ea(t)}function gp(r,e,t){const n=F(r),i=n.queries.get(e);if(i)for(const s of i.z_)s.onError(t);n.queries.delete(e)}function ea(r){r.J_.forEach(e=>{e.next()})}var ta,Eh;(Eh=ta||(ta={})).X_="default",Eh.Cache="cache";class na{constructor(e,t,n){this.query=e,this.ea=t,this.ta=!1,this.na=null,this.onlineState="Unknown",this.options=n||{}}Z_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Kn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ta?this.ra(e)&&(this.ea.next(e),t=!0):this.ia(e,this.onlineState)&&(this.sa(e),t=!0),this.na=e,t}onError(e){this.ea.error(e)}Y_(e){this.onlineState=e;let t=!1;return this.na&&!this.ta&&this.ia(this.na,e)&&(this.sa(this.na),t=!0),t}ia(e,t){return!e.fromCache||!this.H_()||(!this.options.oa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ra(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.na&&this.na.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}sa(e){e=Kn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ta=!0,this.ea.next(e)}H_(){return this.options.source!==ta.Cache}}class pp{constructor(e,t){this._a=e,this.byteLength=t}aa(){return"metadata"in this._a}}class vh{constructor(e){this.serializer=e}Ts(e){return nt(this.serializer,e)}Es(e){return e.metadata.exists?pl(this.serializer,e.document,!1):ce.newNoDocument(this.Ts(e.metadata.name),this.ds(e.metadata.readTime))}ds(e){return Ie(e)}}class _p{constructor(e,t,n){this.ua=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ah(e)}ca(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e._a.namedQuery)this.queries.push(e._a.namedQuery);else if(e._a.documentMetadata){this.documents.push({metadata:e._a.documentMetadata}),e._a.documentMetadata.exists||++t;const n=J.fromString(e._a.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e._a.document&&(this.documents[this.documents.length-1].document=e._a.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}la(e){const t=new Map,n=new vh(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Ts(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||$()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,x.A)(function*(){const t=yield function jg(r,e,t,n){return Ao.apply(this,arguments)}(e.localStore,new vh(e.serializer),e.documents,e.ua.id),n=e.la(e.documents);for(const i of e.queries)yield $g(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ha:e.collectionGroups,Pa:t}})()}}function Ah(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class wh{constructor(e){this.key=e}}class Rh{constructor(e){this.key=e}}class Ph{constructor(e,t){this.query=e,this.Ia=t,this.Ta=null,this.hasCachedResults=!1,this.current=!1,this.Ea=$(),this.mutatedKeys=$(),this.da=Mc(e),this.Aa=new zn(this.da)}get Ra(){return this.Ia}Va(e,t){const n=t?t.ma:new Ih,i=t?t.Aa:this.Aa;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const _=i.get(f),R=gr(this.query,g)?g:null,b=!!_&&this.mutatedKeys.has(_.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;_&&R?_.data.isEqual(R.data)?b!==k&&(n.track({type:3,doc:R}),D=!0):this.fa(_,R)||(n.track({type:2,doc:R}),D=!0,(c&&this.da(R,c)>0||h&&this.da(R,h)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),D=!0):_&&!R&&(n.track({type:1,doc:_}),D=!0,(c||h)&&(u=!0)),D&&(R?(a=a.add(R),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Aa:a,ma:n,ts:u,mutatedKeys:s}}fa(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Aa;this.Aa=e.Aa,this.mutatedKeys=e.mutatedKeys;const a=e.ma.W_();a.sort((f,g)=>function(R,b){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(R)-k(b)}(f.type,g.type)||this.da(f.doc,g.doc)),this.ga(n),i=null!=i&&i;const u=t&&!i?this.pa():[],c=0===this.Ea.size&&this.current&&!i?1:0,h=c!==this.Ta;return this.Ta=c,0!==a.length||h?{snapshot:new Kn(this.query,e.Aa,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),ya:u}:{ya:u}}Y_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Aa:this.Aa,ma:new Ih,mutatedKeys:this.mutatedKeys,ts:!1},!1)):{ya:[]}}wa(e){return!this.Ia.has(e)&&!!this.Aa.has(e)&&!this.Aa.get(e).hasLocalMutations}ga(e){e&&(e.addedDocuments.forEach(t=>this.Ia=this.Ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ia=this.Ia.delete(t)),this.current=e.current)}pa(){if(!this.current)return[];const e=this.Ea;this.Ea=$(),this.Aa.forEach(n=>{this.wa(n.key)&&(this.Ea=this.Ea.add(n.key))});const t=[];return e.forEach(n=>{this.Ea.has(n)||t.push(new Rh(n))}),this.Ea.forEach(n=>{e.has(n)||t.push(new wh(n))}),t}Sa(e){this.Ia=e.Is,this.Ea=$();const t=this.Va(e.documents);return this.applyChanges(t,!0)}ba(){return Kn.fromInitialDocuments(this.query,this.Aa,this.mutatedKeys,0===this.Ta,this.hasCachedResults)}}class yp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ip{constructor(e){this.key=e,this.Da=!1}}class Tp{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.va=new ct(u=>kc(u),mr),this.Fa=new Map,this.Ma=new Set,this.xa=new oe(O.comparator),this.Oa=new Map,this.Na=new go,this.La={},this.Ba=new Map,this.ka=tn.Bn(),this.onlineState="Unknown",this.qa=void 0}get isPrimaryClient(){return!0===this.qa}}function Ep(r,e){return ra.apply(this,arguments)}function ra(){return(ra=(0,x.A)(function*(r,e,t=!0){const n=Hi(r);let i;const s=n.va.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ba()):i=yield Sh(n,e,t,!0),i})).apply(this,arguments)}function vp(r,e){return ia.apply(this,arguments)}function ia(){return(ia=(0,x.A)(function*(r,e){const t=Hi(r);yield Sh(t,e,!0,!1)})).apply(this,arguments)}function Sh(r,e,t,n){return sa.apply(this,arguments)}function sa(){return(sa=(0,x.A)(function*(r,e,t,n){const i=yield Mn(r.localStore,be(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield oa(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Qi(r.remoteStore,i),u})).apply(this,arguments)}function oa(r,e,t,n,i){return aa.apply(this,arguments)}function aa(){return aa=(0,x.A)(function*(r,e,t,n,i){r.Qa=(g,_,R)=>{return(b=(0,x.A)(function*(D,B,z,q){let K=B.view.Va(z);K.ts&&(K=yield Gi(D.localStore,B.query,!1).then(({documents:p})=>B.view.Va(p,K)));const H=q&&q.targetChanges.get(B.targetId),Q=q&&null!=q.targetMismatches.get(B.targetId),T=B.view.applyChanges(K,D.isPrimaryClient,H,Q);return ya(D,B.targetId,T.ya),T.snapshot}),function k(D,B,z,q){return b.apply(this,arguments)})(r,g,_,R);var b};const s=yield Gi(r.localStore,e,!0),a=new Ph(e,s.Is),u=a.Va(s.documents),c=vr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);ya(r,t,h.ya);const f=new yp(e,t,a);return r.va.set(e,f),r.Fa.has(t)?r.Fa.get(t).push(e):r.Fa.set(t,[e]),h.snapshot}),aa.apply(this,arguments)}function Ap(r,e,t){return ua.apply(this,arguments)}function ua(){return(ua=(0,x.A)(function*(r,e,t){const n=F(r),i=n.va.get(e),s=n.Fa.get(i.targetId);if(s.length>1)return n.Fa.set(i.targetId,s.filter(a=>!mr(a,e))),void n.va.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield On(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Bn(n.remoteStore,i.targetId),jn(n,i.targetId)}).catch(Tt))):(jn(n,i.targetId),yield On(n.localStore,i.targetId,!0))})).apply(this,arguments)}function wp(r,e){return ca.apply(this,arguments)}function ca(){return(ca=(0,x.A)(function*(r,e){const t=F(r),n=t.va.get(e),i=t.Fa.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Bn(t.remoteStore,n.targetId))})).apply(this,arguments)}function la(){return(la=(0,x.A)(function*(r,e,t){const n=xa(r);try{const i=yield function(a,u){const c=F(a),h=de.now(),f=u.reduce((R,b)=>R.add(b.key),$());let g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let b=Ke(),k=$();return c.us.getEntries(R,f).next(D=>{b=D,b.forEach((B,z)=>{z.isValidDocument()||(k=k.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,b)).next(D=>{g=D;const B=[];for(const z of u){const q=Ym(z,g.get(z.key).overlayedDocument);null!=q&&B.push(new lt(z.key,q,yc(q.value.mapValue),fe.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,B,u)}).next(D=>{_=D;const B=D.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(R,D.batchId,B)})}).then(()=>({batchId:_.batchId,changes:Lc(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.La[a.currentUser.toKey()];h||(h=new oe(j)),h=h.insert(u,c),a.La[a.currentUser.toKey()]=h}(n,i.batchId,t),yield dt(n,i.changes),yield qn(n.remoteStore)}catch(i){const s=Gn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Vh(r,e){return ha.apply(this,arguments)}function ha(){return(ha=(0,x.A)(function*(r,e){const t=F(r);try{const n=yield function zg(r,e){const t=F(r),n=e.snapshotVersion;let i=t.ss;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.us.newChangeBuffer({trackRemovals:!0});i=t.ss;const u=[];e.targetChanges.forEach((f,g)=>{const _=i.get(g);if(!_)return;u.push(t.$r.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.$r.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);var k,D,B;null!==e.targetMismatches.get(g)?R=R.withResumeToken(ge.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),D=R,B=f,(0===(k=_).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8||B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0)&&u.push(t.$r.updateTargetData(s,R))});let c=Ke(),h=$();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(rh(s,a,e.documentUpdates).next(f=>{c=f.hs,h=f.Ps})),!n.isEqual(G.min())){const f=t.$r.getLastRemoteSnapshotVersion(s).next(g=>t.$r.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return w.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.ss=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Oa.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Da=!0:i.modifiedDocuments.size>0?U(a.Da):i.removedDocuments.size>0&&(U(a.Da),a.Da=!1))}),yield dt(t,n,e)}catch(n){yield Tt(n)}})).apply(this,arguments)}function xh(r,e,t){const n=F(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.va.forEach((s,a)=>{const u=a.view.Y_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=F(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(const _ of g.z_)_.Y_(u)&&(h=!0)}),h&&ea(c)}(n.eventManager,e),i.length&&n.Ca.E_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Pp(r,e,t){return da.apply(this,arguments)}function da(){return(da=(0,x.A)(function*(r,e,t){const n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Oa.get(e),s=i&&i.key;if(s){let a=new oe(O.comparator);a=a.insert(s,ce.newNoDocument(s,G.min()));const u=$().add(s),c=new Er(G.min(),new Map,new oe(j),a,u);yield Vh(n,c),n.xa=n.xa.remove(s),n.Oa.delete(e),Ia(n)}else yield On(n.localStore,e,!1).then(()=>jn(n,e,t)).catch(Tt)})).apply(this,arguments)}function Sp(r,e){return fa.apply(this,arguments)}function fa(){return(fa=(0,x.A)(function*(r,e){const t=F(r),n=e.batch.batchId;try{const i=yield function Gg(r,e){const t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.us.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const g=h.batch,_=g.keys();let R=w.resolve();return _.forEach(b=>{R=R.next(()=>f.getEntry(c,b)).next(k=>{const D=h.docVersions.get(b);U(null!==D),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=$();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);_a(t,n,null),pa(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield dt(t,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function Vp(r,e,t){return ma.apply(this,arguments)}function ma(){return(ma=(0,x.A)(function*(r,e,t){const n=F(r);try{const i=yield function(a,u){const c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(U(null!==g),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);_a(n,e,t),pa(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield dt(n,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function ga(){return(ga=(0,x.A)(function*(r,e){const t=F(r);Dt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Ba.get(n)||[];i.push(e),t.Ba.set(n,i)}catch(n){const i=Gn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function pa(r,e){(r.Ba.get(e)||[]).forEach(t=>{t.resolve()}),r.Ba.delete(e)}function _a(r,e,t){const n=F(r);let i=n.La[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.La[n.currentUser.toKey()]=i}}function jn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Fa.get(e))r.va.delete(n),t&&r.Ca.Ka(n,t);r.Fa.delete(e),r.isPrimaryClient&&r.Na.mr(e).forEach(n=>{r.Na.containsKey(n)||bh(r,n)})}function bh(r,e){r.Ma.delete(e.path.canonicalString());const t=r.xa.get(e);null!==t&&(Bn(r.remoteStore,t),r.xa=r.xa.remove(e),r.Oa.delete(t),Ia(r))}function ya(r,e,t){for(const n of t)n instanceof wh?(r.Na.addReference(n.key,e),bp(r,n)):n instanceof Rh?(N("SyncEngine","Document no longer in limbo: "+n.key),r.Na.removeReference(n.key,e),r.Na.containsKey(n.key)||bh(r,n.key)):L()}function bp(r,e){const t=e.key,n=t.path.canonicalString();r.xa.get(t)||r.Ma.has(n)||(N("SyncEngine","New document in limbo: "+t),r.Ma.add(n),Ia(r))}function Ia(r){for(;r.Ma.size>0&&r.xa.size<r.maxConcurrentLimboResolutions;){const e=r.Ma.values().next().value;r.Ma.delete(e);const t=new O(J.fromString(e)),n=r.ka.next();r.Oa.set(n,new Ip(t)),r.xa=r.xa.insert(t,n),Qi(r.remoteStore,new ht(be(An(t.path)),n,"TargetPurposeLimboResolution",$e.oe))}}function dt(r,e,t){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,x.A)(function*(r,e,t){const n=F(r),i=[],s=[],a=[];var u;n.va.isEmpty()||(n.va.forEach((u,c)=>{a.push(n.Qa(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const g=h?!h.fromCache:null===(f=t?.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(h){i.push(h);const g=To.Ui(c.targetId,h);s.push(g)}}))}),yield Promise.all(a),n.Ca.E_(i),yield(u=(0,x.A)(function*(h,f){const g=F(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>w.forEach(f,R=>w.forEach(R.Ki,b=>g.persistence.referenceDelegate.addReference(_,R.targetId,b)).next(()=>w.forEach(R.$i,b=>g.persistence.referenceDelegate.removeReference(_,R.targetId,b)))))}catch(_){if(!Et(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const R=_.targetId;if(!_.fromCache){const b=g.ss.get(R),D=b.withLastLimboFreeSnapshotVersion(b.snapshotVersion);g.ss=g.ss.insert(R,D)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Ta.apply(this,arguments)}function Cp(r,e){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,x.A)(function*(r,e){const t=F(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield th(t.localStore,e);t.currentUser=e,(s=t).Ba.forEach(u=>{u.forEach(c=>{c.reject(new C(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ba.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield dt(t,n.ls)}var s})).apply(this,arguments)}function Dp(r,e){const t=F(r),n=t.Oa.get(e);if(n&&n.Da)return $().add(n.key);{let i=$();const s=t.Fa.get(e);if(!s)return i;for(const a of s){const u=t.va.get(a);i=i.unionWith(u.view.Ra)}return i}}function Np(r,e){return va.apply(this,arguments)}function va(){return(va=(0,x.A)(function*(r,e){const t=F(r),n=yield Gi(t.localStore,e.query,!0),i=e.view.Sa(n);return t.isPrimaryClient&&ya(t,e.targetId,i.ya),i})).apply(this,arguments)}function kp(r,e){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,x.A)(function*(r,e){const t=F(r);return sh(t.localStore,e).then(n=>dt(t,n))})).apply(this,arguments)}function Fp(r,e,t,n){return wa.apply(this,arguments)}function wa(){return(wa=(0,x.A)(function*(r,e,t,n){const i=F(r),s=yield function(u,c){const h=F(u),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Fn(g,c).next(_=>_?h.localDocuments.getDocuments(g,_):w.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield qn(i.remoteStore):"acknowledged"===t||"rejected"===t?(_a(i,e,n||null),pa(i,e),c=e,F(F(i.localStore).mutationQueue).xn(c)):L(),yield dt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Ra(){return(Ra=(0,x.A)(function*(r,e){const t=F(r);if(Hi(t),xa(t),!0===e&&!0!==t.qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ch(t,n.toArray());t.qa=!0,yield Qo(t.remoteStore,!0);for(const s of i)Qi(t.remoteStore,s)}else if(!1===e&&!1!==t.qa){const n=[];let i=Promise.resolve();t.Fa.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(jn(t,a),On(t.localStore,a,!0))),Bn(t.remoteStore,a)}),yield i,yield Ch(t,n),function(a){const u=F(a);u.Oa.forEach((c,h)=>{Bn(u.remoteStore,h)}),u.Na.gr(),u.Oa=new Map,u.xa=new oe(O.comparator)}(t),t.qa=!1,yield Qo(t.remoteStore,!1)}})).apply(this,arguments)}function Ch(r,e,t){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,x.A)(function*(r,e,t){const n=F(r),i=[],s=[];for(const a of e){let u;const c=n.Fa.get(a);if(c&&0!==c.length){u=yield Mn(n.localStore,be(c[0]));for(const h of c){const f=n.va.get(h),g=yield Np(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield ih(n.localStore,a);u=yield Mn(n.localStore,h),yield oa(n,Dh(h),a,!1,u.resumeToken)}i.push(u)}return n.Ca.E_(s),i})).apply(this,arguments)}function Dh(r){return bc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Op(r){return t=F(r).localStore,F(F(t).persistence).qi();var t}function Lp(r,e,t,n){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,x.A)(function*(r,e,t,n){const i=F(r);if(i.qa)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield sh(i.localStore,Fc(s[0])),u=Er.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ge.EMPTY_BYTE_STRING);yield dt(i,a,u);break}case"rejected":yield On(i.localStore,e,!0),jn(i,e,n);break;default:L()}})).apply(this,arguments)}function Bp(r,e,t){return Va.apply(this,arguments)}function Va(){return(Va=(0,x.A)(function*(r,e,t){const n=Hi(r);if(n.qa){for(const i of e){if(n.Fa.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield ih(n.localStore,i),a=yield Mn(n.localStore,s);yield oa(n,Dh(s),a.targetId,!1,a.resumeToken),Qi(n.remoteStore,a)}for(const i of t)n.Fa.has(i)&&(yield On(n.localStore,i,!1).then(()=>{Bn(n.remoteStore,i),jn(n,i)}).catch(Tt))}})).apply(this,arguments)}function Hi(r){const e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Vh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Dp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Pp.bind(null,e),e.Ca.E_=mp.bind(null,e.eventManager),e.Ca.Ka=gp.bind(null,e.eventManager),e}function xa(r){const e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Sp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vp.bind(null,e),e}class $n{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,x.A)(function*(){t.serializer=Dr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return eh(this.persistence,new Zl,e.initialUser,this.serializer)}createPersistence(e){return new po(Bi.Yr,this.serializer)}createSharedClientState(e){return new ch}terminate(){var e=this;return(0,x.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ba extends $n{constructor(e,t,n){super(),this.Ua=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,x.A)(function*(){yield t().call(n,e),yield n.Ua.initialize(n,e),yield xa(n.Ua.syncEngine),yield qn(n.Ua.remoteStore),yield n.persistence.pi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return eh(this.persistence,new Zl,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Kl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new um(t,this.persistence);return new am(e.asyncQueue,n)}createPersistence(e){const t=Io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new yo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,hh(),$i(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new ch}}class Nh extends ba{constructor(e,t){super(e,t,!1),this.Ua=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,x.A)(function*(){yield t().call(n,e);const i=n.Ua.syncEngine;n.sharedClientState instanceof Vo&&(n.sharedClientState.syncEngine={eo:Fp.bind(null,i),no:Lp.bind(null,i),ro:Bp.bind(null,i),qi:Op.bind(null,i),Xs:kp.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.pi(function(){var s=(0,x.A)(function*(a){yield function Mp(r,e){return Ra.apply(this,arguments)}(n.Ua.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=hh();if(!Vo.D(t))throw new C(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Vo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Qn{initialize(e,t){var n=this;return(0,x.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>xh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Cp.bind(null,n.syncEngine),yield Qo(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new fp}createDatastore(e){const t=Dr(e.databaseInfo.databaseId),n=new Jg(e.databaseInfo);return new Zg(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>xh(this.syncEngine,t,0),u=lh.D()?new lh:new Qg,new tp(n,i,s,a,u);var n,i,s,a,u}createSyncEngine(e,t){return function(i,s,a,u,c,h,f){const g=new Tp(i,s,a,u,c,h);return f&&(g.qa=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,x.A)(function*(){var t,n,i;yield(i=(0,x.A)(function*(a){const u=F(a);N("RemoteStore","RemoteStore shutting down."),u.N_.add(5),yield Ln(u),u.B_.shutdown(),u.k_.set("Unknown")}),function s(a){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function kh(r,e=10240){let t=0;return{read:()=>(0,x.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,x.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Ji{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Wa(this.observer.next,e)}error(e){this.observer.error?this.Wa(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}Ga(){this.muted=!0}Wa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Gp{constructor(e,t){this.za=e,this.serializer=t,this.metadata=new Ee,this.buffer=new Uint8Array,this.ja=new TextDecoder("utf-8"),this.Ha().then(n=>{n&&n.aa()?this.metadata.resolve(n._a.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?._a)}`))},n=>this.metadata.reject(n))}close(){return this.za.cancel()}getMetadata(){var e=this;return(0,x.A)(function*(){return e.metadata.promise})()}$a(){var e=this;return(0,x.A)(function*(){return yield e.getMetadata(),e.Ha()})()}Ha(){var e=this;return(0,x.A)(function*(){const t=yield e.Ja();if(null===t)return null;const n=e.ja.decode(t),i=Number(n);isNaN(i)&&e.Ya(`length string (${n}) is not valid number`);const s=yield e.Za(i);return new pp(JSON.parse(s),t.length+i)})()}Xa(){return this.buffer.findIndex(e=>123===e)}Ja(){var e=this;return(0,x.A)(function*(){for(;e.Xa()<0&&!(yield e.eu()););if(0===e.buffer.length)return null;const t=e.Xa();t<0&&e.Ya("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Za(e){var t=this;return(0,x.A)(function*(){for(;t.buffer.length<e;)(yield t.eu())&&t.Ya("Reached the end of bundle when more is expected.");const n=t.ja.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Ya(e){throw this.za.cancel(),new Error(`Invalid bundle format: ${e}`)}eu(){var e=this;return(0,x.A)(function*(){const t=yield e.za.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class zp{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,x.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,x.A)(function*(a,u){const c=F(a),h={documents:u.map(R=>Ar(c.serializer,R))},f=yield c.No("BatchGetDocuments",c.serializer.databaseId,J.emptyPath(),h,u.length),g=new Map;f.forEach(R=>{const b=function og(r,e){return"found"in e?function(n,i){U(!!i.found);const s=nt(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):G.min(),c=new Pe({mapValue:{fields:i.found.fields}});return ce.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){U(!!i.missing),U(!!i.readTime);const s=nt(n,i.missing),a=Ie(i.readTime);return ce.newNoDocument(s,a)}(r,e):L()}(c.serializer,R);g.set(b.key.toString(),b)});const _=[];return u.forEach(R=>{const b=g.get(R.toString());U(!!b),_.push(b)}),_}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new xn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,x.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=O.fromPath(i);e.mutations.push(new Ys(s,e.precondition(s)))}),yield(n=(0,x.A)(function*(s,a){const u=F(s),c={writes:a.map(h=>wr(u.serializer,h))};yield u.Fo("Commit",u.serializer.databaseId,J.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L();t=G.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new C(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Kp{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.tu=n.maxAttempts,this.e_=new bo(this.asyncQueue,"transaction_retry")}nu(){this.tu-=1,this.ru()}ru(){var e=this;this.e_.Wo((0,x.A)(function*(){const t=new zp(e.datastore),n=e.iu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.su(s)}))}).catch(i=>{e.su(i)})}))}iu(e){try{const t=this.updateFunction(e);return!or(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}su(e){this.tu>0&&this.ou(e)?(this.tu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ru(),Promise.resolve()))):this.deferred.reject(e)}ou(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!el(t)}return!1}}class jp{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=$u.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var a=(0,x.A)(function*(u){N("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(n,a=>(N("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,x.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Gn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Yi(r,e){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,x.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,x.A)(function*(s){n.isEqual(s)||(yield th(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Ca.apply(this,arguments)}function Da(r,e){return Na.apply(this,arguments)}function Na(){return(Na=(0,x.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield ka(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>yh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>yh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Fh(r){return"FirebaseError"===r.name?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function ka(r){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,x.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Yi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Fh(t))throw t;Ge("Error using user provided cache. Falling back to memory cache: "+t),yield Yi(r,new $n)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield Yi(r,new $n);return r._offlineComponents})).apply(this,arguments)}function Xi(r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,x.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Da(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Da(r,new Qn))),r._onlineComponents})).apply(this,arguments)}function Mh(r){return ka(r).then(e=>e.persistence)}function Wn(r){return ka(r).then(e=>e.localStore)}function Oh(r){return Xi(r).then(e=>e.remoteStore)}function Oa(r){return Xi(r).then(e=>e.syncEngine)}function Hn(r){return La.apply(this,arguments)}function La(){return(La=(0,x.A)(function*(r){const e=yield Xi(r),t=e.eventManager;return t.onListen=Ep.bind(null,e.syncEngine),t.onUnlisten=Ap.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wp.bind(null,e.syncEngine),t})).apply(this,arguments)}function Bh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function(s,a,u,c,h){const f=new Ji({next:_=>{a.enqueueAndForget(()=>Xo(s,g));const R=_.docs.has(u);!R&&_.fromCache?h.reject(new C(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new na(An(u.path),f,{includeMetadataChanges:!0,oa:!0});return Jo(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function qh(r,e,t={}){const n=new Ee;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function(s,a,u,c,h){const f=new Ji({next:_=>{a.enqueueAndForget(()=>Xo(s,g)),_.fromCache&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new na(u,f,{includeMetadataChanges:!0,oa:!0});return Jo(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function Uh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Gh=new Map;function Ba(r,e,t){if(!t)throw new C(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function zh(r,e,t,n){if(!0===e&&!0===n)throw new C(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Kh(r){if(!O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function jh(r){if(O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":L()}function W(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zi(r);throw new C(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function $h(r,e){if(e<=0)throw new C(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Qh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Uh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kr{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Hf;switch(n.type){case"firstParty":return new Zf(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Gh.get(t);n&&(N("ComponentProvider","Removing Datastore"),Gh.delete(t),n.terminate())}(this),Promise.resolve()}}class Se{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Se(this.firestore,e,this._query)}}class le{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}}class rt extends Se{constructor(e,t,n){super(e,t,An(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new O(e))}withConverter(e){return new rt(this.firestore,e,this._path)}}function Hh(r,e,...t){if(r=(0,ee.Ku)(r),Ba("collection","path",e),r instanceof kr){const n=J.fromString(e,...t);return jh(n),new rt(r,null,n)}{if(!(r instanceof le||r instanceof rt))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return jh(n),new rt(r.firestore,null,n)}}function es(r,e,...t){if(r=(0,ee.Ku)(r),1===arguments.length&&(e=$u.newId()),Ba("doc","path",e),r instanceof kr){const n=J.fromString(e,...t);return Kh(n),new le(r,null,new O(n))}{if(!(r instanceof le||r instanceof rt))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return Kh(n),new le(r.firestore,r instanceof rt?r.converter:null,new O(n))}}function Jh(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),(r instanceof le||r instanceof rt)&&(e instanceof le||e instanceof rt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function qa(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),r instanceof Se&&e instanceof Se&&r.firestore===e.firestore&&mr(r._query,e._query)&&r.converter===e.converter}class i_{constructor(){this._u=Promise.resolve(),this.au=[],this.uu=!1,this.cu=[],this.lu=null,this.hu=!1,this.Pu=!1,this.Iu=[],this.e_=new bo(this,"async_queue_retry"),this.Tu=()=>{const t=$i();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.e_.zo()};const e=$i();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tu)}get isShuttingDown(){return this.uu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Eu(),this.du(e)}enterRestrictedMode(e){if(!this.uu){this.uu=!0,this.Pu=e||!1;const t=$i();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tu)}}enqueue(e){if(this.Eu(),this.uu)return new Promise(()=>{});const t=new Ee;return this.du(()=>this.uu&&this.Pu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.au.push(e),this.Au()))}Au(){var e=this;return(0,x.A)(function*(){if(0!==e.au.length){try{yield e.au[0](),e.au.shift(),e.e_.reset()}catch(t){if(!Et(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.au.length>0&&e.e_.Wo(()=>e.Au())}})()}du(e){const t=this._u.then(()=>(this.hu=!0,e().catch(n=>{throw this.lu=n,this.hu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.hu=!1,n))));return this._u=t,t}enqueueAfterDelay(e,t,n){this.Eu(),this.Iu.indexOf(e)>-1&&(t=0);const i=Ho.createAndSchedule(this,e,t,n,s=>this.Ru(s));return this.cu.push(i),i}Eu(){this.lu&&L()}verifyOperationInProgress(){}Vu(){var e=this;return(0,x.A)(function*(){let t;do{t=e._u,yield t}while(t!==e._u)})()}mu(e){for(const t of this.cu)if(t.timerId===e)return!0;return!1}fu(e){return this.Vu().then(()=>{this.cu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.cu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Vu()})}gu(e){this.Iu.push(e)}Ru(e){const t=this.cu.indexOf(e);this.cu.splice(t,1)}}function Ua(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class s_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class re extends kr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new i_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Yh(this),this._firestoreClient.terminate()}}function me(r){return r._firestoreClient||Yh(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Yh(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new bm(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Uh(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new jp(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Xh(r,e,t){const n=new Ee;return r.asyncQueue.enqueue((0,x.A)(function*(){try{yield Yi(r,t),yield Da(r,e),n.resolve()}catch(i){const s=i;if(!Fh(s))throw s;Ge("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Zh(r){if(r._initialized||r._terminated)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class it{constructor(e){this._byteString=e}static fromBase64String(e){try{return new it(ge.fromBase64String(e))}catch(t){throw new C(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new it(ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ft{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._methodName=e}}class ts{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}const p_=/^__.*__$/;class __{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vn(e,this.data,t,this.fieldTransforms)}}class ed{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new lt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function td(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class ns{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.pu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get yu(){return this.settings.yu}wu(e){return new ns(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.Du(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.pu(),i}vu(e){return this.wu({path:void 0,bu:!0})}Fu(e){return ss(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.xu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Du(this.path.get(e))}Du(e){if(0===e.length)throw this.Fu("Document fields must not be empty");if(td(this.yu)&&p_.test(e))throw this.Fu('Document fields cannot begin and end with "__"')}}class y_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Dr(e)}Ou(e,t,n,i=!1){return new ns({yu:e,methodName:t,xu:n,path:ue.emptyPath(),bu:!1,Mu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sn(r){const e=r._freezeSettings(),t=Dr(r._databaseId);return new y_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function rs(r,e,t,n,i,s={}){const a=r.Ou(s.merge||s.mergeFields?2:0,e,t,i);Wa("Data must be an object, but it was:",a,n);const u=id(n,a);let c,h;if(s.merge)c=new ze(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const _=Or(e,g,t);if(!a.contains(_))throw new C(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);od(f,_)||f.push(_)}c=new ze(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new __(new Pe(u),c,h)}class Mr extends rn{_toFieldTransform(e){if(2!==e.yu)throw e.Fu(1===e.yu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mr}}function nd(r,e,t){return new ns({yu:3,xu:e.settings.xu,methodName:r._methodName,bu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ga extends rn{_toFieldTransform(e){return new yr(e.path,new Pn)}isEqual(e){return e instanceof Ga}}class za extends rn{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){const t=nd(this,e,!0),n=this.Nu.map(s=>on(s,t)),i=new Wt(n);return new yr(e.path,i)}isEqual(e){return e instanceof za&&(0,ee.bD)(this.Nu,e.Nu)}}class Ka extends rn{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){const t=nd(this,e,!0),n=this.Nu.map(s=>on(s,t)),i=new Ht(n);return new yr(e.path,i)}isEqual(e){return e instanceof Ka&&(0,ee.bD)(this.Nu,e.Nu)}}class ja extends rn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=new Sn(e.serializer,Gc(e.serializer,this.Lu));return new yr(e.path,t)}isEqual(e){return e instanceof ja&&this.Lu===e.Lu}}function $a(r,e,t,n){const i=r.Ou(1,e,t);Wa("Data must be an object, but it was:",i,n);const s=[],a=Pe.empty();vt(n,(c,h)=>{const f=is(e,c,t);h=(0,ee.Ku)(h);const g=i.Cu(f);if(h instanceof Mr)s.push(f);else{const _=on(h,g);null!=_&&(s.push(f),a.set(f,_))}});const u=new ze(s);return new ed(a,u,i.fieldTransforms)}function Qa(r,e,t,n,i,s){const a=r.Ou(1,e,t),u=[Or(e,n,t)],c=[i];if(s.length%2!=0)throw new C(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Or(e,s[_])),c.push(s[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!od(h,u[_])){const R=u[_];let b=c[_];b=(0,ee.Ku)(b);const k=a.Cu(R);if(b instanceof Mr)h.push(R);else{const D=on(b,k);null!=D&&(h.push(R),f.set(R,D))}}const g=new ze(h);return new ed(f,g,a.fieldTransforms)}function rd(r,e,t,n=!1){return on(t,r.Ou(n?4:3,e))}function on(r,e){if(sd(r=(0,ee.Ku)(r)))return Wa("Unsupported field value:",e,r),id(r,e);if(r instanceof rn)return function(n,i){if(!td(i.yu))throw i.Fu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Fu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.bu&&4!==e.yu)throw e.Fu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=on(u,i.vu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ee.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Gc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:bn(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:bn(i.serializer,s)}}if(n instanceof ts)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof it)return{bytesValue:ll(i.serializer,n._byteString)};if(n instanceof le){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Fu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ro(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Fu(`Unsupported field value: ${Zi(n)}`)}(r,e)}function id(r,e){const t={};return cc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vt(r,(n,i)=>{const s=on(i,e.Su(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function sd(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof ts||r instanceof it||r instanceof le||r instanceof rn)}function Wa(r,e,t){if(!sd(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=Zi(t);throw e.Fu("an object"===n?r+" a custom object":r+" "+n)}var i}function Or(r,e,t){if((e=(0,ee.Ku)(e))instanceof ft)return e._internalPath;if("string"==typeof e)return is(r,e);throw ss("Field path arguments must be of type string or ",r,!1,void 0,t)}const I_=new RegExp("[~\\*/\\[\\]]");function is(r,e,t){if(e.search(I_)>=0)throw ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ft(...e.split("."))._internalPath}catch{throw ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ss(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new C(S.INVALID_ARGUMENT,u+r+c)}function od(r,e){return r.some(t=>t.isEqual(e))}class Lr{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new T_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(os("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class T_ extends Lr{data(){return super.data()}}function os(r,e){return"string"==typeof e?is(r,e):e instanceof ft?e._internalPath:e._delegate._internalPath}function ad(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ha{}class Br extends Ha{}function kt(r,e,...t){let n=[];e instanceof Ha&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Jn).length,u=s.filter(c=>c instanceof qr).length;if(a>1||a>0&&u>0)throw new C(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class qr extends Br{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new qr(e,t,n)}_apply(e){const t=this._parse(e);return hd(e._query,t),new Se(e.firestore,e.converter,Hs(e._query,t))}_parse(e){const t=sn(e.firestore);return function(s,a,u,c,h,f,g){let _;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){ld(g,f);const R=[];for(const b of g)R.push(cd(c,s,b));_={arrayValue:{values:R}}}else _=cd(c,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||ld(g,f),_=rd(u,"where",g,"in"===f||"not-in"===f);return Y.create(h,f,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Jn extends Ha{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)hd(a,c),a=Hs(a,c)}(e._query,t),new Se(e.firestore,e.converter,Hs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ja extends Br{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ja(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dr(s,a)}(e._query,this._field,this._direction);return new Se(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new ut(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class as extends Br{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new as(e,t,n)}_apply(e){return new Se(e.firestore,e.converter,Ri(e._query,this._limit,this._limitType))}}class us extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new us(e,t,n)}_apply(e){const t=ud(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class cs extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new cs(e,t,n)}_apply(e){const t=ud(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function ud(r,e,t,n){if(t[0]=(0,ee.Ku)(t[0]),t[0]instanceof Lr)return function(s,a,u,c,h){if(!c)throw new C(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of wn(s))if(g.field.isKeyField())f.push($t(a,c.key));else{const _=c.data.field(g.field);if(yi(_))throw new C(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const R=g.field.canonicalString();throw new C(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new St(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=sn(r.firestore);return function(a,u,c,h,f,g){const _=a.explicitOrderBy;if(f.length>_.length)throw new C(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let b=0;b<f.length;b++){const k=f[b];if(_[b].field.isKeyField()){if("string"!=typeof k)throw new C(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!Ws(a)&&-1!==k.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);const D=a.path.child(J.fromString(k));if(!O.isDocumentKey(D))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const B=new O(D);R.push($t(u,B))}else{const D=rd(c,h,k);R.push(D)}}return new St(R,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function cd(r,e,t){if("string"==typeof(t=(0,ee.Ku)(t))){if(""===t)throw new C(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ws(e)&&-1!==t.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(J.fromString(t));if(!O.isDocumentKey(n))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return $t(r,new O(n))}if(t instanceof le)return $t(r,t._key);throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zi(t)}.`)}function ld(r,e){if(!Array.isArray(r)||0===r.length)throw new C(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hd(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(S.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Ya{convertValue(e,t="none"){switch(Rt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(at(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return vt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new ts(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ii(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ur(e));default:return null}}convertTimestamp(e){const t=ot(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=J.fromString(e);U(vl(n));const i=new At(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ls(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class x_ extends Ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}class an{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mt extends Lr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(os("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ur extends mt{data(e={}){return super.data(e)}}class Ft{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Ur(this._firestore,this._userDataWriter,n.key,n,new an(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Ur(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Ur(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:C_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function C_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function fd(r,e){return r instanceof mt&&e instanceof mt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ft&&e instanceof Ft&&r._firestore===e._firestore&&qa(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Mt extends Ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function md(r,e,t){r=W(r,le);const n=W(r.firestore,re),i=ls(r.converter,e,t);return Yn(n,[rs(sn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,fe.none())])}function gd(r,e,t,...n){r=W(r,le);const i=W(r.firestore,re),s=sn(i);let a;return a="string"==typeof(e=(0,ee.Ku)(e))||e instanceof ft?Qa(s,"updateDoc",r._key,e,t,n):$a(s,"updateDoc",r._key,e),Yn(i,[a.toMutation(r._key,fe.exists(!0))])}function pd(r,...e){var t,n,i;r=(0,ee.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Ua(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ua(e[a])){const g=e[a];e[a]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,f;if(r instanceof le)h=W(r.firestore,re),f=An(r._key.path),c={next:g=>{e[a]&&e[a](Xa(h,r,g))},error:e[a+1],complete:e[a+2]};else{const g=W(r,Se);h=W(g.firestore,re),f=g._query;const _=new Mt(h);c={next:R=>{e[a]&&e[a](new Ft(h,_,g,R))},error:e[a+1],complete:e[a+2]},ad(r._query)}return function(_,R,b,k){const D=new Ji(k),B=new na(R,D,b);return _.asyncQueue.enqueueAndForget((0,x.A)(function*(){return Jo(yield Hn(_),B)})),()=>{D.Ga(),_.asyncQueue.enqueueAndForget((0,x.A)(function*(){return Xo(yield Hn(_),B)}))}}(me(h),f,u,c)}function Yn(r,e){return function(n,i){const s=new Ee;return n.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function Rp(r,e,t){return la.apply(this,arguments)}(yield Oa(n),i,s)})),s.promise}(me(r),e)}function Xa(r,e,t){const n=t.docs.get(e._key),i=new Mt(r);return new mt(r,i,e._key,n,new an(t.hasPendingWrites,t.fromCache),e.converter)}const H_={maxAttempts:5};class _d{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=sn(e)}set(e,t,n){this._verifyNotCommitted();const i=Ot(e,this._firestore),s=ls(i.converter,t,n),a=rs(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,fe.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Ot(e,this._firestore);let a;return a="string"==typeof(t=(0,ee.Ku)(t))||t instanceof ft?Qa(this._dataReader,"WriteBatch.update",s._key,t,n,i):$a(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ot(e,this._firestore);return this._mutations=this._mutations.concat(new xn(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ot(r,e){if((r=(0,ee.Ku)(r)).firestore!==e)throw new C(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class J_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=sn(t)}get(t){const n=Ot(t,this._firestore),i=new x_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return L();const a=s[0];if(a.isFoundDocument())return new Lr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Lr(this._firestore,i,n._key,null,n.converter);throw L()})}set(t,n,i){const s=Ot(t,this._firestore),a=ls(s.converter,n,i),u=rs(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Ot(t,this._firestore);let u;return u="string"==typeof(n=(0,ee.Ku)(n))||n instanceof ft?Qa(this._dataReader,"Transaction.update",a._key,n,i,s):$a(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Ot(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ot(e,this._firestore),n=new Mt(this._firestore);return super.get(e).then(i=>new mt(this._firestore,n,t._key,i._document,new an(!1,!1),t.converter))}}function eu(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ed(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function vd(){if(!function Vm(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){gn=di.SDK_VERSION,(0,di._registerComponent)(new Nu.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new re(new Yf(n.getProvider("auth-internal")),new em(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new At(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,di.registerVersion)(zu,"4.6.5",e),(0,di.registerVersion)(zu,"4.6.5","esm2017")}();class Gr{constructor(e){this._delegate=e}static fromBase64String(e){return vd(),new Gr(it.fromBase64String(e))}static fromUint8Array(e){return Ed(),new Gr(it.fromUint8Array(e))}toBase64(){return vd(),this._delegate.toBase64()}toUint8Array(){return Ed(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function tu(r){return function oy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class ay{enableIndexedDbPersistence(e,t){return function a_(r,e){Zh(r=W(r,re));const t=me(r);if(t._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Qn;return Xh(t,i,new ba(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function u_(r){Zh(r=W(r,re));const e=me(r);if(e._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Qn;return Xh(e,n,new Nh(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function c_(r){if(r._initialized&&!r._terminated)throw new C(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ee;return r._queue.enqueueAndForgetEvenWhileRestricted((0,x.A)(function*(){try{yield(t=(0,x.A)(function*(i){if(!Xe.D())return Promise.resolve();const s=i+"main";yield Xe.delete(s)}),function n(i){return t.apply(this,arguments)})(Io(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Ad{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof At||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ge("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function Wh(r,e,t,n={}){var i;const s=(r=W(r,kr))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ae.MOCK_USER;else{u=(0,ee.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new C(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ae(h)}r._authCredentials=new Jf(new Ku(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function h_(r){return function $p(r){return r.asyncQueue.enqueue((0,x.A)(function*(){const e=yield Mh(r),t=yield Oh(r);return e.setNetworkEnabled(!0),function(i){const s=F(i);return s.N_.delete(0),Nr(s)}(t)}))}(me(r=W(r,re)))}(this._delegate)}disableNetwork(){return function d_(r){return function Qp(r){return r.asyncQueue.enqueue((0,x.A)(function*(){const e=yield Mh(r),t=yield Oh(r);return e.setNetworkEnabled(!1),(n=(0,x.A)(function*(s){const a=F(s);a.N_.add(0),yield Ln(a),a.k_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(me(r=W(r,re)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,zh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function l_(r){return function(t){const n=new Ee;return t.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function xp(r,e){return ga.apply(this,arguments)}(yield Oa(t),n)})),n.promise}(me(r=W(r,re)))}(this._delegate)}onSnapshotsInSync(e){return function q_(r,e){return function Yp(r,e){const t=new Ji(e);return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return i=yield Hn(r),s=t,F(i).J_.add(s),void s.next();var i,s})),()=>{t.Ga(),r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return i=yield Hn(r),s=t,void F(i).J_.delete(s);var i,s}))}}(me(r=W(r,re)),Ua(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Xn(this,Hh(this._delegate,e))}catch(t){throw Oe(t,"collection()","Firestore.collection()")}}doc(e){try{return new We(this,es(this._delegate,e))}catch(t){throw Oe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Le(this,function r_(r,e){if(r=W(r,kr),Ba("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Se(r,null,(n=e,new ut(J.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Oe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function Y_(r,e,t){r=W(r,re);const n=Object.assign(Object.assign({},H_),t);return function(s){if(s.maxAttempts<1)throw new C(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new Ee;return s.asyncQueue.enqueueAndForget((0,x.A)(function*(){const h=yield function Lh(r){return Xi(r).then(e=>e.datastore)}(s);new Kp(s.asyncQueue,h,u,a,c).nu()})),c.promise}(me(r),i=>e(new J_(r,i)),n)}(this._delegate,t=>e(new wd(this,t)))}batch(){return me(this._delegate),new Rd(new _d(this._delegate,e=>Yn(this._delegate,e)))}loadBundle(e){return function f_(r,e){const t=me(r=W(r,re)),n=new s_;return function Xp(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?nl().encode(a):a,f=function(f,g){if(f instanceof Uint8Array)return kh(f,g);if(f instanceof ArrayBuffer)return kh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Gp(f,u);var f}(t,Dr(e));r.asyncQueue.enqueueAndForget((0,x.A)(function*(){!function qp(r,e,t){const n=F(r);var i;(i=(0,x.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(b,k){const D=F(b),B=Ie(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",z=>D.Wr.getBundleMetadata(z,k.id)).then(z=>!!z&&z.createTime.compareTo(B)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(b=h).totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}),Promise.resolve(new Set);c._updateProgress(Ah(h));const f=new _p(h,a.localStore,u.serializer);let g=yield u.$a();for(;g;){const R=yield f.ca(g);R&&c._updateProgress(R),g=yield u.$a()}const _=yield f.complete();return yield dt(a,_.Pa,void 0),yield function(b,k){const D=F(b);return D.persistence.runTransaction("Save bundle","readwrite",B=>D.Wr.saveBundleMetadata(B,k))}(a.localStore,h),c._completeWith(_.progress),Promise.resolve(_.ha)}catch(h){return Ge("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var b}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield Oa(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function m_(r,e){return function Zp(r,e){return r.asyncQueue.enqueue((0,x.A)(function*(){return function(n,i){const s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Wr.getNamedQuery(a,i))}(yield Wn(r),e)}))}(me(r=W(r,re)),e).then(t=>t?new Se(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Le(this,t):null)}}class ds extends Ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(new it(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return We.forKey(t,this.firestore,null)}}class wd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}get(e){const t=cn(e);return this._delegate.get(t).then(n=>new zr(this._firestore,new mt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=cn(e);return n?(eu("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}}class Rd{constructor(e){this._delegate=e}set(e,t,n){const i=cn(e);return n?(eu("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class un{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Ur(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Kr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=un.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new un(e,new ds(e),t),i.set(t,s)),s}}un.INSTANCES=new WeakMap;class We{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new We(t,new le(t._delegate,n,new O(e)))}static forKey(e,t,n){return new We(t,new le(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Xn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Xn(this.firestore,Hh(this._delegate,e))}catch(t){throw Oe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ee.Ku)(e))instanceof le&&Jh(this._delegate,e)}set(e,t){t=eu("DocumentReference.set",t);try{return t?md(this._delegate,e,t):md(this._delegate,e)}catch(n){throw Oe(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?gd(this._delegate,e):gd(this._delegate,e,t,...n)}catch(i){throw Oe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function L_(r){return Yn(W(r.firestore,re),[new xn(r._key,fe.none())])}(this._delegate)}onSnapshot(...e){const t=Pd(e),n=Sd(e,i=>new zr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return pd(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function N_(r){r=W(r,le);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return function Wp(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return(n=(0,x.A)(function*(s,a,u){try{const c=yield function(f,g){const _=F(f);return _.persistence.runTransaction("read document","readonly",R=>_.localDocuments.getDocument(R,g))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new C(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=Gn(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new mt(e,n,r._key,i,new an(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function k_(r){r=W(r,le);const e=W(r.firestore,re);return Bh(me(e),r._key,{source:"server"}).then(t=>Xa(e,r,t))}(this._delegate):function D_(r){r=W(r,le);const e=W(r.firestore,re);return Bh(me(e),r._key).then(t=>Xa(e,r,t))}(this._delegate),t.then(n=>new zr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new We(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function Oe(r,e,t){return r.message=r.message.replace(e,t),r}function Pd(r){for(const e of r)if("object"==typeof e&&!tu(e))return e;return{}}function Sd(r,e){var t,n;let i;return i=tu(r[0])?r[0]:tu(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class zr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new We(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return fd(this._delegate,e._delegate)}}class Kr extends zr{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Wf(r,e){r||L()}(void 0!==t),t}}class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}where(e,t,n){try{return new Le(this.firestore,kt(this._delegate,function E_(r,e,t){const n=e,i=os("where",r);return qr._create(i,n,t)}(e,t,n)))}catch(i){throw Oe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Le(this.firestore,kt(this._delegate,function v_(r,e="asc"){const t=e,n=os("orderBy",r);return Ja._create(n,t)}(e,t)))}catch(n){throw Oe(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Le(this.firestore,kt(this._delegate,function A_(r){return $h("limit",r),as._create("limit",r,"F")}(e)))}catch(t){throw Oe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Le(this.firestore,kt(this._delegate,function w_(r){return $h("limitToLast",r),as._create("limitToLast",r,"L")}(e)))}catch(t){throw Oe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Le(this.firestore,kt(this._delegate,function R_(...r){return us._create("startAt",r,!0)}(...e)))}catch(t){throw Oe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Le(this.firestore,kt(this._delegate,function P_(...r){return us._create("startAfter",r,!1)}(...e)))}catch(t){throw Oe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Le(this.firestore,kt(this._delegate,function S_(...r){return cs._create("endBefore",r,!1)}(...e)))}catch(t){throw Oe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Le(this.firestore,kt(this._delegate,function V_(...r){return cs._create("endAt",r,!0)}(...e)))}catch(t){throw Oe(t,"endAt()","Query.endAt()")}}isEqual(e){return qa(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function M_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return function Hp(r,e){const t=new Ee;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return(n=(0,x.A)(function*(s,a,u){try{const c=yield Gi(s,a,!0),h=new Ph(a,c.Is),f=h.Va(c.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(c){const h=Gn(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate):"server"===e?.source?function O_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return qh(t,r._query,{source:"server"}).then(i=>new Ft(e,n,r,i))}(this._delegate):function F_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return ad(r._query),qh(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate),t.then(n=>new nu(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Pd(e),n=Sd(e,i=>new nu(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return pd(this._delegate,t,n)}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}class cy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Kr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class nu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Kr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new cy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Kr(this._firestore,n))})}isEqual(e){return fd(this._delegate,e._delegate)}}class Xn extends Le{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new We(this.firestore,e):null}doc(e){try{return new We(this.firestore,void 0===e?es(this._delegate):es(this._delegate,e))}catch(t){throw Oe(t,"doc()","CollectionReference.doc()")}}add(e){return function B_(r,e){const t=W(r.firestore,re),n=es(r),i=ls(r.converter,e);return Yn(t,[rs(sn(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,fe.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new We(this.firestore,t))}isEqual(e){return Jh(this._delegate,e._delegate)}withConverter(e){return new Xn(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function cn(r){return W(r,le)}class ru{constructor(...e){this._delegate=new ft(...e)}static documentId(){return new ru(ue.keyField().canonicalString())}isEqual(e){return(e=(0,ee.Ku)(e))instanceof ft&&this._delegate._internalPath.isEqual(e._internalPath)}}class ln{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Z_(){return new Ga("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ln(e)}static delete(){const e=function X_(){return new Mr("deleteField")}();return e._methodName="FieldValue.delete",new ln(e)}static arrayUnion(...e){const t=function ey(...r){return new za("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ln(t)}static arrayRemove(...e){const t=function ty(...r){return new Ka("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ln(t)}static increment(e){const t=function ny(r){return new ja("increment",r)}(e);return t._methodName="FieldValue.increment",new ln(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const ly={Firestore:Ad,GeoPoint:ts,Timestamp:de,Blob:Gr,Transaction:wd,WriteBatch:Rd,DocumentReference:We,DocumentSnapshot:zr,Query:Le,QueryDocumentSnapshot:Kr,QuerySnapshot:nu,CollectionReference:Xn,FieldPath:ru,FieldValue:ln,setLogLevel:function uy(r){!function Qf(r){It.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};!function dy(r){(function hy(r,e){r.INTERNAL.registerComponent(new Nu.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},ly)))})(r,(e,t)=>new Ad(e,t,new ay)),r.registerVersion("@firebase/firestore-compat","0.3.34")}($f.A);var fy=ae(7935);function Vd(r,e){return function my(r,e=Uf.E){return new Gf.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function iu(r,e){return Vd(r,e).pipe((0,Je.T)(t=>({payload:t,type:"query"})))}class xd{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Fd(n,t);return new Dd(i,s,this.afs)}snapshotChanges(){return function gy(r,e){return Vd(r,e).pipe((0,Cs.Z)(void 0),Ds(),(0,Je.T)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Je.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,hi.H)(this.ref.get(e)).pipe(Ue.U0)}}function fs(r,e){return iu(r,e).pipe((0,Cs.Z)(void 0),Ds(),(0,Je.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function bd(r,e,t){return fs(r,t).pipe((0,Ns.S)((n,i)=>function py(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function _y(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return su(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return su(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return su(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,jf.F)(),(0,Je.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function su(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Cd(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Dd{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=fs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Je.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Cs.Z)(void 0),Ds(),(0,Du.p)(([n,i])=>i.length>0||!n),(0,Je.T)(([,n])=>n),Ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ns.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Cd(e);return bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return iu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),Ue.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(Ue.U0)}add(e){return this.ref.add(e)}doc(e){return new xd(this.ref.doc(e),this.afs)}}class yy{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?fs(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Du.p)(t=>t.length>0),Ue.U0):fs(this.query,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ns.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Cd(e);return bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return iu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ue.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(Ue.U0)}}const Nd=new se.nKC("angularfire2.enableFirestorePersistence"),kd=new se.nKC("angularfire2.firestore.persistenceSettings"),Iy=new se.nKC("angularfire2.firestore.settings"),Ty=new se.nKC("angularfire2.firestore.use-emulator");function Fd(r,e=(t=>t)){return{query:e(r),ref:r}}let Md=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,h,f,g,_,R,b,k,D,B,z){this.schedulers=c;const q=(0,li.iB)(t,u,n),K=f;g&&(0,yt.gF)(q,u,_,b,k,D,R,B),[this.firestore,this.persistenceEnabled$]=(0,li.BM)(`${q.name}.firestore`,"AngularFirestore",q.name,()=>{const H=u.runOutsideAngular(()=>q.firestore());if(s&&H.settings(s),K&&H.useEmulator(...K),i&&!(0,qf.Vy)(a)){const Q=()=>{try{return(0,hi.H)(H.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),(0,Cu.of)(!1)}};return[H,u.runOutsideAngular(Q)]}return[H,(0,Cu.of)(!1)]},[s,K,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:a}=Fd(i,n),u=this.schedulers.ngZone.run(()=>s);return new Dd(u,a,this)}collectionGroup(t,n){const i=n||(a=>a),s=this.firestore.collectionGroup(t);return new yy(i(s),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>n);return new xd(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(se.KVO(li.rx),se.KVO(li.uP,8),se.KVO(Nd,8),se.KVO(Iy,8),se.KVO(se.Agw),se.KVO(se.SKi),se.KVO(Ue.u0),se.KVO(kd,8),se.KVO(Ty,8),se.KVO(yt.DS,8),se.KVO(yt.CP,8),se.KVO(yt.yy,8),se.KVO(yt.ZP,8),se.KVO(yt.$z,8),se.KVO(yt.AU,8),se.KVO(yt.UB,8),se.KVO(Ue.Jv,8))};static \u0275prov=se.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),Ey=(()=>{class r{constructor(){fy.A.registerVersion("angularfire",Ue.xv.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Nd,useValue:!0},{provide:kd,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=se.$C({type:r});static \u0275inj=se.G2t({providers:[Md]})}return r})()}}]);