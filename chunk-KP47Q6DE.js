import{$ as ze,G as Ne,H as Ue,I as Oe,J as xe,K as Le,M as We,N as Me,U as _e,_ as je,ca as te,ga as He,n as ke,p as Re,t as De}from"./chunk-LQZV7VGV.js";import{a as qe}from"./chunk-Y3ASEDM3.js";import{a as Ie}from"./chunk-SXB6XA5Q.js";import{a as k,b as R,c as F,d as D,e as d,l as H,m as V,p as q,x as Ve}from"./chunk-3W4SIWKU.js";import{$ as W,E as he,G as me,H as x,M as Z,Oc as ee,P as b,Qc as v,R as P,Rc as A,S as ge,Tc as y,Z as L,a as fe,aa as g,b as U,ba as ve,ca as M,d as X,da as Ae,ia as _,m as Y,ma as j,o as O,ra as f,z as K}from"./chunk-LXNYTSMG.js";import{E as z,F as Pe,K as ye,L as Fe,M as Te,P as we,R as I,d as Ee,g as Se,h as $e,j as Ce,w as be}from"./chunk-LZXNU2FR.js";var ln="auth";var T=class{constructor(){return F(ln)}};var B=function(){return B=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},B.apply(this,arguments)};var fn={includeMetadataChanges:!1};function ne(e,t){return t===void 0&&(t=fn),new fe(function(n){var r=te(e,t,{next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)});return{unsubscribe:r}})}function Be(e){return ne(e,{includeMetadataChanges:!0})}function Ge(e,t){return t===void 0&&(t={}),Be(e).pipe(O(function(n){return re(n,t)}))}function re(e,t){var n;t===void 0&&(t={});var r=e.data(t);return!e.exists()||typeof r!="object"||r===null||!t.idField?r:B(B({},r),(n={},n[t.idField]=e.id,n))}function Je(e){return ne(e,{includeMetadataChanges:!0}).pipe(O(function(t){return t.docs}))}function Qe(e,t){return t===void 0&&(t={}),Je(e).pipe(O(function(n){return n.map(function(r){return re(r,t)})}))}var S=class{constructor(t){return t}},Xe="firestore",oe=class{constructor(){return F(Xe)}};var se=new W("angularfire2.firestore-instances");function hn(e,t){let n=R(Xe,e,t);return n&&new S(n)}function mn(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new S(r)}}var gn={provide:oe,deps:[[new f,se]]},vn={provide:S,useFactory:hn,deps:[[new f,se],H]};function Go(e,...t){return I("angularfire",k.full,"fst"),M([vn,gn,{provide:se,useFactory:mn(e),multi:!0,deps:[j,_,D,V,[new f,T],[new f,q],...t]}])}var Ye=d(Qe,!0);var Jo=d(Ge,!0);var Ke=d(ke,!0,2);var Qo=d(Re,!0,2);var Xo=d(Me,!0,2);var Yo=d(_e,!0);var Ko=d(De,!0);var Zo=d(xe,!0,2),es=d(Le,!0,2);var ts=d(Oe,!0,2),ns=d(Ne,!0,2);var rs=d(He,!0),os=d(je,!0,2);var ss=d(We,!0,2);var is=d(ze,!0,2);var as=d(Ue,!0,2);var In="type.googleapis.com/google.protobuf.Int64Value",En="type.googleapis.com/google.protobuf.UInt64Value";function nt(e,t){let n={};for(let r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function G(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>G(t));if(typeof e=="function"||typeof e=="object")return nt(e,t=>G(t));throw new Error("Data cannot be encoded in JSON: "+e)}function w(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case In:case En:{let t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>w(t)):typeof e=="function"||typeof e=="object"?nt(e,t=>w(t)):e}var ue="functions";var Ze={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},p=class e extends be{constructor(t,n,r){super(`${ue}/${t}`,n||""),this.details=r,Object.setPrototypeOf(this,e.prototype)}};function Sn(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function J(e,t){let n=Sn(e),r=n,o;try{let i=t&&t.error;if(i){let a=i.status;if(typeof a=="string"){if(!Ze[a])return new p("internal","internal");n=Ze[a],r=a}let c=i.message;typeof c=="string"&&(r=c),o=i.details,o!==void 0&&(o=w(o))}}catch{}return n==="ok"?null:new p(n,r,o)}var ie=class{constructor(t,n,r,o){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Te(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=n.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||n.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||o?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{let t=await this.auth.getToken();return t?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let n=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(t){let n=await this.getAuthToken(),r=await this.getMessagingToken(),o=await this.getAppCheckToken(t);return{authToken:n,messagingToken:r,appCheckToken:o}}};var ae="us-central1",$n=/^data: (.*?)(?:\n|$)/;function Cn(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new p("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}var ce=class{constructor(t,n,r,o,i=ae,a=(...c)=>fetch(...c)){this.app=t,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new ie(t,n,r,o),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{let c=new URL(i);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=ae}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(t){let n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${n}.cloudfunctions.net/${t}`}};function bn(e,t,n){let r=Se(t);e.emulatorOrigin=`http${r?"s":""}://${t}:${n}`,r&&($e(e.emulatorOrigin),Ce("Functions",!0))}function Pn(e,t,n){let r=o=>Fn(e,t,o,n||{});return r.stream=(o,i)=>wn(e,t,o,i),r}async function yn(e,t,n,r){n["Content-Type"]="application/json";let o;try{o=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch{return{status:0,json:null}}let i=null;try{i=await o.json()}catch{}return{status:o.status,json:i}}async function rt(e,t){let n={},r=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}function Fn(e,t,n,r){let o=e._url(t);return Tn(e,o,n,r)}async function Tn(e,t,n,r){n=G(n);let o={data:n},i=await rt(e,r),a=r.timeout||7e4,c=Cn(a),s=await Promise.race([yn(t,o,i,e.fetchImpl),c.promise,e.cancelAllRequests]);if(c.cancel(),!s)throw new p("cancelled","Firebase Functions instance was deleted.");let l=J(s.status,s.json);if(l)throw l;if(!s.json)throw new p("internal","Response is not valid JSON object.");let u=s.json.data;if(typeof u>"u"&&(u=s.json.result),typeof u>"u")throw new p("internal","Response is missing data field.");return{data:w(u)}}function wn(e,t,n,r){let o=e._url(t);return kn(e,o,n,r||{})}async function kn(e,t,n,r){var o;n=G(n);let i={data:n},a=await rt(e,r);a["Content-Type"]="application/json",a.Accept="text/event-stream";let c;try{c=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(i),headers:a,signal:r?.signal})}catch(h){if(h instanceof Error&&h.name==="AbortError"){let N=new p("cancelled","Request was cancelled.");return{data:Promise.reject(N),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(N)}}}}}}let C=J(0,null);return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}let s,l,u=new Promise((h,C)=>{s=h,l=C});(o=r?.signal)===null||o===void 0||o.addEventListener("abort",()=>{let h=new p("cancelled","Request was cancelled.");l(h)});let m=c.body.getReader(),E=Rn(m,s,l,r?.signal);return{stream:{[Symbol.asyncIterator](){let h=E.getReader();return{async next(){let{value:C,done:N}=await h.read();return{value:C,done:N}},async return(){return await h.cancel(),{done:!0,value:void 0}}}}},data:u}}function Rn(e,t,n,r){let o=(a,c)=>{let s=a.match($n);if(!s)return;let l=s[1];try{let u=JSON.parse(l);if("result"in u){t(w(u.result));return}if("message"in u){c.enqueue(w(u.message));return}if("error"in u){let m=J(0,u);c.error(m),n(m);return}}catch(u){if(u instanceof p){c.error(u),n(u);return}}},i=new TextDecoder;return new ReadableStream({start(a){let c="";return s();async function s(){if(r?.aborted){let l=new p("cancelled","Request was cancelled");return a.error(l),n(l),Promise.resolve()}try{let{value:l,done:u}=await e.read();if(u){c.trim()&&o(c.trim(),a),a.close();return}if(r?.aborted){let E=new p("cancelled","Request was cancelled");a.error(E),n(E),await e.cancel();return}c+=i.decode(l,{stream:!0});let m=c.split(`
`);c=m.pop()||"";for(let E of m)E.trim()&&o(E.trim(),a);return s()}catch(l){let u=l instanceof p?l:J(0,null);a.error(u),n(u)}}},cancel(){return e.cancel()}})}var et="@firebase/functions",tt="0.12.9";var Dn="auth-internal",Nn="app-check-internal",Un="messaging-internal";function On(e){let t=(n,{instanceIdentifier:r})=>{let o=n.getProvider("app").getImmediate(),i=n.getProvider(Dn),a=n.getProvider(Un),c=n.getProvider(Nn);return new ce(o,i,a,c,r)};ye(new Pe(ue,t,"PUBLIC").setMultipleInstances(!0)),I(et,tt,e),I(et,tt,"esm2017")}function ot(e=we(),t=ae){let r=Fe(z(e),ue).getImmediate({identifier:t}),o=Ee("functions");return o&&st(r,...o),r}function st(e,t,n){bn(z(e),t,n)}function it(e,t,n){return Pn(z(e),t,n)}On();var $=class{constructor(t){return t}},at="functions",le=class{constructor(){return F(at)}};var de=new W("angularfire2.functions-instances");function xn(e,t){let n=R(at,e,t);return n&&new $(n)}function Ln(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new $(r)}}var Wn={provide:le,deps:[[new f,de]]},Mn={provide:$,useFactory:xn,deps:[[new f,de],H]};function bs(e,...t){return I("angularfire",k.full,"fn"),M([Mn,Wn,{provide:de,useFactory:Ln(e),multi:!0,deps:[j,_,D,V,[new f,T],[new f,q],...t]}])}var Ps=d(ot,!0),ct=d(it,!0);var Q=class e{constructor(t){this.remote=t;v("LocalFunctionsService.constructor()")}destroy$=new U;ngOnDestroy(){v("LocalFunctionsService.OnDestroy()"),this.destroy$.next()}async action(t){this.call(t,void 0)}async read(t){return this.call(t,void 0)}async call(t,n){return this.execute(t,n)}async execute(t,n){return(await ct(this.remote,t)(n)).data}static \u0275fac=function(n){return new(n||e)(g($))};static \u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})};var pe=class{constructor(t,n,r,o,i){this.auth=t;this.funcs=n;this.localSession=r;this.firestore=o;this.dom=i;v("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${ee.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${ee.FirebaseCloudFunctionsHost}`,"preconnect");let a=this.auth.user.pipe(x());a.pipe(x(),P(this.finalize$)).subscribe(s=>{this.sourceValue$.next()}),this.state$=a.pipe(K(s=>s!==null)),this.localSession.markedLogout$.pipe(P(this.finalize$)).subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe(P(this.finalize$)).subscribe({error:s=>{y("AuthService.state$ error",s),this.doFinalize()},complete:()=>{A("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe(b(s=>{let l=Ke(this.firestore,"users/v1/protected",s.uid,"fcm");return Ye(l).pipe(ge(u=>v("UserProtectedStore has changed.",u)))}),P(this.finalize$)).subscribe({next:s=>{this.sourceValue$.next()},error:s=>{y("AuthService.state$ Maybe after logout permission error. Ignore it.",s),this.doFinalize()},complete:()=>{A("AuthService.state$ completed."),this.doFinalize()}});let c=this.state$.pipe(b(async s=>{try{let l=await this.funcs.read("readUserSettings"),u=s;return u.isAdmin=l.isAdmin,u.isDeveloper=l.isDeveloper,u.hasMessaging=l.hasMessaging,u}catch(l){return y("AuthService while check user settings.",l),null}}));this.localUser$=this.sourceValue$.pipe(he(100),b(()=>a.pipe(b(s=>s===null?Y(null):c))),Z(1)),this.localUser$.pipe(P(this.finalize$)).subscribe({next:async s=>{v("AuthService.localUser$.subscribe()",s),s?(this.loginUid=s.uid,this.isAdminUser=!!s.isAdmin,this.isDevelopUser=!!s.isDeveloper,this.hasMessagingDevice=!!s.hasMessaging,this.localSession.updateLoginPhoto(s.photoURL),this.localSession.markLogin()):(this.localSession.unmarkLogin(),this.localSession.updateLoginPhoto(null),this.loginUid=null,this.isAdminUser=!1,this.isDevelopUser=!1,this.hasMessagingDevice=!1,A("Explicitly logout on client sdk."),await this.auth.signOut())},complete:()=>{A("AuthService.localUser$ complete."),this.doFinalize()},error:s=>{y("AuthService.localUser$ error while retrieving.",s),this.doFinalize()}})}finalize$=new U;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;env=ve(Ae);sourceValue$=new X;doFinalize(){this.finalize$.isStopped||(A("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}},ut=class e{constructor(t,n,r,o,i){this.auth=t;this.funcs=n;this.localSession=r;this.firestore=o;this.dom=i;v("AuthService.constructor()");let a=new X;e.AUTH===null&&(e.AUTH=new pe(t,n,r,o,i),e.AUTH.finalize$.pipe(me(1)).subscribe({next:()=>{A("Finalize singleton auth continue..")},complete:()=>{A("Finalizing singleton auth completed."),e.AUTH=null,a.next()},error:c=>{y("Finalizing singleton auth cause by error.",c),e.AUTH=null,a.next()}})),this._clientSideUser$=a.pipe(b(()=>e.AUTH===null?Y(null):e.AUTH.localUser$),Z(1)),a.next()}static AUTH=null;_clientSideUser$;get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return e.AUTH?e.AUTH.isAdminUser:!1}get isDeveloper(){return e.AUTH?e.AUTH.isDevelopUser:!1}get hasMessaging(){return e.AUTH?e.AUTH.hasMessagingDevice:!1}get myUid(){return e.AUTH?e.AUTH.loginUid:null}static \u0275fac=function(n){return new(n||e)(g(Ve),g(Q),g(Ie),g(S),g(qe))};static \u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})};export{S as a,Go as b,Ye as c,Jo as d,Ke as e,Qo as f,Xo as g,Yo as h,Ko as i,Zo as j,es as k,ts as l,ns as m,rs as n,os as o,ss as p,is as q,as as r,bs as s,Ps as t,Q as u,ut as v};
