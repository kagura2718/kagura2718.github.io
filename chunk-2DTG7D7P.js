import{a as or}from"./chunk-25HB5RHV.js";import{a as sr}from"./chunk-JAZVKBN7.js";import{a as Sn}from"./chunk-O3QUZWY7.js";import{a as Fn}from"./chunk-LPTBQK7N.js";import{a as Yn}from"./chunk-NPUYNGZX.js";import"./chunk-7EPLRJ4Z.js";import{$ as mi,A as qt,Aa as qn,B as zt,Ba as zn,C as ft,Ca as Hn,D as vt,Da as Di,E as Ct,Ea as Ui,F as _t,G as Ht,H as Kt,I as bt,J as Yt,K as Qt,L as Jt,M as Zt,N as Xt,O as ei,P as ti,Q as ii,R as ni,S as ri,T as oi,U as si,V as ai,W as ui,X as li,Y as ci,Z as di,_ as pi,a as mt,aa as hi,b as Mt,ba as gi,c as Ln,ca as fi,d as Lt,da as vi,e as $n,ea as Ci,f as ht,fa as _i,g as ye,ga as Ie,h as Vn,ha as Q,i as Wn,ia as bi,j as Ee,ja as de,k as ue,ka as yi,l as ie,la as Ei,m as $t,ma as Ai,n as le,na as Si,o as Be,oa as xi,p as M,pa as pe,q as Vt,qa as Ii,r as ce,ra as ki,s as Ae,sa as wi,t as Se,ta as jn,u as gt,ua as Oe,v as Wt,va as Ti,w as Gn,wa as Pi,x as xe,xa as Fi,y as Gt,ya as Ri,z as jt,za as Ne}from"./chunk-O6LU5PJZ.js";import{a as tr}from"./chunk-ZCNZH7N4.js";import"./chunk-PVDFZURY.js";import{a as Zn}from"./chunk-CAUXKSHT.js";import"./chunk-T2NEJTFN.js";import{a as ir,b as nr,c as rr}from"./chunk-6IEAZPGH.js";import{a as hn}from"./chunk-46547TLV.js";import{a as dt,b as Dn,c as Un,d as Nt,e as be,f as pt,g as Bn,k as On,l as Qn,m as Bi,n as Xn,o as er}from"./chunk-PF44J4XZ.js";import"./chunk-CEGM4YDP.js";import{a as mn,b as gn,d as lt,e as ct}from"./chunk-PPKZ6WBG.js";import{b as Nn,c as Mn,d as ke,e as G}from"./chunk-CMOT2GVO.js";import{j as Rn,k as Jn}from"./chunk-UXGQAVKW.js";import"./chunk-DG46H57O.js";import"./chunk-M5PFS4RI.js";import{a as _e}from"./chunk-GWNSOZ2S.js";import{b as En,c as An}from"./chunk-IDYZAMJ5.js";import{d as xn,f as In,g as kn,h as wn,i as Tn,k as Pn,x as Kn}from"./chunk-XQP67AG3.js";import"./chunk-ZF5UGXRX.js";import{a as ve}from"./chunk-XA4BGICE.js";import{$ as Rt,$a as ee,Ba as l,C as Qi,Cb as Re,Eb as s,F as Ji,Fb as Y,Fc as pn,G as $,Gb as se,H as Zi,Ha as C,Hb as Ye,Ia as sn,Ib as Qe,Ic as it,Jb as Je,Ka as W,Kb as Ze,La as re,M as qe,Nc as Bt,Oa as ze,Ob as Ut,Oc as De,P as y,Pb as un,Q as Ft,Qc as f,R as k,Rb as ln,Rc as S,S as Xi,T as en,Tc as x,Va as h,Wc as nt,Xa as g,Xb as ae,Xc as rt,Yb as Xe,Yc as ot,Z as fe,Za as oe,Zb as et,Zc as st,_ as ne,_a as X,_c as Ue,a as Pt,aa as w,ab as _,ad as O,b as L,bb as a,bd as fn,cb as u,cd as vn,db as v,eb as T,ed as Ot,fa as R,fb as A,ga as D,gb as He,gd as Cn,hd as at,i as Ki,j as z,k as H,la as tn,m as ge,ma as nn,mb as te,na as rn,nd as _n,o as V,p as Ge,pb as b,pd as bn,q as je,qb as an,qd as yn,r as Yi,rb as m,rd as ut,sc as cn,sd as Ce,tc as tt,ub as Ke,uc as dn,va as on,vb as Pe,wb as Fe,z as K,za as Dt}from"./chunk-NPI22PXE.js";import"./chunk-KEDNFY7G.js";import"./chunk-EU2KAMEK.js";import"./chunk-LZXNU2FR.js";import"./chunk-VB56BUGO.js";var Oi=new Rt("angularfire2.messaging.vapid-key"),xr=new Rt("angularfire2.messaging.service-worker-registeration"),ar=(()=>{class n{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(e,i,r,o,c,p,E){let F=E,d=ge(void 0).pipe(H(c.outsideAngular),z(c.insideAngular),y(Fn),y(B=>B?import("./chunk-OOP74IBZ.js"):Ki),V(()=>Tn(e,o,i)),y(B=>Pn(`${B.name}.messaging`,"AngularFireMessaging",B.name,()=>ge(B.messaging()),[])),qe({bufferSize:1,refCount:!1}));this.requestPermission=d.pipe(H(c.outsideAngular),z(c.insideAngular),y(()=>Notification.requestPermission())),this.getToken=d.pipe(H(c.outsideAngular),z(c.insideAngular),y(async B=>{if(Notification.permission==="granted"){let Te=F?await F:null;return await B.getToken({vapidKey:p,serviceWorkerRegistration:Te})}else return null}));let I=new Pt(B=>{navigator.permissions.query({name:"notifications"}).then(Te=>{Te.onchange=()=>B.next()})}),We=d.pipe(H(c.outsideAngular),z(c.insideAngular),Ft(I),Ft(this.getToken));return this.tokenChanges=d.pipe(H(c.outsideAngular),z(c.insideAngular),y(()=>Yi(this.getToken,We))),this.messages=d.pipe(H(c.outsideAngular),z(c.insideAngular),y(B=>new Pt(Te=>B.onMessage(Te)))),this.requestToken=d.pipe(H(c.outsideAngular),z(c.insideAngular),y(()=>this.requestPermission),Qi(()=>ge(null)),je(()=>this.tokenChanges)),this.deleteToken=()=>d.pipe(H(c.outsideAngular),z(c.insideAngular),y(B=>B.deleteToken()),Ji(!1)),In(this,d,o)}static \u0275fac=function(i){return new(i||n)(w(kn),w(wn,8),w(on),w(nn),w(xn),w(Oi,8),w(xr,8))};static \u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var yt=class n extends lt{constructor(){super()}ngOnInit(){f("DeleteConfirmComponent.OnInit()")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=W({type:n,selectors:[["gitfire-delete-confirm"]],features:[ze],decls:10,vars:0,consts:[[1,"m-3"]],template:function(e,i){e&1&&(T(0,"div",0)(1,"div"),s(2,"\u672C\u5F53\u306B\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F"),A(),T(3,"ul")(4,"li"),s(5,"Google / Twitter \u306A\u3069\u306E\u30A2\u30AB\u30A6\u30F3\u30C8\u60C5\u5831\u306F\u524A\u9664\u3055\u308C\u307E\u305B\u3093\u3002"),A(),T(6,"li"),s(7,"\u516C\u958B\u3055\u308C\u305F\u6295\u7A3F\u306F\u524A\u9664\u3055\u308C\u307E\u305B\u3093\u3002"),A(),T(8,"li"),s(9,"\u53D6\u308A\u6D88\u3057\u306F\u3067\u304D\u307E\u305B\u3093\u3002"),A()()())},encapsulation:2})};function me(){return window}var kr=2e3;async function wr(n,t,e){let{BuildInfo:i}=me();Vt(t.sessionId,"AuthEvent did not contain a session ID");let r=await Dr(t.sessionId),o={};return Wt()?o.ibi=i.packageName:gt()?o.apn=i.packageName:le(n,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=r,Hn(n,e,t.type,void 0,t.eventId??void 0,o)}async function Tr(n){let{BuildInfo:t}=me(),e={};Wt()?e.iosBundleId=t.packageName:gt()?e.androidPackageName=t.packageName:le(n,"operation-not-supported-in-this-environment"),await zn(n,e)}function Pr(n){let{cordova:t}=me();return new Promise(e=>{t.plugins.browsertab.isAvailable(i=>{let r=null;i?t.plugins.browsertab.openUrl(n):r=t.InAppBrowser.open(n,Gn()?"_blank":"_system","location=yes"),e(r)})})}async function Fr(n,t,e){let{cordova:i}=me(),r=()=>{};try{await new Promise((o,c)=>{let p=null;function E(){o();let I=i.plugins.browsertab?.close;typeof I=="function"&&I(),typeof e?.close=="function"&&e.close()}function F(){p||(p=window.setTimeout(()=>{c(Be(n,"redirect-cancelled-by-user"))},kr))}function d(){document?.visibilityState==="visible"&&F()}t.addPassiveListener(E),document.addEventListener("resume",F,!1),gt()&&document.addEventListener("visibilitychange",d,!1),r=()=>{t.removePassiveListener(E),document.removeEventListener("resume",F,!1),document.removeEventListener("visibilitychange",d,!1),p&&window.clearTimeout(p)}})}finally{r()}}function Rr(n){let t=me();M(typeof t?.universalLinks?.subscribe=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),M(typeof t?.BuildInfo?.packageName<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),M(typeof t?.cordova?.plugins?.browsertab?.openUrl=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),M(typeof t?.cordova?.plugins?.browsertab?.isAvailable=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),M(typeof t?.cordova?.InAppBrowser?.open=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function Dr(n){let t=Ur(n),e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Ur(n){if(Vt(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);let t=new ArrayBuffer(n.length),e=new Uint8Array(t);for(let i=0;i<n.length;i++)e[i]=n.charCodeAt(i);return e}var Br=20,Ni=class extends qn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(t=>{this.resolveInitialized=t})}addPassiveListener(t){this.passiveListeners.add(t)}removePassiveListener(t){this.passiveListeners.delete(t)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInitialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}};function Or(n,t,e=null){return{type:t,eventId:e,urlResponse:null,sessionId:Lr(),postBody:null,tenantId:n.tenantId,error:Be(n,"no-auth-event")}}function Nr(n,t){return Mi()._set(Li(n),t)}async function ur(n){let t=await Mi()._get(Li(n));return t&&await Mi()._remove(Li(n)),t}function Mr(n,t){let e=Vr(t);if(e.includes("/__/auth/callback")){let i=At(e),o=(i.firebaseError?$r(decodeURIComponent(i.firebaseError)):null)?.code?.split("auth/")?.[1],c=o?Be(o):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:e,postBody:null}}return null}function Lr(){let n=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<Br;e++){let i=Math.floor(Math.random()*t.length);n.push(t.charAt(i))}return n.join("")}function Mi(){return ce(Ie)}function Li(n){return Se("authEvent",n.config.apiKey,n.name)}function $r(n){try{return JSON.parse(n)}catch{return null}}function Vr(n){let t=At(n),e=t.link?decodeURIComponent(t.link):void 0,i=At(e).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return At(r).link||r||i||e||n}function At(n){if(!n?.includes("?"))return{};let[t,...e]=n.split("?");return Vn(e.join("?"))}var Wr=500,$i=class{constructor(){this._redirectPersistence=Q,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ne,this._overrideRedirectResult=Oe}async _initialize(t){let e=t._key(),i=this.eventManagers.get(e);return i||(i=new Ni(t),this.eventManagers.set(e,i),this.attachCallbackListeners(t,i)),i}_openPopup(t){le(t,"operation-not-supported-in-this-environment")}async _openRedirect(t,e,i,r){Rr(t);let o=await this._initialize(t);await o.initialized(),o.resetRedirect(),jn(),await this._originValidation(t);let c=Or(t,i,r);await Nr(t,c);let p=await wr(t,c,e),E=await Pr(p);return Fr(t,o,E)}_isIframeWebStorageSupported(t,e){throw new Error("Method not implemented.")}_originValidation(t){let e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Tr(t)),this.originValidationPromises[e]}attachCallbackListeners(t,e){let{universalLinks:i,handleOpenURL:r,BuildInfo:o}=me(),c=setTimeout(async()=>{await ur(t),e.onEvent(lr())},Wr),p=async d=>{clearTimeout(c);let I=await ur(t),We=null;I&&d?.url&&(We=Mr(I,d.url)),e.onEvent(We||lr())};typeof i<"u"&&typeof i.subscribe=="function"&&i.subscribe(null,p);let E=r,F=`${o.packageName.toLowerCase()}://`;me().handleOpenURL=async d=>{if(d.toLowerCase().startsWith(F)&&p({url:d}),typeof E=="function")try{E(d)}catch(I){console.error(I)}}}},cr=$i;function lr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Be("no-auth-event")}}function dr(n,t){xe(n)._logFramework(t)}var jr="@firebase/auth-compat",qr="0.6.2";var zr=1e3;function $e(){return self?.location?.protocol||null}function Hr(){return $e()==="http:"||$e()==="https:"}function hr(n=mt()){return!!(($e()==="file:"||$e()==="ionic:"||$e()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function Kr(){return Lt()||Mt()}function Yr(){return $n()&&document?.documentMode===11}function Qr(n=mt()){return/Edge\/\d+/.test(n)}function Jr(n=mt()){return Yr()||Qr(n)}function gr(){try{let n=self.localStorage,t=bi();if(n)return n.setItem(t,"1"),n.removeItem(t),Jr()?ht():!0}catch{return zi()&&ht()}return!1}function zi(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Vi(){return(Hr()||Ln()||hr())&&!Kr()&&gr()&&!zi()}function fr(){return hr()&&typeof document<"u"}async function Zr(){return fr()?new Promise(n=>{let t=setTimeout(()=>{n(!1)},zr);document.addEventListener("deviceready",()=>{clearTimeout(t),n(!0)})}):!1}function Xr(){return typeof window<"u"?window:null}var N={LOCAL:"local",NONE:"none",SESSION:"session"},Me=M,vr="persistence";function eo(n,t){if(Me(Object.values(N).includes(t),n,"invalid-persistence-type"),Lt()){Me(t!==N.SESSION,n,"unsupported-persistence-type");return}if(Mt()){Me(t===N.NONE,n,"unsupported-persistence-type");return}if(zi()){Me(t===N.NONE||t===N.LOCAL&&ht(),n,"unsupported-persistence-type");return}Me(t===N.NONE||gr(),n,"unsupported-persistence-type")}async function Wi(n){await n._initializationPromise;let t=Cr(),e=Se(vr,n.config.apiKey,n.name);t&&t.setItem(e,n._getPersistenceType())}function to(n,t){let e=Cr();if(!e)return[];let i=Se(vr,n,t);switch(e.getItem(i)){case N.NONE:return[Ae];case N.LOCAL:return[de,Q];case N.SESSION:return[Q];default:return[]}}function Cr(){try{return Xr()?.sessionStorage||null}catch{return null}}var io=M,q=class{constructor(){this.browserResolver=ce(Di),this.cordovaResolver=ce(cr),this.underlyingResolver=null,this._redirectPersistence=Q,this._completeRedirectFn=Ne,this._overrideRedirectResult=Oe}async _initialize(t){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(t)}async _openPopup(t,e,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(t,e,i,r)}async _openRedirect(t,e,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(t,e,i,r)}_isIframeWebStorageSupported(t,e){this.assertedUnderlyingResolver._isIframeWebStorageSupported(t,e)}_originValidation(t){return this.assertedUnderlyingResolver._originValidation(t)}get _shouldInitProactively(){return fr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return io(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;let t=await Zr();this.underlyingResolver=t?this.cordovaResolver:this.browserResolver}};function _r(n){return n.unwrap()}function no(n){return n.wrapped()}function ro(n){return br(n)}function oo(n,t){let e=t.customData?._tokenResponse;if(t?.code==="auth/multi-factor-auth-required"){let i=t;i.resolver=new ji(n,Ci(n,t))}else if(e){let i=br(t),r=t;i&&(r.credential=i,r.tenantId=e.tenantId||void 0,r.email=e.email||void 0,r.phoneNumber=e.phoneNumber||void 0)}}function br(n){let{_tokenResponse:t}=n instanceof ye?n.customData:n;if(!t)return null;if(!(n instanceof ye)&&"temporaryProof"in t&&"phoneNumber"in t)return pe.credentialFromResult(n);let e=t.providerId;if(!e||e===ue.PASSWORD)return null;let i;switch(e){case ue.GOOGLE:i=Ct;break;case ue.FACEBOOK:i=vt;break;case ue.GITHUB:i=_t;break;case ue.TWITTER:i=bt;break;default:let{oauthIdToken:r,oauthAccessToken:o,oauthTokenSecret:c,pendingToken:p,nonce:E}=t;return!o&&!c&&!r&&!p?null:p?e.startsWith("saml.")?Ht._create(e,p):qt._fromParams({providerId:e,signInMethod:e,pendingToken:p,idToken:r,accessToken:o}):new ft(e).credential({idToken:r,accessToken:o,rawNonce:E})}return n instanceof ye?i.credentialFromError(n):i.credentialFromResult(n)}function U(n,t){return t.catch(e=>{throw e instanceof ye&&oo(n,e),e}).then(e=>{let i=e.operationType,r=e.user;return{operationType:i,credential:ro(e),additionalUserInfo:vi(e),user:we.getOrCreate(r)}})}async function Gi(n,t){let e=await t;return{verificationId:e.verificationId,confirm:i=>U(n,e.confirm(i))}}var ji=class{constructor(t,e){this.resolver=e,this.auth=no(t)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(t){return U(_r(this.auth),this.resolver.resolveSignIn(t))}};var we=class n{constructor(t){this._delegate=t,this.multiFactor=_i(t)}static getOrCreate(t){return n.USER_MAP.has(t)||n.USER_MAP.set(t,new n(t)),n.USER_MAP.get(t)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(t){return this._delegate.getIdTokenResult(t)}getIdToken(t){return this._delegate.getIdToken(t)}linkAndRetrieveDataWithCredential(t){return this.linkWithCredential(t)}async linkWithCredential(t){return U(this.auth,Zt(this._delegate,t))}async linkWithPhoneNumber(t,e){return Gi(this.auth,Ai(this._delegate,t,e))}async linkWithPopup(t){return U(this.auth,wi(this._delegate,t,q))}async linkWithRedirect(t){return await Wi(xe(this.auth)),Fi(this._delegate,t,q)}reauthenticateAndRetrieveDataWithCredential(t){return this.reauthenticateWithCredential(t)}async reauthenticateWithCredential(t){return U(this.auth,Xt(this._delegate,t))}reauthenticateWithPhoneNumber(t,e){return Gi(this.auth,Si(this._delegate,t,e))}reauthenticateWithPopup(t){return U(this.auth,ki(this._delegate,t,q))}async reauthenticateWithRedirect(t){return await Wi(xe(this.auth)),Pi(this._delegate,t,q)}sendEmailVerification(t){return pi(this._delegate,t)}async unlink(t){return await Qt(this._delegate,t),this}updateEmail(t){return gi(this._delegate,t)}updatePassword(t){return fi(this._delegate,t)}updatePhoneNumber(t){return xi(this._delegate,t)}updateProfile(t){return hi(this._delegate,t)}verifyBeforeUpdateEmail(t,e){return mi(this._delegate,t,e)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};we.USER_MAP=new WeakMap;var Le=M,pr=(()=>{class n{constructor(e,i){if(this.app=e,i.isInitialized()){this._delegate=i.getImmediate(),this.linkUnderlyingAuth();return}let{apiKey:r}=e.options;Le(r,"invalid-api-key",{appName:e.name}),Le(r,"invalid-api-key",{appName:e.name});let o=typeof window<"u"?q:void 0;this._delegate=i.initialize({options:{persistence:so(r,e.name),popupRedirectResolver:o}}),this._delegate._updateErrorMap($t),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?we.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,i){Gt(this._delegate,e,i)}applyActionCode(e){return ni(this._delegate,e)}checkActionCode(e){return ri(this._delegate,e)}confirmPasswordReset(e,i){return ii(this._delegate,e,i)}async createUserWithEmailAndPassword(e,i){return U(this._delegate,si(this._delegate,e,i))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return di(this._delegate,e)}isSignInWithEmailLink(e){return li(this._delegate,e)}async getRedirectResult(){Le(Vi(),this._delegate,"operation-not-supported-in-this-environment");let e=await Ri(this._delegate,q);return e?U(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){dr(this._delegate,e)}onAuthStateChanged(e,i,r){let{next:o,error:c,complete:p}=mr(e,i,r);return this._delegate.onAuthStateChanged(o,c,p)}onIdTokenChanged(e,i,r){let{next:o,error:c,complete:p}=mr(e,i,r);return this._delegate.onIdTokenChanged(o,c,p)}sendSignInLinkToEmail(e,i){return ui(this._delegate,e,i)}sendPasswordResetEmail(e,i){return ti(this._delegate,e,i||void 0)}async setPersistence(e){eo(this._delegate,e);let i;switch(e){case N.SESSION:i=Q;break;case N.LOCAL:i=await ce(de)._isAvailable()?de:Ie;break;case N.NONE:i=Ae;break;default:return le("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(i)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return U(this._delegate,Yt(this._delegate))}signInWithCredential(e){return U(this._delegate,Jt(this._delegate,e))}signInWithCustomToken(e){return U(this._delegate,ei(this._delegate,e))}signInWithEmailAndPassword(e,i){return U(this._delegate,ai(this._delegate,e,i))}signInWithEmailLink(e,i){return U(this._delegate,ci(this._delegate,e,i))}signInWithPhoneNumber(e,i){return Gi(this._delegate,Ei(this._delegate,e,i))}async signInWithPopup(e){return Le(Vi(),this._delegate,"operation-not-supported-in-this-environment"),U(this._delegate,Ii(this._delegate,e,q))}async signInWithRedirect(e){return Le(Vi(),this._delegate,"operation-not-supported-in-this-environment"),await Wi(this._delegate),Ti(this._delegate,e,q)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return oi(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return n.Persistence=N,n})();function mr(n,t,e){let i=n;typeof n!="function"&&({next:i,error:t,complete:e}=n);let r=i;return{next:c=>r(c&&we.getOrCreate(c)),error:t,complete:e}}function so(n,t){let e=to(n,t);if(typeof self<"u"&&!e.includes(de)&&e.push(de),typeof window<"u")for(let i of[Ie,Q])e.includes(i)||e.push(i);return e.includes(Ae)||e.push(Ae),e}var Ve=class{static credential(t,e){return pe.credential(t,e)}constructor(){this.providerId="phone",this._delegate=new pe(_r(Ee.auth()))}verifyPhoneNumber(t,e){return this._delegate.verifyPhoneNumber(t,e)}unwrap(){return this._delegate}};Ve.PHONE_SIGN_IN_METHOD=pe.PHONE_SIGN_IN_METHOD;Ve.PROVIDER_ID=pe.PROVIDER_ID;var ao=M,qi=class{constructor(t,e,i=Ee.app()){ao(i.options?.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new yi(i.auth(),t,e),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}};var uo="auth-compat";function lo(n){n.INTERNAL.registerComponent(new Wn(uo,t=>{let e=t.getProvider("app-compat").getImmediate(),i=t.getProvider("auth");return new pr(e,i)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:ie.EMAIL_SIGNIN,PASSWORD_RESET:ie.PASSWORD_RESET,RECOVER_EMAIL:ie.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:ie.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:ie.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:ie.VERIFY_EMAIL}},EmailAuthProvider:zt,FacebookAuthProvider:vt,GithubAuthProvider:_t,GoogleAuthProvider:Ct,OAuthProvider:ft,SAMLAuthProvider:Kt,PhoneAuthProvider:Ve,PhoneMultiFactorGenerator:Ui,RecaptchaVerifier:qi,TwitterAuthProvider:bt,Auth:pr,AuthCredential:jt,Error:ye}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(jr,qr)}lo(Ee);var co=["specialAuthContainer"];function po(n,t){if(n&1){let e=te();T(0,"a",7),an("click",function(r){let o=R(e).$implicit,c=m();return D(c.onClickReauthProvider(r,o))}),s(1),A()}if(n&2){let e=t.$implicit;l(),Y(e.providerId)}}var St=class n extends lt{constructor(e,i){super();this.loader=e;this.toastr=i}static SUPPORTED_PROVIDERS={};static SupportedOauthProviderIds=[];destroy$=new L;get providers(){return this.currentUser.providerData}currentUser;reauthed=new tn;specialAuthContainer;static{let e=n.SUPPORTED_PROVIDERS,i=Ee.auth;e[i.EmailAuthProvider.PROVIDER_ID]=i.EmailAuthProvider,e[i.TwitterAuthProvider.PROVIDER_ID]=i.TwitterAuthProvider,e[i.GoogleAuthProvider.PROVIDER_ID]=i.GoogleAuthProvider,e[i.GithubAuthProvider.PROVIDER_ID]=i.GithubAuthProvider;let r=n.SupportedOauthProviderIds;r.push(i.TwitterAuthProvider.PROVIDER_ID),r.push(i.GoogleAuthProvider.PROVIDER_ID),r.push(i.GithubAuthProvider.PROVIDER_ID)}ngOnDestroy(){this.destroy$.next()}isOAuthProvider(e){return!!n.SupportedOauthProviderIds.includes(e)}async onClickReauthProvider(e,i){f("onClickReauthProvider()",e,i),e.preventDefault();let r=n.SUPPORTED_PROVIDERS[i.providerId],o=new r;if(this.specialAuthContainer.clear(),this.isOAuthProvider(i.providerId)){try{await this.currentUser.reauthenticateWithPopup(o)}catch(c){x("Error while reauth",c);let p=c instanceof Error?c.message:"Unknown error";this.toastr.error(`\u518D\u8A8D\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${p} )`);return}f("Reanthenticated via OAuth provider")}else{let{GitfireLoginModule:c}=await import("./chunk-LOGE6XRQ.js"),{InputAuthComponent:p}=await import("./chunk-QRH4B22R.js"),E=this.loader.appendComponent(this.specialAuthContainer,c,p);E.isReauth=!0,E.reauthUser=this.currentUser,E.showFederations=!1;let F=E.reauthed.pipe($(1));try{await F.toPromise()}catch(d){x("Error while reauth done",d);let I=d instanceof Error?d.message:"Unknown error";this.toastr.error(`\u518D\u8A8D\u8A3C\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${I} )`);return}f("Reanthenticated via password")}this.reauthed.next(),super.close()}static \u0275fac=function(i){return new(i||n)(C(Sn),C(ve))};static \u0275cmp=W({type:n,selectors:[["gitfire-reauth-box"]],viewQuery:function(i,r){if(i&1&&Ke(co,5,sn),i&2){let o;Pe(o=Fe())&&(r.specialAuthContainer=o.first)}},inputs:{currentUser:"currentUser"},outputs:{reauthed:"reauthed"},features:[ze],decls:11,vars:0,consts:[["specialAuthContainer",""],[1,"m-3"],[1,"btn-group"],["type","button","data-bs-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","btn-primary","dropdown-toggle"],[1,"visually-hidden"],[1,"dropdown-menu"],["href","#",1,"dropdown-item"],["href","#",1,"dropdown-item",3,"click"]],template:function(i,r){i&1&&(T(0,"div",1)(1,"div",2)(2,"button",3)(3,"span",4),s(4,"Toggle Dropdown"),A(),s(5,"\u8A8D\u8A3C\u65B9\u6CD5"),A(),T(6,"div",5),X(7,po,2,1,"a",6,oe),A()(),He(9,"div",null,0),A()),i&2&&(l(7),ee(r.providers))},encapsulation:2})};function J(n,t){if(n.value!==t){if(n.dirty){x(`Upstream value has been changed to ${n.value} -> ${t} but sillengly ignore the value.`);return}n.setErrors(null),n.setValue(t)}}function P(n){n.markAsPristine(),n.markAsUntouched()}var _o=(n,t)=>t.id;function bo(n,t){if(n&1){let e=te();a(0,"button",20),b("click",function(r){R(e);let o=m().$implicit,c=m();return D(c.onClickDeleteDevice(r,o))}),s(1,"\u524A\u9664"),u()}}function yo(n,t){if(n&1){let e=te();a(0,"div",7)(1,"app-switch",18),ae(2,"date"),b("checkChanged",function(r){let o=R(e).$implicit,c=m();return D(c.onToggleDevice(r,o))}),u(),h(3,bo,2,0,"button",19),u()}if(n&2){let e=t.$implicit,i=m();l(),_("controlLabel",ln("",e.name||"No Name"," ",e.id===i.registeredDeviceId()?"[\u3053\u306E\u7AEF\u672B]":null," (\u767B\u9332\u65E5: ",et(2,8,e.createdAt.toDate(),"yyyy-MM-dd"),")"))("formName",un("device-",e.id))("parentForm",i.deviceForm),l(2),g(e.id!==i.registeredDeviceId()?3:-1)}}function Eo(n,t){if(n&1&&(a(0,"div"),s(1),u()),n&2){let e=t.$implicit,i=t.$index;l(),Ye("",i,": ",e)}}function Ao(n,t){if(n&1&&(a(0,"div"),s(1),u()),n&2){let e=t.$implicit,i=t.$index;l(),Ye("",i,": ",e)}}function So(n,t){if(n&1&&(a(0,"div"),s(1),u()),n&2){let e=t.$implicit,i=t.$index;l(),Ye("",i,": ",e)}}function xo(n,t){if(n&1&&(a(0,"div"),s(1),ae(2,"json"),u()),n&2){let e=t.$implicit;l(),Y(Xe(2,1,e))}}var xt=class n{constructor(t,e,i,r,o,c){this.auth=t;this.dialog=e;this.toastr=i;this.firestore=r;this.funcs=o;this.messaging=c;this.currentUser$=this.auth.clientSideUser$.pipe(K(p=>!!p))}destroy$=new L;mainForm;userPrivStore$;deviceForm;messagingTypeArray;configArray;currentUser$;registeredDeviceId=rn(null);registeredToken;debugObservable={};devices;tokenReceived=new L;tokenReceived$;MessagingDeviceConverter=Qn(["createdAt","updatedAt"]);onToggleDevice(t,e){f("onToggleDevice()");let i=this.getDeviceControl(e),r={deviceId:e.id,off:!i.value};try{this.funcs.call("toggleSuspendDevice",r),this.toastr.success("\u7AEF\u672B\u306E\u8A2D\u5B9A\u3092\u66F4\u65B0\u3057\u307E\u3057\u305F\u3002")}catch{this.toastr.error("\u7AEF\u672B\u306E\u8A2D\u5B9A\u304C\u66F4\u65B0\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}onClickDeleteDevice(t,e){f("onClickDeleteDevice()"),this.messaging.deleteToken(e.token).pipe(k(this.destroy$)).subscribe({next:async r=>{S(`deleteToken() result ${r}`),this.toastr.success("\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")},error:r=>{x(`Failed to delete token token: ${e.token}`,r),this.toastr.error("\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u65E2\u306B\u5931\u52B9\u3057\u3066\u3044\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002")}});let i={deviceId:e.id};try{this.funcs.call("revokeDevice",i),this.toastr.success("\u30B7\u30B9\u30C6\u30E0\u4E0A\u304B\u3089\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")}catch{this.toastr.error("\u30B7\u30B9\u30C6\u30E0\u4E0A\u306E\u7AEF\u672B\u306E\u901A\u77E5\u3092\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}ngOnInit(){let e=this.currentUser$.pipe($(1),K(i=>!!i)).pipe(y(i=>{let r=be(this.firestore,"users/v1/protected",i.uid,"fcm").withConverter(this.MessagingDeviceConverter);return Un(r,{idField:"id"})}),qe(1));e.pipe(k(this.destroy$)).subscribe(i=>{this.devices=i;for(let r in this.deviceForm.controls)this.deviceForm.removeControl(r);for(let r of this.devices)this.addDeviceControl(r);this.triggerTokenRefresh()}),this.mainForm.addControl("messagingOn",new O(!1,[])),this.deviceForm=new Ue({}),this.mainForm.addControl("devices",this.deviceForm),this.mainForm.addControl("messagingSystemCheck",new O(!1,[])),this.mainForm.addControl("messagingTrivialCheck",new O(!1,[])),this.mainForm.addControl("messagingMentionCheck",new O(!1,[])),this.mainForm.addControl("messagingAdminCheck",new O(!1,[])),this.messagingTypeArray=new Ot([this.typeSystemControl,this.typeMentionControl,this.typeAdminControl]),this.configArray=new Ot([this.typeTrivialControl,this.messagingTypeArray]),this.userPrivStore$.pipe(k(this.destroy$)).subscribe(i=>{S("this.userPrivStore$.subscribe()",i);let r=i.messagingTypes||["mention","admin"];J(this.typeSystemControl,r.includes("system")),J(this.typeMentionControl,r.includes("mention")),J(this.typeAdminControl,r.includes("admin")),J(this.typeTrivialControl,i.isWatchTrivial)}),this.tokenReceived$=this.tokenReceived.pipe(K(i=>i!==null),Zi()),Ge(this.tokenReceived$,e).pipe(k(this.destroy$)).subscribe(async([i,r])=>{f("this.messaging.tokenReceived subscribe()",i,r);let o=!!i;if(this.debugObservable.registeredToken=i,this.registeredToken=i,i){let c=this.findDeviceId(i,r);if(!c){this.toastr.error("\u30C7\u30D0\u30A4\u30B9\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002");return}this.registeredDeviceId.set(c)}J(this.messagingOnControl,!!this.registeredDeviceId())}),this.triggerTokenRefresh(),this.debugObservable.messages=[],this.messaging.messages.pipe(k(this.destroy$)).subscribe(i=>{S("message received from messaging",i),this.debugObservable.messages.push(i)}),this.debugObservable.getToken$=this.messaging.getToken,this.debugObservable.getToken=[],this.debugObservable.getToken$.subscribe({next:i=>this.debugObservable.getToken.push(i),complete:()=>S("Complete getToken()")}),this.debugObservable.tokenChanges$=this.messaging.tokenChanges,this.debugObservable.tokenChanges=[],this.debugObservable.tokenChanges$.subscribe({next:i=>this.debugObservable.tokenChanges.push(i),complete:()=>S("Complete tokenChanges()")}),this.debugObservable.tokenReceived=[]}findDeviceId(t,e){for(let i of e)if(i.token===t)return i.id;return null}ngOnDestroy(){this.destroy$.next()}triggerTokenRefresh(){this.messaging.getToken.pipe($(1),k(this.destroy$)).subscribe({next:t=>this.tokenReceived.next(t),complete:()=>f("Completed getToken")})}get messagingOnControl(){return this.mainForm.get("messagingOn")}getDeviceControl(t){return this.deviceForm.get(`device-${t.id}`)}addDeviceControl(t){let e=new O(!t.isSuspend,[]);this.deviceForm.addControl(`device-${t.id}`,e)}get typeTrivialControl(){return this.mainForm.get("messagingTrivialCheck")}get typeSystemControl(){return this.mainForm.get("messagingSystemCheck")}get typeMentionControl(){return this.mainForm.get("messagingMentionCheck")}get typeAdminControl(){return this.mainForm.get("messagingAdminCheck")}async revokeNotification(){if(!this.registeredDeviceId()){x("Unexpectedly no deviceId is found."),this.toastr.error("\u30C7\u30D0\u30A4\u30B9\u60C5\u5831\u3092\u7121\u52B9\u306B\u3067\u304D\u307E\u305B\u3093\u3002");return}try{let t={deviceId:this.registeredDeviceId()};this.funcs.call("revokeDevice",t),this.toastr.info("\u30B7\u30B9\u30C6\u30E0\u304B\u3089\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002")}catch(t){x("Error while deleting token via Functions",t),this.messagingOnControl.setValue(!0),P(this.messagingOnControl),this.toastr.error("\u30B7\u30B9\u30C6\u30E0\u306E\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002");return}this.messaging.getToken.pipe(Xi(t=>f(`getToken before deleteToken ${t}`)),je(t=>this.messaging.deleteToken(t)),$(1),k(this.destroy$)).subscribe({next:t=>{S(`Deleted result: ${t} on FCM.`),P(this.messagingOnControl),this.toastr.success("\u901A\u77E5\u60C5\u5831\u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002")},error:t=>{x("Error while deleting token on FCM",t),this.toastr.error("\u901A\u77E5\u60C5\u5831\u304C\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}})}async onToggleMessaging(t){if(f("UserSettingsComponent.onToggleMessaging()"),this.messagingOnControl.value){if(!this.registeredDeviceId()&&this.devices&&this.devices.length>=De.FCMDeviceMaxCount){this.toastr.error("\u767B\u9332\u3055\u308C\u305F\u30C7\u30D0\u30A4\u30B9\u304C\u591A\u3059\u304E\u307E\u3059\u3002\u524A\u9664\u3057\u3066\u304B\u3089\u3084\u308A\u76F4\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}await this.updateRequestToken()}else{let i=this.dialog.createHtmlBuilder(),r=new mn(`
<div>
\u767B\u9332\u3092\u89E3\u9664\u3059\u308B\u3068\u3059\u3079\u3066\u306E\u901A\u77E5\u306F\u505C\u6B62\u3057\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F
</div>
`);i.setMessage(r).setType(1).setSize(1).setTitle("\u78BA\u8A8D").okButton(async()=>{await this.revokeNotification()}).cancelButton(()=>{this.messagingOnControl.setValue(!0),P(this.messagingOnControl)}).open()}}getMessagingTypes(){let t=[];return this.typeSystemControl.value&&t.push("system"),this.typeMentionControl.value&&t.push("mention"),this.typeAdminControl.value&&t.push("admin"),t}async updateRequestToken(){this.messaging.requestToken.pipe($(1),k(this.destroy$)).subscribe({next:async t=>{if(this.tokenReceived.next(t),this.debugObservable.tokenReceived.push(t),!t){x("No token returned from requestToken"),this.messagingOnControl.setValue(!1),P(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u60C5\u5831\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002");return}try{f(`Updated token with ${t}`);let e={token:t,deviceId:this.registeredDeviceId()};this.registeredToken=t,this.registeredDeviceId.set(await this.funcs.call("saveDeviceToken",e)),this.toastr.success("\u901A\u77E5\u60C5\u5831\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002"),P(this.messagingOnControl)}catch(e){x("Error while save token to Firestore",e),this.messagingOnControl.setValue(!1),P(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u60C5\u5831\u3092\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}},error:t=>{x("Error while request Token",t),this.messagingOnControl.setValue(!1),P(this.messagingOnControl),this.toastr.error("\u901A\u77E5\u3092\u6709\u52B9\u306B\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u30D6\u30E9\u30A6\u30B6\u306E\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002")}})}async onClickUpdateMessaging(t){f("UserSettingsComponent.onClickUpdateMessaging()");try{let e={messageTypes:this.getMessagingTypes(),token:this.registeredToken,isWatchTrivial:this.typeTrivialControl.value};await this.funcs.call("setNotifications",e),P(this.configArray),this.toastr.success("\u8A2D\u5B9A\u3092\u4FDD\u5B58\u3057\u307E\u3057\u305F\u3002")}catch(e){x("Failed to save configuration",e),this.toastr.error("\u8A2D\u5B9A\u304C\u4FDD\u5B58\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}async onClickSubscribeTopic(t){if(!this.debugObservable.topicText){alert("Not set");return}let e={topic:this.debugObservable.topicText,token:this.registeredToken},i=await this.funcs.call("subscribeTopicTest",e);S("subscribeTopicTest ->",i),this.toastr.success(`done subscribe ${i}`)}async onClickUnsubscribeTopic(t){if(!this.debugObservable.topicText){alert("Not set");return}let e={topic:this.debugObservable.topicText,token:this.registeredToken},i=await this.funcs.call("unsubscribeTopicTest",e);S("unsubscribeTopicTest ->",i),this.toastr.success(`done unsubscribe ${i}`)}async onClickPostToTopic(t){if(!this.debugObservable.topicText||!this.debugObservable.topicPostText){alert("Not set");return}let e={topic:this.debugObservable.topicText,title:this.debugObservable.topicPostText},i=await this.funcs.call("postTopicTest",e);S("postTopicTest ->",i),this.toastr.success(`done post ${i}`)}async onClickConditionPostToTopic(t){if(!this.debugObservable.conditionTopicPostText||!this.debugObservable.conditionTopicPostText){alert("Not set");return}let e={topic:this.debugObservable.conditionTopicPostText,title:this.debugObservable.topicPostText},i=await this.funcs.call("postConditionTopicTest",e);S("postConditionTopicTest ->",i),this.toastr.success(`done post ${i}`)}onClickClearMessages(t){this.debugObservable.messages=[]}static \u0275fac=function(e){return new(e||n)(C(G),C(ct),C(ve),C(dt),C(ke),C(ar))};static \u0275cmp=W({type:n,selectors:[["gitfire-user-notification"]],inputs:{mainForm:"mainForm",userPrivStore$:"userPrivStore$"},decls:74,vars:11,consts:[[1,"m-2"],["title","\u3053\u306E\u6A5F\u80FD\u306F\u30C6\u30B9\u30C8\u4E2D\u306E\u305F\u3081\u5909\u66F4\u3055\u308C\u308B\u3053\u3068\u3084\u3001\u60F3\u5B9A\u5916\u306E\u6319\u52D5\u3092\u3059\u308B\u5834\u5408\u304C\u3042\u308A\u307E\u3059\u3002\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u306E\u901A\u77E5\u3092\u30B3\u30F3\u30C8\u30ED\u30FC\u30EB\u3057\u307E\u3059\u3002\u8A2D\u5B9A\u304C\u3046\u307E\u304F\u3044\u304B\u306A\u3044\u5834\u5408\u306F\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u5F53\u30B5\u30A4\u30C8\u306E\u901A\u77E5 on/off \u3092\u3057\u305F\u308A\u3001\u300E\u7AEF\u672B\u306E\u524A\u9664\u300F\u3092\u304A\u8A66\u3057\u304F\u3060\u3055\u3044\u3002","src","/assets/octicons/question.svg",1,"m-3","octicon-info","help-icon"],[1,"m-2",3,"formGroup"],[1,"row","p-1"],[1,"d-flex","align-content-start","flex-wrap","p-1"],["controlLabel","\u901A\u77E5\u3092\u53D7\u3051\u53D6\u308B","formName","messagingOn","tooltipText","\u30D6\u30E9\u30A6\u30B6\u304B\u3089\u306E\u901A\u77E5\u3092\u30B3\u30F3\u30C8\u30ED\u30FC\u30EB\u3057\u307E\u3059\u3002",1,"p-2",3,"checkChanged","parentForm"],[1,"d-flex","align-content-start","flex-wrap","p-3"],[1,"m-1","input-group"],[1,"row","m-2"],["controlLabel","\u3061\u3087\u3063\u3068\u3057\u305F\u901A\u77E5","formName","messagingTrivialCheck","tooltipText","\u3061\u3087\u3063\u3068\u3057\u305F\u901A\u77E5\u3082\u53D7\u3051\u53D6\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002\u901A\u5E38\u306F\u4E0D\u8981\u3067\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u30B7\u30B9\u30C6\u30E0","formName","messagingSystemCheck","tooltipText","\u30B7\u30B9\u30C6\u30E0\u304B\u3089\u306E\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u3042\u306A\u305F\u3078\u306E\u8A00\u53CA","formName","messagingMentionCheck","tooltipText","\u30B7\u30B9\u30C6\u30E0\u306E\u30E1\u30C3\u30BB\u30FC\u30B8\u30B7\u30B9\u30C6\u30E0\u3067\u3042\u306A\u305F\u306B\u8A00\u53CA\u3055\u308C\u305F\u5834\u5408\u306B\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],["controlLabel","\u7BA1\u7406\u4EBA\u304B\u3089","formName","messagingAdminCheck","tooltipText","\u7BA1\u7406\u4EBA\u304C\u624B\u52D5\u3067\u3042\u306A\u305F\u306B\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u9001\u3063\u305F\u5834\u5408\u306B\u901A\u77E5\u3092\u9001\u308B\u304B\u3069\u3046\u304B\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002",1,"p-2",3,"parentForm"],[1,"btn","btn-primary",3,"click","disabled"],[2,"width","100%","overflow-wrap","break-word"],["type","text",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-warning",3,"click"],["tooltipText","\u767B\u9332\u3055\u308C\u305F Device \u306E\u901A\u77E5\u3092\u4E00\u6642\u7684\u306B\u505C\u6B62\u3057\u307E\u3059\u3002",1,"m-2",3,"checkChanged","parentForm","controlLabel","formName"],["title","\u767B\u9332\u60C5\u5831\u3092\u524A\u9664\u3057\u3066\u3001\u3053\u306E\u7AEF\u672B\u3078\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"btn","btn-warning"],["title","\u767B\u9332\u60C5\u5831\u3092\u524A\u9664\u3057\u3066\u3001\u3053\u306E\u7AEF\u672B\u3078\u306E\u901A\u77E5\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"btn","btn-warning",3,"click"]],template:function(e,i){e&1&&(a(0,"h2",0),s(1,"\u901A\u77E5\u8A2D\u5B9A (\u30C6\u30B9\u30C8\u4E2D)"),v(2,"img",1),u(),a(3,"div",2)(4,"div",3)(5,"div",4)(6,"app-switch",5),b("checkChanged",function(o){return i.onToggleMessaging(o)}),u()()(),a(7,"div",0)(8,"h3"),s(9,"\u767B\u9332\u3055\u308C\u305F\u30C7\u30D0\u30A4\u30B9"),u(),a(10,"div",6),X(11,yo,4,11,"div",7,_o),u()(),a(13,"div")(14,"div",8)(15,"h3"),s(16,"\u91CD\u8981\u5EA6"),u(),a(17,"div",4),v(18,"app-switch",9),u()(),a(19,"div",8)(20,"h3"),s(21,"\u7A2E\u985E"),u(),a(22,"div",4),v(23,"app-switch",10)(24,"app-switch",11)(25,"app-switch",12),u()(),a(26,"div",8)(27,"button",13),b("click",function(o){return i.onClickUpdateMessaging(o)}),s(28,"\u66F4\u65B0"),u()()()(),a(29,"div",14)(30,"div"),s(31,"Token: "),a(32,"div"),s(33),u()(),a(34,"div"),s(35,"GetToken: "),X(36,Eo,2,2,"div",null,oe),u(),a(38,"div"),s(39,"TokenChanges: "),X(40,Ao,2,2,"div",null,oe),u(),a(42,"div"),s(43,"TokenReceived: "),X(44,So,2,2,"div",null,oe),u(),a(46,"div")(47,"div")(48,"label"),s(49,"Topic: "),a(50,"input",15),Ze("ngModelChange",function(o){return Je(i.debugObservable.topicText,o)||(i.debugObservable.topicText=o),o}),u()(),a(51,"button",16),b("click",function(o){return i.onClickSubscribeTopic(o)}),s(52,"subscribe"),u(),a(53,"button",16),b("click",function(o){return i.onClickUnsubscribeTopic(o)}),s(54,"unsubscribe"),u()(),a(55,"div")(56,"label"),s(57,"Post Title: "),a(58,"input",15),Ze("ngModelChange",function(o){return Je(i.debugObservable.topicPostText,o)||(i.debugObservable.topicPostText=o),o}),u()(),a(59,"button",16),b("click",function(o){return i.onClickPostToTopic(o)}),s(60,"Post"),u()(),a(61,"div")(62,"label"),s(63,"Condition Topic Post: "),a(64,"input",15),Ze("ngModelChange",function(o){return Je(i.debugObservable.conditionTopicPostText,o)||(i.debugObservable.conditionTopicPostText=o),o}),u()(),a(65,"button",16),b("click",function(o){return i.onClickConditionPostToTopic(o)}),s(66,"CondPost"),u()()()(),a(67,"div")(68,"button",17),b("click",function(o){return i.onClickClearMessages(o)}),s(69,"Clear"),u(),a(70,"div"),s(71,"Messages: "),X(72,xo,3,3,"div",null,oe),u()()),e&2&&(l(3),_("formGroup",i.mainForm),l(3),_("parentForm",i.mainForm),l(5),ee(i.devices),l(7),_("parentForm",i.mainForm),l(5),_("parentForm",i.mainForm),l(),_("parentForm",i.mainForm),l(),_("parentForm",i.mainForm),l(2),_("disabled",i.configArray.invalid||!i.configArray.dirty),l(6),Y(i.debugObservable.registeredToken),l(3),ee(i.debugObservable.getToken),l(4),ee(i.debugObservable.tokenChanges),l(4),ee(i.debugObservable.tokenReceived),l(6),Qe("ngModel",i.debugObservable.topicText),l(8),Qe("ngModel",i.debugObservable.topicPostText),l(6),Qe("ngModel",i.debugObservable.conditionTopicPostText),l(8),ee(i.debugObservable.messages))},dependencies:[Ce,nt,ot,st,at,ut,fn,En,tt,dn],encapsulation:2})};var Io=["protectedSettings"],ko=["imageBox"];function wo(n,t){if(n&1&&v(0,"img",10),n&2){let e=m();_("src",Ut(e.photoURL),Dt)}}function To(n,t){n&1&&s(0,"\u753B\u50CF\u304C\u3042\u308A\u307E\u305B\u3093")}function Po(n,t){if(n&1){let e=te();a(0,"span",36),s(1," -> "),u(),a(2,"label",9),s(3,"\u65B0\u3057\u3044\u753B\u50CF"),u(),v(4,"img",37),a(5,"button",38),b("click",function(r){let o=R(e),c=m(2);return D(c.onClickOkImage(r,o))}),s(6,"\u78BA\u5B9A"),u()}n&2&&(l(4),_("src",Ut(t),Dt))}function Fo(n,t){n&1&&v(0,"div",18)}function Ro(n,t){if(n&1&&(a(0,"div",18),s(1),u()),n&2){let e=m(3);l(),se("\u6B8B\u308A ",e.nicknameResult.changesRemain," \u56DE \u5909\u66F4\u3067\u304D\u307E\u3059\u3002")}}function Do(n,t){n&1&&(a(0,"div",39),s(1,"\u3053\u308C\u4EE5\u4E0A\u306F\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3002"),u())}function Uo(n,t){if(n&1&&(h(0,Ro,2,1,"div",18),h(1,Do,2,0,"div",39)),n&2){let e=m(2);g(e.nicknameResult.changesRemain>0?0:-1),l(),g(e.nicknameResult.changesRemain===0?1:-1)}}function Bo(n,t){n&1&&(a(0,"div",39),s(1,"\u5165\u529B\u5FC5\u9808\u3067\u3059\u3002"),u())}function Oo(n,t){n&1&&(a(0,"div",39),s(1,"\u9577\u3059\u304E\u307E\u3059\u3002"),u())}function No(n,t){n&1&&(a(0,"div",39),s(1,"\u77ED\u3059\u304E\u307E\u3059\u3002"),u())}function Mo(n,t){if(n&1&&(h(0,Bo,2,0,"div",39),h(1,Oo,2,0,"div",39),h(2,No,2,0,"div",39)),n&2){let e=m(2);g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.required?0:-1),l(),g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.maxlength?1:-1),l(),g(e.nicknameControl.errors!=null&&e.nicknameControl.errors.minlength?2:-1)}}function Lo(n,t){n&1&&v(0,"div",18)}function $o(n,t){n&1&&(a(0,"div",39),s(1,"\u9577\u3059\u304E\u307E\u3059\u3002"),u())}function Vo(n,t){if(n&1&&h(0,$o,2,0,"div",39),n&2){let e=m(2);g(e.aboutControl.errors!=null&&e.aboutControl.errors.maxlength?0:-1)}}function Wo(n,t){if(n&1&&v(0,"hr")(1,"gitfire-user-notification",40),n&2){let e=m(2);l(),_("mainForm",e.notificationForm)("userPrivStore$",e.userPrivate$)}}function Go(n,t){n&1&&v(0,"div",18)}function jo(n,t){n&1&&(a(0,"div",39),s(1,"E \u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059\u3002"),u())}function qo(n,t){n&1&&(a(0,"div",39),s(1,"E \u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),u())}function zo(n,t){if(n&1&&(h(0,jo,2,0,"div",39),h(1,qo,2,0,"div",39)),n&2){let e=m(2);g(e.emailControl.errors!=null&&e.emailControl.errors.required?0:-1),l(),g(e.emailControl.errors!=null&&e.emailControl.errors.minlength||e.emailControl.errors!=null&&e.emailControl.errors.maxlength?1:-1)}}function Ho(n,t){n&1&&(a(0,"div",18),s(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u5F37\u5EA6\u306F\u5145\u5206\u306B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),u())}function Ko(n,t){n&1&&(a(0,"div",39),s(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),u())}function Yo(n,t){n&1&&(a(0,"div",39),s(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u9577\u3055\u304C\u8DB3\u308A\u307E\u305B\u3093\u3002"),u())}function Qo(n,t){if(n&1&&(h(0,Ko,2,0,"div",39),h(1,Yo,2,0,"div",39)),n&2){let e=m(2);g(e.passwordControl.errors!=null&&e.passwordControl.errors.required?0:-1),l(),g(e.passwordControl.errors!=null&&e.passwordControl.errors.minlength?1:-1)}}function Jo(n,t){if(n&1){let e=te();a(0,"div",3)(1,"form",4,0)(3,"h2",5),s(4,"\u516C\u958B\u8A2D\u5B9A"),v(5,"img",6),u(),a(6,"div")(7,"div",7)(8,"div",8)(9,"label",9),s(10,"\u73FE\u5728\u306E\u753B\u50CF"),u(),h(11,wo,1,2,"img",10)(12,To,1,0),h(13,Po,7,2),ae(14,"async"),u(),a(15,"div",11),v(16,"input",12,1),a(18,"button",13),b("click",function(r){R(e);let o=m();return D(o.onClickUploadImage(r))}),s(19,"Upload"),u()()(),a(20,"div",14)(21,"label",15),s(22,"\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0"),v(23,"img",16),u(),v(24,"input",17),a(25,"button",13),b("click",function(r){R(e);let o=m();return D(o.onClickUpdateNickname(r))}),s(26,"\u66F4\u65B0"),u()(),h(27,Fo,1,0,"div",18),h(28,Uo,2,2),h(29,Mo,3,3),a(30,"div",14)(31,"label",15),s(32,"\u81EA\u5DF1\u7D39\u4ECB"),v(33,"img",19),u(),v(34,"textarea",20),a(35,"button",21),b("click",function(r){R(e);let o=m();return D(o.onClickUpdateAbout(r))}),s(36,"\u66F4\u65B0"),u()()(),h(37,Lo,1,0,"div",18)(38,Vo,1,1),h(39,Wo,2,2),v(40,"hr"),a(41,"a",22),b("click",function(r){R(e);let o=m();return D(o.onClickImportant(r))}),s(42),u(),a(43,"div",23,2)(45,"div",24)(46,"label",25),s(47,"\u540D\u524D"),v(48,"img",26),u(),v(49,"input",27),u(),a(50,"div",24)(51,"label",25),s(52,"Email"),v(53,"img",28),u(),v(54,"input",29),a(55,"button",30),b("click",function(r){R(e);let o=m();return D(o.onClickUpdateEmail(r))}),s(56,"\u66F4\u65B0"),u(),h(57,Go,1,0,"div",18)(58,zo,2,2),u(),a(59,"div",24)(60,"label",25),s(61,"Password"),v(62,"img",31),u(),v(63,"input",32),a(64,"button",30),b("click",function(r){R(e);let o=m();return D(o.onClickUpdatePassword(r))}),s(65,"\u66F4\u65B0"),u(),h(66,Ho,2,0,"div",18)(67,Qo,2,2),u(),a(68,"h3",33),s(69,"\u30A2\u30AB\u30A6\u30F3\u30C8\u306E\u7D42\u4E86"),u(),a(70,"div",34)(71,"button",35),b("click",function(r){R(e);let o=m();return D(o.onClickDeleteAccount(r))}),s(72,"\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u524A\u9664"),u()()()()()}if(n&2){let e,i=t,r=m();l(),_("formGroup",r.inputForm),l(10),g(i.photoURL?11:12),l(2),g((e=Xe(14,25,r.profileTempImage$))?13:-1,e),l(5),_("disabled",r.userIconControl.invalid||!r.userIconControl.dirty),l(2),Re("was-validated",r.nicknameControl.dirty||r.nicknameControl.touched),l(5),_("disabled",r.nicknameControl.invalid||!r.nicknameControl.dirty),l(2),g(r.nicknameControl.invalid?-1:27),l(),g(r.nicknameResult?28:-1),l(),g(r.nicknameControl.invalid?29:-1),l(),Re("was-validated",r.aboutControl.dirty||r.aboutControl.touched),l(5),_("disabled",r.aboutControl.invalid||!r.aboutControl.dirty),l(2),g(r.aboutControl.invalid?38:37),l(2),g(r.auth.isDeveloper?39:-1),l(3),Y(r.isOpenOther?"\u518D\u8A8D\u8A3C":"\u305D\u306E\u4ED6\u306E\u8A2D\u5B9A"),l(7),_("value",i.displayName),l(),Re("was-validated",r.emailControl.dirty||r.emailControl.touched),l(5),_("disabled",r.emailControl.invalid||!r.emailControl.dirty),l(2),g(r.emailControl.invalid?58:57),l(2),Re("was-validated",r.passwordControl.dirty||r.passwordControl.touched),l(5),_("disabled",!r.passwordControl.value||r.passwordControl.invalid||!r.passwordControl.dirty),l(2),g(r.passwordControl.invalid?67:66)}}var It=class n{constructor(t,e,i,r,o,c,p,E){this.auth=t;this.firestore=e;this.storage=i;this.funcs=r;this.toastr=o;this.router=c;this.dialog=p;this.localSession=E;f("UserSettingsComponent()"),this.inputForm=new Ue({}),this.pubUser=be(this.firestore,"users/v1/public"),this.privUser=be(this.firestore,"users/v1/protected"),this.nicknameIndex=be(this.firestore,"index/users/usernick"),this.currentUser$=this.auth.clientSideUser$,this.currentUser$.pipe(k(this.destroy$)).subscribe(d=>{this.currentUser=d});let F=this.currentUser$.pipe($(1),K(d=>!!d));F.pipe(y(d=>{let I=pt(this.pubUser,d.uid).withConverter(this.UserPublicStoreConverter);return Nt(I)}),k(this.destroy$)).subscribe(d=>{this.userPublic=d,J(this.aboutControl,d.about),this.aboutControl.enable(),J(this.nicknameControl,d.nickname),this.nicknameControl.enable()}),F.pipe(y(d=>{let I=pt(this.privUser,d.uid).withConverter(this.UserProtectedStoreConverter);return Nt(I)}),k(this.destroy$)).subscribe(d=>{this.userPrivate$.next(d)}),F.pipe(en(this.viewInited$),V(([d,I])=>d),k(this.destroy$)).subscribe(d=>{this.emailControl.setValue(d.email)})}destroy$=new L;viewInited$=new L;currentUser;currentUser$;userPublic;userPrivate$=new L;profileTempImage$;inputForm;notificationForm;isOpenOther=!1;nicknameResult=null;protectedSettings;imageBox;pubUser;privUser;nicknameIndex;UserPublicStoreConverter=Bi(["createdAt","updatedAt"]);UserProtectedStoreConverter=Bi(["createdAt","updatedAt"]);ngOnInit(){f("UserSettingsComponent.OnInit()"),this.inputForm.addControl("userIcon",new O("",[rt.required])),this.inputForm.addControl("email",new O({value:"",disabled:!1},[rt.required])),this.inputForm.addControl("password",new O("",[])),this.inputForm.addControl("nickname",new O({value:"",disabled:!0},[rt.required])),this.inputForm.addControl("about",new O({value:"",disabled:!0},[])),this.notificationForm=new Ue({}),this.inputForm.addControl("messaging",this.notificationForm)}ngAfterViewInit(){this.viewInited$.next()}ngOnDestroy(){this.destroy$.next()}get emailControl(){return this.inputForm.get("email")}get passwordControl(){return this.inputForm.get("password")}get aboutControl(){return this.inputForm.get("about")}get nicknameControl(){return this.inputForm.get("nickname")}get userIconControl(){return this.inputForm.get("userIcon")}onClickDeleteAccount(t){this.dialog.createDefaultBuilder().prepareBody(yt).setType(1).setSize(1).setTitle("\u6700\u7D42\u78BA\u8A8D").okButton(()=>{this.doDeleteAccount()}).cancelButton(()=>{}).open()}async doDeleteAccount(){let t=this.currentUser.uid;try{await this.currentUser.delete(),f("Account is deleted")}catch(e){x("Error while delete account",e);let i=e instanceof Error?e.message:"Unknown error";this.toastr.error(`\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${i} )`);return}this.localSession.unmarkLogin(),this.router.navigate(["/"])}updateError(t,e){x(`Error while update tag:${t}`,e);let i=e instanceof Error?e.message:"Unknown error";this.toastr.error(`${t} \u306E\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${i} )`)}updateSucceeded(t,e){this.toastr.success(`${t} \u3092 "${e}" \u306B\u66F4\u65B0\u3057\u307E\u3057\u305F\u3002`)}async updateProfileImage(t){if(t==="")return;let e="\u30D7\u30ED\u30D5\u30A3\u30FC\u30EB\u753B\u50CF";try{await this.currentUser.updateProfile({photoURL:t});let i={photoURL:t,updatedAt:Rn()},r=pt(this.pubUser,this.currentUser.uid);await On(r,i),this.updateSucceeded(e,"Upload \u3057\u305F\u753B\u50CF"),this.getProfileRef("temp_profile").delete(),this.profileTempImage$=null,this.userIconControl.setValue(""),P(this.userIconControl)}catch(i){this.updateError(e,i)}}async onClickUpdateNickname(t){if(this.nicknameControl.invalid)return;let e=this.nicknameControl.value;if(e===this.userPublic.nickname)return;let i="\u30CB\u30C3\u30AF\u30CD\u30FC\u30E0";try{let r={nickname:e};this.nicknameResult=await this.funcs.call("updateNickname",r),this.updateSucceeded(i,e),P(this.nicknameControl)}catch(r){this.updateError(i,r)}}async onClickUpdateAbout(t){if(this.aboutControl.invalid)return;let e=this.aboutControl.value;if(e===this.userPublic.about)return;let i="\u81EA\u5DF1\u7D39\u4ECB";try{let r={about:e};await this.funcs.call("updateAbout",r),this.updateSucceeded(i,e),P(this.aboutControl)}catch(r){this.updateError(i,r)}}async onClickUpdateEmail(t){if(this.emailControl.invalid)return;let e=this.emailControl.value;if(e===this.currentUser.email)return;this.dialog.createSimpleBuilder().setType(1).setSize(1).setMessage("\u767B\u9332\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5909\u66F4\u3057\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F").setTitle("\u78BA\u8A8D").okButton(()=>{this.doChangeEmail(e)}).cancelButton(()=>{}).open()}async doChangeEmail(t){let e="Email";try{await this.currentUser.updateEmail(t),await this.currentUser.sendEmailVerification(),this.updateSucceeded(e,t),P(this.emailControl),this.toastr.info("\u78BA\u8A8D\u306E\u30E1\u30FC\u30EB\u3092\u9001\u4FE1\u3057\u307E\u3057\u305F\u3002")}catch(i){this.updateError(e,i)}}async onClickUpdatePassword(t){if(this.passwordControl.invalid)return;let e=this.passwordControl.value;if(e==="")return;let i="\u30D1\u30B9\u30EF\u30FC\u30C9";try{await this.currentUser.updatePassword(e),this.updateSucceeded(i,"********"),P(this.passwordControl)}catch(r){this.updateError(i,r)}finally{this.passwordControl.setValue("")}}listProvider(){}ensureImageFile(){let t=this.imageBox.nativeElement;if(t.files.length===0)return this.toastr.error("\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),null;let e=t.files[0];return e.size>=512*1024?(this.toastr.error("\u30D5\u30A1\u30A4\u30EB\u306E\u30B5\u30A4\u30BA\u304C\u5927\u304D\u3059\u304E\u307E\u3059\u3002(\u7D04 500kb \u307E\u3067)"),null):e}getProfileRef(t){return this.storage.ref(`/image/${this.currentUser.uid}/profile/${t}`)}async onClickUploadImage(t){let e=this.ensureImageFile();if(!e)return;let i=await this.uploadProfileImage("temp_profile",e);this.profileTempImage$=i.ref.getDownloadURL()}async uploadProfileImage(t,e){return await this.getProfileRef(t).put(e)}async doChangePhoto(t){let i=await(await this.uploadProfileImage("profile",t)).ref.getDownloadURL();this.updateProfileImage(i)}initializeReauth(t){t.currentUser=this.currentUser,t.reauthed.subscribe(()=>{new gn(this.protectedSettings.nativeElement).show(),this.isOpenOther=!0})}constructReauth(){return t=>{}}onClickImportant(t){f("onClickImportant()"),this.dialog.createDefaultBuilder().prepareBody(St,i=>this.initializeReauth(i)).setupChild(this.constructReauth()).setType(3).setSize(1).setTitle("\u518D\u8A8D\u8A3C").cancelButton(()=>{}).closeButton(()=>{}).open()}onClickOkImage(t,e){let i=this.ensureImageFile();if(!i)return;this.dialog.createSimpleBuilder().setType(3).setSize(1).setMessage("\u753B\u50CF\u306F\u516C\u958B\u3055\u308C\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F").setTitle("\u78BA\u8A8D").okButton(()=>{this.doChangePhoto(i)}).cancelButton(()=>{}).open()}static \u0275fac=function(e){return new(e||n)(C(G),C(dt),C(Zn),C(ke),C(ve),C(hn),C(ct),C(_e))};static \u0275cmp=W({type:n,selectors:[["ng-component"]],viewQuery:function(e,i){if(e&1&&Ke(Io,5)(ko,5),e&2){let r;Pe(r=Fe())&&(i.protectedSettings=r.first),Pe(r=Fe())&&(i.imageBox=r.first)}},decls:1,vars:1,consts:[["configForm",""],["imageBox",""],["protectedSettings",""],[1,"container"],[3,"formGroup"],[1,"mb-3"],["title","\u4E00\u822C\u516C\u958B\u3055\u308C\u308B\u60C5\u5831\u3092\u7DE8\u96C6\u3067\u304D\u307E\u3059\u3002","src","/assets/octicons/question.svg",1,"m-3","octicon-info","help-icon"],[1,"my-2"],[1,"input-group","my-1"],[1,"visually-hidden"],["alt","Profile \u753B\u50CF",1,"user-settings-profile-image","rounded",3,"src"],[1,"input-group"],["id","appGitfireInputIconFileInput","name","userIcon","formControlName","userIcon","type","file","placeholder","\u30A2\u30A4\u30B3\u30F3\u3092\u9078\u629E","accept","image/*",1,"form-control"],[1,"btn","btn-primary",3,"click","disabled"],[1,"input-group","my-2"],[1,"input-group-text"],["title","\u30E1\u30C3\u30BB\u30FC\u30B8\u4E0A\u306B\u8868\u793A\u3055\u308C\u308B\u3042\u306A\u305F\u306E\u540D\u524D\u3067\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","nickname","placeholder","\u4F8B: hogehoge1032","formControlName","nickname","autofocus","","type","text","maxlength","19","minlength","4","required","",1,"form-control"],[1,"valid-feedback"],["title","\u30D5\u30EA\u30FC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3067\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","about","placeholder","\u4F8B: Ingress: kagura2718 (RES) \u30DD\u30B1\u30E2\u30F3go: kagura271(\u8D64)","formControlName","about","maxlength","200","type","text",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["role","button","aria-expanded","false",1,"btn","btn-secondary","collapsed",3,"click"],["id","appGitfireUserSettingsSecretContainer",1,"collapse","m-3"],[1,"row","input-group","m-3"],[1,"col-2","text-md-end","col-form-label"],["title","\u8A8D\u8A3C\u30D7\u30ED\u30D0\u30A4\u30C0\u304B\u3089\u63D0\u4F9B\u3055\u308C\u305F\u540D\u524D\u3067\u3059\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","displayname","placeholder","\u4F8B: hogehoge1032","type","text","disabled","",1,"col-10","form-control",3,"value"],["title","\u8A8D\u8A3C\u306B\u4F7F\u308F\u308C\u308B\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3067\u3059\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","email","placeholder","email@example.com","formControlName","email","autocomplete","email","type","email","required","","autofill","","maxlength","1024","minlength","5",1,"col-8","form-control"],[1,"btn","btn-primary","col-2",3,"click","disabled"],["title","\u30ED\u30B0\u30A4\u30F3\u6642\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u3067\u3059\u3002\u4ED6\u4EBA\u306B\u63A8\u6E2C\u3055\u308C\u306A\u3044\u3082\u306E\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044\u3002(\u975E\u516C\u958B)","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["name","password","placeholder","\u5909\u66F4\u306A\u3057","formControlName","password","type","password","autocomplete","new-password","maxlength","256","minlength","6",1,"col-8","form-control"],[1,"m-3"],[1,"input-group","m-3"],["tabindex","-1",1,"btn","btn-warning",3,"click"],[1,"p-3"],["alt","\u65B0\u3057\u3044 Profile \u753B\u50CF",1,"user-settings-profile-image","rounded",3,"src"],[1,"btn","btn-primary",3,"click"],[1,"invalid-feedback"],[3,"mainForm","userPrivStore$"]],template:function(e,i){if(e&1&&h(0,Jo,73,27,"div",3),e&2){let r;g((r=i.currentUser)?0:-1,r)}},dependencies:[Ce,vn,nt,ot,st,_n,bn,yn,at,Cn,xt,cn],styles:[".user-settings-profile-image[_ngcontent-%COMP%]{width:80px;height:80px}.help-icon[_ngcontent-%COMP%]{width:20px;height:20px}"]})};function Zo(n,t){if(n&1&&(T(0,"div"),s(1),A()),n&2){let e=m();l(),se("URL: ",e.url)}}function Xo(n,t){if(n&1&&(T(0,"div")(1,"div")(2,"div"),s(3),A(),h(4,Zo,2,1,"div"),T(5,"div"),s(6),A(),T(7,"div"),s(8),ae(9,"date"),A()(),He(10,"hr"),T(11,"div"),s(12),A()()),n&2){let e=t;l(3),se("Title: ",e.title),l(),g(e.url?4:-1),l(2),se("Done: ",e.hasRead),l(2),se("Date: ",et(9,5,e.createdAt.toDate(),"yyyy-MM-dd hh:mm:ss")),l(4),Y(e.body)}}var kt=class n{constructor(t,e,i){this.auth=t;this.route=e;this.store=i}destroy$=new L;id$;trayStore;ngOnDestroy(){this.destroy$.next()}ngOnInit(){f("UserTrayMessageComponent.OnInit()",this.route.snapshot),this.id$=this.route.queryParams.pipe(K(t=>"id"in t),V(t=>t.id)),this.id$.pipe(y(t=>Ge(ge(t),this.auth.clientSideUser$)),K(([t,e])=>e!==null),y(([t,e])=>this.store.doc(`/users/v1/protected/${e.uid}/tray/${t}`).valueChanges({idField:"id"}).pipe($(1))),k(this.destroy$)).subscribe(t=>{this.trayStore=t})}static \u0275fac=function(e){return new(e||n)(C(G),C(pn),C(Jn))};static \u0275cmp=W({type:n,selectors:[["app-user-tray-message"]],decls:1,vars:1,template:function(e,i){if(e&1&&h(0,Xo,13,8,"div"),e&2){let r;g((r=i.trayStore)?0:-1,r)}},dependencies:[tt],encapsulation:2})};var Z=class n{constructor(t,e,i){this.auth=t;this.localSession=e;this.router=i;f("AuthGuard.constructor")}canActivate(t,e){return this.auth.clientSideUser$.pipe(V(i=>{if(S("AuthGuard",i),i)return!0;let r={queryParams:{redirectPath:e.url}};return f("auth.guard Prepare to redirect",r),this.router.createUrlTree(["/Gitfire/login"],r)}))}static \u0275fac=function(e){return new(e||n)(w(G),w(_e),w(it))};static \u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})};var he=class n{constructor(t,e,i){this.auth=t;this.localSession=e;this.router=i}canActivate(t,e){return this.auth.authState.pipe(V(i=>(S("LoginGuard",i),i?this.router.createUrlTree(["/"]):!0)))}static \u0275fac=function(e){return new(e||n)(w(Kn),w(_e),w(it))};static \u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})};var es=[{path:"login.htm",loadChildren:()=>import("./chunk-LOGE6XRQ.js").then(n=>n.GitfireLoginModule),data:{mode:"login"},canActivate:[he]},{path:"login",redirectTo:"login.htm"},{path:"signup.htm",loadChildren:()=>import("./chunk-LOGE6XRQ.js").then(n=>n.GitfireLoginModule),data:{mode:"signup"},canActivate:[he]},{path:"signup",redirectTo:"signup.htm"},{path:"reset.htm",loadChildren:()=>import("./chunk-LOGE6XRQ.js").then(n=>n.GitfireLoginModule),data:{mode:"reset"}},{path:"reset",redirectTo:"reset.htm"},{path:"chat.htm",loadChildren:()=>import("./chunk-KMAEY3MB.js").then(n=>n.GitfireChatModule),canActivate:[Z]},{path:"chat",redirectTo:"chat.htm"},{path:"post.htm",loadChildren:()=>import("./chunk-MLPOSCJI.js").then(n=>n.GitfirePostModule),canActivate:[Z]},{path:"post",redirectTo:"post.htm"},{path:"settings.htm",component:It,canActivate:[Z]},{path:"settings",redirectTo:"settings.htm"},{path:"tray.htm",component:kt,canActivate:[Z]},{path:"tray",redirectTo:"tray.htm"}],wt=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=re({type:n});static \u0275inj=ne({imports:[Bt.forChild(es),Bt]})};var Tt=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=re({type:n});static \u0275inj=ne({providers:[er,Xn],imports:[ut,Ce,tr,rr,nr,ir]})};var Sr=class n{constructor(){S("Dynamically loaded GitfireModule")}static \u0275fac=function(e){return new(e||n)};static \u0275mod=re({type:n});static \u0275inj=ne({providers:[G,Z,he,ke,{provide:Oi,useValue:De.firebaseVapidKey},Dn(()=>Bn()),Nn(()=>Mn(void 0,De.FirebaseCloudFunctionsRegion))],imports:[wt,Yn,Tt,An,or,sr]})};export{Sr as GitfireModule};
