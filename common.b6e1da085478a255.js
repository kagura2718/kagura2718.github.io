"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[76],{4906:(D,g,t)=>{t.d(g,{C:()=>T});var n=t(4438);let T=(()=>{class C{transform(e){if(null===e)return null;const l=Math.floor(Date.now()/1e3),a=Math.floor(l-e.getTime()/1e3);if(a<-10)return null;if(a<60)return"\u305f\u3063\u305f\u4eca";const r=Math.floor(a/60);if(r<60)return`${r} \u5206\u524d`;const h=Math.floor(r/60);if(h<24)return`${h} \u6642\u9593\u524d`;const s=Math.floor(h/24);if(s<30)return`${s} \u65e5\u524d`;const i=Math.floor(s/30);if(i<12)return`${i} \u30f6\u6708\u524d`;const v=Math.floor(s/365);return v<10?`${v} \u5e74\u524d`:"\u304b\u306a\u308a\u6614"}static \u0275fac=function(l){return new(l||C)};static \u0275pipe=n.EJ8({name:"relativeTime",type:C,pure:!1})}return C})()},896:(D,g,t)=>{t.d(g,{u:()=>R});var n=t(467),T=t(7935);class C{saveNeverAsk;isConfirmed}var f=function(o){return o[o.Ok=0]="Ok",o[o.No=1]="No",o[o.OkPermanent=2]="OkPermanent",o}(f||{}),e=t(4438),l=t(9417),a=t(8531),r=t(5312),h=t(177),s=t(1188);function i(o,w){1&o&&e.nrm(0,"span",12)}function v(o,w){if(1&o&&(e.qex(0),e.j41(1,"div",10),e.nrm(2,"div",13),e.k0s(),e.bVm()),2&o){const p=e.XpG();e.R7$(2),e.Y8G("innerHTML",p.tosJson.html,e.npT)}}let M=(()=>{class o extends a.s{confirmed=new e.bkB;inputConfirmForm;tosJson;constructor(){super()}ngOnInit(){(0,r.Oi)("TosConfirmComponent.OnInit()"),this.inputConfirmForm=new l.gE({}),this.inputConfirmForm.addControl("neverConfirmTosCheck",new l.MJ(!1))}ngAfterViewInit(){(0,r.Oi)("TosConfirmComponent.AfterViewInit()")}get neverCheckTosControl(){return this.inputConfirmForm.get("neverConfirmTosCheck")}onClickConfirm(p){if(p.preventDefault(),this.inputConfirmForm.markAllAsTouched(),this.inputConfirmForm.invalid)return;const c=new C,m=this.inputConfirmForm.get("neverConfirmTosCheck");c.saveNeverAsk=m.value,c.isConfirmed=!0,this.confirmed.emit(c)}static \u0275fac=function(c){return new(c||o)};static \u0275cmp=e.VBU({type:o,selectors:[["gitfire-tos-confirm"]],inputs:{tosJson:"tosJson"},outputs:{confirmed:"confirmed"},features:[e.Vt3],decls:19,vars:6,consts:[["loadingTemplate",""],[1,"container"],[4,"ngIf","ngIfElse"],[1,"text-center"],[3,"formGroup"],[1,"m-5","custom-control","custom-checkbox"],["for","appGitfireTosConfirmNeverDismissCheck",1,"visually-hidden"],["id","appGitfireTosConfirmNeverDismissCheck","name","neverConfirmTosCheck","formControlName","neverConfirmTosCheck","type","checkbox",1,"form-check-input"],[1,"text-muted","fw-light"],["routerLink","/terms.htm"],[1,"m-3"],["id","appGitfireTosConfirmButton","data-bs-dismiss","modal",1,"btn","btn-success",3,"click","disabled"],["role","status",1,"spinner-border","text-primary"],[3,"innerHTML"]],template:function(c,m){if(1&c){const d=e.RV6();e.DNE(0,i,1,0,"ng-template",null,0,e.C5r),e.j41(2,"div",1),e.DNE(3,v,3,1,"ng-container",2),e.j41(4,"div",3)(5,"form",4)(6,"div",5)(7,"label",6),e.EFF(8,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),e.k0s(),e.nrm(9,"input",7),e.EFF(10,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),e.k0s(),e.j41(11,"div",8),e.EFF(12,"\u8a73\u3057\u304f\u306f"),e.j41(13,"a",9),e.EFF(14,"[\u5229\u7528\u898f\u7d04]"),e.k0s(),e.EFF(15,"\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002 "),e.k0s(),e.j41(16,"div",10)(17,"button",11),e.bIt("click",function(F){return e.eBV(d),e.Njj(m.onClickConfirm(F))}),e.EFF(18,"\u78ba\u8a8d\u3057\u307e\u3057\u305f"),e.k0s()()()()()}if(2&c){const d=e.sdS(1);e.R7$(3),e.Y8G("ngIf",m.tosJson)("ngIfElse",d),e.R7$(2),e.Y8G("formGroup",m.inputConfirmForm),e.R7$(),e.AVh("was-validated",m.neverCheckTosControl.dirty||m.neverCheckTosControl.touched),e.R7$(11),e.Y8G("disabled",!m.inputConfirmForm.valid)}},dependencies:[h.bT,l.qT,l.Zm,l.BC,l.cb,l.j4,l.JD,s.Wk]})}return o})();var $=t(2275),k=t(1413),A=t(6697),U=t(5558),y=t(6354),P=t(8001),I=t(4416),b=t(8334);let R=(()=>{class o{http;dialog;store;privUser;constructor(p,c,m){this.http=p,this.dialog=c,this.store=m,this.privUser=this.store.collection("/users/v1/protected")}constructSetupTosConfirm(p,c){return m=>{m.tosJson=c.json,m.confirmed.subscribe(d=>{if(!d.isConfirmed)throw new Error("assert");c.answer=d.saveNeverAsk?f.OkPermanent:f.Ok,p.next(c)})}}confirmTos$(p,c){var m=this;if(p.match(/\/$/))throw new Error(`Assertion. Not a supported ${p}`);const d=new k.B,F=(new k.B,new k.B),x=new k.B,j=this.http.fetchGhJson(c).pipe((0,A.s)(1),(0,U.n)(u=>{const E=this.privUser.doc(`${p}/${u.version}`),O={json:u,cached:!1,cacheRef:E};return E.get().pipe((0,y.T)((B,G)=>(B.exists&&B.data().alwaysConfirmed&&((0,r.Oi)("TOS has already been confirmed."),O.cached=!0),O)))}));return x.pipe().subscribe({next:u=>{this.dialog.createDefaultBuilder().prepareBody(M).setupChild(this.constructSetupTosConfirm(F,u)).setType($.hs.Warn).setSize($.EV.Default).setTitle("\u5229\u7528\u898f\u7d04\u306e\u78ba\u8a8d").closeButton(()=>{u.answer=f.No,F.next(u)}).setFinalize(()=>{u.answer=f.No,F.next(u)}).open()},complete:()=>{(0,r.Oi)("completeed dialog$")},error:u=>{(0,r.sJ)("error dialog$",u)}}),j.pipe((0,A.s)(1)).subscribe({next:u=>{u.cached?d.next(!0):x.next(u)},complete:()=>{(0,r.Oi)("Completed TOS reading")},error:u=>{(0,r.sJ)("Failed reading TOS cache")}}),F.pipe((0,A.s)(1)).subscribe({next:(u=(0,n.A)(function*(E){switch(E.answer){case f.Ok:d.next(!0);break;case f.No:d.next(!1);break;case f.OkPermanent:const O={_docClass:"User:UserAgreementStore",alwaysConfirmed:!0,createdAt:m.fieldTimestamp()};d.next(!0),yield E.cacheRef.set(O);break;default:throw new Error(`Not a valid answer ${E.answer}`)}}),function(O){return u.apply(this,arguments)}),complete:()=>{(0,r.Oi)("Completed dialog result."),d.complete()},error:u=>{(0,r.sJ)("Failed receive dialog result"),d.complete()}}),d;var u}fieldTimestamp(){return T.A.firestore.FieldValue.serverTimestamp()}static \u0275fac=function(c){return new(c||o)(e.KVO(P.kl),e.KVO(I.o3),e.KVO(b.Qe))};static \u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},9243:(D,g,t)=>{t.d(g,{D:()=>a});var n=t(7673),T=t(9568),C=t(6354),f=t(4438),e=t(8334),l=t(1474);let a=(()=>{class r{store;auth;pubUser;nicknameCache={};userCache={};constructor(s,i){this.store=s,this.auth=i,this.pubUser=this.store.collection("/users/v1/public")}myNickname$(){return this.auth.myUid?this.nickname$(this.auth.myUid):(0,n.of)("")}user$(s){let i=this.userCache[s];return i||(i=this.pubUser.doc(s).valueChanges().pipe((0,T.t)(1)),this.userCache[s]=i,i)}nickname$(s){let i=this.nicknameCache[s];return i||(i=this.user$(s).pipe((0,C.T)(v=>v?v.nickname:null)),this.nicknameCache[s]=i,i)}static \u0275fac=function(i){return new(i||r)(f.KVO(e.Qe),f.KVO(l.u))};static \u0275prov=f.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()},681:(D,g,t)=>{t.d(g,{g:()=>l});var n=t(4438),T=t(177);function C(a,r){1&a&&(n.j41(0,"span",2),n.EFF(1,"[\u524a\u9664]"),n.k0s())}function f(a,r){1&a&&n.nrm(0,"img",5),2&a&&n.FS9("src",r.$implicit,n.B4B)}function e(a,r){if(1&a&&(n.j41(0,"span",3),n.DNE(1,f,1,1,"img",4),n.EFF(2),n.k0s()),2&a){const h=r.$implicit;n.FS9("title",h.about),n.R7$(),n.Y8G("ngIf",h.photoURL),n.R7$(),n.JRh(h.nickname)}}let l=(()=>{class a{userPublic;constructor(){}static \u0275fac=function(s){return new(s||a)};static \u0275cmp=n.VBU({type:a,selectors:[["gitfire-user-box"]],inputs:{userPublic:"userPublic"},decls:3,vars:2,consts:[["voidUser",""],["class","p-1",3,"title",4,"ngIf","ngIfElse"],["title","\u524a\u9664\u3055\u308c\u305f\u30e6\u30fc\u30b6\u3067\u3059",1,"text-warning"],[1,"p-1",3,"title"],["class","p-1","style","height: 100%; width: 2rem;",3,"src",4,"ngIf"],[1,"p-1",2,"height","100%","width","2rem",3,"src"]],template:function(s,i){if(1&s&&n.DNE(0,C,2,0,"ng-template",null,0,n.C5r)(2,e,3,3,"span",1),2&s){const v=n.sdS(1);n.R7$(2),n.Y8G("ngIf",i.userPublic)("ngIfElse",v)}},dependencies:[T.bT]})}return a})()}}]);