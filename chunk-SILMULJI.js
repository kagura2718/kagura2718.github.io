import{a as yt}from"./chunk-K2UGS2TL.js";import{c as R,d as m,g as n,h as nt,i as d,k as T,l as k}from"./chunk-T2NEJTFN.js";import{a as ot}from"./chunk-7TUK6JK3.js";import{b as ft}from"./chunk-DQJB75ZH.js";import{c as rt}from"./chunk-65ATPBQ2.js";import{c as dt,d as ut}from"./chunk-JWYJSAI2.js";import{b as at,d as I,f as F,h as st,k as B,l as ct,m as lt,n as O,q as pt,s as mt}from"./chunk-ZJGJ7LC2.js";import{$a as u,A as X,Aa as r,Ab as Y,Db as y,Eb as $,F as Q,Ga as b,Ja as G,Jc as et,Nb as L,Nc as it,O as N,Pb as z,Q as D,Qc as f,Sb as J,Ua as g,Wa as h,Wb as x,Xb as A,Yb as K,Za as H,_a as W,ab as s,b as E,bb as c,c as P,cb as w,d as V,ea as v,fa as _,lb as M,ma as U,ob as C,p as S,q,qb as p,sc as Z,tc as tt,y as j}from"./chunk-EYIZCJHC.js";var gt=i=>({id:i}),ht=(i,e)=>e.id;function Ct(i,e){i&1&&(s(0,"div",2)(1,"div",4)(2,"span",5),y(3,"Notification is alived."),c()()())}function xt(i,e){i&1&&(s(0,"span",12),y(1),c()),i&2&&(u("@shakeItTrigger",void 0),r(),$(e))}function Tt(i,e){if(i&1&&(s(0,"a",18),y(1),c()),i&2){let t=p().$implicit;u("routerLink",L(t.anchorLink))("fragment",t.anchorId),r(),$(t.title)}}function kt(i,e){if(i&1&&y(0),i&2){let t=p().$implicit;$(t.title)}}function St(i,e){if(i&1){let t=M();s(0,"tr",6)(1,"td",17),g(2,Tt,2,4,"a",18)(3,kt,1,1),c(),s(4,"td",19),x(5,"date"),s(6,"a",20),y(7),x(8,"relativeTime"),c()(),s(9,"td")(10,"input",21),C("click",function(a){let l=v(t).$implicit,_t=p(3);return _(_t.onClickRead(a,l))}),c()()()}if(i&2){let t=e.$implicit;r(),u("title",z("Title: ",t.title,`

`,t.body)),r(),h(t.anchorLink?2:3),r(2),u("title",L(K(5,10,t.createdAt.toDate(),"yyyy-MM-dd HH:MM"))),r(2),u("queryParams",J(15,gt,t.id)),r(),$(A(8,13,t.createdAt.toDate())),r(3),u("disabled",t.hasRead)("checked",!!t.hasRead)}}function bt(i,e){if(i&1){let t=M();s(0,"div")(1,"div",6)(2,"div",7)(3,"button",8),C("click",function(a){v(t);let l=p(2);return _(l.onClickNext(a))}),w(4,"img",9),c(),s(5,"button",10),C("click",function(a){v(t);let l=p(2);return _(l.onClickPrevious(a))}),w(6,"img",11),c(),g(7,xt,2,2,"span",12),x(8,"async"),c(),s(9,"div",13)(10,"table",14),H(11,St,11,17,"tr",6,ht),c()(),s(13,"div",7)(14,"button",15),C("click",function(a){v(t);let l=p(2);return _(l.onClickReadAll(a))}),y(15,"Read All"),w(16,"img",16),c()()()()}if(i&2){let t,o=p(2);r(7),h((t=A(8,2,o.pagingMessage$))?7:-1,t),r(3),u("@notificationItemTrigger",o.pageNavigationState),r(),W(o.notifications())}}function wt(i,e){if(i&1){let t=M();s(0,"div",0),C("click",function(a){v(t);let l=p();return _(l.onClickTraySpinner(a))}),w(1,"img",1),g(2,Ct,4,0,"div",2),x(3,"async"),c(),s(4,"div",3),x(5,"async"),g(6,bt,17,4,"div"),c()}if(i&2){let t=p();r(2),h(A(3,4,t.hasMessage$)?2:-1),r(2),Y("left",A(5,6,t.trayLeft$),"px"),r(2),h(t.isShowingList()?6:-1)}}var vt=class i{constructor(e,t,o,a){this.auth=e;this.firestore=t;this.funcs=o;this.router=a}NotificationLimit=10;destroy$=new E;query$=new P([B(this.NotificationLimit)]);TrayStoreConverter=ft(["createdAt"]);pagingMessage$;message$=new E;clickModal$=new E;hasMessage$;isShowingList=U(!1);isActive=U(!1);notificationsSave=[];notifications=U([]);pageNavigationState;trayLeft$=new V;ngOnInit(){f("UserTrayComponent.OnInit()"),this.auth.clientSideUser$.pipe(D(this.destroy$)).subscribe(t=>{this.isActive.update(o=>!!t)});let e=this.auth.clientSideUser$.pipe(X(t=>!!t),S(t=>`users/v1/protected/${t.uid}/tray`));this.hasMessage$=e.pipe(N(t=>{let o=F(this.firestore,t).withConverter(this.TrayStoreConverter),a=O(o,mt("hasRead","==",!1));return I(a)}),S(t=>t.length>0)),q(e,this.query$).pipe(N(([t,o])=>{let a=F(this.firestore,t).withConverter(this.TrayStoreConverter),l=O(a,lt("createdAt","desc"),...o);return I(l,{idField:"id"})}),D(this.destroy$)).subscribe(t=>{if(t.length===0){this.notifications.set(this.notificationsSave),this.pageNavigationState="nomore",this.message$.next("\u3053\u308C\u4EE5\u4E0A\u901A\u77E5\u306F\u3042\u308A\u307E\u305B\u3093\u3002");return}this.pageNavigationState="enter",this.notifications.set(t)}),this.pagingMessage$=j(this.message$,this.message$.pipe(Q(2e3),S(()=>null)),this.clickModal$.pipe(S(()=>null)))}ngOnDestroy(){f("UserTrayComponent.OnDestroy()"),this.destroy$.next()}onClickTraySpinner(e){f("onClickTraySpinner()",e),this.trayLeft$.next(e.x-300),this.isShowingList.set(!0)}prepareToClick(e){e.stopPropagation(),this.clickModal$.next()}async onClickRead(e,t){f("onClickRead()",e),this.prepareToClick(e);let o={id:t.id};await this.funcs.call("setDoneTray",o)}async onClickReadAll(e){f("onClickReadAll()",e),this.prepareToClick(e),await this.funcs.action("setDoneTrayAll")}onClickNext(e){if(f("onClickNext()",e),this.prepareToClick(e),this.pageNavigationState="next",this.notifications().length===0){this.query$.next([]);return}let t=this.notifications()[0];this.notificationsSave=this.notifications(),this.notifications.set([]),this.query$.next([st(t.createdAt),ct(this.NotificationLimit)])}onClickPrevious(e){f("onClickPrevious()",e),this.prepareToClick(e);let t=this.notifications();if(t.length===0)return;this.pageNavigationState="previous";let o=t[t.length-1];this.notificationsSave=t,this.notifications.set([]),this.query$.next([pt(o.createdAt),B(this.NotificationLimit)])}static \u0275fac=function(t){return new(t||i)(b(ut),b(at),b(dt),b(ot))};static \u0275cmp=G({type:i,selectors:[["app-user-tray"]],decls:1,vars:1,consts:[["data-bs-toggle","dropdown",3,"click"],["src","/assets/octicons/bell.svg",1,"",2,"width","100%","cursor","pointer"],[2,"position","absolute","top","0px"],[1,"dropdown-menu",2,"max-height","400px","width","400px","position","fixed","top","50px"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning"],[1,"visually-hidden"],[1,"m-3"],[1,"m-2"],["title","\u65B0\u3057\u3044\u901A\u77E5\u30DA\u30FC\u30B8\u3092\u8868\u793A\u3057\u307E\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-left.svg",1,"mx-3"],["title","\u53E4\u3044\u901A\u77E5\u30DA\u30FC\u30B8\u3092\u8868\u793A\u3057\u307E\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-right.svg",1,"mx-3"],[1,"text-warning","mx-2"],[2,"height","250px","overflow-y","scroll","overflow-x","hidden"],[2,"width","100%"],["title","\u3059\u3079\u3066\u65E2\u8AAD\u306B\u3057\u307E\u3059",1,"btn","btn-warning",3,"click"],["src","/assets/octicons/check.svg",1,"mx-2"],[2,"overflow-x","hidden",3,"title"],[3,"routerLink","fragment"],[3,"title"],["routerLink","/Gitfire/tray",3,"queryParams"],["type","checkbox","title","\u65E2\u8AAD\u306B\u3059\u308B\u5834\u5408\u306F check \u3057\u3066\u304F\u3060\u3055\u3044\u3002",1,"m-2",3,"click","disabled","checked"]],template:function(t,o){t&1&&g(0,wt,7,8),t&2&&h(o.isActive()?0:-1)},dependencies:[it,et,rt,Z,tt,yt],styles:["[_nghost-%COMP%]{cursor:initial}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:snow}"],data:{animation:[R("shakeItTrigger",[d(":leave",[n({transform:"none",position:"absolute"}),m("300ms ease-in-out",n({opacity:0,transform:"translateY(-100%)"}))]),d(":enter",[n({transform:"none",position:"absolute"}),m("1000ms ease-in-out",nt([n({transform:"translate3d(-4px, 0, 0)",offset:.1}),n({transform:"translate3d(4px, 0, 0)",offset:.2}),n({transform:"translate3d(-3px, 0, 0)",offset:.3}),n({transform:"translate3d(3px, 0, 0)",offset:.4}),n({transform:"translate3d(-3px, 0, 0)",offset:.5}),n({transform:"translate3d(2px, 0, 0)",offset:.6}),n({transform:"translate3d(-2px, 0, 0)",offset:.7}),n({transform:"translate3d(1px, 0, 0)",offset:.8}),n({transform:"translate3d(-1px, 0, 0)",offset:.9})]))])]),R("notificationItemTrigger",[d(":enter",[T("tr",[n({opacity:0,transform:"translateX(-100%)"}),k(20,[m("300ms ease-in-out",n({opacity:1,transform:"none"}))])],{optional:!0})]),d("* => previous",[T("tr",[n({}),k(20,[m("300ms ease-in-out",n({opacity:0,transform:"translateX(-100%)"}))])],{optional:!0})]),d("previous => enter",[T("tr",[n({opacity:0,transform:"translateX(100%)"}),k(20,[m("300ms 100ms ease-in-out",n({opacity:1,transform:"none"}))])],{optional:!0})]),d("* => next",[T("tr",[n({}),k(20,[m("300ms ease-in-out",n({opacity:0,transform:"translateX(100%)"}))])],{optional:!0})]),d("next => enter",[T("tr",[n({opacity:0,transform:"translateX(-100%)"}),k(20,[m("300ms 100ms ease-in-out",n({opacity:1,transform:"none"}))])],{optional:!0})]),d("* => nomore",[n({opacity:0,backgroundColor:"red"}),m("300ms 100ms ease-in-out",n({opacity:1,backgroundColor:"*"}))])])]}})};export{vt as a};
