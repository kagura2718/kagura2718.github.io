import{Fa as tt,j as Y}from"./chunk-PILREPZC.js";import{a as X}from"./chunk-VHUMRDWQ.js";import{g as Z}from"./chunk-NAEJWWIV.js";import{a as W}from"./chunk-5QAG3LX3.js";import{$a as v,$c as Q,Aa as u,Db as a,Eb as O,Ga as g,Hb as y,Ib as w,Ic as B,Ja as D,Jb as E,Jc as G,Nb as L,Q as h,Tc as R,Ua as f,Va as F,Wa as _,Wb as T,Wc as $,Xb as N,Yc as j,Zc as q,ab as r,b as U,bb as o,bd as z,c as I,cb as l,cd as H,ea as p,fa as d,lb as S,ma as C,nd as J,ob as x,qb as c,rd as K,sc as V,tb as k,ub as P,vb as A,ya as M}from"./chunk-5QLRW66F.js";var it=["loginForm"];function nt(e,i){e&1&&l(0,"span",2)}function ot(e,i){e&1&&(r(0,"div",10),l(1,"app-oauth-federations",13),o()),e&2&&(u(),v("isTiny",!0))}function rt(e,i){if(e&1){let t=S();r(0,"form",3,0)(2,"div",4)(3,"label",5),a(4,"Email"),o(),r(5,"input",6),E("ngModelChange",function(n){p(t);let m=c();return w(m.emailInput,n)||(m.emailInput=n),d(n)}),o()(),r(6,"div",4)(7,"label",7),a(8,"Password"),o(),r(9,"input",8),E("ngModelChange",function(n){p(t);let m=c();return w(m.passwordInput,n)||(m.passwordInput=n),d(n)}),o()(),r(10,"div",4)(11,"button",9),x("click",function(n){p(t);let m=c();return d(m.doLogin(n))}),a(12,"Login"),o(),f(13,ot,2,1,"div",10),o()(),l(14,"hr"),r(15,"div",11)(16,"a",12),a(17,"\u305D\u306E\u4ED6\u306E\u6A5F\u80FD"),o()()}if(e&2){let t=c();u(5),y("ngModel",t.emailInput),u(4),y("ngModel",t.passwordInput),u(4),_(-1)}}function st(e,i){e&1&&l(0,"img",15),e&2&&v("src",L(i),M)}function at(e,i){e&1&&l(0,"span",16)}function lt(e,i){if(e&1){let t=S();r(0,"div",11)(1,"div")(2,"div",14),a(3),o(),r(4,"div",11),f(5,st,1,2,"img",15)(6,at,1,0,"span",16),o(),r(7,"div",17)(8,"div",18)(9,"a",19),l(10,"img",20),a(11,"Chat"),o()(),r(12,"div",18)(13,"a",21),l(14,"img",22),a(15,"Post"),o()()(),r(16,"div",14)(17,"a",23),l(18,"img",24),a(19,"\u8A2D\u5B9A"),o()(),r(20,"div",14)(21,"button",9),x("click",function(n){p(t);let m=c(2);return d(m.doLogout(n))}),l(22,"img",25),a(23,"\u30ED\u30B0\u30A2\u30A6\u30C8"),o()()(),l(24,"hr"),r(25,"div",26)(26,"div")(27,"a",27),a(28,"\u30D7\u30E9\u30A4\u30D0\u30B7\u30FC\u30DD\u30EA\u30B7\u30FC"),o(),a(29,"\u30FB"),r(30,"a",28),a(31,"\u5229\u7528\u898F\u7D04"),o()()()()}if(e&2){let t,s=c(2);u(3),O(i.displayName),u(2),_((t=s.status.photoUrl())?5:6,t)}}function mt(e,i){if(e&1&&f(0,lt,32,2,"div",11),e&2){let t,s=c();_((t=s.status.user())?0:-1,t)}}var b=class{state$=new I("checking");user=C(null);photoUrl=C(null)},et=class e{constructor(i,t,s,n){this.auth=i;this.localSession=t;this.toastr=s;this.router=n}status=new b;destroy$=new U;emailInput;passwordInput;loginForm;ngOnDestroy(){this.destroy$.next()}ngOnInit(){this.auth.user.pipe(h(this.destroy$)).subscribe(i=>{i?this.localSession.isSeemsLogin?this.status.state$.next("login"):this.status.state$.next("logout"):this.status.state$.next("logout"),this.status.user.set(i)}),this.localSession.loginPhoto$().pipe(h(this.destroy$)).subscribe(i=>{this.status.photoUrl.set(i)})}async doLogin(i){if(i.preventDefault(),i.stopPropagation(),this.loginForm.invalid){this.toastr.error("\u5165\u529B\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}try{await this.auth.setPersistence(Y.auth.Auth.Persistence.SESSION);let t=await this.auth.signInWithEmailAndPassword(this.emailInput,this.passwordInput)}catch(t){let s=t.code,n=t.message;this.toastr.error(`Login \u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002(${s}: ${n})`)}}async doLogout(i){i.preventDefault();try{await this.auth.signOut(),this.router.navigate(["/"])}catch(t){R("UserStatusComponent.doLogout() is failed",t)}}static \u0275fac=function(t){return new(t||e)(g(Z),g(X),g(W),g(B))};static \u0275cmp=D({type:e,selectors:[["ng-component"]],viewQuery:function(t,s){if(t&1&&k(it,5),t&2){let n;P(n=A())&&(s.loginForm=n.first)}},decls:5,vars:3,consts:[["loginForm","ngForm"],[1,"px-2","py-3"],["role","status",1,"spinner-border","text-primary"],[1,"form-group"],[1,"my-1"],["for","appGitfireUserStatusEmailInput",1,"visually-hidden"],["id","appGitfireUserStatusEmailInput","name","email","placeholder","email@example.com","type","email","required","","autocomplete","email","autofill","",1,"form-control",3,"ngModelChange","ngModel"],["for","appGitfireUserStatusPasswordInput",1,"visually-hidden"],["id","appGitfireUserStatusPasswordInput","name","password","placeholder","Password","type","password","autocomplete","current-password","required","","autofill","",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"my-2"],[1,"text-center"],["routerLink","/Gitfire/login",1,"text-muted","fw-light","footnote"],[3,"isTiny"],[1,"m-3"],[1,"rounded","user-icon",3,"src"],["role","status",1,"spinner-border","text-primary","user-icon"],[1,"m-3","row"],[1,"col-6"],["routerLink","/Gitfire/chat"],["src","/assets/octicons/comment-discussion.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/post"],["src","/assets/octicons/cloud-upload.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/settings"],["src","/assets/octicons/tools.svg",1,"m-1","gitfire-link-icon","octicon-info"],["src","/assets/octicons/sign-out.svg",1,"m-1","gitfire-link-icon","octicon-info"],[1,"m-3","footnote"],["href","/policy.htm","about","_blank",1,"text-muted","fw-light"],["href","/terms.htm","about","_blank",1,"text-muted","fw-light"]],template:function(t,s){if(t&1&&(r(0,"div",1),f(1,nt,1,0,"span",2),T(2,"async"),F(3,rt,18,3)(4,mt,1,1),o()),t&2){let n;u(),_((n=N(2,1,s.status.state$))==="checking"?1:n==="logout"?3:n==="login"?4:-1)}},dependencies:[K,H,$,j,q,J,z,Q,G,tt,V],styles:["[_nghost-%COMP%]{cursor:initial}.footnote[_ngcontent-%COMP%]{font-size:.7rem}.user-icon[_ngcontent-%COMP%]{width:128px;height:128px}.gitfire-link-icon[_ngcontent-%COMP%]{width:24px;height:24px}.oauth-tiny-wide-img[_ngcontent-%COMP%]{height:30px}.oauth-tiny-circle-img[_ngcontent-%COMP%]{width:30px}"]})};export{et as a};
