"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[44],{2664:(T,_,r)=>{r.r(_),r.d(_,{UserStatusComponent:()=>R});var l=r(1528),p=r(5657),g=r(3616),d=r(6716),h=r(9252),t=r(4496),f=r(331),C=r(4848),E=r(4400),m=r(4192),c=r(1368),a=r(6504),I=r(6228);const O=["loginForm"];function y(s,u){1&s&&(t.SAx(0),t.wR5(1,"span",3),t.k70())}function v(s,u){1&s&&(t.I0R(0,"div",15),t.wR5(1,"app-oauth-federations",16),t.C$Y()),2&s&&(t.yG2(),t.E7m("isTiny",!0))}function P(s,u){if(1&s){const n=t.KQA();t.SAx(0),t.I0R(1,"form",4,5)(3,"div",6)(4,"label",7),t.OEk(5,"Email"),t.C$Y(),t.I0R(6,"input",8),t.iHE("ngModelChange",function(e){t.usT(n);const i=t.GaO();return t.kNx(i.emailInput,e)||(i.emailInput=e),t.CGJ(e)}),t.C$Y()(),t.I0R(7,"div",6)(8,"label",9),t.OEk(9,"Password"),t.C$Y(),t.I0R(10,"input",10),t.iHE("ngModelChange",function(e){t.usT(n);const i=t.GaO();return t.kNx(i.passwordInput,e)||(i.passwordInput=e),t.CGJ(e)}),t.C$Y()(),t.I0R(11,"div",6)(12,"button",11),t.qCj("click",function(e){t.usT(n);const i=t.GaO();return t.CGJ(i.doLogin(e))}),t.OEk(13,"Login"),t.C$Y(),t.yuY(14,v,2,1,"div",12),t.C$Y()(),t.wR5(15,"hr"),t.I0R(16,"div",13)(17,"a",14),t.OEk(18,"\u305d\u306e\u4ed6\u306e\u6a5f\u80fd"),t.C$Y()(),t.k70()}if(2&s){const n=t.GaO();t.yG2(6),t.OKB("ngModel",n.emailInput),t.yG2(4),t.OKB("ngModel",n.passwordInput),t.yG2(4),t.E7m("ngIf",!1)}}function M(s,u){if(1&s&&t.wR5(0,"img",33),2&s){const n=t.GaO(3);t._6D("src",n.status.photoUrl,t.K6U)}}function S(s,u){1&s&&t.wR5(0,"span",34)}function G(s,u){if(1&s){const n=t.KQA();t.SAx(0),t.I0R(1,"div",13)(2,"div")(3,"div",18),t.OEk(4),t.C$Y(),t.I0R(5,"div",13),t.yuY(6,M,1,1,"img",19)(7,S,1,0,"span",20),t.C$Y(),t.I0R(8,"div",21)(9,"div",22)(10,"a",23),t.wR5(11,"img",24),t.OEk(12,"Chat"),t.C$Y()(),t.I0R(13,"div",22)(14,"a",25),t.wR5(15,"img",26),t.OEk(16,"Post"),t.C$Y()()(),t.I0R(17,"div",18)(18,"a",27),t.wR5(19,"img",28),t.OEk(20,"\u8a2d\u5b9a"),t.C$Y()(),t.I0R(21,"div",18)(22,"button",11),t.qCj("click",function(e){t.usT(n);const i=t.GaO(2);return t.CGJ(i.doLogout(e))}),t.wR5(23,"img",29),t.OEk(24,"\u30ed\u30b0\u30a2\u30a6\u30c8"),t.C$Y()()(),t.wR5(25,"hr"),t.I0R(26,"div",30)(27,"div")(28,"a",31),t.OEk(29,"\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc"),t.C$Y(),t.OEk(30,"\u30fb"),t.I0R(31,"a",32),t.OEk(32,"\u5229\u7528\u898f\u7d04"),t.C$Y()()()(),t.k70()}if(2&s){const n=u.$implicit,o=t.GaO(2);t.yG2(4),t.cNF(n.displayName),t.yG2(2),t.E7m("ngIf",o.status.photoUrl),t.yG2(),t.E7m("ngIf",!o.status.photoUrl)}}function U(s,u){if(1&s&&(t.SAx(0),t.yuY(1,G,33,3,"ng-container",17),t.k70()),2&s){const n=t.GaO();t.yG2(),t.E7m("ngIf",n.status.user)}}class D{state="checking";user;photoUrl}let R=(()=>{class s{auth;localSession;toastr;router;status=new D;destroy$=new p.E;emailInput;passwordInput;loginForm;constructor(n,o,e,i){this.auth=n,this.localSession=o,this.toastr=e,this.router=i}ngOnDestroy(){this.destroy$.next()}ngOnInit(){this.auth.user.pipe((0,g.a)(this.destroy$)).subscribe(n=>{this.status.state=n&&this.localSession.isSeemsLogin?"login":"logout",this.status.user=n}),this.localSession.loginPhoto$().pipe((0,g.a)(this.destroy$)).subscribe(n=>{this.status.photoUrl=n})}doLogin(n){var o=this;return(0,l.c)(function*(){if(n.preventDefault(),n.stopPropagation(),o.loginForm.invalid)o.toastr.error("\u5165\u529b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else try{yield o.auth.setPersistence(h.c.auth.Auth.Persistence.SESSION),yield o.auth.signInWithEmailAndPassword(o.emailInput,o.passwordInput)}catch(e){o.toastr.error(`Login \u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002(${e.code}: ${e.message})`)}})()}doLogout(n){var o=this;return(0,l.c)(function*(){n.preventDefault();try{yield o.auth.signOut(),o.router.navigate(["/"])}catch(e){(0,d.sJ)("UserStatusComponent.doLogout() is failed",e)}})()}static \u0275fac=function(o){return new(o||s)(t.GI1(f._o),t.GI1(C.U),t.GI1(E.SA),t.GI1(m.E5))};static \u0275cmp=t.In1({type:s,selectors:[["ng-component"]],viewQuery:function(o,e){if(1&o&&t.CC$(O,5),2&o){let i;t.wto(i=t.Gqi())&&(e.loginForm=i.first)}},decls:5,vars:4,consts:[[1,"px-2","py-3"],[3,"ngSwitch"],[4,"ngSwitchCase"],["role","status",1,"spinner-border","text-primary"],[1,"form-group"],["loginForm","ngForm"],[1,"my-1"],["for","appGitfireUserStatusEmailInput",1,"visually-hidden"],["id","appGitfireUserStatusEmailInput","name","email","placeholder","email@example.com","type","email","required","","autocomplete","email","autofill","",1,"form-control",3,"ngModel","ngModelChange"],["for","appGitfireUserStatusPasswordInput",1,"visually-hidden"],["id","appGitfireUserStatusPasswordInput","name","password","placeholder","Password","type","password","autocomplete","current-password","required","","autofill","",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary",3,"click"],["class","my-2",4,"ngIf"],[1,"text-center"],["routerLink","/Gitfire/login",1,"text-muted","fw-light","footnote"],[1,"my-2"],[3,"isTiny"],[4,"ngIf"],[1,"m-3"],["class","rounded user-icon",3,"src",4,"ngIf"],["class","spinner-border text-primary user-icon","role","status",4,"ngIf"],[1,"m-3","row"],[1,"col-6"],["routerLink","/Gitfire/chat"],["src","/assets/octicons/comment-discussion.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/post"],["src","/assets/octicons/cloud-upload.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/settings"],["src","/assets/octicons/tools.svg",1,"m-1","gitfire-link-icon","octicon-info"],["src","/assets/octicons/sign-out.svg",1,"m-1","gitfire-link-icon","octicon-info"],[1,"m-3","footnote"],["href","/policy.htm","about","_blank",1,"text-muted","fw-light"],["href","/terms.htm","about","_blank",1,"text-muted","fw-light"],[1,"rounded","user-icon",3,"src"],["role","status",1,"spinner-border","text-primary","user-icon"]],template:function(o,e){1&o&&(t.I0R(0,"div",0),t.SAx(1,1),t.yuY(2,y,2,0,"ng-container",2)(3,P,19,3,"ng-container",2)(4,U,2,1,"ng-container",2),t.k70(),t.C$Y()),2&o&&(t.yG2(),t.E7m("ngSwitch",e.status.state),t.yG2(),t.E7m("ngSwitchCase","checking"),t.yG2(),t.E7m("ngSwitchCase","logout"),t.yG2(),t.E7m("ngSwitchCase","login"))},dependencies:[c.u_,c.Ko,c.Wm,a.sz,a.ot,a.ue,a.u,a.eJ,a._G,a.SC,m.ER,I.c],styles:["[_nghost-%COMP%]{cursor:initial}.footnote[_ngcontent-%COMP%]{font-size:.7rem}.user-icon[_ngcontent-%COMP%]{width:128px;height:128px}.gitfire-link-icon[_ngcontent-%COMP%]{width:24px;height:24px}.oauth-tiny-wide-img[_ngcontent-%COMP%]{height:30px}.oauth-tiny-circle-img[_ngcontent-%COMP%]{width:30px}"]})}return s})()}}]);