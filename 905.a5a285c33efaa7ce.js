"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[905],{2905:(I,v,l)=>{l.r(v),l.d(v,{S2mapModule:()=>P});var a=l(1180),M=l(6814),g=l(5739),Z=l(5187),A=l(5861),b=l(3010),T=l(7028),p=l(553),x=l(9773),B=l(3620),C=l(5619),f=l(8645),y=l(2572),t=l(5879),E=l(3766),O=l(9798),$=l(6448),R=l(9515);function N(m,i){if(1&m&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&m){const r=t.oxw();t.xp6(1),t.hij("Zoom: ",r.mapZoomLevel,"")}}const G=[{path:"map/index.htm",redirectTo:"map"},{path:"map",component:(()=>{var m;class i{constructor(e,n){(0,a.Z)(this,"translate",void 0),(0,a.Z)(this,"http",void 0),(0,a.Z)(this,"cellMainScales",{}),(0,a.Z)(this,"cellSubScales",{}),(0,a.Z)(this,"googleMap",void 0),(0,a.Z)(this,"S2LEVEL_MAX",20),(0,a.Z)(this,"S2LevelRange",[1,this.S2LEVEL_MAX]),(0,a.Z)(this,"S2LevelSubScaleMax",3),(0,a.Z)(this,"inputS2Level",1),(0,a.Z)(this,"inputS2LevelSubScale",0),(0,a.Z)(this,"inputS2Level$",new C.X(this.inputS2Level)),(0,a.Z)(this,"inputS2LevelSubScale$",new C.X(this.inputS2LevelSubScale)),(0,a.Z)(this,"mapBounds$",new f.x),(0,a.Z)(this,"isDeveloper",!p.NZ.production),(0,a.Z)(this,"mapZoomLevel",void 0),(0,a.Z)(this,"destroy$",new f.x),this.translate=e,this.http=n}ngOnInit(){var e=this;return(0,A.Z)(function*(){const o=yield new T.aN({apiKey:p.NZ.googleMapApiKey,version:"weekly",libraries:["places"]}).load();(0,p.w_)("Google API loaded",o);const s={center:{lat:p.NZ.MapDefaultLocation.lat,lng:p.NZ.MapDefaultLocation.lng},zoom:7},d=document.getElementById("toolsS2MapMain");e.googleMap=new o.maps.Map(d,s),e.googleMap.addListener("bounds_changed",e.onMapBoundsChanged.bind(e)),(0,y.a)([e.inputS2Level$,e.mapBounds$]).pipe((0,x.R)(e.destroy$)).subscribe(([c,S])=>{const u=e.googleMap.getZoom();"number"==typeof u?(e.S2LevelRange=e.getZoomLevelS2Range(u),e.S2LevelSubScaleMax=Math.min(Math.max(e.S2LEVEL_MAX-c,0),3),e.drawMainScales(c,S)):(0,p.wb)("Unexpectedly failed to get zoom",u)}),(0,y.a)([e.inputS2Level$,e.inputS2LevelSubScale$,e.mapBounds$]).pipe((0,B.b)(100),(0,x.R)(e.destroy$)).subscribe(([c,S,u])=>{e.drawSubScales(c+S,u)})})()}ngOnDestroy(){this.destroy$.next()}onChangeLevel(e){this.inputS2Level$.next(e)}clearScales(e){for(const n in e)e[n].setMap(null),delete e[n]}drawSubScales(e,n){this.clearScales(this.cellSubScales);const o=this.googleMap.getCenter();if(!o)return void(0,p.wb)("Unexpectedly failed to get map center");const s=this.toS2Cell(o,e);this.drawWithNeighbors(this.cellSubScales,n,s,.3)}drawMainScales(e,n){this.clearScales(this.cellMainScales);const o=this.googleMap.getCenter();if(!o)return;const s=this.toS2Cell(o,e);this.drawWithNeighbors(this.cellMainScales,n,s)}drawWithNeighbors(e,n,o,s=1){const d=this.toGoogleBounds(o);if(!n.intersects(d))return;const c=o.toHilbertQuadkey();if(c in e)return;const S=o.getCornerLatLngs(),u=S.map(h=>this.toGoogleLatLng(h));u.push(this.toGoogleLatLng(S[0]));const L=new google.maps.Polyline({path:u,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.8*s,strokeWeight:1*s,map:this.googleMap});e[c]=L;for(const h of o.getNeighbors()){const X=h.getLatLng();new google.maps.LatLng(this.toGoogleLatLng(X)),this.drawWithNeighbors(e,n,h,s)}}toS2Cell(e,n){return b.S2.S2Cell.FromLatLng({lat:e.lat(),lng:e.lng()},n)}toGoogleBounds(e){const n=e.getCornerLatLngs();return new google.maps.LatLngBounds(n[0],n[1]).extend(n[2]).extend(n[3])}toGoogleLatLng(e){return{lat:e.lat,lng:e.lng}}onMapBoundsChanged(){const e=this.googleMap.getZoom();if(!e)return;this.mapZoomLevel=e;const n=this.getZoomLevelS2Range(e);if(this.inputS2Level<n[0]||n[1]<this.inputS2Level){const s=this.clamp(this.inputS2Level,n[0],n[1]);this.inputS2Level=s,this.inputS2Level$.next(s)}const o=this.googleMap.getBounds();o?this.mapBounds$.next(o):(0,p.wb)("Unexpectedly failed to get bounds.")}clamp(e,n,o){return Math.trunc(Math.min(o,Math.max(n,e)))}getZoomLevelS2Range(e){const n=this.clamp(Math.trunc(e),0,22),o=[{min:1,max:3},{min:1,max:6},{min:1,max:7},{min:1,max:7},{min:1,max:8},{min:1,max:8},{min:1,max:9},{min:1,max:9},{min:1,max:10},{min:1,max:11},{min:1,max:12},{min:1,max:12},{min:1,max:13},{min:1,max:13},{min:1,max:14},{min:8,max:15},{min:8,max:16},{min:9,max:17},{min:9,max:18},{min:10,max:19},{min:10,max:this.S2LEVEL_MAX},{min:11,max:this.S2LEVEL_MAX},{min:12,max:this.S2LEVEL_MAX}];return[o[n].min,o[n].max]}onChangeSubScale(e){this.inputS2LevelSubScale$.next(e)}}return m=i,(0,a.Z)(i,"\u0275fac",function(e){return new(e||m)(t.Y36(E.xq),t.Y36(O.OE))}),(0,a.Z)(i,"\u0275cmp",t.Xpm({type:m,selectors:[["app-s2-map"]],decls:18,vars:22,consts:[["id","toolsS2MapMain",2,"width","100%","height","600px"],[4,"ngIf"],[1,"form-group","m-2"],[1,"input-group","row","m-2"],[1,"col-1","form-check-label","p-2","text-end",3,"title"],[1,"col-2"],["type","number",1,"form-control",3,"min","max","ngModel","ngModelChange"],["fill","#7878dd","src","/assets/octicons/question.svg",1,"col-1",3,"title"]],template:function(e,n){1&e&&(t._UZ(0,"div",0),t.YNc(1,N,2,1,"span",1),t.TgZ(2,"div",2)(3,"div",3)(4,"label",4),t.ALo(5,"translate"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"span",5)(9,"input",6),t.NdJ("ngModelChange",function(s){return n.inputS2Level=s})("ngModelChange",function(s){return n.onChangeLevel(s)}),t.qZA()(),t.TgZ(10,"label",4),t.ALo(11,"translate"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"span",5)(15,"input",6),t.NdJ("ngModelChange",function(s){return n.inputS2LevelSubScale=s})("ngModelChange",function(s){return n.onChangeSubScale(s)}),t.qZA()(),t._UZ(16,"app-inline-svg",7),t.ALo(17,"translate"),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.isDeveloper),t.xp6(3),t.s9C("title",t.lcZ(5,12,"TOOLTIP_S2_CELL_LEVEL")),t.xp6(2),t.Oqu(t.lcZ(7,14,"LABEL_S2_CELL_LEVEL")),t.xp6(3),t.Q6J("min",n.S2LevelRange[0])("max",n.S2LevelRange[1])("ngModel",n.inputS2Level),t.xp6(1),t.s9C("title",t.lcZ(11,16,"TOOLTIP_S2_CELL_SUB_SCALE")),t.xp6(2),t.Oqu(t.lcZ(13,18,"LABEL_S2_CELL_SUB_SCALES")),t.xp6(3),t.Q6J("min",0)("max",n.S2LevelSubScaleMax)("ngModel",n.inputS2LevelSubScale),t.xp6(1),t.s9C("title",t.lcZ(17,20,"TOOLTIP_S2CELL_LEVEL")))},dependencies:[M.O5,g.Fj,g.wV,g.JJ,g.qQ,g.Fd,g.On,$.h,R.X$]})),i})(),data:{gitweeTitle:"TITLE_TOOL_S2GEO_MAP"}}];let U=(()=>{var m;class i{constructor(){(0,p.eM)("S2mapRoutingModule.constructor()")}}return m=i,(0,a.Z)(i,"\u0275fac",function(e){return new(e||m)}),(0,a.Z)(i,"\u0275mod",t.oAB({type:m})),(0,a.Z)(i,"\u0275inj",t.cJS({imports:[Z.Bz.forChild(G),Z.Bz]})),i})();var V=l(8001),w=l(5101);let P=(()=>{var m;class i{constructor(){(0,p.H_)("Dynamically loaded S2mapModule")}}return m=i,(0,a.Z)(i,"\u0275fac",function(e){return new(e||m)}),(0,a.Z)(i,"\u0275mod",t.oAB({type:m})),(0,a.Z)(i,"\u0275inj",t.cJS({providers:[{provide:E.uY,useValue:"app/tools/s2map/s2map/"}],imports:[M.ez,g.u5,V.f,w.R,U]})),i})()}}]);