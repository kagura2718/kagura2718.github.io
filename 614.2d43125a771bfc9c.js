"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[614],{2614:(G,m,a)=>{a.r(m),a.d(m,{UserTrayComponent:()=>b});var g=a(467),_=a(5312),p=a(1413),v=a(4412),y=a(2771),E=a(4572),T=a(7786),h=a(6977),C=a(5964),l=a(6354),d=a(5558),x=a(152),n=a(9969),t=a(4438),M=a(1474),k=a(8334),P=a(4871),D=a(1637),u=a(177),R=a(1188),O=a(4906);const $=o=>({id:o});function A(o,c){1&o&&(t.j41(0,"div",5)(1,"div",6)(2,"span",7),t.EFF(3,"Notification is alived."),t.k0s()()())}function F(o,c){if(1&o&&(t.j41(0,"span",20),t.EFF(1),t.k0s()),2&o){const i=c.$implicit;t.Y8G("@shakeItTrigger",void 0),t.R7$(),t.JRh(i)}}function I(o,c){if(1&o&&(t.qex(0),t.j41(1,"a",25),t.EFF(2),t.k0s(),t.bVm()),2&o){const i=t.XpG().$implicit;t.R7$(),t.FS9("routerLink",i.anchorLink),t.Y8G("fragment",i.anchorId),t.R7$(),t.JRh(i.title)}}function U(o,c){if(1&o&&(t.qex(0),t.EFF(1),t.bVm()),2&o){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.title)}}function B(o,c){if(1&o){const i=t.RV6();t.j41(0,"tr",8)(1,"td",21),t.DNE(2,I,3,3,"ng-container",0)(3,U,2,1,"ng-container",0),t.k0s(),t.j41(4,"td",22),t.nI1(5,"date"),t.j41(6,"a",23),t.EFF(7),t.nI1(8,"relativeTime"),t.k0s()(),t.j41(9,"td")(10,"input",24),t.bIt("click",function(s){const r=t.eBV(i).$implicit,f=t.XpG(3);return t.Njj(f.onClickRead(s,r))}),t.k0s()()()}if(2&o){const i=c.$implicit;t.R7$(),t.FCK("title","Title: ",i.title,"\n\n",i.body,""),t.R7$(),t.Y8G("ngIf",i.anchorLink),t.R7$(),t.Y8G("ngIf",!i.anchorLink),t.R7$(),t.FS9("title",t.i5U(5,10,i.createdAt.toDate(),"yyyy-MM-dd HH:MM")),t.R7$(2),t.Y8G("queryParams",t.eq3(15,$,i.id)),t.R7$(),t.JRh(t.bMT(8,13,i.createdAt.toDate())),t.R7$(3),t.Y8G("disabled",i.hasRead)("checked",!!i.hasRead)}}function L(o,c){if(1&o){const i=t.RV6();t.j41(0,"div")(1,"div",8)(2,"div",9)(3,"button",10),t.bIt("click",function(s){t.eBV(i);const r=t.XpG(2);return t.Njj(r.onClickNext(s))}),t.nrm(4,"img",11),t.k0s(),t.j41(5,"button",12),t.bIt("click",function(s){t.eBV(i);const r=t.XpG(2);return t.Njj(r.onClickPrevious(s))}),t.nrm(6,"img",13),t.k0s(),t.DNE(7,F,2,2,"span",14),t.nI1(8,"async"),t.k0s(),t.j41(9,"div",15)(10,"table",16),t.DNE(11,B,11,17,"tr",17),t.k0s()(),t.j41(12,"div",9)(13,"button",18),t.bIt("click",function(s){t.eBV(i);const r=t.XpG(2);return t.Njj(r.onClickReadAll(s))}),t.EFF(14,"Read All"),t.nrm(15,"img",19),t.k0s()()()()}if(2&o){const i=t.XpG(2);t.R7$(7),t.Y8G("ngIf",t.bMT(8,3,i.pagingMessage$)),t.R7$(3),t.Y8G("@notificationItemTrigger",i.pageNavigationState),t.R7$(),t.Y8G("ngForOf",i.notifications)}}function j(o,c){if(1&o){const i=t.RV6();t.qex(0),t.j41(1,"div",1),t.bIt("click",function(s){t.eBV(i);const r=t.XpG();return t.Njj(r.onClickTraySpinner(s))}),t.nrm(2,"img",2),t.DNE(3,A,4,0,"div",3),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",4),t.nI1(6,"async"),t.DNE(7,L,16,5,"div",0),t.k0s(),t.bVm()}if(2&o){const i=t.XpG();t.R7$(3),t.Y8G("ngIf",t.bMT(4,4,i.hasMessage$)),t.R7$(2),t.xc7("left",t.bMT(6,6,i.trayLeft$),"px"),t.R7$(2),t.Y8G("ngIf",i.isShowingList)}}let b=(()=>{class o{auth;store;funcs;router;NotificationLimit=10;destroy$=new p.B;query$=new v.t(i=>i.limit(this.NotificationLimit));pagingMessage$;message$=new p.B;clickModal$=new p.B;hasMessage$;isShowingList=!1;isActive=!1;notificationsSave=[];notifications=[];pageNavigationState;trayLeft$=new y.m;constructor(i,e,s,r){this.auth=i,this.store=e,this.funcs=s,this.router=r}ngOnInit(){this.auth.clientSideUser$.pipe((0,h.Q)(this.destroy$)).subscribe(e=>{this.isActive=!!e});const i=this.auth.clientSideUser$.pipe((0,C.p)(e=>!!e),(0,l.T)(e=>`/users/v1/protected/${e.uid}/tray/`));this.hasMessage$=i.pipe((0,d.n)(e=>this.store.collection(e,r=>r.where("hasRead","==",!1)).valueChanges()),(0,l.T)(e=>e.length>0)),(0,E.z)(i,this.query$).pipe((0,d.n)(([e,s])=>this.store.collection(e,f=>s(f.orderBy("createdAt","desc"))).valueChanges({idField:"id"})),(0,h.Q)(this.destroy$)).subscribe(e=>{if(0===e.length)return this.notifications=this.notificationsSave,this.pageNavigationState="nomore",void this.message$.next("\u3053\u308c\u4ee5\u4e0a\u901a\u77e5\u306f\u3042\u308a\u307e\u305b\u3093\u3002");this.pageNavigationState="enter",this.notifications=e}),this.pagingMessage$=(0,T.h)(this.message$,this.message$.pipe((0,x.B)(2e3),(0,l.T)(()=>null)),this.clickModal$.pipe((0,l.T)(()=>null)))}ngOnDestroy(){this.destroy$.next()}onClickTraySpinner(i){(0,_.Oi)("onClickTraySpinner()",i),this.trayLeft$.next(i.x-300),this.isShowingList=!0}prepareToClick(i){i.stopPropagation(),this.clickModal$.next()}onClickRead(i,e){var s=this;return(0,g.A)(function*(){(0,_.Oi)("onClickRead()",i),s.prepareToClick(i);const r={id:e.id};yield s.funcs.call("setDoneTray",r)})()}onClickReadAll(i){var e=this;return(0,g.A)(function*(){(0,_.Oi)("onClickReadAll()",i),e.prepareToClick(i),yield e.funcs.call("setDoneTrayAll")})()}onClickNext(i){if((0,_.Oi)("onClickNext()",i),this.prepareToClick(i),this.pageNavigationState="next",0===this.notifications.length)return void this.query$.next(s=>s);const e=this.notifications[0];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.endBefore(e.createdAt).limitToLast(this.NotificationLimit))}onClickPrevious(i){if((0,_.Oi)("onClickPrevious()",i),this.prepareToClick(i),0===this.notifications.length)return;this.pageNavigationState="previous";const e=this.notifications[this.notifications.length-1];this.notificationsSave=this.notifications,this.notifications=[],this.query$.next(s=>s.startAfter(e.createdAt).limit(this.NotificationLimit))}static \u0275fac=function(e){return new(e||o)(t.rXU(M.u),t.rXU(k.Qe),t.rXU(P.Y),t.rXU(D.O))};static \u0275cmp=t.VBU({type:o,selectors:[["app-user-tray"]],decls:1,vars:1,consts:[[4,"ngIf"],["data-bs-toggle","dropdown",3,"click"],["src","/assets/octicons/bell.svg",1,"",2,"width","100%","cursor","pointer"],["style","position: absolute; top: 0px;",4,"ngIf"],[1,"dropdown-menu",2,"max-height","400px","width","400px","position","fixed","top","50px"],[2,"position","absolute","top","0px"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning"],[1,"visually-hidden"],[1,"m-3"],[1,"m-2"],["title","\u65b0\u3057\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-left.svg",1,"mx-3"],["title","\u53e4\u3044\u901a\u77e5\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002",1,"btn","btn-outline-info","btn-sm","mx-1",3,"click"],["src","/assets/octicons/arrow-right.svg",1,"mx-3"],["class","text-warning mx-2",4,"ngIf"],[2,"height","250px","overflow-y","scroll","overflow-x","hidden"],[2,"width","100%"],["class","m-3",4,"ngFor","ngForOf"],["title","\u3059\u3079\u3066\u65e2\u8aad\u306b\u3057\u307e\u3059",1,"btn","btn-warning",3,"click"],["src","/assets/octicons/check.svg",1,"mx-2"],[1,"text-warning","mx-2"],[2,"overflow-x","hidden",3,"title"],[3,"title"],["routerLink","/Gitfire/tray",3,"queryParams"],["type","checkbox","title","\u65e2\u8aad\u306b\u3059\u308b\u5834\u5408\u306f check \u3057\u3066\u304f\u3060\u3055\u3044\u3002",1,"m-2",3,"click","disabled","checked"],[3,"routerLink","fragment"]],template:function(e,s){1&e&&t.DNE(0,j,8,8,"ng-container",0),2&e&&t.Y8G("ngIf",s.isActive)},dependencies:[u.Sq,u.bT,R.Wk,u.Jj,u.vh,O.C],styles:["[_nghost-%COMP%]{cursor:initial}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:snow}"],data:{animation:[(0,n.hZ)("shakeItTrigger",[(0,n.kY)(":leave",[(0,n.iF)({transform:"none",position:"absolute"}),(0,n.i0)("300ms ease-in-out",(0,n.iF)({opacity:0,transform:"translateY(-100%)"}))]),(0,n.kY)(":enter",[(0,n.iF)({transform:"none",position:"absolute"}),(0,n.i0)("1000ms ease-in-out",(0,n.i7)([(0,n.iF)({transform:"translate3d(-4px, 0, 0)",offset:.1}),(0,n.iF)({transform:"translate3d(4px, 0, 0)",offset:.2}),(0,n.iF)({transform:"translate3d(-3px, 0, 0)",offset:.3}),(0,n.iF)({transform:"translate3d(3px, 0, 0)",offset:.4}),(0,n.iF)({transform:"translate3d(-3px, 0, 0)",offset:.5}),(0,n.iF)({transform:"translate3d(2px, 0, 0)",offset:.6}),(0,n.iF)({transform:"translate3d(-2px, 0, 0)",offset:.7}),(0,n.iF)({transform:"translate3d(1px, 0, 0)",offset:.8}),(0,n.iF)({transform:"translate3d(-1px, 0, 0)",offset:.9})]))])]),(0,n.hZ)("notificationItemTrigger",[(0,n.kY)(":enter",[(0,n.P)("tr",[(0,n.iF)({opacity:0,transform:"translateX(-100%)"}),(0,n.yc)(20,[(0,n.i0)("300ms ease-in-out",(0,n.iF)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.kY)("* => previous",[(0,n.P)("tr",[(0,n.iF)({}),(0,n.yc)(20,[(0,n.i0)("300ms ease-in-out",(0,n.iF)({opacity:0,transform:"translateX(-100%)"}))])],{optional:!0})]),(0,n.kY)("previous => enter",[(0,n.P)("tr",[(0,n.iF)({opacity:0,transform:"translateX(100%)"}),(0,n.yc)(20,[(0,n.i0)("300ms 100ms ease-in-out",(0,n.iF)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.kY)("* => next",[(0,n.P)("tr",[(0,n.iF)({}),(0,n.yc)(20,[(0,n.i0)("300ms ease-in-out",(0,n.iF)({opacity:0,transform:"translateX(100%)"}))])],{optional:!0})]),(0,n.kY)("next => enter",[(0,n.P)("tr",[(0,n.iF)({opacity:0,transform:"translateX(-100%)"}),(0,n.yc)(20,[(0,n.i0)("300ms 100ms ease-in-out",(0,n.iF)({opacity:1,transform:"none"}))])],{optional:!0})]),(0,n.kY)("* => nomore",[(0,n.iF)({opacity:0,backgroundColor:"red"}),(0,n.i0)("300ms 100ms ease-in-out",(0,n.iF)({opacity:1,backgroundColor:"*"}))])])]}})}return o})()}}]);