"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[846],{8846:(I,c,i)=>{i.r(c),i.d(c,{UserStatusComponent:()=>O});var g=i(5861),m=i(8645),l=i(9773),d=i(108),h=i(7142),t=i(9212),f=i(434),U=i(2423),x=i(2425),p=i(5187),_=i(6814),a=i(6223),C=i(1992);const E=["loginForm"];function v(e,u){1&e&&(t.ynx(0),t._UZ(1,"span",3),t.BQk())}function M(e,u){1&e&&(t.TgZ(0,"div",15),t._UZ(1,"app-oauth-federations",16),t.qZA()),2&e&&(t.xp6(1),t.Q6J("isTiny",!0))}function Z(e,u){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"form",4,5)(3,"div",6)(4,"label",7),t._uU(5,"Email"),t.qZA(),t.TgZ(6,"input",8),t.NdJ("ngModelChange",function(s){t.CHM(n);const r=t.oxw();return t.KtG(r.emailInput=s)}),t.qZA()(),t.TgZ(7,"div",6)(8,"label",9),t._uU(9,"Password"),t.qZA(),t.TgZ(10,"input",10),t.NdJ("ngModelChange",function(s){t.CHM(n);const r=t.oxw();return t.KtG(r.passwordInput=s)}),t.qZA()(),t.TgZ(11,"div",6)(12,"button",11),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw();return t.KtG(r.doLogin(s))}),t._uU(13,"Login"),t.qZA(),t.YNc(14,M,2,1,"div",12),t.qZA()(),t._UZ(15,"hr"),t.TgZ(16,"div",13)(17,"a",14),t._uU(18,"\u305d\u306e\u4ed6\u306e\u6a5f\u80fd"),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(6),t.Q6J("ngModel",n.emailInput),t.xp6(4),t.Q6J("ngModel",n.passwordInput),t.xp6(4),t.Q6J("ngIf",!1)}}function P(e,u){if(1&e&&t._UZ(0,"img",33),2&e){const n=t.oxw(3);t.s9C("src",n.status.photoUrl,t.LSH)}}function T(e,u){1&e&&t._UZ(0,"span",34)}function y(e,u){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",13)(2,"div")(3,"div",18),t._uU(4),t.qZA(),t.TgZ(5,"div",13),t.YNc(6,P,1,1,"img",19)(7,T,1,0,"span",20),t.qZA(),t.TgZ(8,"div",21)(9,"div",22)(10,"a",23),t._UZ(11,"img",24),t._uU(12,"Chat"),t.qZA()(),t.TgZ(13,"div",22)(14,"a",25),t._UZ(15,"img",26),t._uU(16,"Post"),t.qZA()()(),t.TgZ(17,"div",18)(18,"a",27),t._UZ(19,"img",28),t._uU(20,"\u8a2d\u5b9a"),t.qZA()(),t.TgZ(21,"div",18)(22,"button",11),t.NdJ("click",function(s){t.CHM(n);const r=t.oxw(2);return t.KtG(r.doLogout(s))}),t._UZ(23,"img",29),t._uU(24,"\u30ed\u30b0\u30a2\u30a6\u30c8"),t.qZA()()(),t._UZ(25,"hr"),t.TgZ(26,"div",30)(27,"div")(28,"a",31),t._uU(29,"\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc"),t.qZA(),t._uU(30,"\u30fb"),t.TgZ(31,"a",32),t._uU(32,"\u5229\u7528\u898f\u7d04"),t.qZA()()()(),t.BQk()}if(2&e){const n=u.$implicit,o=t.oxw(2);t.xp6(4),t.Oqu(n.displayName),t.xp6(2),t.Q6J("ngIf",o.status.photoUrl),t.xp6(1),t.Q6J("ngIf",!o.status.photoUrl)}}function A(e,u){if(1&e&&(t.ynx(0),t.YNc(1,y,33,3,"ng-container",17),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.status.user)}}class D{state="checking";user;photoUrl}let O=(()=>{class e{auth;localSession;toastr;router;status=new D;destroy$=new m.x;emailInput;passwordInput;loginForm;constructor(n,o,s,r){this.auth=n,this.localSession=o,this.toastr=s,this.router=r}ngOnDestroy(){this.destroy$.next()}ngOnInit(){this.auth.user.pipe((0,l.R)(this.destroy$)).subscribe(n=>{this.status.state=n&&this.localSession.isSeemsLogin?"login":"logout",this.status.user=n}),this.localSession.loginPhoto$().pipe((0,l.R)(this.destroy$)).subscribe(n=>{this.status.photoUrl=n})}doLogin(n){var o=this;return(0,g.Z)(function*(){if(n.preventDefault(),n.stopPropagation(),o.loginForm.invalid)o.toastr.error("\u5165\u529b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else try{yield o.auth.setPersistence(h.Z.auth.Auth.Persistence.SESSION),yield o.auth.signInWithEmailAndPassword(o.emailInput,o.passwordInput)}catch(s){o.toastr.error(`Login \u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002(${s.code}: ${s.message})`)}})()}doLogout(n){var o=this;return(0,g.Z)(function*(){n.preventDefault();try{yield o.auth.signOut(),o.router.navigate(["/"])}catch(s){(0,d.wb)("UserStatusComponent.doLogout() is failed",s)}})()}static \u0275fac=function(o){return new(o||e)(t.Y36(f.zQ),t.Y36(U.m),t.Y36(x._W),t.Y36(p.F0))};static \u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&t.Gf(E,5),2&o){let r;t.iGM(r=t.CRH())&&(s.loginForm=r.first)}},decls:5,vars:4,consts:[[1,"px-2","py-3"],[3,"ngSwitch"],[4,"ngSwitchCase"],["role","status",1,"spinner-border","text-primary"],[1,"form-group"],["loginForm","ngForm"],[1,"my-1"],["for","appGitfireUserStatusEmailInput",1,"visually-hidden"],["id","appGitfireUserStatusEmailInput","name","email","placeholder","email@example.com","type","email","required","","autocomplete","email","autofill","",1,"form-control",3,"ngModel","ngModelChange"],["for","appGitfireUserStatusPasswordInput",1,"visually-hidden"],["id","appGitfireUserStatusPasswordInput","name","password","placeholder","Password","type","password","autocomplete","current-password","required","","autofill","",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary",3,"click"],["class","my-2",4,"ngIf"],[1,"text-center"],["routerLink","/Gitfire/login",1,"text-muted","fw-light","footnote"],[1,"my-2"],[3,"isTiny"],[4,"ngIf"],[1,"m-3"],["class","rounded user-icon",3,"src",4,"ngIf"],["class","spinner-border text-primary user-icon","role","status",4,"ngIf"],[1,"m-3","row"],[1,"col-6"],["routerLink","/Gitfire/chat"],["src","/assets/octicons/comment-discussion.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/post"],["src","/assets/octicons/cloud-upload.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/settings"],["src","/assets/octicons/tools.svg",1,"m-1","gitfire-link-icon","octicon-info"],["src","/assets/octicons/sign-out.svg",1,"m-1","gitfire-link-icon","octicon-info"],[1,"m-3","footnote"],["href","/policy.htm","about","_blank",1,"text-muted","fw-light"],["href","/terms.htm","about","_blank",1,"text-muted","fw-light"],[1,"rounded","user-icon",3,"src"],["role","status",1,"spinner-border","text-primary","user-icon"]],template:function(o,s){1&o&&(t.TgZ(0,"div",0),t.ynx(1,1),t.YNc(2,v,2,0,"ng-container",2)(3,Z,19,3,"ng-container",2)(4,A,2,1,"ng-container",2),t.BQk(),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngSwitch",s.status.state),t.xp6(1),t.Q6J("ngSwitchCase","checking"),t.xp6(1),t.Q6J("ngSwitchCase","logout"),t.xp6(1),t.Q6J("ngSwitchCase","login"))},dependencies:[_.O5,_.RF,_.n9,a._Y,a.Fj,a.JJ,a.JL,a.Q7,a.On,a.F,p.rH,C.x],styles:["[_nghost-%COMP%]{cursor:initial}.footnote[_ngcontent-%COMP%]{font-size:.7rem}.user-icon[_ngcontent-%COMP%]{width:128px;height:128px}.gitfire-link-icon[_ngcontent-%COMP%]{width:24px;height:24px}.oauth-tiny-wide-img[_ngcontent-%COMP%]{height:30px}.oauth-tiny-circle-img[_ngcontent-%COMP%]{width:30px}"]})}return e})()}}]);