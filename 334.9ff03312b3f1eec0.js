"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[334],{8334:(JT,wg,oe)=>{oe.d(wg,{Qe:()=>pT});var Rg=oe(177),re=oe(2615),Eo=oe(3664),Pg=oe(5407),Vg=oe(4121),ji=oe(9253),Pt=oe(1152),Sg=oe(3236),bg=oe(1985),zi=oe(8455),jc=oe(7673),Ze=oe(9079),vo=oe(9172),xg=oe(9974),Cg=oe(4360);function Ao(){return(0,xg.N)((r,e)=>{let t,n=!1;r.subscribe((0,Cg._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var Vt,Qc,it=oe(6354),wo=oe(2816),Dg=oe(3294),zc=oe(5964),Ng=(oe(2268),oe(9574)),x=oe(467),Sr=oe(1631),Kc=oe(8779),st=oe(5398),W=oe(1871),Gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$c={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,_,I){I||(I=0);var E=Array(16);if("string"==typeof _)for(var v=0;16>v;++v)E[v]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;var V=T.g[3],y=(_=T.g[0])+(V^(I=T.g[1])&((v=T.g[2])^V))+E[0]+3614090360&4294967295;y=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=(I=(v=(V=(_=I+(y<<7&4294967295|y>>>25))+((y=V+(v^_&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^V&(_^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(_^v&(V^_))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=_+(V^I&(v^V))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=V+(v^_&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^V&(_^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(_^v&(V^_))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=_+(V^I&(v^V))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=V+(v^_&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^V&(_^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(_^v&(V^_))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=_+(V^I&(v^V))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=V+(v^_&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^V&(_^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(_^v&(V^_))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=_+(v^V&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=V+(I^v&(_^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(_^I&(V^_))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(V^_&(v^V))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=_+(v^V&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=V+(I^v&(_^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(_^I&(V^_))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(V^_&(v^V))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=_+(v^V&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=V+(I^v&(_^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(_^I&(V^_))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(V^_&(v^V))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=_+(v^V&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=V+(I^v&(_^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(_^I&(V^_))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(V^_&(v^V))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=_+(I^v^V)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=V+(_^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(V^_^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^V^_)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=_+(I^v^V)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=V+(_^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(V^_^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^V^_)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=_+(I^v^V)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=V+(_^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(V^_^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^V^_)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=_+(I^v^V)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=V+(_^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(V^_^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^V^_)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=_+(v^(I|~V))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=V+(I^(_|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(_^(V|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(V^(v|~_))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=_+(v^(I|~V))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=V+(I^(_|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(_^(V|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(V^(v|~_))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=_+(v^(I|~V))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=V+(I^(_|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(_^(V|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(V^(v|~_))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((V=(_=I+((y=_+(v^(I|~V))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=V+(I^(_|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=V+((y=v+(_^(V|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+V&4294967295}function a(T,_){this.h=_;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var V=0|T[v];E&&V==_||(I[v]=V,E=!1)}this.g=I}(function e(T,_){function I(){}I.prototype=_.prototype,T.D=_.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,V){for(var y=Array(arguments.length-2),At=2;At<arguments.length;At++)y[At-2]=arguments[At];return _.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,_){void 0===_&&(_=T.length);for(var I=_-this.blockSize,E=this.B,v=this.h,V=0;V<_;){if(0==v)for(;V<=I;)i(this,T,V),V+=this.blockSize;if("string"==typeof T){for(;V<_;)if(E[v++]=T.charCodeAt(V++),v==this.blockSize){i(this,E),v=0;break}}else for(;V<_;)if(E[v++]=T[V++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=_},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var I=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=255&I,I/=256;for(this.u(T),T=Array(16),_=I=0;4>_;++_)for(var E=0;32>E;E+=8)T[I++]=this.g[_]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,_){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=_(T)}(T,function(_){return new a([0|_],0>_?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return D(h(-T));for(var _=[],I=1,E=0;T>=I;E++)_[E]=T/I|0,I*=4294967296;return new a(_,0)}var m=c(0),p=c(1),A=c(16777216);function b(T){if(0!=T.h)return!1;for(var _=0;_<T.g.length;_++)if(0!=T.g[_])return!1;return!0}function N(T){return-1==T.h}function D(T){for(var _=T.g.length,I=[],E=0;E<_;E++)I[E]=~T.g[E];return new a(I,~T.h).add(p)}function L(T,_){return T.add(D(_))}function j(T,_){for(;(65535&T[_])!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function B(T,_){this.g=T,this.h=_}function G(T,_){if(b(_))throw Error("division by zero");if(b(T))return new B(m,m);if(N(T))return _=G(D(T),_),new B(D(_.g),D(_.h));if(N(_))return _=G(T,D(_)),new B(D(_.g),_.h);if(30<T.g.length){if(N(T)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var I=p,E=_;0>=E.l(T);)I=J(I),E=J(E);var v=Q(I,1),V=Q(E,1);for(E=Q(E,2),I=Q(I,2);!b(E);){var y=V.add(E);0>=y.l(T)&&(v=v.add(I),V=y),E=Q(E,1),I=Q(I,1)}return _=L(T,v.j(_)),new B(v,_)}for(v=m;0<=T.l(_);){for(I=Math.max(1,Math.floor(T.m()/_.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(V=h(I)).j(_);N(y)||0<y.l(T);)y=(V=h(I-=E)).j(_);b(V)&&(V=p),v=v.add(V),T=L(T,y)}return new B(v,T)}function J(T){for(var _=T.g.length+1,I=[],E=0;E<_;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(I,T.h)}function Q(T,_){var I=_>>5;_%=32;for(var E=T.g.length-I,v=[],V=0;V<E;V++)v[V]=0<_?T.i(V+I)>>>_|T.i(V+I+1)<<32-_:T.i(V+I);return new a(v,T.h)}(r=a.prototype).m=function(){if(N(this))return-D(this).m();for(var T=0,_=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(N(this))return"-"+D(this).toString(T);for(var _=h(Math.pow(T,6)),I=this,E="";;){var v=G(I,_).g,V=((0<(I=L(I,v.j(_))).g.length?I.g[0]:I.h)>>>0).toString(T);if(b(I=v))return V+E;for(;6>V.length;)V="0"+V;E=V+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return N(T=L(this,T))?-1:b(T)?0:1},r.abs=function(){return N(this)?D(this):this},r.add=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=_;v++){var V=E+(65535&this.i(v))+(65535&T.i(v)),y=(V>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(V&=65535)}return new a(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(b(this)||b(T))return m;if(N(this))return N(T)?D(this).j(D(T)):D(D(this).j(T));if(N(T))return D(this.j(D(T)));if(0>this.l(A)&&0>T.l(A))return h(this.m()*T.m());for(var _=this.g.length+T.g.length,I=[],E=0;E<2*_;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var V=this.i(E)>>>16,y=65535&this.i(E),At=T.i(v)>>>16,Ai=65535&T.i(v);I[2*E+2*v]+=y*Ai,j(I,2*E+2*v),I[2*E+2*v+1]+=V*Ai,j(I,2*E+2*v+1),I[2*E+2*v+1]+=y*At,j(I,2*E+2*v+1),I[2*E+2*v+2]+=V*At,j(I,2*E+2*v+2)}for(E=0;E<_;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=_;E<2*_;E++)I[E]=0;return new a(I,0)},r.A=function(T){return G(this,T).h},r.and=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)&T.i(E);return new a(I,this.h&T.h)},r.or=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)|T.i(E);return new a(I,this.h|T.h)},r.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],E=0;E<_;E++)I[E]=this.i(E)^T.i(E);return new a(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Qc=$c.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,_){if(0==T.length)throw Error("number format error: empty string");if(2>(_=_||10)||36<_)throw Error("radix out of range: "+_);if("-"==T.charAt(0))return D(f(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(_,8)),E=m,v=0;v<T.length;v+=8){var V=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+V),_);8>V?(V=h(Math.pow(_,V)),E=E.j(V).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},Vt=$c.Integer=a}).apply(typeof Gc<"u"?Gc:typeof self<"u"?self:typeof window<"u"?window:{});var Wc,br,Hc,Gi,Ro,Xc,Jc,Yc,Ki=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mt={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ki&&Ki];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var g=0;g<o.length-1;g++){var w=o[g];if(!(w in d))break e;d=d[w]}(l=l(g=d[o=o[o.length-1]]))!=g&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,g=!1,w={next:function(){if(!g&&d<o.length){var S=d++;return{value:l(S,o[S]),done:!1}}return g=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function m(o,l,d){if(!o)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,g),o.apply(l,w)}}return function(){return o.apply(l,arguments)}}function p(o,l,d){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:m).apply(null,arguments)}function A(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),o.apply(this,g)}}function b(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(g,w,S){for(var M=Array(arguments.length-2),ue=2;ue<arguments.length;ue++)M[ue-2]=arguments[ue];return l.prototype[w].apply(g,M)}}function N(o){const l=o.length;if(0<l){const d=Array(l);for(let g=0;g<l;g++)d[g]=o[g];return d}return[]}function D(o,l){for(let d=1;d<arguments.length;d++){const g=arguments[d];if(c(g)){const w=o.length||0,S=g.length||0;o.length=w+S;for(let M=0;M<S;M++)o[w+M]=g[M]}else o.push(g)}}function j(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function G(o){return G[" "](o),o}G[" "]=function(){};var J=!(-1==B().indexOf("Gecko")||-1!=B().toLowerCase().indexOf("webkit")&&-1==B().indexOf("Edge")||-1!=B().indexOf("Trident")||-1!=B().indexOf("MSIE")||-1!=B().indexOf("Edge"));function Q(o,l,d){for(const g in o)l.call(d,o[g],g,o)}function _(o){const l={};for(const d in o)l[d]=o[d];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let d,g;for(let w=1;w<arguments.length;w++){for(d in g=arguments[w],g)o[d]=g[d];for(let S=0;S<I.length;S++)d=I[S],Object.prototype.hasOwnProperty.call(g,d)&&(o[d]=g[d])}}function v(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function V(o){u.setTimeout(()=>{throw o},0)}function y(){var o=_c;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var Ai=new class L{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new _T,o=>o.reset());class _T{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let wi,Ri=!1,_c=new class At{constructor(){this.h=this.g=null}add(l,d){const g=Ai.get();g.set(l,d),this.h?this.h.next=g:this.g=g,this.h=g}},Am=()=>{const o=u.Promise.resolve(void 0);wi=()=>{o.then(yT)}};var yT=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){V(d)}var l=Ai;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Ri=!1};function Jt(){this.s=this.s,this.C=this.C}function Me(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Jt.prototype.s=!1,Jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Me.prototype.h=function(){this.defaultPrevented=!0};var IT=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Pi(o,l){if(Me.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(J){e:{try{G(l.nodeName);var w=!0;break e}catch{}w=!1}w||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,g?(this.clientX=void 0!==g.clientX?g.clientX:g.pageX,this.clientY=void 0!==g.clientY?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:TT[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Pi.aa.h.call(this)}}b(Pi,Me);var TT={2:"touch",3:"pen",4:"mouse"};Pi.prototype.h=function(){Pi.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Vi="closure_listenable_"+(1e6*Math.random()|0),ET=0;function vT(o,l,d,g,w){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!g,this.ha=w,this.key=++ET,this.da=this.fa=!1}function ro(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function io(o){this.src=o,this.g={},this.h=0}function yc(o,l){var d=l.type;if(d in o.g){var S,g=o.g[d],w=Array.prototype.indexOf.call(g,l,void 0);(S=0<=w)&&Array.prototype.splice.call(g,w,1),S&&(ro(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function Ic(o,l,d,g){for(var w=0;w<o.length;++w){var S=o[w];if(!S.da&&S.listener==l&&S.capture==!!d&&S.ha==g)return w}return-1}io.prototype.add=function(o,l,d,g,w){var S=o.toString();(o=this.g[S])||(o=this.g[S]=[],this.h++);var M=Ic(o,l,g,w);return-1<M?(l=o[M],d||(l.fa=!1)):((l=new vT(l,this.src,S,!!g,w)).fa=d,o.push(l)),l};var Tc="closure_lm_"+(1e6*Math.random()|0),Ec={};function wm(o,l,d,g,w){if(g&&g.once)return Pm(o,l,d,g,w);if(Array.isArray(l)){for(var S=0;S<l.length;S++)wm(o,l[S],d,g,w);return null}return d=Rc(d),o&&o[Vi]?o.K(l,d,h(g)?!!g.capture:!!g,w):Rm(o,l,d,!1,g,w)}function Rm(o,l,d,g,w,S){if(!l)throw Error("Invalid event type");var M=h(w)?!!w.capture:!!w,ue=Ac(o);if(ue||(o[Tc]=ue=new io(o)),(d=ue.add(l,d,g,M,S)).proxy)return d;if(g=function AT(){const l=wT;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=g,g.src=o,g.listener=d,o.addEventListener)IT||(w=M),void 0===w&&(w=!1),o.addEventListener(l.toString(),g,w);else if(o.attachEvent)o.attachEvent(Sm(l.toString()),g);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(g)}return d}function Pm(o,l,d,g,w){if(Array.isArray(l)){for(var S=0;S<l.length;S++)Pm(o,l[S],d,g,w);return null}return d=Rc(d),o&&o[Vi]?o.L(l,d,h(g)?!!g.capture:!!g,w):Rm(o,l,d,!0,g,w)}function Vm(o,l,d,g,w){if(Array.isArray(l))for(var S=0;S<l.length;S++)Vm(o,l[S],d,g,w);else g=h(g)?!!g.capture:!!g,d=Rc(d),o&&o[Vi]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=Ic(S=o.g[l],d,g,w))&&(ro(S[d]),Array.prototype.splice.call(S,d,1),0==S.length&&(delete o.g[l],o.h--))):o&&(o=Ac(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Ic(l,d,g,w)),(d=-1<o?l[o]:null)&&vc(d))}function vc(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Vi])yc(l.i,o);else{var d=o.type,g=o.proxy;l.removeEventListener?l.removeEventListener(d,g,o.capture):l.detachEvent?l.detachEvent(Sm(d),g):l.addListener&&l.removeListener&&l.removeListener(g),(d=Ac(l))?(yc(d,o),0==d.h&&(d.src=null,l[Tc]=null)):ro(o)}}}function Sm(o){return o in Ec?Ec[o]:Ec[o]="on"+o}function wT(o,l){if(o.da)o=!0;else{l=new Pi(l,this);var d=o.listener,g=o.ha||o.src;o.fa&&vc(o),o=d.call(g,l)}return o}function Ac(o){return(o=o[Tc])instanceof io?o:null}var wc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rc(o){return"function"==typeof o?o:(o[wc]||(o[wc]=function(l){return o.handleEvent(l)}),o[wc])}function Le(){Jt.call(this),this.i=new io(this),this.M=this,this.F=null}function Ke(o,l){var d,g=o.F;if(g)for(d=[];g;g=g.F)d.push(g);if(o=o.M,g=l.type||l,"string"==typeof l)l=new Me(l,o);else if(l instanceof Me)l.target=l.target||o;else{var w=l;E(l=new Me(g,o),w)}if(w=!0,d)for(var S=d.length-1;0<=S;S--){var M=l.g=d[S];w=so(M,g,!0,l)&&w}if(w=so(M=l.g=o,g,!0,l)&&w,w=so(M,g,!1,l)&&w,d)for(S=0;S<d.length;S++)w=so(M=l.g=d[S],g,!1,l)&&w}function so(o,l,d,g){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var w=!0,S=0;S<l.length;++S){var M=l[S];if(M&&!M.da&&M.capture==d){var ue=M.listener,be=M.ha||M.src;M.fa&&yc(o.i,M),w=!1!==ue.call(be,g)&&w}}return w&&!g.defaultPrevented}function bm(o,l,d){if("function"==typeof o)d&&(o=p(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=p(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function xm(o){o.g=bm(()=>{o.g=null,o.i&&(o.i=!1,xm(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}b(Le,Jt),Le.prototype[Vi]=!0,Le.prototype.removeEventListener=function(o,l,d,g){Vm(this,o,l,d,g)},Le.prototype.N=function(){if(Le.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],g=0;g<d.length;g++)ro(d[g]);delete o.g[l],o.h--}}this.F=null},Le.prototype.K=function(o,l,d,g){return this.i.add(String(o),l,!1,d,g)},Le.prototype.L=function(o,l,d,g){return this.i.add(String(o),l,!0,d,g)};class RT extends Jt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:xm(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Si(o){Jt.call(this),this.h=o,this.g={}}b(Si,Jt);var Cm=[];function Dm(o){Q(o.g,function(l,d){this.g.hasOwnProperty(d)&&vc(l)},o),o.g={}}Si.prototype.N=function(){Si.aa.N.call(this),Dm(this)},Si.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pc=u.JSON.stringify,PT=u.JSON.parse,VT=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Vc(){}function km(){}Vc.prototype.h=null;var bi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Sc(){Me.call(this,"d")}function bc(){Me.call(this,"c")}b(Sc,Me),b(bc,Me);var xn={},Fm=null;function oo(){return Fm=Fm||new Le}function Om(o){Me.call(this,xn.La,o)}function xi(o){const l=oo();Ke(l,new Om(l))}function Mm(o,l){Me.call(this,xn.STAT_EVENT,o),this.stat=l}function Ge(o){const l=oo();Ke(l,new Mm(l,o))}function Lm(o,l){Me.call(this,xn.Ma,o),this.size=l}function Ci(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function Di(){this.g=!0}function wr(o,l,d,g){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function CT(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var g=d[o];if(!(2>g.length)){var w=g[1];if(Array.isArray(w)&&!(1>w.length)){var S=w[0];if("noop"!=S&&"stop"!=S&&"close"!=S)for(var M=1;M<w.length;M++)w[M]=""}}}return Pc(d)}catch{return l}}(o,d)+(g?" "+g:"")})}xn.La="serverreachability",b(Om,Me),xn.STAT_EVENT="statevent",b(Mm,Me),xn.Ma="timingevent",b(Lm,Me),Di.prototype.xa=function(){this.g=!1},Di.prototype.info=function(){};var xc,ao={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function uo(){}function Yt(o,l,d,g){this.j=o,this.i=l,this.l=d,this.R=g||1,this.U=new Si(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bm}function Bm(){this.i=null,this.g="",this.h=!1}b(uo,Vc),uo.prototype.g=function(){return new XMLHttpRequest},uo.prototype.i=function(){return{}},xc=new uo;var Um={},Cc={};function Dc(o,l,d){o.L=1,o.v=fo(wt(l)),o.m=d,o.P=!0,jm(o,null)}function jm(o,l){o.F=Date.now(),co(o),o.A=wt(o.v);var d=o.A,g=o.R;Array.isArray(g)||(g=[String(g)]),ng(d.i,"t",g),o.C=0,d=o.j.J,o.h=new Bm,o.g=Tg(o.j,d?l:null,!o.m),0<o.O&&(o.M=new RT(p(o.Y,o,o.g),o.O)),l=o.U,d=o.g,g=o.ca;var w="readystatechange";Array.isArray(w)||(w&&(Cm[0]=w.toString()),w=Cm);for(var S=0;S<w.length;S++){var M=wm(d,w[S],g||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?_(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),xi(),function ST(o,l,d,g,w,S){o.info(function(){if(o.g)if(S)for(var M="",ue=S.split("&"),be=0;be<ue.length;be++){var te=ue[be].split("=");if(1<te.length){var qe=te[0];te=te[1];var Be=qe.split("_");M=2<=Be.length&&"type"==Be[1]?M+(qe+"=")+te+"&":M+(qe+"=redacted&")}}else M=null;else M=S;return"XMLHTTP REQ ("+g+") [attempt "+w+"]: "+l+"\n"+d+"\n"+M})}(o.i,o.u,o.A,o.l,o.R,o.m)}function zm(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function DT(o,l){var d=o.C,g=l.indexOf("\n",d);return-1==g?Cc:(d=Number(l.substring(d,g)),isNaN(d)?Um:(g+=1)+d>l.length?Cc:(l=l.slice(g,g+d),o.C=g+d,l))}function co(o){o.S=Date.now()+o.I,Km(o,o.I)}function Km(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=Ci(p(o.ba,o),l)}function Nc(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function Ni(o){0==o.j.G||o.J||pg(o.j,o)}function Cn(o){Nc(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,Dm(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function kc(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Fc(d.h,o)))if(!o.K&&Fc(d.h,o)&&3==d.G){try{var g=d.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&3==g.length){var w=g;if(0==w[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;yo(d),po(d)}qc(d),Ge(18)}}else d.za=w[1],0<d.za-d.T&&37500>w[2]&&d.F&&0==d.v&&!d.C&&(d.C=Ci(p(d.Za,d),6e3));if(1>=Qm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Nn(d,11)}else if((o.K||d.g==o)&&yo(d),!j(l))for(w=d.Da.g.parse(l),l=0;l<w.length;l++){let te=w[l];if(d.T=te[0],te=te[1],2==d.G)if("c"==te[0]){d.K=te[1],d.ia=te[2];const qe=te[3];null!=qe&&(d.la=qe,d.j.info("VER="+d.la));const Be=te[4];null!=Be&&(d.Aa=Be,d.j.info("SVER="+d.Aa));const Vr=te[5];null!=Vr&&"number"==typeof Vr&&0<Vr&&(d.L=g=1.5*Vr,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const rt=o.g;if(rt){const To=rt.g?rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(To){var S=g.h;S.g||-1==To.indexOf("spdy")&&-1==To.indexOf("quic")&&-1==To.indexOf("h2")||(S.j=S.l,S.g=new Set,S.h&&(Oc(S,S.h),S.h=null))}if(g.D){const Uc=rt.g?rt.g.getResponseHeader("X-HTTP-Session-Id"):null;Uc&&(g.ya=Uc,de(g.I,g.D,Uc))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var M=o;if((g=d).qa=Ig(g,g.J?g.ia:null,g.W),M.K){Wm(g.h,M);var ue=M,be=g.L;be&&(ue.I=be),ue.B&&(Nc(ue),co(ue)),g.g=M}else mg(g);0<d.i.length&&_o(d)}else"stop"!=te[0]&&"close"!=te[0]||Nn(d,7);else 3==d.G&&("stop"==te[0]||"close"==te[0]?"stop"==te[0]?Nn(d,7):Lc(d):"noop"!=te[0]&&d.l&&d.l.ta(te),d.v=0)}xi()}catch{}}Yt.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==Rt(o)?l.j():this.Y(o)},Yt.prototype.Y=function(o){try{if(o==this.g)e:{const Be=Rt(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Be)&&(3!=Be||this.g&&(this.h.h||this.g.oa()||cg(this.g)))){this.J||4!=Be||7==l||xi(),Nc(this);var d=this.g.Z();this.X=d;t:if(zm(this)){var g=cg(this.g);o="";var w=g.length,S=4==Rt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Cn(this),Ni(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<w;l++)this.h.h=!0,o+=this.h.i.decode(g[l],{stream:!(S&&l==w-1)});g.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=200==d,function bT(o,l,d,g,w,S,M){o.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+w+"]: "+l+"\n"+d+"\n"+S+" "+M})}(this.i,this.u,this.A,this.l,this.R,Be,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ue,be=this.g;if((ue=be.g?be.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(ue)){var te=ue;break t}}te=null}if(!(d=te)){this.o=!1,this.s=3,Ge(12),Cn(this),Ni(this);break e}wr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kc(this,d)}if(this.P){let rt;for(d=!0;!this.J&&this.C<M.length;){if(rt=DT(this,M),rt==Cc){4==Be&&(this.s=4,Ge(14),d=!1),wr(this.i,this.l,null,"[Incomplete Response]");break}if(rt==Um){this.s=4,Ge(15),wr(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}wr(this.i,this.l,rt,null),kc(this,rt)}if(zm(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Be||0!=M.length||this.h.h||(this.s=1,Ge(16),d=!1),this.o=this.o&&d,d){if(0<M.length&&!this.W){this.W=!0;var qe=this.j;qe.g==this&&qe.ba&&!qe.M&&(qe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Bc(qe),qe.M=!0,Ge(11))}}else wr(this.i,this.l,M,"[Invalid Chunked Response]"),Cn(this),Ni(this)}else wr(this.i,this.l,M,null),kc(this,M);4==Be&&Cn(this),this.o&&!this.J&&(4==Be?pg(this.j,this):(this.o=!1,co(this)))}else(function HT(o){const l={};o=(o.g&&2<=Rt(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let g=0;g<o.length;g++){if(j(o[g]))continue;var d=v(o[g]);const w=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const S=l[w]||[];l[w]=S,S.push(d)}!function T(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(g){return g.join(", ")})})(this.g),400==d&&0<M.indexOf("Unknown SID")?(this.s=3,Ge(12)):(this.s=0,Ge(13)),Cn(this),Ni(this)}}}catch{}},Yt.prototype.cancel=function(){this.J=!0,Cn(this)},Yt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function xT(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(xi(),Ge(17)),Cn(this),this.s=2,Ni(this)):Km(this,this.S-o)};var NT=class{constructor(o,l){this.g=o,this.map=l}};function Gm(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function $m(o){return!!o.h||!!o.g&&o.g.size>=o.j}function Qm(o){return o.h?1:o.g?o.g.size:0}function Fc(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function Oc(o,l){o.g?o.g.add(l):o.h=l}function Wm(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function Hm(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return N(o.i)}function Xm(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function FT(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const g in o)l[d++]=g;return l}}}(o),g=function kT(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,g=0;g<d;g++)l.push(o[g]);return l}for(g in l=[],d=0,o)l[d++]=o[g];return l}(o),w=g.length,S=0;S<w;S++)l.call(void 0,g[S],d&&d[S],o)}Gm.prototype.cancel=function(){if(this.i=Hm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var Jm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Dn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Dn){this.h=o.h,lo(this,o.j),this.o=o.o,this.g=o.g,ho(this,o.s),this.l=o.l;var l=o.i,d=new Oi;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Ym(this,d),this.m=o.m}else o&&(l=String(o).match(Jm))?(this.h=!1,lo(this,l[1]||"",!0),this.o=ki(l[2]||""),this.g=ki(l[3]||"",!0),ho(this,l[4]),this.l=ki(l[5]||"",!0),Ym(this,l[6]||"",!0),this.m=ki(l[7]||"")):(this.h=!1,this.i=new Oi(null,this.h))}function wt(o){return new Dn(o)}function lo(o,l,d){o.j=d?ki(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function ho(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Ym(o,l,d){l instanceof Oi?(o.i=l,function jT(o,l){l&&!o.j&&(Zt(o),o.i=null,o.g.forEach(function(d,g){var w=g.toLowerCase();g!=w&&(eg(this,g),ng(this,w,d))},o)),o.j=l}(o.i,o.h)):(d||(l=Fi(l,BT)),o.i=new Oi(l,o.h))}function de(o,l,d){o.i.set(l,d)}function fo(o){return de(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ki(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Fi(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,MT),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function MT(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}Dn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(Fi(l,Zm,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(Fi(l,Zm,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(Fi(d,"/"==d.charAt(0)?qT:LT,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Fi(d,UT)),o.join("")};var Zm=/[#\/\?@]/g,LT=/[#\?:]/g,qT=/[#\?]/g,BT=/[#\?@]/g,UT=/#/g;function Oi(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Zt(o){o.g||(o.g=new Map,o.h=0,o.i&&function OT(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var g=o[d].indexOf("="),w=null;if(0<=g){var S=o[d].substring(0,g);w=o[d].substring(g+1)}else S=o[d];l(S,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function eg(o,l){Zt(o),l=Rr(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function tg(o,l){return Zt(o),l=Rr(o,l),o.g.has(l)}function ng(o,l,d){eg(o,l),0<d.length&&(o.i=null,o.g.set(Rr(o,l),N(d)),o.h+=d.length)}function Rr(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function en(o,l,d,g,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),g(d)}catch{}}function GT(){this.g=new VT}function $T(o,l,d){const g=d||"";try{Xm(o,function(w,S){let M=w;h(w)&&(M=Pc(w)),l.push(g+S+"="+encodeURIComponent(M))})}catch(w){throw l.push(g+"type="+encodeURIComponent("_badmap")),w}}function Mi(o){this.l=o.Ub||null,this.j=o.eb||!1}function mo(o,l){Le.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function rg(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function Li(o){o.readyState=4,o.l=null,o.j=null,o.v=null,qi(o)}function qi(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function ig(o){let l="";return Q(o,function(d,g){l+=g,l+=":",l+=d,l+="\r\n"}),l}function Mc(o,l,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=ig(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):de(o,l,d))}function _e(o){Le.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=Oi.prototype).add=function(o,l){Zt(this),this.i=null,o=Rr(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){Zt(this),this.g.forEach(function(d,g){d.forEach(function(w){o.call(l,w,g,this)},this)},this)},r.na=function(){Zt(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let g=0;g<l.length;g++){const w=o[g];for(let S=0;S<w.length;S++)d.push(l[g])}return d},r.V=function(o){Zt(this);let l=[];if("string"==typeof o)tg(this,o)&&(l=l.concat(this.g.get(Rr(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Zt(this),this.i=null,tg(this,o=Rr(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var g=l[d];const S=encodeURIComponent(String(g)),M=this.V(g);for(g=0;g<M.length;g++){var w=S;""!==M[g]&&(w+="="+encodeURIComponent(String(M[g]))),o.push(w)}}return this.i=o.join("&")},b(Mi,Vc),Mi.prototype.g=function(){return new mo(this.l,this.j)},Mi.prototype.i=function(o){return function(){return o}}({}),b(mo,Le),(r=mo.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,qi(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Li(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,qi(this)),this.g&&(this.readyState=3,qi(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;rg(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Li(this):qi(this),3==this.readyState&&rg(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Li(this))},r.Qa=function(o){this.g&&(this.response=o,Li(this))},r.ga=function(){this.g&&Li(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(mo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),b(_e,Le);var QT=/^https?$/i,WT=["POST","PUT"];function sg(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,og(o),go(o)}function og(o){o.A||(o.A=!0,Ke(o,"complete"),Ke(o,"error"))}function ag(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=Rt(o)||2!=o.Z()))if(o.u&&4==Rt(o))bm(o.Ea,0,o);else if(Ke(o,"readystatechange"),4==Rt(o)){o.h=!1;try{const M=o.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var g;if(g=0===M){var w=String(o.D).match(Jm)[1]||null;!w&&u.self&&u.self.location&&(w=u.self.location.protocol.slice(0,-1)),g=!QT.test(w?w.toLowerCase():"")}d=g}if(d)Ke(o,"complete"),Ke(o,"success");else{o.m=6;try{var S=2<Rt(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",og(o)}}finally{go(o)}}}function go(o,l){if(o.g){ug(o);const d=o.g,g=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ke(o,"ready");try{d.onreadystatechange=g}catch{}}}function ug(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function Rt(o){return o.g?o.g.readyState:0}function cg(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Bi(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function lg(o){this.Aa=0,this.i=[],this.j=new Di,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Bi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Bi("baseRetryDelayMs",5e3,o),this.cb=Bi("retryDelaySeedMs",1e4,o),this.Wa=Bi("forwardChannelMaxRetries",2,o),this.wa=Bi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Gm(o&&o.concurrentRequestLimit),this.Da=new GT,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Lc(o){if(hg(o),3==o.G){var l=o.U++,d=wt(o.I);if(de(d,"SID",o.K),de(d,"RID",l),de(d,"TYPE","terminate"),Ui(o,d),(l=new Yt(o,o.j,l)).L=2,l.v=fo(wt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=Tg(l.j,null),l.g.ea(l.v)),l.F=Date.now(),co(l)}yg(o)}function po(o){o.g&&(Bc(o),o.g.cancel(),o.g=null)}function hg(o){po(o),o.u&&(u.clearTimeout(o.u),o.u=null),yo(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function _o(o){if(!$m(o.h)&&!o.s){o.s=!0;var l=o.Ga;wi||Am(),Ri||(wi(),Ri=!0),_c.add(l,o),o.B=0}}function dg(o,l){var d;d=l?l.l:o.U++;const g=wt(o.I);de(g,"SID",o.K),de(g,"RID",d),de(g,"AID",o.T),Ui(o,g),o.m&&o.o&&Mc(g,o.m,o.o),d=new Yt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=fg(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Oc(o.h,d),Dc(d,g,l)}function Ui(o,l){o.H&&Q(o.H,function(d,g){de(l,g,d)}),o.l&&Xm({},function(d,g){de(l,g,d)})}function fg(o,l,d){d=Math.min(o.i.length,d);var g=o.l?p(o.l.Na,o.l,o):null;e:{var w=o.i;let S=-1;for(;;){const M=["count="+d];-1==S?0<d?(S=w[0].g,M.push("ofs="+S)):S=0:M.push("ofs="+S);let ue=!0;for(let be=0;be<d;be++){let te=w[be].g;const qe=w[be].map;if(te-=S,0>te)S=Math.max(0,w[be].g-100),ue=!1;else try{$T(qe,M,"req"+te+"_")}catch{g&&g(qe)}}if(ue){g=M.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,g}function mg(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;wi||Am(),Ri||(wi(),Ri=!0),_c.add(l,o),o.v=0}}function qc(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=Ci(p(o.Fa,o),_g(o,o.v)),o.v++,0))}function Bc(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function gg(o){o.g=new Yt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=wt(o.qa);de(l,"RID","rpc"),de(l,"SID",o.K),de(l,"AID",o.T),de(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&de(l,"TO",o.ja),de(l,"TYPE","xmlhttp"),Ui(o,l),o.m&&o.o&&Mc(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=fo(wt(l)),d.m=null,d.P=!0,jm(d,o)}function yo(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function pg(o,l){var d=null;if(o.g==l){yo(o),Bc(o),o.g=null;var g=2}else{if(!Fc(o.h,l))return;d=l.D,Wm(o.h,l),g=1}if(0!=o.G)if(l.o)if(1==g){d=l.m?l.m.length:0,l=Date.now()-l.F;var w=o.B;Ke(g=oo(),new Lm(g,d)),_o(o)}else mg(o);else if(3==(w=l.s)||0==w&&0<l.X||!(1==g&&function XT(o,l){return!(Qm(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=Ci(p(o.Ga,o,l),_g(o,o.B)),o.B++,0)))}(o,l)||2==g&&qc(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),w){case 1:Nn(o,5);break;case 4:Nn(o,10);break;case 3:Nn(o,6);break;default:Nn(o,2)}}function _g(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function Nn(o,l){if(o.j.info("Error code "+l),2==l){var d=p(o.fb,o),g=o.Xa;const w=!g;g=new Dn(g||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||lo(g,"https"),fo(g),w?function zT(o,l){const d=new Di;if(u.Image){const g=new Image;g.onload=A(en,d,"TestLoadImage: loaded",!0,l,g),g.onerror=A(en,d,"TestLoadImage: error",!1,l,g),g.onabort=A(en,d,"TestLoadImage: abort",!1,l,g),g.ontimeout=A(en,d,"TestLoadImage: timeout",!1,l,g),u.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=o}else l(!1)}(g.toString(),d):function KT(o,l){new Di;const g=new AbortController,w=setTimeout(()=>{g.abort(),en(0,0,!1,l)},1e4);fetch(o,{signal:g.signal}).then(S=>{clearTimeout(w),en(0,0,!!S.ok,l)}).catch(()=>{clearTimeout(w),en(0,0,!1,l)})}(g.toString(),d)}else Ge(2);o.G=0,o.l&&o.l.sa(l),yg(o),hg(o)}function yg(o){if(o.G=0,o.ka=[],o.l){const l=Hm(o.h);(0!=l.length||0!=o.i.length)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function Ig(o,l,d){var g=d instanceof Dn?wt(d):new Dn(d);if(""!=g.g)l&&(g.g=l+"."+g.g),ho(g,g.s);else{var w=u.location;g=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;var S=new Dn(null);g&&lo(S,g),l&&(S.g=l),w&&ho(S,w),d&&(S.l=d),g=S}return l=o.ya,(d=o.D)&&l&&de(g,d,l),de(g,"VER",o.la),Ui(o,g),g}function Tg(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new _e(o.Ca&&!o.pa?new Mi({eb:d}):o.pa)).Ha(o.J),l}function Eg(){}function Io(){}function Je(o,l){Le.call(this),this.g=new lg(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!j(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!j(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new Pr(this)}function vg(o){Sc.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Ag(){bc.call(this),this.status=1}function Pr(o){this.g=o}(r=_e.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xc.g(),this.v=function Nm(o){return o.h||(o.h=o.i())}(this.o?this.o:xc),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(S){return void sg(this,S)}if(o=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var w in g)d.set(w,g[w]);else{if("function"!=typeof g.keys||"function"!=typeof g.get)throw Error("Unknown input type for opt_headers: "+String(g));for(const S of g.keys())d.set(S,g.get(S))}g=Array.from(d.keys()).find(S=>"content-type"==S.toLowerCase()),w=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(WT,l,void 0))||g||w||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,M]of d)this.g.setRequestHeader(S,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ug(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){sg(this,S)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ke(this,"complete"),Ke(this,"abort"),go(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),go(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?ag(this):this.bb())},r.bb=function(){ag(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Rt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),PT(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=lg.prototype).la=8,r.G=1,r.connect=function(o,l,d,g){Ge(0),this.W=o,this.H=l||{},d&&void 0!==g&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=Ig(this,null,this.W),_o(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const w=new Yt(this,this.j,o);let S=this.o;if(this.S&&(S?(S=_(S),E(S,this.S)):S=this.S),null!==this.m||this.O||(w.H=S,S=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var g=this.i[d];if(void 0===(g="__data__"in g.map&&"string"==typeof(g=g.map.__data__)?g.length:void 0))break;if(4096<(l+=g)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=fg(this,w,l),de(d=wt(this.I),"RID",o),de(d,"CVER",22),this.D&&de(d,"X-HTTP-Session-Id",this.D),Ui(this,d),S&&(this.O?l="headers="+encodeURIComponent(String(ig(S)))+"&"+l:this.m&&Mc(d,this.m,S)),Oc(this.h,w),this.Ua&&de(d,"TYPE","init"),this.P?(de(d,"$req",l),de(d,"SID","null"),w.T=!0,Dc(w,d,null)):Dc(w,d,l),this.G=2}}else 3==this.G&&(o?dg(this,o):0==this.i.length||$m(this.h)||dg(this))},r.Fa=function(){if(this.u=null,gg(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Ci(p(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ge(10),po(this),gg(this))},r.Za=function(){null!=this.C&&(this.C=null,po(this),qc(this),Ge(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Eg.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Io.prototype.g=function(o,l){return new Je(o,l)},b(Je,Le),Je.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Je.prototype.close=function(){Lc(this.g)},Je.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=Pc(o),o=d);l.i.push(new NT(l.Ya++,o)),3==l.G&&_o(l)},Je.prototype.N=function(){this.g.l=null,delete this.j,Lc(this.g),delete this.g,Je.aa.N.call(this)},b(vg,Sc),b(Ag,bc),b(Pr,Eg),Pr.prototype.ua=function(){Ke(this.g,"a")},Pr.prototype.ta=function(o){Ke(this.g,new vg(o))},Pr.prototype.sa=function(o){Ke(this.g,new Ag)},Pr.prototype.ra=function(){Ke(this.g,"b")},Io.prototype.createWebChannel=Io.prototype.g,Je.prototype.send=Je.prototype.o,Je.prototype.open=Je.prototype.m,Je.prototype.close=Je.prototype.close,Yc=mt.createWebChannelTransport=function(){return new Io},Jc=mt.getStatEventTarget=function(){return oo()},Xc=mt.Event=xn,Ro=mt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ao.NO_ERROR=0,ao.TIMEOUT=8,ao.HTTP_ERROR=6,Gi=mt.ErrorCode=ao,qm.COMPLETE="complete",Hc=mt.EventType=qm,km.EventType=bi,bi.OPEN="a",bi.CLOSE="b",bi.ERROR="c",bi.MESSAGE="d",Le.prototype.listen=Le.prototype.K,br=mt.WebChannel=km,mt.FetchXmlHttpFactory=Mi,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Wc=mt.XhrIo=_e}).apply(typeof Ki<"u"?Ki:typeof self<"u"?self:typeof window<"u"?window:{});const Zc="@firebase/firestore";class Ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let kn="11.10.0";const St=new st.Vy("@firebase/firestore");function Fn(){return St.logLevel}function k(r,...e){if(St.logLevel<=st.$b.DEBUG){const t=e.map(Po);St.debug(`Firestore (${kn}): ${r}`,...t)}}function ye(r,...e){if(St.logLevel<=st.$b.ERROR){const t=e.map(Po);St.error(`Firestore (${kn}): ${r}`,...t)}}function xe(r,...e){if(St.logLevel<=st.$b.WARN){const t=e.map(Po);St.warn(`Firestore (${kn}): ${r}`,...t)}}function Po(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function q(r,e,t){let n="Unexpected state";"string"==typeof e?n=e:t=e,tl(r,n,t)}function tl(r,e,t){let n=`FIRESTORE (${kn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(void 0!==t)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ye(n),new Error(n)}function U(r,e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,r||tl(e,i,n)}function O(r,e){return r}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends W.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class we{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class nl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Mg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}}class Lg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class qg{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;U(void 0===this.o,42304);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new we;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new we,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,x.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new we)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U("string"==typeof n.accessToken,31837,{l:n}),new nl(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e,2055,{h:e}),new Ae(e)}}class Bg{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ug{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Bg(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jg{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,Sr._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){U(void 0===this.o,3512);const n=s=>{null!=s.error&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Vo(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Vo(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function zg(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}function So(){return new TextEncoder}class bo{static newId(){const t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=zg(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function K(r,e){return r<e?-1:r>e?1:0}function xo(r,e){let t=0;for(;t<r.length&&t<e.length;){const n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return K(n,i);{const s=So(),a=Kg(s.encode(rl(r,t)),s.encode(rl(e,t)));return 0!==a?a:K(n,i)}}t+=n>65535?2:1}return K(r.length,e.length)}function rl(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function Kg(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return K(r[t],e[t]);return K(r.length,e.length)}function On(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function il(r){return r+"\0"}const Co="__name__";class ot{constructor(e,t,n){void 0===t?t=0:t>e.length&&q(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&q(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ot.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ot?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=ot.compareSegments(e.get(i),t.get(i));if(0!==s)return s}return K(e.length,t.length)}static compareSegments(e,t){const n=ot.isNumericId(e),i=ot.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?ot.extractNumericId(e).compare(ot.extractNumericId(t)):xo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}}class H extends ot{construct(e,t,n){return new H(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new H(t)}static emptyPath(){return new H([])}}const Gg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class le extends ot{construct(e,t,n){return new le(e,t,n)}static isValidIdentifier(e){return Gg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Co}static keyField(){return new le([Co])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new C(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new le(t)}static emptyPath(){return new le([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(H.fromString(e))}static fromName(e){return new F(H.fromString(e).popFirst(5))}static empty(){return new F(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===H.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return H.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new H(e.slice()))}}function Do(r,e,t){if(!t)throw new C(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function sl(r,e,t,n){if(!0===e&&!0===n)throw new C(P.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function ol(r){if(!F.isDocumentKey(r))throw new C(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function al(r){if(F.isDocumentKey(r))throw new C(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ul(r){return"object"==typeof r&&null!==r&&(Object.getPrototypeOf(r)===Object.prototype||null===Object.getPrototypeOf(r))}function $i(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":q(12329,{type:typeof r})}function X(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=$i(r);throw new C(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function cl(r,e){if(e<=0)throw new C(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}function Te(r,e){const t={typeString:r};return e&&(t.value=e),t}function tn(r,e){if(!ul(r))throw new C(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const a=r[n];if(i&&typeof a!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new C(P.INVALID_ARGUMENT,t);return!0}const ll=-62135596800;class ne{static now(){return ne.fromMillis(Date.now())}static fromDate(e){return ne.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ne(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ll)throw new C(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ne._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(tn(e,ne._jsonSchema))return new ne(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-ll).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ne._jsonSchemaVersion="firestore/timestamp/1.0",ne._jsonSchema={type:Te("string",ne._jsonSchemaVersion),seconds:Te("number"),nanoseconds:Te("number")};class z{static fromTimestamp(e){return new z(e)}static min(){return new z(new ne(0,0))}static max(){return new z(new ne(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ln{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function No(r){return r.fields.find(e=>2===e.kind)}function nn(r){return r.fields.filter(e=>2!==e.kind)}Ln.UNKNOWN_ID=-1;class rn{constructor(e,t){this.fieldPath=e,this.kind=t}}class qn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new qn(0,We.min())}}function dl(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=z.fromTimestamp(1e9===n?new ne(t+1,0):new ne(t,n));return new We(i,F.empty(),e)}function fl(r){return new We(r.readTime,r.key,-1)}class We{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new We(z.min(),F.empty(),-1)}static max(){return new We(z.max(),F.empty(),-1)}}function ko(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=F.comparator(r.documentKey,e.documentKey),0!==t?t:K(r.largestBatchId,e.largestBatchId))}const ml="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function bt(r){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,x.A)(function*(r){if(r.code!==P.FAILED_PRECONDITION||r.message!==ml)throw r;k("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,n)=>{t(e)})}static reject(e){return new R((t,n)=>{n(e)})}static waitFor(e){return new R((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=R.resolve(!1);for(const n of e)t=t.next(i=>i?R.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new R((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new R((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}const He="SimpleDb";class Qi{static open(e,t,n,i){try{return new Qi(t,e.transaction(i,n))}catch(s){throw new xr(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new we,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new xr(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const i=Oo(n.target.error);this.S.reject(new xr(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(k(He,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Hg(t)}}class at{static delete(e){return k(He,"Removing database:",e),sn((0,W.mS)().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,W.zW)())return!1;if(at.F())return!0;const e=(0,W.ZQ)(),t=at.M(e),n=0<t&&t<10,i=pl(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===at.M((0,W.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){var t=this;return(0,x.A)(function*(){return t.db||(k(He,"Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new xr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new C(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new xr(e,u))},s.onupgradeneeded=a=>{k(He,'Database "'+t.name+'" requires upgrade from version:',a.oldVersion);const u=a.target.result;if(null!==t.L&&t.L!==a.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${t.L}, event.oldVersion=${a.oldVersion}, event.newVersion=${a.newVersion}, db.version=${u.version}`);t.B.q(u,s.transaction,a.oldVersion,t.version).next(()=>{k(He,"Database upgrade to version "+t.version+" complete")})}}),t.db.addEventListener("close",n=>{t.L=n.target.version},{passive:!0})),t.db.addEventListener("versionchange",n=>{var i;null===n.newVersion&&(xe('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null===(i=t.databaseDeletedListener)||void 0===i||i.call(t))},{passive:!0}),t.db})()}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}runTransaction(e,t,n,i){var s=this;return(0,x.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.k(e);const c=Qi.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.v(),f)).catch(f=>(c.abort(f),R.reject(f))).toPromise();return h.catch(()=>{}),yield c.D,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(k(He,"Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function pl(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class Wg{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return sn(this.$.delete())}}class xr extends C{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function xt(r){return"IndexedDbTransactionError"===r.name}class Hg{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(k(He,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(k(He,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),sn(n)}add(e){return k(He,"ADD",this.store.name,e,e),sn(this.store.add(e))}get(e){return sn(this.store.get(e)).next(t=>(void 0===t&&(t=null),k(He,"GET",this.store.name,e,t),t))}delete(e){return k(He,"DELETE",this.store.name,e),sn(this.store.delete(e))}count(){return k(He,"COUNT",this.store.name),sn(this.store.count())}j(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new R((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.J(s,(u,c)=>{a.push(c)}).next(()=>a)}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new R((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}Y(e,t){k(He,"DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;const i=this.cursor(n);return this.J(i,(s,a,u)=>u.delete())}X(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.J(i,t)}ee(e){const t=this.cursor({});return new R((n,i)=>{t.onerror=s=>{const a=Oo(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(e,t){const n=[];return new R((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new Wg(u),h=t(u.primaryKey,u.value,c);if(h instanceof R){const f=h.catch(m=>(c.done(),R.reject(m)));n.push(f)}c.isDone?i():null===c.W?u.continue():u.continue(c.W)}}).next(()=>R.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function sn(r){return new R((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=Oo(n.target.error);t(i)}})}let _l=!1;function Oo(r){const e=at.M((0,W.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _l||(_l=!0,setTimeout(()=>{throw n},0)),n}}return r}const Cr="IndexBackfiller";class Xg{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ne(e){var t=this;k(Cr,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,x.A)(function*(){t.task=null;try{const n=yield t.te.re();k(Cr,`Documents written: ${n}`)}catch(n){xt(n)?k(Cr,"Ignoring IndexedDB error during index backfill: ",n):yield bt(n)}yield t.ne(6e4)}))}}class Jg{constructor(e,t){this.localStore=e,this.persistence=t}re(){var e=this;return(0,x.A)(function*(t=50){return e.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>e.ie(n,t))}).apply(this,arguments)}ie(e,t){const n=new Set;let i=t,s=!0;return R.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return k(Cr,`Processing collection: ${a}`),this.se(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}se(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.oe(i,s)).next(u=>(k(Cr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}oe(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=fl(s);ko(a,n)>0&&(n=a)}),new We(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Xe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this._e(i),this.ae=i=>n.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ae&&this.ae(t),t}}return r.ue=-1,r})();function Dr(r){return null==r}function Nr(r){return 0===r&&1/r==-1/0}function yl(r){return"number"==typeof r&&Number.isInteger(r)&&!Nr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ce(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Il(e)),e=Yg(r.get(t),e);return Il(e)}function Yg(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Il(r){return r+"\x01\x01"}function ut(r){const e=r.length;if(U(e>=2,64408,{path:r}),2===e)return U("\x01"===r.charAt(0)&&"\x01"===r.charAt(1),56145,{path:r}),H.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&q(50515,{path:r}),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:q(61167,{path:r})}s=a+2}return new H(n)}const on="remoteDocuments",kr="owner",Bn="owner",Fr="mutationQueues",et="mutations",Tl="batchId",an="userMutationsIndex",El=["userId","batchId"];function Hi(r,e){return[r,Ce(e)]}function vl(r,e,t){return[r,Ce(e),t]}const ep={},Un="documentMutations",Xi="remoteDocumentsV14",tp=["prefixPath","collectionGroup","readTime","documentId"],Ji="documentKeyIndex",np=["prefixPath","collectionGroup","documentId"],Al="collectionGroupIndex",rp=["collectionGroup","readTime","prefixPath","documentId"],Or="remoteDocumentGlobal",Mo="remoteDocumentGlobalKey",jn="targets",wl="queryTargetsIndex",ip=["canonicalId","targetId"],zn="targetDocuments",sp=["targetId","path"],Lo="documentTargetsIndex",op=["path","targetId"],Yi="targetGlobalKey",un="targetGlobal",Mr="collectionParents",ap=["collectionId","parent"],Kn="clientMetadata",Zi="bundles",es="namedQueries",qo="indexConfiguration",Bo="collectionGroupIndex",Lr="indexState",fp=["indexId","uid"],Rl="sequenceNumberIndex",mp=["uid","sequenceNumber"],qr="indexEntries",gp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Pl="documentKeyIndex",pp=["indexId","uid","orderedDocumentKey"],ts="documentOverlays",_p=["userId","collectionPath","documentId"],Uo="collectionPathOverlayIndex",yp=["userId","collectionPath","largestBatchId"],Vl="collectionGroupOverlayIndex",Ip=["userId","collectionGroup","largestBatchId"],jo="globals",Sl=[Fr,et,Un,on,jn,kr,un,zn,Kn,Or,Mr,Zi,es],Ep=[...Sl,ts],bl=[Fr,et,Un,Xi,jn,kr,un,zn,Kn,Or,Mr,Zi,es,ts],xl=bl,zo=[...xl,qo,Lr,qr],vp=zo,Cl=[...zo,jo],Ap=Cl;class Ko extends gl{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function ve(r,e){const t=O(r);return at.N(t.ce,e)}function Dl(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Dt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function kl(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ce{constructor(e,t){this.comparator=e,this.root=t||Ve.EMPTY}insert(e,t){return new ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ve.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ve.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ns(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ns(this.root,e,this.comparator,!1)}getReverseIterator(){return new ns(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ns(this.root,e,this.comparator,!0)}}class ns{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ve{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Ve.RED,this.left=i??Ve.EMPTY,this.right=s??Ve.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Ve(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ve.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Ve.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ve.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ve.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}}Ve.EMPTY=null,Ve.RED=!0,Ve.BLACK=!1,Ve.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new Ve(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ie{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fl(this.data.getIterator())}getIteratorFrom(e){return new Fl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ie)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ie(this.comparator);return t.data=e,t}}class Fl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Gn(r){return r.hasNext()?r.getNext():void 0}class $e{constructor(e){this.fields=e,e.sort(le.comparator)}static empty(){return new $e([])}unionWith(e){let t=new ie(le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new $e(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return On(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Ol extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class pe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ol("Invalid base64 string: "+s):s}}(e);return new pe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new pe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pe.EMPTY_BYTE_STRING=new pe("");const Rp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gt(r){if(U(!!r,39018),"string"==typeof r){let e=0;const t=Rp.exec(r);if(U(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:fe(r.seconds),nanos:fe(r.nanos)}}function fe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function pt(r){return"string"==typeof r?pe.fromBase64String(r):pe.fromUint8Array(r)}const Ml="server_timestamp",Ll="__type__",ql="__previous_value__",Bl="__local_write_time__";function rs(r){var e,t;return(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{})[Ll])||void 0===t?void 0:t.stringValue)===Ml}function is(r){const e=r.mapValue.fields[ql];return rs(e)?is(e):e}function Br(r){const e=gt(r.mapValue.fields[Bl].timestampValue);return new ne(e.seconds,e.nanos)}class Pp{constructor(e,t,n,i,s,a,u,c,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}}const Ur="(default)";class Nt{constructor(e,t){this.projectId=e,this.database=t||Ur}static empty(){return new Nt("","")}get isDefaultDatabase(){return this.database===Ur}isEqual(e){return e instanceof Nt&&e.projectId===this.projectId&&e.database===this.database}}const Go="__type__",Ul="__max__",kt={mapValue:{fields:{__type__:{stringValue:Ul}}}},$o="__vector__",$n="value",ss={nullValue:"NULL_VALUE"};function Ft(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?rs(r)?4:$l(r)?9007199254740991:us(r)?10:11:q(28295,{value:r})}function ct(r,e){if(r===e)return!0;const t=Ft(r);if(t!==Ft(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Br(r).isEqual(Br(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=gt(i.timestampValue),u=gt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,pt(r.bytesValue).isEqual(pt(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=fe(i.doubleValue),u=fe(s.doubleValue);return a===u?Nr(a)===Nr(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return On(r.arrayValue.values||[],e.arrayValue.values||[],ct);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Dl(a)!==Dl(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!ct(a[c],u[c])))return!1;return!0}(r,e);default:return q(52216,{left:r})}var s}function jr(r,e){return void 0!==(r.values||[]).find(t=>ct(t,e))}function Ot(r,e){if(r===e)return 0;const t=Ft(r),n=Ft(e);if(t!==n)return K(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return K(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=fe(s.integerValue||s.doubleValue),c=fe(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return jl(r.timestampValue,e.timestampValue);case 4:return jl(Br(r),Br(e));case 5:return xo(r.stringValue,e.stringValue);case 6:return function(s,a){const u=pt(s),c=pt(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=K(u[h],c[h]);if(0!==f)return f}return K(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=K(fe(s.latitude),fe(a.latitude));return 0!==u?u:K(fe(s.longitude),fe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return zl(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,h,f;const A=null===(u=(s.fields||{})[$n])||void 0===u?void 0:u.arrayValue,b=null===(c=(a.fields||{})[$n])||void 0===c?void 0:c.arrayValue,N=K((null===(h=A?.values)||void 0===h?void 0:h.length)||0,(null===(f=b?.values)||void 0===f?void 0:f.length)||0);return 0!==N?N:zl(A,b)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===kt.mapValue&&a===kt.mapValue)return 0;if(s===kt.mapValue)return 1;if(a===kt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){const p=xo(c[m],f[m]);if(0!==p)return p;const A=Ot(u[c[m]],h[f[m]]);if(0!==A)return A}return K(c.length,f.length)}(r.mapValue,e.mapValue);default:throw q(23264,{le:t})}}function jl(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return K(r,e);const t=gt(r),n=gt(e),i=K(t.seconds,n.seconds);return 0!==i?i:K(t.nanos,n.nanos)}function zl(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Ot(t[i],n[i]);if(s)return s}return K(t.length,n.length)}function Qn(r){return Qo(r)}function Qo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=gt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?pt(r.bytesValue).toBase64():"referenceValue"in r?F.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Qo(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${Qo(t.fields[a])}`;return i+"}"}(r.mapValue):q(61005,{value:r})}function os(r){switch(Ft(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=is(r);return e?16+os(e):16;case 5:return 2*r.stringValue.length;case 6:return pt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((i,s)=>i+os(s),0);case 10:case 11:return function(n){let i=0;return Dt(n.fields,(s,a)=>{i+=s.length+os(a)}),i}(r.mapValue);default:throw q(13486,{value:r})}}function cn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Wo(r){return!!r&&"integerValue"in r}function zr(r){return!!r&&"arrayValue"in r}function Kl(r){return!!r&&"nullValue"in r}function Gl(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function as(r){return!!r&&"mapValue"in r}function us(r){var e,t;return(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{})[Go])||void 0===t?void 0:t.stringValue)===$o}function Kr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Dt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Kr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Kr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function $l(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Ul}const Ql={mapValue:{fields:{[Go]:{stringValue:$o},[$n]:{arrayValue:{}}}}};function Vp(r){return"nullValue"in r?ss:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?cn(Nt.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?us(r)?Ql:{mapValue:{}}:q(35942,{value:r})}function Sp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?cn(Nt.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Ql:"mapValue"in r?us(r)?{mapValue:{}}:kt:q(61959,{value:r})}function Wl(r,e){const t=Ot(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Hl(r,e){const t=Ot(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Se{constructor(e){this.value=e}static empty(){return new Se({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!as(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kr(t)}setAll(e){let t=le.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=Kr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());as(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ct(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];as(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Dt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Se(Kr(this.value))}}function Xl(r){const e=[];return Dt(r.fields,(t,n)=>{const i=new le([t]);if(as(n)){const s=Xl(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new $e(e)}class he{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new he(e,0,z.min(),z.min(),z.min(),Se.empty(),0)}static newFoundDocument(e,t,n,i){return new he(e,1,t,z.min(),n,i,0)}static newNoDocument(e,t){return new he(e,2,t,z.min(),z.min(),Se.empty(),0)}static newUnknownDocument(e,t){return new he(e,3,t,z.min(),z.min(),Se.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Se.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Se.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof he&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new he(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Mt{constructor(e,t){this.position=e,this.inclusive=t}}function Jl(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?F.comparator(F.fromName(a.referenceValue),t.key):Ot(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Yl(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!ct(r.position[t],e.position[t]))return!1;return!0}class Gr{constructor(e,t="asc"){this.field=e,this.dir=t}}function bp(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Zl{}class Y extends Zl{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new xp(e,t,n):"array-contains"===t?new Np(e,n):"in"===t?new sh(e,n):"not-in"===t?new kp(e,n):"array-contains-any"===t?new Fp(e,n):new Y(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Cp(e,n):new Dp(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Ot(t,this.value)):null!==t&&Ft(this.value)===Ft(t)&&this.matchesComparison(Ot(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class se extends Zl{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new se(e,t)}matches(e){return Wn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Wn(r){return"and"===r.op}function Ho(r){return"or"===r.op}function Xo(r){return eh(r)&&Wn(r)}function eh(r){for(const e of r.filters)if(e instanceof se)return!1;return!0}function Jo(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+Qn(r.value);if(Xo(r))return r.filters.map(e=>Jo(e)).join(",");{const e=r.filters.map(t=>Jo(t)).join(",");return`${r.op}(${e})`}}function th(r,e){return r instanceof Y?(n=r,(i=e)instanceof Y&&n.op===i.op&&n.field.isEqual(i.field)&&ct(n.value,i.value)):r instanceof se?function(n,i){return i instanceof se&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&th(a,i.filters[u]),!0)}(r,e):void q(19439);var n,i}function nh(r,e){const t=r.filters.concat(e);return se.create(t,r.op)}function rh(r){return r instanceof Y?`${(t=r).field.canonicalString()} ${t.op} ${Qn(t.value)}`:r instanceof se?function(t){return t.op.toString()+" {"+t.getFilters().map(rh).join(" ,")+"}"}(r):"Filter";var t}class xp extends Y{constructor(e,t,n){super(e,t,n),this.key=F.fromName(n.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class Cp extends Y{constructor(e,t){super(e,"in",t),this.keys=ih(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Dp extends Y{constructor(e,t){super(e,"not-in",t),this.keys=ih(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ih(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>F.fromName(n.referenceValue))}class Np extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return zr(t)&&jr(t.arrayValue,this.value)}}class sh extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&jr(this.value.arrayValue,t)}}class kp extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(jr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!jr(this.value.arrayValue,t)}}class Fp extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!zr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>jr(this.value.arrayValue,n))}}class Op{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Pe=null}}function Yo(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Op(r,e,t,n,i,s,a)}function ln(r){const e=O(r);if(null===e.Pe){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Jo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),Dr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Qn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Qn(n)).join(",")),e.Pe=t}return e.Pe}function $r(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!bp(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!th(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Yl(r.startAt,e.startAt)&&Yl(r.endAt,e.endAt)}function cs(r){return F.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function ls(r,e){return r.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function oh(r,e,t){let n=ss,i=!0;for(const s of ls(r,e)){let a=ss,u=!0;switch(s.op){case"<":case"<=":a=Vp(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=ss}Wl({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Wl({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function ah(r,e,t){let n=kt,i=!0;for(const s of ls(r,e)){let a=kt,u=!0;switch(s.op){case">=":case">":a=Sp(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=kt}Hl({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Hl({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class _t{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.Te=null,this.Ie=null,this.de=null}}function uh(r,e,t,n,i,s,a,u){return new _t(r,e,t,n,i,s,a,u)}function Hn(r){return new _t(r)}function ch(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Zo(r){return null!==r.collectionGroup}function Xn(r){const e=O(r);if(null===e.Te){e.Te=[];const t=new Set;for(const s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ie(le.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Gr(s,n))}),t.has(le.keyField().canonicalString())||e.Te.push(new Gr(le.keyField(),n))}return e.Te}function De(r){const e=O(r);return e.Ie||(e.Ie=function hh(r,e){if("F"===r.limitType)return Yo(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Gr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Mt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Mt(r.startAt.position,r.startAt.inclusive):null;return Yo(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Xn(r))),e.Ie}function ea(r,e){const t=r.filters.concat([e]);return new _t(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function hs(r,e,t){return new _t(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Qr(r,e){return $r(De(r),De(e))&&r.limitType===e.limitType}function dh(r){return`${ln(De(r))}|lt:${r.limitType}`}function Jn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>rh(i)).join(", ")}]`),Dr(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Qn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Qn(i)).join(",")),`Target(${n})`}(De(r))}; limitType=${r.limitType})`}function Wr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):F.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Xn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=Jl(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,Xn(n),i)||n.endAt&&!function(a,u,c){const h=Jl(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,Xn(n),i)));var n,i}function fh(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function mh(r){return(e,t)=>{let n=!1;for(const i of Xn(r)){const s=Mp(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Mp(r,e,t){const n=r.field.isKeyField()?F.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Ot(c,h):q(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return q(19790,{direction:r.dir})}}class yt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Dt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return kl(this.inner)}size(){return this.innerSize}}const Lp=new ce(F.comparator);function Qe(){return Lp}const gh=new ce(F.comparator);function Hr(...r){let e=gh;for(const t of r)e=e.insert(t.key,t);return e}function ph(r){let e=gh;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function lt(){return Xr()}function _h(){return Xr()}function Xr(){return new yt(r=>r.toString(),(r,e)=>r.isEqual(e))}const qp=new ce(F.comparator),Bp=new ie(F.comparator);function $(...r){let e=Bp;for(const t of r)e=e.add(t);return e}const Up=new ie(K);function ta(){return Up}function na(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nr(e)?"-0":e}}function yh(r){return{integerValue:""+r}}function Ih(r,e){return yl(e)?yh(e):na(r,e)}class ds{constructor(){this._=void 0}}function jp(r,e,t){return r instanceof Yn?function(i,s){const a={fields:{[Ll]:{stringValue:Ml},[Bl]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&rs(s)&&(s=is(s)),s&&(a.fields[ql]=s),{mapValue:a}}(t,e):r instanceof hn?Eh(r,e):r instanceof dn?vh(r,e):function(i,s){const a=Th(i,s),u=Ah(a)+Ah(i.Ee);return Wo(a)&&Wo(i.Ee)?yh(u):na(i.serializer,u)}(r,e)}function zp(r,e,t){return r instanceof hn?Eh(r,e):r instanceof dn?vh(r,e):t}function Th(r,e){return r instanceof Zn?Wo(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Yn extends ds{}class hn extends ds{constructor(e){super(),this.elements=e}}function Eh(r,e){const t=wh(e);for(const n of r.elements)t.some(i=>ct(i,n))||t.push(n);return{arrayValue:{values:t}}}class dn extends ds{constructor(e){super(),this.elements=e}}function vh(r,e){let t=wh(e);for(const n of r.elements)t=t.filter(i=>!ct(i,n));return{arrayValue:{values:t}}}class Zn extends ds{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Ah(r){return fe(r.integerValue||r.doubleValue)}function wh(r){return zr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Jr{constructor(e,t){this.field=e,this.transform=t}}class Gp{constructor(e,t){this.version=e,this.transformResults=t}}class me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new me}static exists(e){return new me(void 0,e)}static updateTime(e){return new me(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fs(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class ms{}function Rh(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new tr(r.key,me.none()):new er(r.key,r.data,me.none());{const t=r.data,n=Se.empty();let i=new ie(le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new It(r.key,n,new $e(i.toArray()),me.none())}}function $p(r,e,t){r instanceof er?function(i,s,a){const u=i.value.clone(),c=Sh(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof It?function(i,s,a){if(!fs(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=Sh(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Vh(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Yr(r,e,t,n){return r instanceof er?function(s,a,u,c){if(!fs(s.precondition,a))return u;const h=s.value.clone(),f=bh(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof It?function(s,a,u,c){if(!fs(s.precondition,a))return u;const h=bh(s.fieldTransforms,c,a),f=a.data;return f.setAll(Vh(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(r,e,t,n):(u=t,fs(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Qp(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Th(n.transform,i||null);null!=s&&(null===t&&(t=Se.empty()),t.set(n.field,s))}return t||null}function Ph(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&On(n,i,(s,a)=>function Kp(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof hn&&i instanceof hn||n instanceof dn&&i instanceof dn?On(n.elements,i.elements,ct):n instanceof Zn&&i instanceof Zn?ct(n.Ee,i.Ee):n instanceof Yn&&i instanceof Yn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class er extends ms{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class It extends ms{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Vh(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Sh(r,e,t){const n=new Map;U(r.length===t.length,32656,{Ae:t.length,Re:r.length});for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,zp(a,u,t[i]))}return n}function bh(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,jp(s,a,e))}return n}class tr extends ms{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ra extends ms{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ia{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&$p(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Yr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Yr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=_h();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=Rh(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&On(this.mutations,e.mutations,(t,n)=>Ph(t,n))&&On(this.baseMutations,e.baseMutations,(t,n)=>Ph(t,n))}}class sa{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let i=function(){return qp}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new sa(e,t,n,i)}}class oa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Wp{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ee,Z;function Ch(r){switch(r){case P.OK:return q(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return q(15467,{code:r})}}function Dh(r){if(void 0===r)return ye("GRPC error has no .code"),P.UNKNOWN;switch(r){case Ee.OK:return P.OK;case Ee.CANCELLED:return P.CANCELLED;case Ee.UNKNOWN:return P.UNKNOWN;case Ee.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ee.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ee.INTERNAL:return P.INTERNAL;case Ee.UNAVAILABLE:return P.UNAVAILABLE;case Ee.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ee.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ee.NOT_FOUND:return P.NOT_FOUND;case Ee.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ee.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ee.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ee.ABORTED:return P.ABORTED;case Ee.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ee.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ee.DATA_LOSS:return P.DATA_LOSS;default:return q(39323,{code:r})}}(Z=Ee||(Ee={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";const Hp=new Vt([4294967295,4294967295],0);function Nh(r){const e=So().encode(r),t=new Qc;return t.update(e),new Uint8Array(t.digest())}function kh(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Vt([t,n],0),new Vt([i,s],0)]}class aa{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Zr(`Invalid padding: ${t}`);if(n<0)throw new Zr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Zr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Zr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Vt.fromNumber(this.fe)}pe(e,t,n){let i=e.add(t.multiply(Vt.fromNumber(n)));return 1===i.compare(Hp)&&(i=new Vt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=Nh(e),[n,i]=kh(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(n,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new aa(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.fe)return;const t=Nh(e),[n,i]=kh(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(n,i,s);this.we(a)}}we(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Zr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ei{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,ti.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ei(z.min(),i,new ce(K),Qe(),$())}}class ti{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ti(n,t,$(),$(),$())}}class ps{constructor(e,t,n,i){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=i}}class Fh{constructor(e,t){this.targetId=e,this.De=t}}class Oh{constructor(e,t,n=pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Mh{constructor(){this.ve=0,this.Ce=Lh(),this.Fe=pe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=$(),t=$(),n=$();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:q(38017,{changeType:s})}}),new ti(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=Lh()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,U(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class Xp{constructor(e){this.We=e,this.Ge=new Map,this.ze=Qe(),this.je=_s(),this.Je=_s(),this.He=new ce(K)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:q(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((n,i)=>{this.nt(i)&&t(i)})}it(e){const t=e.targetId,n=e.De.count,i=this.st(t);if(i){const s=i.target;if(cs(s))if(0===n){const a=new F(s.path);this.Xe(t,a,he.newNoDocument(a,z.min()))}else U(1===n,20013,{expectedCount:n});else{const a=this.ot(t);if(a!==n){const u=this._t(e),c=u?this.ut(u,e,a):1;0!==c&&(this.rt(t),this.He=this.He.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=pt(n).toUint8Array()}catch(c){if(c instanceof Ol)return xe("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new aa(a,i,s)}catch(c){return xe(c instanceof Zr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.fe?null:u}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){const n=this.We.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Xe(t,s,null),i++)}),i}Pt(e){const t=new Map;this.Ge.forEach((s,a)=>{const u=this.st(a);if(u){if(s.current&&cs(u.target)){const c=new F(u.target.path);this.Tt(c).has(a)||this.It(a,c)||this.Xe(a,c,he.newNoDocument(c,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let n=$();this.Je.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.st(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));const i=new ei(e,t,this.He,this.ze,n);return this.ze=Qe(),this.je=_s(),this.Je=_s(),this.He=new ce(K),i}Ze(e,t){if(!this.nt(e))return;const n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;const i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Mh,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new ie(K),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new ie(K),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||k("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Mh),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function _s(){return new ce(F.comparator)}function Lh(){return new ce(F.comparator)}const Jp={asc:"ASCENDING",desc:"DESCENDING"},Yp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Zp={and:"AND",or:"OR"};class e_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ua(r,e){return r.useProto3Json||Dr(e)?e:{value:e}}function nr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qh(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function t_(r,e){return nr(r,e.toTimestamp())}function Ie(r){return U(!!r,49232),z.fromTimestamp(function(t){const n=gt(t);return new ne(n.seconds,n.nanos)}(r))}function ca(r,e){return la(r,e).canonicalString()}function la(r,e){const t=(i=r,new H(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Bh(r){const e=H.fromString(r);return U(Xh(e),10190,{key:e.toString()}),e}function ni(r,e){return ca(r.databaseId,e.path)}function ht(r,e){const t=Bh(e);if(t.get(1)!==r.databaseId.projectId)throw new C(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new F(zh(t))}function Uh(r,e){return ca(r.databaseId,e)}function jh(r){const e=Bh(r);return 4===e.length?H.emptyPath():zh(e)}function ha(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function zh(r){return U(r.length>4&&"documents"===r.get(4),29091,{key:r.toString()}),r.popFirst(5)}function Kh(r,e,t){return{name:ni(r,e),fields:t.value.mapValue.fields}}function ys(r,e,t){const n=ht(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):z.min(),a=new Se({mapValue:{fields:e.fields}}),u=he.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function ri(r,e){let t;if(e instanceof er)t={update:Kh(r,e.key,e.value)};else if(e instanceof tr)t={delete:ni(r,e.key)};else if(e instanceof It)t={update:Kh(r,e.key,e.data),updateMask:c_(e.fieldMask)};else{if(!(e instanceof ra))return q(16599,{Rt:e.type});t={verify:ni(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Yn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof hn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof dn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Zn)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw q(20930,{transform:a.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:t_(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:q(27497)),t;var s}function da(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?me.updateTime(Ie(s.updateTime)):void 0!==s.exists?me.exists(s.exists):me.none():me.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(U("REQUEST_TIME"===u.setToServerValue,16630,{proto:u}),c=new Yn):"appendMissingElements"in u?c=new hn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new dn(u.removeAllFromArray.values||[]):"increment"in u?c=new Zn(a,u.increment):q(16584,{proto:u});const h=le.fromServerFormat(u.fieldPath);return new Jr(h,c)}(r,i)):[];var s;if(e.update){const i=ht(r,e.update.name),s=new Se({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new $e((e.updateMask.fieldPaths||[]).map(f=>le.fromServerFormat(f)));return new It(i,s,a,t,n)}return new er(i,s,t,n)}if(e.delete){const i=ht(r,e.delete);return new tr(i,t)}if(e.verify){const i=ht(r,e.verify);return new ra(i,t)}return q(1463,{proto:e})}function Gh(r,e){return{documents:[Uh(r,e.path)]}}function Is(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Uh(r,i);const s=function(h){if(0!==h.length)return Hh(se.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:Lt((p=f).field),direction:o_(p.dir)};var p})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=ua(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:t,parent:i};var h}function Qh(r){let e=jh(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){U(1===n,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){const p=Wh(m);return p instanceof se&&Xo(p)?p.getFilters():[p]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(p=>{return new Gr(rr((b=p).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction));var b}));let u=null;t.limit&&(u=function(m){let p;return p="object"==typeof m?m.value:m,Dr(p)?null:p}(t.limit));let c=null;var m;t.startAt&&(c=new Mt((m=t.startAt).values||[],!!m.before));let h=null;return t.endAt&&(h=function(m){return new Mt(m.values||[],!m.before)}(t.endAt)),uh(e,i,a,s,u,"F",c,h)}function Wh(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=rr(t.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=rr(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=rr(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=rr(t.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}}(r):void 0!==r.fieldFilter?Y.create(rr((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return se.create(t.compositeFilter.filters.map(n=>Wh(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return q(1026)}}(t.compositeFilter.op))}(r):q(30097,{filter:r});var t}function o_(r){return Jp[r]}function a_(r){return Yp[r]}function u_(r){return Zp[r]}function Lt(r){return{fieldPath:r.canonicalString()}}function rr(r){return le.fromServerFormat(r.fieldPath)}function Hh(r){return r instanceof Y?function(t){if("=="===t.op){if(Gl(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NAN"}};if(Kl(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Gl(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NOT_NAN"}};if(Kl(t.value))return{unaryFilter:{field:Lt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Lt(t.field),op:a_(t.op),value:t.value}}}(r):r instanceof se?function(t){const n=t.getFilters().map(i=>Hh(i));return 1===n.length?n[0]:{compositeFilter:{op:u_(t.op),filters:n}}}(r):q(54877,{filter:r})}function c_(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Xh(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Tt{constructor(e,t,n,i,s=z.min(),a=z.min(),u=pe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Tt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Tt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Tt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Tt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Jh{constructor(e){this.gt=e}}function Yh(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ts(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:ni(s=r.gt,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:nr(s,a.version.toTimestamp()),createTime:nr(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:fn(e.version)};else{if(!e.isUnknownDocument())return q(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:fn(e.version)}}var s,a;return n}function Ts(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function fn(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function mn(r){const e=new ne(r.seconds,r.nanoseconds);return z.fromTimestamp(e)}function gn(r,e){const t=(e.baseMutations||[]).map(s=>da(r.gt,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>da(r.gt,s)),i=ne.fromMillis(e.localWriteTimeMs);return new ia(e.batchId,i,t,n)}function ii(r){const e=mn(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?mn(r.lastLimboFreeSnapshotVersion):z.min();let n;return n=void 0!==r.query.documents?function(s){const a=s.documents.length;return U(1===a,1966,{count:a}),De(Hn(jh(s.documents[0])))}(r.query):De(Qh(r.query)),new Tt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,pe.fromBase64String(r.resumeToken))}function Zh(r,e){const t=fn(e.snapshotVersion),n=fn(e.lastLimboFreeSnapshotVersion);let i;i=cs(e.target)?Gh(r.gt,e.target):Is(r.gt,e.target).Vt;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ln(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Es(r){const e=Qh({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?hs(e,e.limit,"L"):e}function fa(r,e){return new oa(e.largestBatchId,da(r.gt,e.overlayMutation))}function ed(r,e){const t=e.path.lastSegment();return[r,Ce(e.path.popLast()),t]}function td(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:fn(n.readTime),documentKey:Ce(n.documentKey.path),largestBatchId:n.largestBatchId}}class h_{getBundleMetadata(e,t){return nd(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:mn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return nd(e).put({bundleId:(i=t).id,createTime:fn(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return rd(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:Es(s.bundledQuery),readTime:mn(s.readTime)};var s})}saveNamedQuery(e,t){return rd(e).put({name:(i=t).name,readTime:fn(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function nd(r){return ve(r,Zi)}function rd(r){return ve(r,es)}class vs{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){return new vs(e,t.uid||"")}getOverlay(e,t){return si(e).get(ed(this.userId,t)).next(n=>n?fa(this.serializer,n):null)}getOverlays(e,t){const n=lt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new oa(t,a);i.push(this.wt(e,u))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(Ce(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(si(e).Y(Uo,u))}),R.waitFor(s)}getOverlaysForCollection(e,t,n){const i=lt(),s=Ce(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return si(e).j(Uo,a).next(u=>{for(const c of u){const h=fa(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=lt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return si(e).X({index:Vl,range:u},(c,h,f)=>{const m=fa(this.serializer,h);s.size()<i||m.largestBatchId===a?(s.set(m.getKey(),m),a=m.largestBatchId):f.done()}).next(()=>s)}wt(e,t){return si(e).put(function(i,s,a){const[u,c,h]=ed(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:ri(i.gt,a.mutation)}}(this.serializer,this.userId,t))}}function si(r){return ve(r,ts)}class d_{St(e){return ve(e,jo)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{const n=t?.value;return n?pe.fromUint8Array(n):pe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class pn{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(fe(e.integerValue));else if("doubleValue"in e){const n=fe(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),Nr(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&&(n=gt(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(pt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?$l(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):us(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):q(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const n=e.fields||{};this.Ct(t,55);for(const i of Object.keys(n))this.xt(i,t),this.Dt(n[i],t)}Lt(e,t){var n,i;const s=e.fields||{};this.Ct(t,53);const a=$n,u=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.Ct(t,15),t.Ft(fe(u)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){const n=e.values||[];this.Ct(t,50);for(const i of n)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),F.fromName(e).path.forEach(n=>{this.Ct(t,60),this.$t(n,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}function f_(r){if(0===r)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function id(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=f_(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}pn.Ut=new pn;class m_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Wt(n.value),n=t.next();this.Gt()}zt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.jt(n.value),n=t.next();this.Jt()}Ht(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{const i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{const i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){const t=this.Xt(e),n=id(t);this.en(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){const t=this.Xt(e),n=id(t);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(255),this.rn(255)}sn(){this._n(255),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Wt(e){const t=255&e;0===t?(this.rn(0),this.rn(255)):255===t?(this.rn(255),this.rn(0)):this.rn(t)}jt(e){const t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class g_{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class p_{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class oi{constructor(){this.un=new m_,this.cn=new g_(this.un),this.ln=new p_(this.un)}seed(e){this.un.seed(e)}hn(e){return 0===e?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}class _n{constructor(e,t,n,i){this.Pn=e,this.Tn=t,this.In=n,this.dn=i}En(){const e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new _n(this.Pn,this.Tn,this.In,n)}An(e,t,n){return{indexId:this.Pn,uid:e,arrayValue:As(this.In),directionalValue:As(this.dn),orderedDocumentKey:As(t),documentKey:n.path.toArray()}}Rn(e,t,n){const i=this.An(e,t,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function qt(r,e){let t=r.Pn-e.Pn;return 0!==t?t:(t=sd(r.In,e.In),0!==t?t:(t=sd(r.dn,e.dn),0!==t?t:F.comparator(r.Tn,e.Tn)))}function sd(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}function As(r){return(0,W.Ov)()?function(t){let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}(r):r}function od(r){return"string"!=typeof r?r:function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(r)}class ad{constructor(e){this.Vn=new ie((t,n)=>le.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(e){if(U(e.collectionGroup===this.collectionId,49279),this.gn)return!1;const t=No(e);if(void 0!==t&&!this.yn(t))return!1;const n=nn(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.yn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Vn.size>0){const u=this.Vn.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.wn(u,c)||!this.Sn(this.mn[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.mn.length||!this.Sn(this.mn[a++],n[s]))return!1;return!0}bn(){if(this.gn)return null;let e=new ie(le.comparator);const t=[];for(const n of this.fn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new rn(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new rn(n.field,0))}for(const n of this.mn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new rn(n.field,"asc"===n.dir?0:1)));return new Ln(Ln.UNKNOWN_ID,this.collectionId,t,qn.empty())}yn(e){for(const t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ud(r){var e,t;if(U(r instanceof Y||r instanceof se,20012),r instanceof Y){if(r instanceof sh){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(r.field,"==",s)))||[];return se.create(i,"or")}return r}const n=r.filters.map(i=>ud(i));return se.create(n,r.op)}function __(r){if(0===r.getFilters().length)return[];const e=pa(ud(r));return U(cd(e),7391),ma(e)||ga(e)?[e]:e.getFilters()}function ma(r){return r instanceof Y}function ga(r){return r instanceof se&&Xo(r)}function cd(r){return ma(r)||ga(r)||function(t){if(t instanceof se&&Ho(t)){for(const n of t.getFilters())if(!ma(n)&&!ga(n))return!1;return!0}return!1}(r)}function pa(r){if(U(r instanceof Y||r instanceof se,34018),r instanceof Y)return r;if(1===r.filters.length)return pa(r.filters[0]);const e=r.filters.map(n=>pa(n));let t=se.create(e,r.op);return t=ws(t),cd(t)?t:(U(t instanceof se,64498),U(Wn(t),40251),U(t.filters.length>1,57927),t.filters.reduce((n,i)=>_a(n,i)))}function _a(r,e){let t;return U(r instanceof Y||r instanceof se,38388),U(e instanceof Y||e instanceof se,25473),t=r instanceof Y?e instanceof Y?se.create([r,e],"and"):ld(r,e):e instanceof Y?ld(e,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0,48005),Wn(i)&&Wn(s))return nh(i,s.getFilters());const a=Ho(i)?i:s,u=Ho(i)?s:i,c=a.filters.map(h=>_a(h,u));return se.create(c,"or")}(r,e),ws(t)}function ld(r,e){if(Wn(e))return nh(e,r.getFilters());{const t=e.filters.map(n=>_a(r,n));return se.create(t,"or")}}function ws(r){if(U(r instanceof Y||r instanceof se,11850),r instanceof Y)return r;const e=r.getFilters();if(1===e.length)return ws(e[0]);if(eh(r))return r;const t=e.map(i=>ws(i)),n=[];return t.forEach(i=>{i instanceof Y?n.push(i):i instanceof se&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:se.create(n,r.op)}class y_{constructor(){this.Dn=new ya}addToCollectionParentIndex(e,t){return this.Dn.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(We.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(We.min())}updateCollectionGroup(e,t,n){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class ya{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ie(H.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ie(H.comparator)).toArray()}}const hd="IndexedDbIndexManager",Rs=new Uint8Array(0);class I_{constructor(e,t){this.databaseId=t,this.vn=new ya,this.Cn=new yt(n=>ln(n),(n,i)=>$r(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const s={collectionId:n,parent:Ce(i)};return dd(e).put(s)}return R.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[il(t),""],!1,!0);return dd(e).j(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(ut(a.parent))}return n})}addFieldIndex(e,t){const n=ai(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=or(e);return s.next(u=>{a.put(td(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=ai(e),i=or(e),s=sr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ai(e),n=sr(e),i=or(e);return t.Y().next(()=>n.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return R.forEach(this.Fn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new ad(n).bn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=sr(e);let i=!0;const s=new Map;return R.forEach(this.Fn(t),a=>this.Mn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=$();const u=[];return R.forEach(s,(c,h)=>{var B;k(hd,`Using index ${B=c,`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`} to execute ${ln(t)}`);const f=function(B,G){const J=No(G);if(void 0===J)return null;for(const Q of ls(B,J.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,c),m=function(B,G){const J=new Map;for(const Q of nn(G))for(const T of ls(B,Q.fieldPath))switch(T.op){case"==":case"in":J.set(Q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return J.set(Q.fieldPath.canonicalString(),T.value),Array.from(J.values())}return null}(h,c),p=function(B,G){const J=[];let Q=!0;for(const T of nn(G)){const _=0===T.kind?oh(B,T.fieldPath,B.startAt):ah(B,T.fieldPath,B.startAt);J.push(_.value),Q&&(Q=_.inclusive)}return new Mt(J,Q)}(h,c),A=function(B,G){const J=[];let Q=!0;for(const T of nn(G)){const _=0===T.kind?ah(B,T.fieldPath,B.endAt):oh(B,T.fieldPath,B.endAt);J.push(_.value),Q&&(Q=_.inclusive)}return new Mt(J,Q)}(h,c),b=this.xn(c,h,p),N=this.xn(c,h,A),D=this.On(c,h,m),L=this.Nn(c.indexId,f,b,p.inclusive,N,A.inclusive,D);return R.forEach(L,j=>n.H(j,t.limit).next(B=>{B.forEach(G=>{const J=F.fromSegments(G.documentKey);a.has(J)||(a=a.add(J),u.push(J))})}))}).next(()=>u)}return R.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:__(se.create(e.filters,"and")).map(n=>Yo(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let m=0;m<c;++m){const p=t?this.Bn(t[m/h]):Rs,A=this.Ln(e,p,n[m%h],i),b=this.kn(e,p,s[m%h],a),N=u.map(D=>this.Ln(e,p,D,!0));f.push(...this.createRange(A,b,N))}return f}Ln(e,t,n,i){const s=new _n(e,F.empty(),t,n);return i?s:s.En()}kn(e,t,n,i){const s=new _n(e,F.empty(),t,n);return i?s.En():s}Mn(e,t){const n=new ad(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.Fn(t);return R.forEach(i,s=>this.Mn(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new ie(le.comparator),f=!1;for(const m of c.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||("array-contains"===p.op||"array-contains-any"===p.op?f=!0:h=h.add(p.field));for(const m of c.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}qn(e,t){const n=new oi;for(const i of nn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.hn(i.kind);pn.Ut.bt(s,a)}return n.an()}Bn(e){const t=new oi;return pn.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){const n=new oi;return pn.Ut.bt(cn(this.databaseId,t),n.hn(function(s){const a=nn(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.an()}On(e,t,n){if(null===n)return[];let i=[];i.push(new oi);let s=0;for(const a of nn(e)){const u=n[s++];for(const c of i)if(this.$n(t,a.fieldPath)&&zr(u))i=this.Un(i,a,u);else{const h=c.hn(a.kind);pn.Ut.bt(u,h)}}return this.Kn(i)}xn(e,t,n){return this.On(e,t,n.position)}Kn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].an();return t}Un(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new oi;c.seed(u.an()),pn.Ut.bt(a,c.hn(t.kind)),s.push(c)}return s}$n(e,t){return!!e.filters.find(n=>n instanceof Y&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=ai(e),i=or(e);return(t?n.j(Bo,IDBKeyRange.bound(t,t)):n.j()).next(s=>{const a=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,m){const p=m?new qn(m.sequenceNumber,new We(mn(m.readTime),new F(ut(m.documentKey)),m.largestBatchId)):qn.empty(),A=f.fields.map(([b,N])=>new rn(le.fromServerFormat(b),N));return new Ln(f.indexId,f.collectionGroup,A,p)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:K(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=ai(e),s=or(e);return this.Wn(e).next(a=>i.j(Bo,IDBKeyRange.bound(t,t)).next(u=>R.forEach(u,c=>s.put(td(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return R.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),R.forEach(u,c=>this.Gn(e,i,c).next(h=>{const f=this.zn(s,c);return h.isEqual(f)?R.resolve():this.jn(e,s,c,h,f)}))))})}Jn(e,t,n,i){return sr(e).put(i.An(this.uid,this.Qn(n,t.key),t.key))}Hn(e,t,n,i){return sr(e).delete(i.Rn(this.uid,this.Qn(n,t.key),t.key))}Gn(e,t,n){const i=sr(e);let s=new ie(qt);return i.X({index:Pl,range:IDBKeyRange.only([n.indexId,this.uid,As(this.Qn(n,t))])},(a,u)=>{s=s.add(new _n(n.indexId,t,od(u.arrayValue),od(u.directionalValue)))}).next(()=>s)}zn(e,t){let n=new ie(qt);const i=this.qn(t,e);if(null==i)return n;const s=No(t);if(null!=s){const a=e.data.field(s.fieldPath);if(zr(a))for(const u of a.arrayValue.values||[])n=n.add(new _n(t.indexId,e.key,this.Bn(u),i))}else n=n.add(new _n(t.indexId,e.key,Rs,i));return n}jn(e,t,n,i,s){k(hd,"Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,m,p){const A=c.getIterator(),b=h.getIterator();let N=Gn(A),D=Gn(b);for(;N||D;){let L=!1,j=!1;if(N&&D){const B=f(N,D);B<0?j=!0:B>0&&(L=!0)}else null!=N?j=!0:L=!0;L?(m(D),D=Gn(b)):j?(p(N),N=Gn(A)):(N=Gn(A),D=Gn(b))}}(i,s,qt,u=>{a.push(this.Jn(e,t,n,u))},u=>{a.push(this.Hn(e,t,n,u))}),R.waitFor(a)}Wn(e){let t=1;return or(e).X({index:Rl,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>qt(a,u)).filter((a,u,c)=>!u||0!==qt(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=qt(a,e),c=qt(a,t);if(0===u)i[0]=e.En();else if(u>0&&c<0)i.push(a),i.push(a.En());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Yn(i[a],i[a+1]))return[];const u=i[a].Rn(this.uid,Rs,F.empty()),c=i[a+1].Rn(this.uid,Rs,F.empty());s.push(IDBKeyRange.bound(u,c))}return s}Yn(e,t){return qt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(fd)}getMinOffset(e,t){return R.mapArray(this.Fn(t),n=>this.Mn(e,n).next(i=>i||q(44426))).next(fd)}}function dd(r){return ve(r,Mr)}function sr(r){return ve(r,qr)}function ai(r){return ve(r,qo)}function or(r){return ve(r,Lr)}function fd(r){U(0!==r.length,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;ko(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new We(e.readTime,e.documentKey,t)}const md={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ne{static withCacheSize(e){return new Ne(e,Ne.DEFAULT_COLLECTION_PERCENTILE,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function pd(r,e,t){const n=r.store(et),i=r.store(Un),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.X({range:a},(f,m,p)=>(u++,p.delete()));s.push(c.next(()=>{U(1===u,47070,{batchId:t.batchId})}));const h=[];for(const f of t.mutations){const m=vl(e,f.key.path,t.batchId);s.push(i.delete(m)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function Ps(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw q(14731);e=r.noDocument}return JSON.stringify(e).length}Ne.DEFAULT_COLLECTION_PERCENTILE=10,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ne.DEFAULT=new Ne(41943040,Ne.DEFAULT_COLLECTION_PERCENTILE,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ne.DISABLED=new Ne(-1,0,0);class Vs{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Zn={}}static yt(e,t,n,i){U(""!==e.uid,64387);const s=e.isAuthenticated()?e.uid:"";return new Vs(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bt(e).X({index:an,range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=ar(e),a=Bt(e);return a.add({}).next(u=>{U("number"==typeof u,49019);const c=new ia(u,t,n,i),h=function(A,b,N){const D=N.baseMutations.map(j=>ri(A.gt,j)),L=N.mutations.map(j=>ri(A.gt,j));return{userId:b,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:L}}(this.serializer,this.userId,c),f=[];let m=new ie((p,A)=>K(p.canonicalString(),A.canonicalString()));for(const p of i){const A=vl(this.userId,p.key.path,u);m=m.add(p.key.path.popLast()),f.push(a.put(h)),f.push(s.put(A,ep))}return m.forEach(p=>{f.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Zn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Bt(e).get(t).next(n=>n?(U(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),gn(this.serializer,n)):null)}Xn(e,t){return this.Zn[t]?R.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Bt(e).X({index:an,range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n,47524,{er:n}),s=gn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Bt(e).X({index:an,range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bt(e).j(an,t).next(n=>n.map(i=>gn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Hi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return ar(e).X({range:i},(a,u,c)=>{const[h,f,m]=a,p=ut(f);if(h===this.userId&&t.path.isEqual(p))return Bt(e).get(m).next(A=>{if(!A)throw q(61480,{tr:a,batchId:m});U(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:m}),s.push(gn(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ie(K);const i=[];return t.forEach(s=>{const a=Hi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=ar(e).X({range:u},(h,f,m)=>{const[p,A,b]=h,N=ut(A);p===this.userId&&s.path.isEqual(N)?n=n.add(b):m.done()});i.push(c)}),R.waitFor(i).next(()=>this.nr(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Hi(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new ie(K);return ar(e).X({range:a},(c,h,f)=>{const[m,p,A]=c,b=ut(p);m===this.userId&&n.isPrefixOf(b)?b.length===i&&(u=u.add(A)):f.done()}).next(()=>this.nr(e,u))}nr(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Bt(e).get(s).next(a=>{if(null===a)throw q(35274,{batchId:s});U(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:s}),n.push(gn(this.serializer,a))}))}),R.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return pd(e.ce,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),R.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return ar(e).X({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=ut(s[1]);i.push(c)}else u.done()}).next(()=>{U(0===i.length,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return _d(e,this.userId,t)}sr(e){return yd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function _d(r,e,t){const n=Hi(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return ar(r).X({range:s,Z:!0},(u,c,h)=>{const[f,m,p]=u;f===e&&m===i&&(a=!0),h.done()}).next(()=>a)}function Bt(r){return ve(r,et)}function ar(r){return ve(r,Un)}function yd(r){return ve(r,Fr)}class yn{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new yn(0)}static ur(){return new yn(-1)}}class T_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{const n=new yn(t.highestTargetId);return t.highestTargetId=n.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>z.fromTimestamp(new ne(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(n=>(n.targetCount+=1,this.Pr(t,n),this.lr(e,n))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ur(e).delete(t.targetId)).next(()=>this.cr(e)).next(n=>(U(n.targetCount>0,8065),n.targetCount-=1,this.lr(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return ur(e).X((a,u)=>{const c=ii(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ur(e).X((n,i)=>{const s=ii(i);t(s)})}cr(e){return Id(e).get(Yi).next(t=>(U(null!==t,2888),t))}lr(e,t){return Id(e).put(Yi,t)}hr(e,t){return ur(e).put(Zh(this.serializer,t))}Pr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){const n=ln(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return ur(e).X({range:i,index:wl},(a,u,c)=>{const h=ii(u);$r(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Ut(e);return t.forEach(a=>{const u=Ce(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),R.waitFor(i)}removeMatchingKeys(e,t,n){const i=Ut(e);return R.forEach(t,s=>{const a=Ce(s.path);return R.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Ut(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ut(e);let s=$();return i.X({range:n,Z:!0},(a,u,c)=>{const h=ut(a[1]),f=new F(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=Ce(t.path),i=IDBKeyRange.bound([n],[il(n)],!1,!0);let s=0;return Ut(e).X({index:Lo,Z:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}Et(e,t){return ur(e).get(t).next(n=>n?ii(n):null)}}function ur(r){return ve(r,jn)}function Id(r){return ve(r,un)}function Ut(r){return ve(r,zn)}const Td="LruGarbageCollector";function vd([r,e],[t,n]){const i=K(r,t);return 0===i?K(e,n):i}class E_{constructor(e){this.Tr=e,this.buffer=new ie(vd),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();vd(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ad{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){var t=this;k(Td,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,x.A)(function*(){t.Ar=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){xt(n)?k(Td,"Ignoring IndexedDB error during garbage collection: ",n):yield bt(n)}yield t.Rr(3e5)}))}}class v_{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return R.resolve(Xe.ue);const n=new E_(t);return this.Vr.forEachTarget(e,i=>n.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>n.Er(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(md)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),md):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,u=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(h=Date.now(),Fn()<=st.$b.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${m} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}}function wd(r,e){return new v_(r,e)}class A_{constructor(e,t){this.db=e,this.garbageCollector=wd(this,t)}mr(e){const t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}yr(e){let t=0;return this.gr(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(n,i)=>t(i))}addReference(e,t,n){return Ss(e,n)}removeReference(e,t,n){return Ss(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ss(e,t)}Sr(e,t){return function(i,s){let a=!1;return yd(i).ee(u=>_d(i,u,s).next(c=>(c&&(a=!0),R.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.wr(e,(a,u)=>{if(u<=t){const c=this.Sr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,z.min()),Ut(e).delete([0,Ce(a.path)])))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ss(e,t)}wr(e,t){const n=Ut(e);let i,s=Xe.ue;return n.X({index:Lo},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==Xe.ue&&t(new F(ut(i)),s),s=h,i=c):s=Xe.ue}).next(()=>{s!==Xe.ue&&t(new F(ut(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ss(r,e){return Ut(r).put((i=r.currentSequenceNumber,{targetId:0,path:Ce(e.path),sequenceNumber:i}));var i}class Rd{constructor(){this.changes=new yt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,he.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?R.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class w_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return In(e).put(n)}removeEntry(e,t,n){return In(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ts(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=he.newInvalidDocument(t);return In(e).X({index:Ji,range:IDBKeyRange.only(ui(t))},(i,s)=>{n=this.Dr(t,s)}).next(()=>n)}vr(e,t){let n={size:0,document:he.newInvalidDocument(t)};return In(e).X({index:Ji,range:IDBKeyRange.only(ui(t))},(i,s)=>{n={document:this.Dr(t,s),size:Ps(s)}}).next(()=>n)}getEntries(e,t){let n=Qe();return this.Cr(e,t,(i,s)=>{const a=this.Dr(i,s);n=n.insert(i,a)}).next(()=>n)}Fr(e,t){let n=Qe(),i=new ce(F.comparator);return this.Cr(e,t,(s,a)=>{const u=this.Dr(s,a);n=n.insert(s,u),i=i.insert(s,Ps(a))}).next(()=>({documents:n,Mr:i}))}Cr(e,t,n){if(t.isEmpty())return R.resolve();let i=new ie(bd);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(ui(i.first()),ui(i.last())),a=i.getIterator();let u=a.getNext();return In(e).X({index:Ji,range:s},(c,h,f)=>{const m=F.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&bd(u,m)<0;)n(u,null),u=a.getNext();u&&u.isEqual(m)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.G(ui(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Ts(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return In(e).j(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Qe();for(const m of h){const p=this.Dr(F.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Wr(t,p)||i.has(p.key))&&(f=f.insert(p.key,p))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=Qe();const a=Sd(t,n),u=Sd(t,We.max());return In(e).X({index:Al,range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const m=this.Dr(F.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new R_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Vd(e).get(Mo).next(t=>(U(!!t,20021),t))}br(e,t){return Vd(e).put(Mo,t)}Dr(e,t){if(t){const n=function l_(r,e){let t;if(e.document)t=ys(r.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=F.fromSegments(e.noDocument.path),i=mn(e.noDocument.readTime);t=he.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return q(56709);{const n=F.fromSegments(e.unknownDocument.path),i=mn(e.unknownDocument.version);t=he.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new ne(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(z.min()))return n}return he.newInvalidDocument(e)}}function Pd(r){return new w_(r)}class R_ extends Rd{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new yt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ie((s,a)=>K(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=Yh(this.Or.serializer,a);i=i.add(s.path.popLast());const h=Ps(c);n+=h-u.size,t.push(this.Or.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=Yh(this.Or.serializer,a.convertToNoDocument(z.min()));t.push(this.Or.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,n)),R.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(n=>(this.Nr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:n,Mr:i})=>(i.forEach((s,a)=>{this.Nr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function Vd(r){return ve(r,Or)}function In(r){return ve(r,Xi)}function ui(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Sd(r,e){const t=e.documentKey.path.toArray();return[r,Ts(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function bd(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=K(t[s],n[s]),i)return i;return i=K(t.length,n.length),i||(i=K(t[t.length-2],n[n.length-2]),i||K(t[t.length-1],n[n.length-1]))}class P_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class xd{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Yr(n.mutation,i,$e.empty(),ne.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,$()).next(()=>n))}getLocalViewOfDocuments(e,t,n=$()){const i=lt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Hr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=lt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,$()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=Qe();const a=Xr(),u=Xr();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof It)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Yr(f.mutation,h,f.mutation.getFieldMask(),ne.now())):a.set(h.key,$e.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var m;return u.set(h,new P_(f,null!==(m=a.get(h))&&void 0!==m?m:null))}),u))}recalculateAndSaveOverlays(e,t){const n=Xr();let i=new ce((a,u)=>a-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||$e.empty();f=u.applyToLocalView(h,f),n.set(c,f);const m=(i.get(u.batchId)||$()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,m=_h();f.forEach(p=>{if(!s.has(p)){const A=Rh(t.get(p),n.get(p));null!==A&&m.set(p,A),s=s.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return R.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return F.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Zo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):R.resolve(lt());let u=-1,c=s;return a.next(h=>R.forEach(h,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(p=>{c=c.insert(f,p)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,$())).next(f=>({batchId:u,changes:ph(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(n=>{let i=Hr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=Hr();return this.indexManager.getCollectionParents(e,s).next(u=>R.forEach(u,c=>{const h=(m=t,p=c.child(s),new _t(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,p;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,he.newInvalidDocument(f)))});let u=Hr();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Yr(f.mutation,h,$e.empty(),ne.now()),Wr(t,h)&&(u=u.insert(c,h))}),u})}}class V_{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return R.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),R.resolve();var i}getNamedQuery(e,t){return R.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,{name:(i=t).name,query:Es(i.bundledQuery),readTime:Ie(i.readTime)}),R.resolve();var i}}class S_{constructor(){this.overlays=new ce(F.comparator),this.kr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const n=lt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.wt(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.kr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(n)),R.resolve()}getOverlaysForCollection(e,t,n){const i=lt(),s=t.length+1,a=new F(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ce((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=lt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=lt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return R.resolve(u)}wt(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.kr.get(i.largestBatchId).delete(n.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new oa(t,n));let s=this.kr.get(t);void 0===s&&(s=$(),this.kr.set(t,s)),this.kr.set(t,s.add(n.key))}}class b_{constructor(){this.sessionToken=pe.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class Ia{constructor(){this.qr=new ie(Re.Qr),this.$r=new ie(Re.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const n=new Re(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Wr(new Re(e,t))}Gr(e,t){e.forEach(n=>this.removeReference(n,t))}zr(e){const t=new F(new H([])),n=new Re(t,e),i=new Re(t,e+1),s=[];return this.$r.forEachInRange([n,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new F(new H([])),n=new Re(t,e),i=new Re(t,e+1);let s=$();return this.$r.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Re(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Re{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return F.comparator(e.key,t.key)||K(e.Hr,t.Hr)}static Ur(e,t){return K(e.Hr,t.Hr)||F.comparator(e.key,t.key)}}class x_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ie(Re.Qr)}checkEmpty(e){return R.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.er;this.er++;const a=new ia(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.Yr=this.Yr.add(new Re(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Xr(t+1),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Re(t,0),i=new Re(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([n,i],a=>{const u=this.Zr(a.Hr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ie(K);return t.forEach(i=>{const s=new Re(i,0),a=new Re(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],u=>{n=n.add(u.Hr)})}),R.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;F.isDocumentKey(s)||(s=s.child(""));const a=new Re(new F(s),0);let u=new ie(K);return this.Yr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Hr)),!0)},a),R.resolve(this.ei(u))}ei(e){const t=[];return e.forEach(n=>{const i=this.Zr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){U(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return R.forEach(t.mutations,i=>{const s=new Re(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){const n=new Re(t,0),i=this.Yr.firstAfterOrEqual(n);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return R.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class C_{constructor(e){this.ni=e,this.docs=new ce(F.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return R.resolve(n?n.document.mutableCopy():he.newInvalidDocument(t))}getEntries(e,t){let n=Qe();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():he.newInvalidDocument(i))}),R.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Qe();const a=t.path,u=new F(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||ko(fl(f),n)<=0||(i.has(f.key)||Wr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,n,i){q(9500)}ri(e,t){return R.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new D_(this)}getSize(e){return R.resolve(this.size)}}class D_ extends Rd{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(n)}),R.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class N_{constructor(e){this.persistence=e,this.ii=new yt(t=>ln(t),$r),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.si=0,this.oi=new Ia,this.targetCount=0,this._i=yn.ar()}forEachTarget(e,t){return this.ii.forEach((n,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),R.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new yn(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.hr(t),R.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const n=this.ii.get(t)||null;return R.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),R.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const n=this.oi.Jr(t);return R.resolve(n)}containsKey(e,t){return R.resolve(this.oi.containsKey(t))}}class Ta{constructor(e,t){this.ai={},this.overlays={},this.ui=new Xe(0),this.ci=!1,this.ci=!0,this.li=new b_,this.referenceDelegate=e(this),this.hi=new N_(this),this.indexManager=new y_,this.remoteDocumentCache=new C_(n=>this.referenceDelegate.Pi(n)),this.serializer=new Jh(t),this.Ti=new V_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new S_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new x_(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);const i=new k_(this.ui.next());return this.referenceDelegate.Ii(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return R.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}}class k_ extends gl{constructor(e){super(),this.currentSequenceNumber=e}}class bs{constructor(e){this.persistence=e,this.Ai=new Ia,this.Ri=null}static Vi(e){return new bs(e)}get mi(){if(this.Ri)return this.Ri;throw q(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),R.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),R.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.mi,n=>{const i=F.fromPath(n);return this.fi(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(n=>{n?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return R.or([()=>R.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class xs{constructor(e,t){this.persistence=e,this.gi=new yt(n=>Ce(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=wd(this,t)}static Vi(e,t){return new xs(e,t)}Ii(){}di(e){return R.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}yr(e){let t=0;return this.gr(e,n=>{t++}).next(()=>t)}gr(e,t){return R.forEach(this.gi,(n,i)=>this.Sr(e,n,i).next(s=>s?R.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(u=>{u||(n++,s.removeEntry(a,z.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),R.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),R.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),R.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),R.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=os(e.data.value)),t}Sr(e,t,n){return R.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.gi.get(t);return R.resolve(void 0!==i&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class F_{constructor(e){this.serializer=e}q(e,t,n,i){const s=new Qi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore(kr),(c=e).createObjectStore(Fr,{keyPath:"userId"}),c.createObjectStore(et,{keyPath:Tl,autoIncrement:!0}).createIndex(an,El,{unique:!0}),c.createObjectStore(Un),Cd(e),function(c){c.createObjectStore(on)}(e));let a=R.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore(zn),c.deleteObjectStore(jn),c.deleteObjectStore(un)}(e),Cd(e)),a=a.next(()=>function(c){const h=c.store(un),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(Yi,f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store(et).j().next(m=>{c.deleteObjectStore(et),c.createObjectStore(et,{keyPath:Tl,autoIncrement:!0}).createIndex(an,El,{unique:!0});const p=h.store(et),A=m.map(b=>p.put(b));return R.waitFor(A)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore(Kn,{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.pi(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore(Or)}(e),this.yi(s)))),n<7&&i>=7&&(a=a.next(()=>this.wi(s))),n<8&&i>=8&&(a=a.next(()=>this.Si(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.bi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(Zi,{keyPath:"bundleId"})})(e),function(c){c.createObjectStore(es,{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore(ts,{keyPath:_p});h.createIndex(Uo,yp,{unique:!1}),h.createIndex(Vl,Ip,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore(Xi,{keyPath:tp});h.createIndex(Ji,np),h.createIndex(Al,rp)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(on))),n<14&&i>=14&&(a=a.next(()=>this.Ci(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore(qo,{keyPath:"indexId",autoIncrement:!0}).createIndex(Bo,"collectionGroup",{unique:!1}),c.createObjectStore(Lr,{keyPath:fp}).createIndex(Rl,mp,{unique:!1}),c.createObjectStore(qr,{keyPath:gp}).createIndex(Pl,pp,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore(Lr).clear()}).next(()=>{t.objectStore(qr).clear()})),n<17&&i>=17&&(a=a.next(()=>{!function(c){c.createObjectStore(jo,{keyPath:"name"})}(e)})),n<18&&i>=18&&(0,W.Ov)()&&(a=a.next(()=>{t.objectStore(Lr).clear()}).next(()=>{t.objectStore(qr).clear()})),a}yi(e){let t=0;return e.store(on).X((n,i)=>{t+=Ps(i)}).next(()=>{const n={byteSize:t};return e.store(Or).put(Mo,n)})}pi(e){const t=e.store(Fr),n=e.store(et);return t.j().next(i=>R.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.j(an,a).next(u=>R.forEach(u,c=>{U(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const h=gn(this.serializer,c);return pd(e,s.userId,h).next(()=>{})}))}))}wi(e){const t=e.store(zn),n=e.store(on);return e.store(un).get(Yi).next(i=>{const s=[];return n.X((a,u)=>{const c=new H(a),h=[0,Ce(c)];s.push(t.get(h).next(f=>f?R.resolve():t.put({targetId:0,path:Ce(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>R.waitFor(s))})}Si(e,t){e.createObjectStore(Mr,{keyPath:ap});const n=t.store(Mr),i=new ya,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Ce(c)})}};return t.store(on).X({Z:!0},(a,u)=>{const c=new H(a);return s(c.popLast())}).next(()=>t.store(Un).X({Z:!0},([a,u,c],h)=>{const f=ut(u);return s(f.popLast())}))}bi(e){const t=e.store(jn);return t.X((n,i)=>{const s=ii(i),a=Zh(this.serializer,s);return t.put(a)})}Di(e,t){const n=t.store(on),i=[];return n.X((s,a)=>{const u=t.store(Xi),c=(m=a,m.document?new F(H.fromString(m.document.name).popFirst(5)):m.noDocument?F.fromSegments(m.noDocument.path):m.unknownDocument?F.fromSegments(m.unknownDocument.path):q(36783)).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var m;i.push(u.put(h))}).next(()=>R.waitFor(i))}Ci(e,t){const n=t.store(et),i=Pd(this.serializer),s=new Ta(bs.Vi,this.serializer.gt);return n.j().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:$();gn(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{const f=new Ae(h),m=vs.yt(this.serializer,f),p=s.getIndexManager(f),A=Vs.yt(f,this.serializer,p,s.referenceDelegate);return new xd(i,A,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Ko(t,Xe.ue),c).next()})})}}function Cd(r){r.createObjectStore(zn,{keyPath:sp}).createIndex(Lo,op,{unique:!0}),r.createObjectStore(jn,{keyPath:"targetId"}).createIndex(wl,ip,{unique:!0}),r.createObjectStore(un)}const jt="IndexedDbPersistence",Ea=18e5,Aa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class wa{constructor(e,t,n,i,s,a,u,c,h,f,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Fi=s,this.window=a,this.document=u,this.Mi=h,this.xi=f,this.Oi=m,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=p=>Promise.resolve(),!wa.C())throw new C(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new A_(this,i),this.Qi=t+"main",this.serializer=new Jh(c),this.$i=new at(this.Qi,this.Oi,new F_(this.serializer)),this.li=new d_,this.hi=new T_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Pd(this.serializer),this.Ti=new h_,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===f&&ye(jt,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(P.FAILED_PRECONDITION,Aa);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new Xe(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){var t=this;return this.qi=function(){var n=(0,x.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget((0,x.A)(function*(){t.started&&(yield t.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Cs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(xt(e))return k(jt,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k(jt,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return ci(e).get(Bn).next(t=>R.resolve(this.Xi(t)))}es(e){return Cs(e).delete(this.clientId)}ts(){var e=this;return(0,x.A)(function*(){if(e.isPrimary&&!e.ns(e.ki,Ea)){e.ki=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=ve(n,Kn);return i.j().next(s=>{const a=e.rs(s,Ea),u=s.filter(c=>-1===a.indexOf(c));return R.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Ui)for(const n of t)e.Ui.removeItem(e.ss(n.clientId))}})()}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?R.resolve(!0):ci(e).get(Bn).next(t=>{if(null!==t&&this.ns(t.leaseTimestampMs,5e3)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new C(P.FAILED_PRECONDITION,Aa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Cs(e).j().next(n=>void 0===this.rs(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&k(jt,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,x.A)(function*(){e.ci=!1,e.us(),e.Li&&(e.Li.cancel(),e.Li=null),e.cs(),e.ls(),yield e.$i.runTransaction("shutdown","readwrite",[kr,Kn],t=>{const n=new Ko(t,Xe.ue);return e.Yi(n).next(()=>e.es(n))}),e.$i.close(),e.hs()})()}rs(e,t){return e.filter(n=>this.ns(n.updateTimeMs,t)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>Cs(e).j().next(t=>this.rs(t,Ea).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return Vs.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new I_(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return vs.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,n){k(jt,"Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=18===(c=this.Oi)?Ap:17===c?Cl:16===c?vp:15===c?zo:14===c?xl:13===c?bl:12===c?Ep:11===c?Sl:void q(60245);var c;let a;return this.$i.runTransaction(e,i,s,u=>(a=new Ko(u,this.ui?this.ui.next():Xe.ue),"readwrite-primary"===t?this.Ji(a).next(c=>!!c||this.Hi(a)).next(c=>{if(!c)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new C(P.FAILED_PRECONDITION,ml);return n(a)}).next(c=>this.Zi(a).next(()=>c)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(e){return ci(e).get(Bn).next(t=>{if(null!==t&&this.ns(t.leaseTimestampMs,5e3)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(P.FAILED_PRECONDITION,Aa)})}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ci(e).put(Bn,t)}static C(){return at.C()}Yi(e){const t=ci(e);return t.get(Bn).next(n=>this.Xi(n)?(k(jt,"Releasing primary lease."),t.delete(Bn)):R.resolve())}ns(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground="visible"===this.document.visibilityState)}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ni=()=>{this.us();const t=/(?:Version|Mobile)\/1[456]/;(0,W.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{const n=null!==(null===(t=this.Ui)||void 0===t?void 0:t.getItem(this.ss(e)));return k(jt,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye(jt,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ci(r){return ve(r,kr)}function Cs(r){return ve(r,Kn)}function Ra(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Pa{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=i}static Es(e,t){let n=$(),i=$();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Pa(e,t.fromCache,n,i)}}class O_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Nd{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(0,W.nr)()?8:pl((0,W.ZQ)())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new O_;return this.ws(e,t,a).next(u=>{if(s.result=u,this.Rs)return this.Ss(e,t,a,u.size)})}).next(()=>s.result)}Ss(e,t,n,i){return n.documentReadCount<this.Vs?(Fn()<=st.$b.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Jn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),R.resolve()):(Fn()<=st.$b.DEBUG&&k("QueryEngine","Query:",Jn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.fs*i?(Fn()<=st.$b.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Jn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,De(t))):R.resolve())}ps(e,t){if(ch(t))return R.resolve(null);let n=De(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=hs(t,null,"F"),n=De(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=$(...s);return this.gs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.bs(t,u);return this.Ds(t,h,a,c.readTime)?this.ps(e,hs(t,null,"F")):this.vs(e,h,t,c)}))})))}ys(e,t,n,i){return ch(t)||i.isEqual(z.min())?R.resolve(null):this.gs.getDocuments(e,n).next(s=>{const a=this.bs(t,s);return this.Ds(t,a,n,i)?R.resolve(null):(Fn()<=st.$b.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Jn(t)),this.vs(e,a,t,dl(i,-1)).next(u=>u))})}bs(e,t){let n=new ie(mh(e));return t.forEach((i,s)=>{Wr(e,s)&&(n=n.add(s))}),n}Ds(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,n){return Fn()<=st.$b.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Jn(t)),this.gs.getDocumentsMatchingQuery(e,t,We.min(),n)}vs(e,t,n,i){return this.gs.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}const Va="LocalStore";class L_{constructor(e,t,n,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new ce(K),this.Ms=new yt(s=>ln(s),$r),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new xd(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function kd(r,e,t,n){return new L_(r,e,t,n)}function Fd(r,e){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,x.A)(function*(r,e){const t=O(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=$();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({Bs:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function Od(r){const e=O(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function Md(r,e,t){let n=$(),i=$();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Qe();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(z.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):k(Va,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ls:a,ks:i}})}function U_(r,e){const t=O(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function cr(r,e){const t=O(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.hi.getTargetData(n,e).next(s=>s?(i=s,R.resolve(i)):t.hi.allocateTargetId(n).next(a=>(i=new Tt(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.hi.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.Fs.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(n.targetId,n),t.Ms.set(e,n.targetId)),n})}function lr(r,e,t){return ba.apply(this,arguments)}function ba(){return(ba=(0,x.A)(function*(r,e,t){const n=O(r),i=n.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!xt(a))throw a;k(Va,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Fs=n.Fs.remove(e),n.Ms.delete(i.target)})).apply(this,arguments)}function Ds(r,e,t){const n=O(r);let i=z.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const m=O(c),p=m.Ms.get(f);return void 0!==p?R.resolve(m.Fs.get(p)):m.hi.getTargetData(h,f)}(n,a,De(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,e,t?i:z.min(),t?s:$())).next(u=>(Bd(n,fh(e),u),{documents:u,qs:s})))}function Ld(r,e){const t=O(r),n=O(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.Et(s,e).next(a=>a?a.target:null))}function qd(r,e){const t=O(r),n=t.xs.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,dl(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Bd(t,e,i),i))}function Bd(r,e,t){let n=r.xs.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.xs.set(e,n)}function xa(){return(xa=(0,x.A)(function*(r,e,t,n){const i=O(r);let s=$(),a=Qe();for(const h of t){const f=e.Qs(h.metadata.name);h.document&&(s=s.add(f));const m=e.$s(h);m.setReadTime(e.Us(h.metadata.readTime)),a=a.insert(f,m)}const u=i.Os.newChangeBuffer({trackRemovals:!0}),c=yield cr(i,(f=n,De(Hn(H.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Md(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.hi.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.hi.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ls,f.ks)).next(()=>f.Ls)))})).apply(this,arguments)}function z_(r,e){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,x.A)(function*(r,e,t=$()){const n=yield cr(r,De(Es(e.bundledQuery))),i=O(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ie(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Ti.saveNamedQuery(s,e);const u=n.withResumeToken(pe.EMPTY_BYTE_STRING,a);return i.Fs=i.Fs.insert(u.targetId,u),i.hi.updateTargetData(s,u).next(()=>i.hi.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.hi.addMatchingKeys(s,t,n.targetId)).next(()=>i.Ti.saveNamedQuery(s,e))})})).apply(this,arguments)}const Ud="firestore_clients";function jd(r,e){return`${Ud}_${r}_${e}`}const zd="firestore_mutations";function Kd(r,e,t){let n=`${zd}_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}const Gd="firestore_targets";function Da(r,e){return`${Gd}_${r}_${e}`}const dt="SharedClientState";class Ns{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Ks(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new Ns(e,t,i.state,s):(ye(dt,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class li{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ks(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new li(e,n.state,i):(ye(dt,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ks{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=ta();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=yl(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new ks(e,s):(ye(dt,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Na{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Na(t.clientId,t.onlineState):(ye(dt,`Failed to parse online state: ${e}`),null)}}class ka{constructor(){this.activeTargetIds=ta()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fa{constructor(e,t,n,i,s){this.window=e,this.Fi=t,this.persistenceKey=n,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new ce(K),this.started=!1,this.Zs=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=jd(this.persistenceKey,this.js),this.eo=`firestore_sequence_number_${this.persistenceKey}`,this.Ys=this.Ys.insert(this.js,new ka),this.no=new RegExp(`^${Ud}_${a}_([^_]*)$`),this.ro=new RegExp(`^${zd}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Gd}_${a}_(\\d+)$`),this.so=`firestore_online_state_${this.persistenceKey}`,this.oo=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,x.A)(function*(){const t=yield e.syncEngine.Ps();for(const i of t){if(i===e.js)continue;const s=e.getItem(jd(e.persistenceKey,i));if(s){const a=ks.Ks(i,s);a&&(e.Ys=e.Ys.insert(a.clientId,a))}}e._o();const n=e.storage.getItem(e.so);if(n){const i=e.ao(n);i&&e.uo(i)}for(const i of e.Zs)e.Hs(i);e.Zs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,n){this.lo(e,t,n),this.ho(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Da(this.persistenceKey,e));if(i){const s=li.Ks(e,i);s&&(n=s.state)}}return t&&this.Po.Gs(e),this._o(),n}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Da(this.persistenceKey,e))}updateQueryState(e,t,n){this.To(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.ho(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return k(dt,"READ",e,t),t}setItem(e,t){k(dt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){k(dt,"REMOVE",e),this.storage.removeItem(e)}Hs(e){var t=this;const n=e;if(n.storageArea===this.storage){if(k(dt,"EVENT",n.key,n.newValue),n.key===this.Xs)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable((0,x.A)(function*(){if(t.started){if(null!==n.key)if(t.no.test(n.key)){if(null==n.newValue){const i=t.Ao(n.key);return t.Ro(i,null)}{const i=t.Vo(n.key,n.newValue);if(i)return t.Ro(i.clientId,i)}}else if(t.ro.test(n.key)){if(null!==n.newValue){const i=t.mo(n.key,n.newValue);if(i)return t.fo(i)}}else if(t.io.test(n.key)){if(null!==n.newValue){const i=t.po(n.key,n.newValue);if(i)return t.yo(i)}}else if(n.key===t.so){if(null!==n.newValue){const i=t.ao(n.newValue);if(i)return t.uo(i)}}else if(n.key===t.eo){const i=function(a){let u=Xe.ue;if(null!=a)try{const c=JSON.parse(a);U("number"==typeof c,30636,{wo:a}),u=c}catch(c){ye(dt,"Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==Xe.ue&&t.sequenceNumberHandler(i)}else if(n.key===t.oo){const i=t.So(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.bo(s)))}}else t.Zs.push(n)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,n){const i=new Ns(this.currentUser,e,t,n),s=Kd(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){const t=Kd(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){this.storage.setItem(this.so,JSON.stringify({clientId:this.js,onlineState:e}))}To(e,t,n){const i=Da(this.persistenceKey,e),s=new li(e,t,n);this.setItem(i,s.Ws())}Eo(e){const t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){const t=this.no.exec(e);return t?t[1]:null}Vo(e,t){const n=this.Ao(e);return ks.Ks(n,t)}mo(e,t){const n=this.ro.exec(e),i=Number(n[1]);return Ns.Ks(new Ae(void 0!==n[2]?n[2]:null),i,t)}po(e,t){const n=this.io.exec(e),i=Number(n[1]);return li.Ks(i,t)}ao(e){return Na.Ks(e)}So(e){return JSON.parse(e)}fo(e){var t=this;return(0,x.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Do(e.batchId,e.state,e.error);k(dt,`Ignoring mutation for non-active user ${e.user.uid}`)})()}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){const n=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=ta();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class $d{constructor(){this.Fo=new ka,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new ka,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class K_{xo(e){}shutdown(){}}const Qd="ConnectivityMonitor";class Wd{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){k(Qd,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){k(Qd,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Fs=null;function Oa(){return null===Fs?Fs=268435456+Math.round(2147483648*Math.random()):Fs++,"0x"+Fs.toString(16)}const Ma="RestConnection",G_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $_{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${i}`,this.Ko=this.databaseId.database===Ur?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(e,t,n,i,s){const a=Oa(),u=this.Go(e,t.toUriEncodedString());k(Ma,`Sending RPC '${e}' ${a}:`,u,n);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,i,s);const{host:h}=new URL(u),f=(0,W.zJ)(h);return this.jo(e,u,c,n,f).then(m=>(k(Ma,`Received RPC '${e}' ${a}: `,m),m),m=>{throw xe(Ma,`RPC '${e}' ${a} failed with error: `,m,"url: ",u,"request:",n),m})}Jo(e,t,n,i,s,a){return this.Wo(e,t,n,i,s)}zo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+kn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}Go(e,t){return`${this.$o}/v1/${t}:${G_[e]}`}terminate(){}}class Q_{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const ke="WebChannelConnection";class W_ extends $_{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,i,s){const a=Oa();return new Promise((u,c)=>{const h=new Wc;h.setWithCredentials(!0),h.listenOnce(Hc.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Gi.NO_ERROR:const m=h.getResponseJson();k(ke,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),u(m);break;case Gi.TIMEOUT:k(ke,`RPC '${e}' ${a} timed out`),c(new C(P.DEADLINE_EXCEEDED,"Request time out"));break;case Gi.HTTP_ERROR:const p=h.getStatus();if(k(ke,`RPC '${e}' ${a} failed with status:`,p,"response text:",h.getResponseText()),p>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);const b=A?.error;if(b&&b.status&&b.message){const N=function(L){const j=L.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(j)>=0?j:P.UNKNOWN}(b.status);c(new C(N,b.message))}else c(new C(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new C(P.UNAVAILABLE,"Connection failed."));break;default:q(9055,{c_:e,streamId:a,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{k(ke,`RPC '${e}' ${a} completed.`)}});const f=JSON.stringify(i);k(ke,`RPC '${e}' ${a} sending request:`,i),h.send(t,"POST",f,n,15)})}P_(e,t,n){const i=Oa(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Yc(),u=Jc(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");k(ke,`Creating RPC '${e}' stream ${i}: ${f}`,c);const m=a.createWebChannel(f,c);this.T_(m);let p=!1,A=!1;const b=new Q_({Ho:D=>{A?k(ke,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(p||(k(ke,`Opening RPC '${e}' stream ${i} transport.`),m.open(),p=!0),k(ke,`RPC '${e}' stream ${i} sending:`,D),m.send(D))},Yo:()=>m.close()}),N=(D,L,j)=>{D.listen(L,B=>{try{j(B)}catch(G){setTimeout(()=>{throw G},0)}})};return N(m,br.EventType.OPEN,()=>{A||(k(ke,`RPC '${e}' stream ${i} transport opened.`),b.s_())}),N(m,br.EventType.CLOSE,()=>{A||(A=!0,k(ke,`RPC '${e}' stream ${i} transport closed`),b.__(),this.I_(m))}),N(m,br.EventType.ERROR,D=>{A||(A=!0,xe(ke,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),b.__(new C(P.UNAVAILABLE,"The operation could not be completed")))}),N(m,br.EventType.MESSAGE,D=>{var L;if(!A){const j=D.data[0];U(!!j,16349);const B=j,G=B?.error||(null===(L=B[0])||void 0===L?void 0:L.error);if(G){k(ke,`RPC '${e}' stream ${i} received error:`,G);const J=G.status;let Q=function(I){const E=Ee[I];if(void 0!==E)return Dh(E)}(J),T=G.message;void 0===Q&&(Q=P.INTERNAL,T="Unknown error status: "+J+" with message "+G.message),A=!0,b.__(new C(Q,T)),m.close()}else k(ke,`RPC '${e}' stream ${i} received:`,j),b.a_(j)}}),N(u,Xc.STAT_EVENT,D=>{D.stat===Ro.PROXY?k(ke,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Ro.NOPROXY&&k(ke,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{b.o_()},0),b}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Hd(){return typeof window<"u"?window:null}function Os(){return typeof document<"u"?document:null}function Tn(r){return new e_(r,!0)}class La{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-n);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const Xd="PersistentStream";class Jd{constructor(e,t,n,i,s,a,u,c){this.Fi=e,this.w_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new La(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}stop(){var e=this;return(0,x.A)(function*(){e.M_()&&(yield e.close(0))})()}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){var e=this;return(0,x.A)(function*(){if(e.x_())return e.close(0)})()}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){var n=this;return(0,x.A)(function*(){n.q_(),n.Q_(),n.F_.cancel(),n.b_++,4!==e?n.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.U_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.n_(t)})()}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.b_===t&&this.W_(n,i)},n=>{e(()=>{const i=new C(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(i)})})}W_(e,t){const n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{n(()=>this.G_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.C_?this.j_(i):this.onNext(i))})}O_(){var e=this;this.state=5,this.F_.g_((0,x.A)(function*(){e.state=0,e.start()}))}G_(e){return k(Xd,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(k(Xd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H_ extends Jd{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function r_(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:q(39313,{state:h}),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(U(void 0===f||"string"==typeof f,58123),pe.fromBase64String(f||"")):(U(void 0===f||f instanceof Buffer||f instanceof Uint8Array,16193),pe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?P.UNKNOWN:Dh(h.code);return new C(f,h.message||"")}(a);t=new Oh(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=ht(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):z.min(),u=new Se({mapValue:{fields:n.document.fields}}),c=he.newFoundDocument(i,s,a,u);t=new ps(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=ht(r,n.document),s=n.readTime?Ie(n.readTime):z.min(),a=he.newNoDocument(i,s);t=new ps([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=ht(r,n.document);t=new ps([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return q(11601,{At:e});{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new Wp(i,s);t=new Fh(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return z.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?Ie(a.readTime):z.min()}(e);return this.listener.J_(t,n)}H_(e){const t={};t.database=ha(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=cs(c)?{documents:Gh(s,c)}:{query:Is(s,c).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=qh(s,a.resumeToken);const h=ua(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(z.min())>0){u.readTime=nr(s,a.snapshotVersion.toTimestamp());const h=ua(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function s_(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:i})}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.k_(t)}Y_(e){const t={};t.database=ha(this.serializer),t.removeTarget=e,this.k_(t)}}class X_ extends Jd{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return U(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,U(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){U(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=function i_(r,e){return r&&r.length>0?(U(void 0!==e,14353),r.map(t=>function(i,s){let a=Ie(i.updateTime?i.updateTime:s);return a.isEqual(z.min())&&(a=Ie(s)),new Gp(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.ta(n,t)}na(){const e={};e.database=ha(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>ri(this.serializer,n))};this.k_(t)}}class J_{}class Y_ extends J_{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new C(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,la(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(P.UNKNOWN,s.toString())})}Jo(e,t,n,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(e,la(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(P.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class Z_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ye(t),this._a=!1):k("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const En="RemoteStore";class ey{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(u=>{n.enqueueAndForget((0,x.A)(function*(){var c;zt(a)&&(k(En,"Restarting streams for network reachability change."),yield(c=(0,x.A)(function*(f){const m=O(f);m.Ia.add(4),yield hr(m),m.Aa.set("Unknown"),m.Ia.delete(4),yield hi(m)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.Aa=new Z_(n,i)}}function hi(r){return qa.apply(this,arguments)}function qa(){return(qa=(0,x.A)(function*(r){if(zt(r))for(const e of r.da)yield e(!0)})).apply(this,arguments)}function hr(r){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,x.A)(function*(r){for(const e of r.da)yield e(!1)})).apply(this,arguments)}function Ms(r,e){const t=O(r);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),za(t)?ja(t):mr(t).x_()&&Ua(t,e))}function dr(r,e){const t=O(r),n=mr(t);t.Ta.delete(e),n.x_()&&Yd(t,e),0===t.Ta.size&&(n.x_()?n.B_():zt(t)&&t.Aa.set("Unknown"))}function Ua(r,e){if(r.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}mr(r).H_(e)}function Yd(r,e){r.Ra.$e(e),mr(r).Y_(e)}function ja(r){r.Ra=new Xp({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>r.Ta.get(e)||null,lt:()=>r.datastore.serializer.databaseId}),mr(r).start(),r.Aa.aa()}function za(r){return zt(r)&&!mr(r).M_()&&r.Ta.size>0}function zt(r){return 0===O(r).Ia.size}function Zd(r){r.Ra=void 0}function ty(r){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,x.A)(function*(r){r.Aa.set("Online")})).apply(this,arguments)}function ny(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,x.A)(function*(r){r.Ta.forEach((e,t)=>{Ua(r,e)})})).apply(this,arguments)}function ry(r,e){return $a.apply(this,arguments)}function $a(){return($a=(0,x.A)(function*(r,e){Zd(r),za(r)?(r.Aa.la(e),ja(r)):r.Aa.set("Unknown")})).apply(this,arguments)}function iy(r,e,t){return Qa.apply(this,arguments)}function Qa(){return Qa=(0,x.A)(function*(r,e,t){if(r.Aa.set("Online"),e instanceof Oh&&2===e.state&&e.cause)try{yield(n=(0,x.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.Ta.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.Ta.delete(c),s.Ra.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){k(En,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Ls(r,n)}else if(e instanceof ps?r.Ra.Ye(e):e instanceof Fh?r.Ra.it(e):r.Ra.et(e),!t.isEqual(z.min()))try{const n=yield Od(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.Ra.Pt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.Ta.get(h);f&&s.Ta.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.Ta.get(c);if(!f)return;s.Ta.set(c,f.withResumeToken(pe.EMPTY_BYTE_STRING,f.snapshotVersion)),Yd(s,c);const m=new Tt(f.target,c,h,f.sequenceNumber);Ua(s,m)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){k(En,"Failed to raise snapshot:",n),yield Ls(r,n)}var n}),Qa.apply(this,arguments)}function Ls(r,e,t){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,x.A)(function*(r,e,t){if(!xt(e))throw e;r.Ia.add(1),yield hr(r),r.Aa.set("Offline"),t||(t=()=>Od(r.localStore)),r.asyncQueue.enqueueRetryable((0,x.A)(function*(){k(En,"Retrying IndexedDB access"),yield t(),r.Ia.delete(1),yield hi(r)}))})).apply(this,arguments)}function ef(r,e){return e().catch(t=>Ls(r,t,e))}function fr(r){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,x.A)(function*(r){const e=O(r),t=Kt(e);let n=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:-1;for(;sy(e);)try{const i=yield U_(e.localStore,n);if(null===i){0===e.Pa.length&&t.B_();break}n=i.batchId,oy(e,i)}catch(i){yield Ls(e,i)}tf(e)&&nf(e)})).apply(this,arguments)}function sy(r){return zt(r)&&r.Pa.length<10}function oy(r,e){r.Pa.push(e);const t=Kt(r);t.x_()&&t.Z_&&t.X_(e.mutations)}function tf(r){return zt(r)&&!Kt(r).M_()&&r.Pa.length>0}function nf(r){Kt(r).start()}function ay(r){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,x.A)(function*(r){Kt(r).na()})).apply(this,arguments)}function uy(r){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,x.A)(function*(r){const e=Kt(r);for(const t of r.Pa)e.X_(t.mutations)})).apply(this,arguments)}function cy(r,e,t){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,x.A)(function*(r,e,t){const n=r.Pa.shift(),i=sa.from(n,e,t);yield ef(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield fr(r)})).apply(this,arguments)}function ly(r,e){return Za.apply(this,arguments)}function Za(){return Za=(0,x.A)(function*(r,e){var t;e&&Kt(r).Z_&&(yield(t=(0,x.A)(function*(i,s){if(Ch(u=s.code)&&u!==P.ABORTED){const a=i.Pa.shift();Kt(i).N_(),yield ef(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield fr(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),tf(r)&&nf(r)}),Za.apply(this,arguments)}function rf(r,e){return eu.apply(this,arguments)}function eu(){return(eu=(0,x.A)(function*(r,e){const t=O(r);t.asyncQueue.verifyOperationInProgress(),k(En,"RemoteStore received new credentials");const n=zt(t);t.Ia.add(3),yield hr(t),n&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield hi(t)})).apply(this,arguments)}function tu(r,e){return nu.apply(this,arguments)}function nu(){return(nu=(0,x.A)(function*(r,e){const t=O(r);e?(t.Ia.delete(2),yield hi(t)):e||(t.Ia.add(2),yield hr(t),t.Aa.set("Unknown"))})).apply(this,arguments)}function mr(r){return r.Va||(r.Va=function(t,n,i){const s=O(t);return s.ia(),new H_(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:ty.bind(null,r),e_:ny.bind(null,r),n_:ry.bind(null,r),J_:iy.bind(null,r)}),r.da.push(function(){var e=(0,x.A)(function*(t){t?(r.Va.N_(),za(r)?ja(r):r.Aa.set("Unknown")):(yield r.Va.stop(),Zd(r))});return function(t){return e.apply(this,arguments)}}())),r.Va}function Kt(r){return r.ma||(r.ma=function(t,n,i){const s=O(t);return s.ia(),new X_(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:ay.bind(null,r),n_:ly.bind(null,r),ea:uy.bind(null,r),ta:cy.bind(null,r)}),r.da.push(function(){var e=(0,x.A)(function*(t){t?(r.ma.N_(),yield fr(r)):(yield r.ma.stop(),r.Pa.length>0&&(k(En,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))});return function(t){return e.apply(this,arguments)}}())),r.ma}class ru{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new we,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new ru(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gr(r,e){if(ye("AsyncQueue",`${e}: ${r}`),xt(r))return new C(P.UNAVAILABLE,`${e}: ${r}`);throw r}class vn{static emptySet(e){return new vn(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||F.comparator(t.key,n.key):(t,n)=>F.comparator(t.key,n.key),this.keyedMap=Hr(),this.sortedSet=new ce(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new vn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class sf{constructor(){this.fa=new ce(F.comparator)}track(e){const t=e.doc.key,n=this.fa.get(t);n?0!==e.type&&3===n.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.fa=this.fa.remove(t):1===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):q(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}}class An{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new An(e,t,vn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class hy{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class dy{constructor(){this.queries=of(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(t,n){const i=O(t),s=i.queries;i.queries=of(),s.forEach((a,u)=>{for(const c of u.wa)c.onError(n)})}(this,new C(P.ABORTED,"Firestore shutting down"))}}function of(){return new yt(r=>dh(r),Qr)}function iu(r,e){return su.apply(this,arguments)}function su(){return(su=(0,x.A)(function*(r,e){const t=O(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(n=2):(s=new hy,n=e.ba()?0:1);try{switch(n){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=gr(a,`Initialization of query '${Jn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&uu(t)})).apply(this,arguments)}function ou(r,e){return au.apply(this,arguments)}function au(){return(au=(0,x.A)(function*(r,e){const t=O(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),0===s.wa.length?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function fy(r,e){const t=O(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.wa)u.Ca(i)&&(n=!0);a.ya=i}}n&&uu(t)}function my(r,e,t){const n=O(r),i=n.queries.get(e);if(i)for(const s of i.wa)s.onError(t);n.queries.delete(e)}function uu(r){r.Da.forEach(e=>{e.next()})}var cu,af;(af=cu||(cu={})).Fa="default",af.Cache="cache";class lu{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new An(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){return!e.fromCache||!this.ba()||(!this.options.ka||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}La(e){e=An.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==cu.Cache}}class uf{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}}class cf{constructor(e){this.serializer=e}Qs(e){return ht(this.serializer,e)}$s(e){return e.metadata.exists?ys(this.serializer,e.document,!1):he.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return Ie(e)}}class hu{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=lf(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;const n=H.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){const t=new Map,n=new cf(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Qs(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||$()).add(s);t.set(a,u)}}return t}za(e){var t=this;return(0,x.A)(function*(){const n=yield function j_(r,e,t,n){return xa.apply(this,arguments)}(e,new cf(t.serializer),t.Ka,t.$a.id),i=t.Ga(t.documents);for(const s of t.Ua)yield z_(e,s,i.get(s.name));return t.progress.taskState="Success",{progress:t.progress,ja:t.collectionGroups,Ja:n}})()}}function lf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class hf{constructor(e){this.key=e}}class df{constructor(e){this.key=e}}class ff{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=$(),this.mutatedKeys=$(),this.Xa=mh(e),this.eu=new vn(this.Xa)}get tu(){return this.Ha}nu(e,t){const n=t?t.ru:new sf,i=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{const p=i.get(f),A=Wr(this.query,m)?m:null,b=!!p&&this.mutatedKeys.has(p.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let D=!1;p&&A?p.data.isEqual(A.data)?b!==N&&(n.track({type:3,doc:A}),D=!0):this.iu(p,A)||(n.track({type:2,doc:A}),D=!0,(c&&this.Xa(A,c)>0||h&&this.Xa(A,h)<0)&&(u=!0)):!p&&A?(n.track({type:0,doc:A}),D=!0):p&&!A&&(n.track({type:1,doc:p}),D=!0,(c||h)&&(u=!0)),D&&(A?(a=a.add(A),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const a=e.ru.pa();a.sort((f,m)=>function(A,b){const N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{At:D})}};return N(A)-N(b)}(f.type,m.type)||this.Xa(f.doc,m.doc)),this.su(n),i=null!=i&&i;const u=t&&!i?this.ou():[],c=0===this.Za.size&&this.current&&!i?1:0,h=c!==this.Ya;return this.Ya=c,0!==a.length||h?{snapshot:new An(this.query,e.eu,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new sf,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=$(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});const t=[];return e.forEach(n=>{this.Za.has(n)||t.push(new df(n))}),this.Za.forEach(n=>{e.has(n)||t.push(new hf(n))}),t}uu(e){this.Ha=e.qs,this.Za=$();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return An.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const Gt="SyncEngine";class gy{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class py{constructor(e){this.key=e,this.lu=!1}}class _y{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new yt(u=>dh(u),Qr),this.Tu=new Map,this.Iu=new Set,this.du=new ce(F.comparator),this.Eu=new Map,this.Au=new Ia,this.Ru={},this.Vu=new Map,this.mu=yn.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}function yy(r,e){return du.apply(this,arguments)}function du(){return(du=(0,x.A)(function*(r,e,t=!0){const n=qs(r);let i;const s=n.Pu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield mf(n,e,t,!0),i})).apply(this,arguments)}function Iy(r,e){return fu.apply(this,arguments)}function fu(){return(fu=(0,x.A)(function*(r,e){const t=qs(r);yield mf(t,e,!0,!1)})).apply(this,arguments)}function mf(r,e,t,n){return mu.apply(this,arguments)}function mu(){return(mu=(0,x.A)(function*(r,e,t,n){const i=yield cr(r.localStore,De(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t);let u;return n&&(u=yield gu(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Ms(r.remoteStore,i),u})).apply(this,arguments)}function gu(r,e,t,n,i){return pu.apply(this,arguments)}function pu(){return pu=(0,x.A)(function*(r,e,t,n,i){r.gu=(m,p,A)=>{return(b=(0,x.A)(function*(D,L,j,B){let G=L.view.nu(j);G.Ds&&(G=yield Ds(D.localStore,L.query,!1).then(({documents:_})=>L.view.nu(_,G)));const J=B&&B.targetChanges.get(L.targetId),Q=B&&null!=B.targetMismatches.get(L.targetId),T=L.view.applyChanges(G,D.isPrimaryClient,J,Q);return Vu(D,L.targetId,T._u),T.snapshot}),function N(D,L,j,B){return b.apply(this,arguments)})(r,m,p,A);var b};const s=yield Ds(r.localStore,e,!0),a=new ff(e,s.qs),u=a.nu(s.documents),c=ti.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);Vu(r,t,h._u);const f=new gy(e,t,a);return r.Pu.set(e,f),r.Tu.has(t)?r.Tu.get(t).push(e):r.Tu.set(t,[e]),h.snapshot}),pu.apply(this,arguments)}function Ty(r,e,t){return _u.apply(this,arguments)}function _u(){return(_u=(0,x.A)(function*(r,e,t){const n=O(r),i=n.Pu.get(e),s=n.Tu.get(i.targetId);if(s.length>1)return n.Tu.set(i.targetId,s.filter(a=>!Qr(a,e))),void n.Pu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield lr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&dr(n.remoteStore,i.targetId),pr(n,i.targetId)}).catch(bt))):(pr(n,i.targetId),yield lr(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Ey(r,e){return yu.apply(this,arguments)}function yu(){return(yu=(0,x.A)(function*(r,e){const t=O(r),n=t.Pu.get(e),i=t.Tu.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),dr(t.remoteStore,n.targetId))})).apply(this,arguments)}function Iu(){return(Iu=(0,x.A)(function*(r,e,t){const n=Lu(r);try{const i=yield function(a,u){const c=O(a),h=ne.now(),f=u.reduce((A,b)=>A.add(b.key),$());let m,p;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let b=Qe(),N=$();return c.Os.getEntries(A,f).next(D=>{b=D,b.forEach((L,j)=>{j.isValidDocument()||(N=N.add(L))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,b)).next(D=>{m=D;const L=[];for(const j of u){const B=Qp(j,m.get(j.key).overlayedDocument);null!=B&&L.push(new It(j.key,B,Xl(B.value.mapValue),me.exists(!0)))}return c.mutationQueue.addMutationBatch(A,h,L,u)}).next(D=>{p=D;const L=D.applyToLocalDocumentSet(m,N);return c.documentOverlayCache.saveOverlays(A,D.batchId,L)})}).then(()=>({batchId:p.batchId,changes:ph(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.Ru[a.currentUser.toKey()];h||(h=new ce(K)),h=h.insert(u,c),a.Ru[a.currentUser.toKey()]=h}(n,i.batchId,t),yield Et(n,i.changes),yield fr(n.remoteStore)}catch(i){const s=gr(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function gf(r,e){return Tu.apply(this,arguments)}function Tu(){return(Tu=(0,x.A)(function*(r,e){const t=O(r);try{const n=yield function B_(r,e){const t=O(r),n=e.snapshotVersion;let i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;const u=[];e.targetChanges.forEach((f,m)=>{const p=i.get(m);if(!p)return;u.push(t.hi.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.hi.addMatchingKeys(s,f.addedDocuments,m)));let A=p.withSequenceNumber(s.currentSequenceNumber);var N,D,L;null!==e.targetMismatches.get(m)?A=A.withResumeToken(pe.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(m,A),D=A,L=f,(0===(N=p).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8||L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0)&&u.push(t.hi.updateTargetData(s,A))});let c=Qe(),h=$();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Md(s,a,e.documentUpdates).next(f=>{c=f.Ls,h=f.ks})),!n.isEqual(z.min())){const f=t.hi.getLastRemoteSnapshotVersion(s).next(m=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.Fs=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Eu.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?U(a.lu,14607):i.removedDocuments.size>0&&(U(a.lu,42227),a.lu=!1))}),yield Et(t,n,e)}catch(n){yield bt(n)}})).apply(this,arguments)}function pf(r,e,t){const n=O(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Pu.forEach((s,a)=>{const u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=O(a);c.onlineState=u;let h=!1;c.queries.forEach((f,m)=>{for(const p of m.wa)p.va(u)&&(h=!0)}),h&&uu(c)}(n.eventManager,e),i.length&&n.hu.J_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Ay(r,e,t){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,x.A)(function*(r,e,t){const n=O(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Eu.get(e),s=i&&i.key;if(s){let a=new ce(F.comparator);a=a.insert(s,he.newNoDocument(s,z.min()));const u=$().add(s),c=new ei(z.min(),new Map,new ce(K),a,u);yield gf(n,c),n.du=n.du.remove(s),n.Eu.delete(e),Su(n)}else yield lr(n.localStore,e,!1).then(()=>pr(n,e,t)).catch(bt)})).apply(this,arguments)}function wy(r,e){return vu.apply(this,arguments)}function vu(){return(vu=(0,x.A)(function*(r,e){const t=O(r),n=e.batch.batchId;try{const i=yield function q_(r,e){const t=O(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const m=h.batch,p=m.keys();let A=R.resolve();return p.forEach(b=>{A=A.next(()=>f.getEntry(c,b)).next(N=>{const D=h.docVersions.get(b);U(null!==D,48541),N.version.compareTo(D)<0&&(m.applyToRemoteDocument(N,h),N.isValidDocument()&&(N.setReadTime(h.commitVersion),f.addEntry(N)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=$();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Pu(t,n,null),Ru(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Et(t,i)}catch(i){yield bt(i)}})).apply(this,arguments)}function Ry(r,e,t){return Au.apply(this,arguments)}function Au(){return(Au=(0,x.A)(function*(r,e,t){const n=O(r);try{const i=yield function(a,u){const c=O(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(m=>(U(null!==m,37113),f=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);Pu(n,e,t),Ru(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Et(n,i)}catch(i){yield bt(i)}})).apply(this,arguments)}function wu(){return(wu=(0,x.A)(function*(r,e){const t=O(r);zt(t.remoteStore)||k(Gt,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Vu.get(n)||[];i.push(e),t.Vu.set(n,i)}catch(n){const i=gr(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function Ru(r,e){(r.Vu.get(e)||[]).forEach(t=>{t.resolve()}),r.Vu.delete(e)}function Pu(r,e,t){const n=O(r);let i=n.Ru[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ru[n.currentUser.toKey()]=i}}function pr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Tu.get(e))r.Pu.delete(n),t&&r.hu.pu(n,t);r.Tu.delete(e),r.isPrimaryClient&&r.Au.zr(e).forEach(n=>{r.Au.containsKey(n)||_f(r,n)})}function _f(r,e){r.Iu.delete(e.path.canonicalString());const t=r.du.get(e);null!==t&&(dr(r.remoteStore,t),r.du=r.du.remove(e),r.Eu.delete(t),Su(r))}function Vu(r,e,t){for(const n of t)n instanceof hf?(r.Au.addReference(n.key,e),Vy(r,n)):n instanceof df?(k(Gt,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,e),r.Au.containsKey(n.key)||_f(r,n.key)):q(19791,{yu:n})}function Vy(r,e){const t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Iu.has(n)||(k(Gt,"New document in limbo: "+t),r.Iu.add(n),Su(r))}function Su(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Iu.values().next().value;r.Iu.delete(e);const t=new F(H.fromString(e)),n=r.mu.next();r.Eu.set(n,new py(t)),r.du=r.du.insert(t,n),Ms(r.remoteStore,new Tt(De(Hn(t.path)),n,"TargetPurposeLimboResolution",Xe.ue))}}function Et(r,e,t){return bu.apply(this,arguments)}function bu(){return bu=(0,x.A)(function*(r,e,t){const n=O(r),i=[],s=[],a=[];var u;n.Pu.isEmpty()||(n.Pu.forEach((u,c)=>{a.push(n.gu(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const m=h?!h.fromCache:null===(f=t?.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){i.push(h);const m=Pa.Es(c.targetId,h);s.push(m)}}))}),yield Promise.all(a),n.hu.J_(i),yield(u=(0,x.A)(function*(h,f){const m=O(h);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>R.forEach(f,A=>R.forEach(A.Is,b=>m.persistence.referenceDelegate.addReference(p,A.targetId,b)).next(()=>R.forEach(A.ds,b=>m.persistence.referenceDelegate.removeReference(p,A.targetId,b)))))}catch(p){if(!xt(p))throw p;k(Va,"Failed to update sequence numbers: "+p)}for(const p of f){const A=p.targetId;if(!p.fromCache){const b=m.Fs.get(A),D=b.withLastLimboFreeSnapshotVersion(b.snapshotVersion);m.Fs=m.Fs.insert(A,D)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),bu.apply(this,arguments)}function Sy(r,e){return xu.apply(this,arguments)}function xu(){return(xu=(0,x.A)(function*(r,e){const t=O(r);if(!t.currentUser.isEqual(e)){k(Gt,"User change. New user:",e.toKey());const n=yield Fd(t.localStore,e);t.currentUser=e,(s=t).Vu.forEach(u=>{u.forEach(c=>{c.reject(new C(P.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Vu.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Et(t,n.Bs)}var s})).apply(this,arguments)}function by(r,e){const t=O(r),n=t.Eu.get(e);if(n&&n.lu)return $().add(n.key);{let i=$();const s=t.Tu.get(e);if(!s)return i;for(const a of s){const u=t.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}function xy(r,e){return Cu.apply(this,arguments)}function Cu(){return(Cu=(0,x.A)(function*(r,e){const t=O(r),n=yield Ds(t.localStore,e.query,!0),i=e.view.uu(n);return t.isPrimaryClient&&Vu(t,e.targetId,i._u),i})).apply(this,arguments)}function Cy(r,e){return Du.apply(this,arguments)}function Du(){return(Du=(0,x.A)(function*(r,e){const t=O(r);return qd(t.localStore,e).then(n=>Et(t,n))})).apply(this,arguments)}function Dy(r,e,t,n){return Nu.apply(this,arguments)}function Nu(){return(Nu=(0,x.A)(function*(r,e,t,n){const i=O(r),s=yield function(u,c){const h=O(u),f=O(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Xn(m,c).next(p=>p?h.localDocuments.getDocuments(m,p):R.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield fr(i.remoteStore):"acknowledged"===t||"rejected"===t?(Pu(i,e,n||null),Ru(i,e),c=e,O(O(i.localStore).mutationQueue).rr(c)):q(6720,"Unknown batchState",{wu:t}),yield Et(i,s)):k(Gt,"Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function ku(){return(ku=(0,x.A)(function*(r,e){const t=O(r);if(qs(t),Lu(t),!0===e&&!0!==t.fu){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield yf(t,n.toArray());t.fu=!0,yield tu(t.remoteStore,!0);for(const s of i)Ms(t.remoteStore,s)}else if(!1===e&&!1!==t.fu){const n=[];let i=Promise.resolve();t.Tu.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(pr(t,a),lr(t.localStore,a,!0))),dr(t.remoteStore,a)}),yield i,yield yf(t,n),function(a){const u=O(a);u.Eu.forEach((c,h)=>{dr(u.remoteStore,h)}),u.Au.jr(),u.Eu=new Map,u.du=new ce(F.comparator)}(t),t.fu=!1,yield tu(t.remoteStore,!1)}})).apply(this,arguments)}function yf(r,e,t){return Fu.apply(this,arguments)}function Fu(){return(Fu=(0,x.A)(function*(r,e,t){const n=O(r),i=[],s=[];for(const a of e){let u;const c=n.Tu.get(a);if(c&&0!==c.length){u=yield cr(n.localStore,De(c[0]));for(const h of c){const f=n.Pu.get(h),m=yield xy(n,f);m.snapshot&&s.push(m.snapshot)}}else{const h=yield Ld(n.localStore,a);u=yield cr(n.localStore,h),yield gu(n,If(h),a,!1,u.resumeToken)}i.push(u)}return n.hu.J_(s),i})).apply(this,arguments)}function If(r){return uh(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function ky(r){return t=O(r).localStore,O(O(t).persistence).Ps();var t}function Fy(r,e,t,n){return Ou.apply(this,arguments)}function Ou(){return(Ou=(0,x.A)(function*(r,e,t,n){const i=O(r);if(i.fu)return void k(Gt,"Ignoring unexpected query state notification.");const s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield qd(i.localStore,fh(s[0])),u=ei.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,pe.EMPTY_BYTE_STRING);yield Et(i,a,u);break}case"rejected":yield lr(i.localStore,e,!0),pr(i,e,n);break;default:q(64155,t)}})).apply(this,arguments)}function Oy(r,e,t){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,x.A)(function*(r,e,t){const n=qs(r);if(n.fu){for(const i of e){if(n.Tu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){k(Gt,"Adding an already active target "+i);continue}const s=yield Ld(n.localStore,i),a=yield cr(n.localStore,s);yield gu(n,If(s),a.targetId,!1,a.resumeToken),Ms(n.remoteStore,a)}for(const i of t)n.Tu.has(i)&&(yield lr(n.localStore,i,!1).then(()=>{dr(n.remoteStore,i),pr(n,i)}).catch(bt))}})).apply(this,arguments)}function qs(r){const e=O(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=gf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=by.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ay.bind(null,e),e.hu.J_=fy.bind(null,e.eventManager),e.hu.pu=my.bind(null,e.eventManager),e}function Lu(r){const e=O(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ry.bind(null,e),e}let Bs=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,x.A)(function*(){n.serializer=Tn(t.databaseInfo.databaseId),n.sharedClientState=n.bu(t),n.persistence=n.Du(t),yield n.persistence.start(),n.localStore=n.vu(t),n.gcScheduler=n.Cu(t,n.localStore),n.indexBackfillerScheduler=n.Fu(t,n.localStore)})()}Cu(t,n){return null}Fu(t,n){return null}vu(t){return kd(this.persistence,new Nd,t.initialUser,this.serializer)}Du(t){return new Ta(bs.Vi,this.serializer)}bu(t){return new $d}terminate(){var t=this;return(0,x.A)(function*(){var n,i;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class qu extends Bs{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){return U(this.persistence.referenceDelegate instanceof xs,46915),new Ad(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?Ne.withCacheSize(this.cacheSizeBytes):Ne.DEFAULT;return new Ta(n=>xs.Vi(n,t),this.serializer)}}class Bu extends Bs{constructor(e,t,n){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,x.A)(function*(){yield t().call(n,e),yield n.Mu.initialize(n,e),yield Lu(n.Mu.syncEngine),yield fr(n.Mu.remoteStore),yield n.persistence.ji(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}vu(e){return kd(this.persistence,new Nd,e.initialUser,this.serializer)}Cu(e,t){return new Ad(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Fu(e,t){const n=new Jg(t,this.persistence);return new Xg(e.asyncQueue,n)}Du(e){const t=Ra(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ne.withCacheSize(this.cacheSizeBytes):Ne.DEFAULT;return new wa(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hd(),Os(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new $d}}class Tf extends Bu{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,x.A)(function*(){yield t().call(n,e);const i=n.Mu.syncEngine;n.sharedClientState instanceof Fa&&(n.sharedClientState.syncEngine={Do:Dy.bind(null,i),vo:Fy.bind(null,i),Co:Oy.bind(null,i),Ps:ky.bind(null,i),bo:Cy.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.ji(function(){var s=(0,x.A)(function*(a){yield function Ny(r,e){return ku.apply(this,arguments)}(n.Mu.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}bu(e){const t=Hd();if(!Fa.C(t))throw new C(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ra(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fa(t,e.asyncQueue,n,e.clientId,e.initialUser)}}let _r=(()=>{class r{initialize(t,n){var i=this;return(0,x.A)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>pf(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=Sy.bind(null,i.syncEngine),yield tu(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new dy}createDatastore(t){const n=Tn(t.databaseInfo.databaseId),i=new W_(t.databaseInfo);return new Y_(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,s=this.datastore,a=t.asyncQueue,u=n=>pf(this.syncEngine,n,0),c=Wd.C()?new Wd:new K_,new ey(i,s,a,u,c);var i,s,a,u,c}createSyncEngine(t,n){return function(s,a,u,c,h,f,m){const p=new _y(s,a,u,c,h,f);return m&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,x.A)(function*(){var n,i,s;yield(s=(0,x.A)(function*(u){const c=O(u);k(En,"RemoteStore shutting down."),c.Ia.add(5),yield hr(c),c.Ea.shutdown(),c.Aa.set("Unknown")}),function a(u){return s.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();function Ef(r,e=10240){let t=0;return{read:()=>(0,x.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,x.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Us{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Ly{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new we,this.buffer=new Uint8Array,this.Bu=new TextDecoder("utf-8"),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}getMetadata(){var e=this;return(0,x.A)(function*(){return e.metadata.promise})()}Su(){var e=this;return(0,x.A)(function*(){return yield e.getMetadata(),e.Lu()})()}Lu(){var e=this;return(0,x.A)(function*(){const t=yield e.ku();if(null===t)return null;const n=e.Bu.decode(t),i=Number(n);isNaN(i)&&e.qu(`length string (${n}) is not valid number`);const s=yield e.Qu(i);return new uf(JSON.parse(s),t.length+i)})()}$u(){return this.buffer.findIndex(e=>123===e)}ku(){var e=this;return(0,x.A)(function*(){for(;e.$u()<0&&!(yield e.Uu()););if(0===e.buffer.length)return null;const t=e.$u();t<0&&e.qu("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Qu(e){var t=this;return(0,x.A)(function*(){for(;t.buffer.length<e;)(yield t.Uu())&&t.qu("Reached the end of bundle when more is expected.");const n=t.Bu.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}Uu(){var e=this;return(0,x.A)(function*(){const t=yield e.Nu.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class By{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,x.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,x.A)(function*(a,u){const c=O(a),h={documents:u.map(A=>ni(c.serializer,A))},f=yield c.Jo("BatchGetDocuments",c.serializer.databaseId,H.emptyPath(),h,u.length),m=new Map;f.forEach(A=>{const b=function n_(r,e){return"found"in e?function(n,i){U(!!i.found,43571);const s=ht(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):z.min(),c=new Se({mapValue:{fields:i.found.fields}});return he.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){U(!!i.missing,3894),U(!!i.readTime,22933);const s=ht(n,i.missing),a=Ie(i.readTime);return he.newNoDocument(s,a)}(r,e):q(7234,{result:e})}(c.serializer,A);m.set(b.key.toString(),b)});const p=[];return u.forEach(A=>{const b=m.get(A.toString());U(!!b,55234,{key:A}),p.push(b)}),p}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new tr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,x.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=F.fromPath(i);e.mutations.push(new ra(s,e.precondition(s)))}),yield(n=(0,x.A)(function*(s,a){const u=O(s),c={writes:a.map(h=>ri(u.serializer,h))};yield u.Wo("Commit",u.serializer.databaseId,H.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw q(50498,{Wu:e.constructor.name});t=z.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?me.exists(!1):me.updateTime(t):me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new C(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(t)}return me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Uy{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Gu=n.maxAttempts,this.F_=new La(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){var e=this;this.F_.g_((0,x.A)(function*(){const t=new By(e.datastore),n=e.Ju(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Hu(s)}))}).catch(i=>{e.Hu(i)})}))}Ju(e){try{const t=this.updateFunction(e);return!Dr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ch(t)}return!1}}const $t="FirestoreClient";class jy{constructor(e,t,n,i,s){var a=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=bo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var u=(0,x.A)(function*(c){k($t,"Received user=",c.uid),yield a.authCredentialListener(c),a.user=c});return function(c){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(k($t,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new we;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,x.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=gr(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Uu(r,e){return ju.apply(this,arguments)}function ju(){return ju=(0,x.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),k($t,"Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,x.A)(function*(s){n.isEqual(s)||(yield Fd(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>{xe("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{k("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{xe("Terminating Firestore due to IndexedDb database deletion failed",i)})}),r._offlineComponents=e}),ju.apply(this,arguments)}function vf(r,e){return zu.apply(this,arguments)}function zu(){return(zu=(0,x.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Ku(r);k($t,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>rf(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>rf(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Ku(r){return Gu.apply(this,arguments)}function Gu(){return(Gu=(0,x.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k($t,"Using user provided OfflineComponentProvider");try{yield Uu(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;xe("Error using user provided cache. Falling back to memory cache: "+e),yield Uu(r,new Bs)}}else k($t,"Using default OfflineComponentProvider"),yield Uu(r,new qu(void 0));var i;return r._offlineComponents})).apply(this,arguments)}function js(r){return $u.apply(this,arguments)}function $u(){return($u=(0,x.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(k($t,"Using user provided OnlineComponentProvider"),yield vf(r,r._uninitializedComponentsProvider._online)):(k($t,"Using default OnlineComponentProvider"),yield vf(r,new _r))),r._onlineComponents})).apply(this,arguments)}function Af(r){return Ku(r).then(e=>e.persistence)}function yr(r){return Ku(r).then(e=>e.localStore)}function wf(r){return js(r).then(e=>e.remoteStore)}function Qu(r){return js(r).then(e=>e.syncEngine)}function Ir(r){return Wu.apply(this,arguments)}function Wu(){return(Wu=(0,x.A)(function*(r){const e=yield js(r),t=e.eventManager;return t.onListen=yy.bind(null,e.syncEngine),t.onUnlisten=Ty.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Iy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Ey.bind(null,e.syncEngine),t})).apply(this,arguments)}function Pf(r,e,t={}){const n=new we;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function(s,a,u,c,h){const f=new Us({next:p=>{f.Ou(),a.enqueueAndForget(()=>ou(s,m));const A=p.docs.has(u);!A&&p.fromCache?h.reject(new C(P.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&p.fromCache&&c&&"server"===c.source?h.reject(new C(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(p)},error:p=>h.reject(p)}),m=new lu(Hn(u.path),f,{includeMetadataChanges:!0,ka:!0});return iu(s,m)}(yield Ir(r),r.asyncQueue,e,t,n)})),n.promise}function Vf(r,e,t={}){const n=new we;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function(s,a,u,c,h){const f=new Us({next:p=>{f.Ou(),a.enqueueAndForget(()=>ou(s,m)),p.fromCache&&"server"===c.source?h.reject(new C(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(p)},error:p=>h.reject(p)}),m=new lu(u,f,{includeMetadataChanges:!0,ka:!0});return iu(s,m)}(yield Ir(r),r.asyncQueue,e,t,n)})),n.promise}function bf(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const xf=new Map,Cf="firestore.googleapis.com";class Nf{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Cf,this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=bf(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class di{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nf(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Mg;switch(n.type){case"firstParty":return new Ug(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,x.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=xf.get(t);n&&(k("ComponentProvider","Removing Datastore"),xf.delete(t),n.terminate())}(this),Promise.resolve()}}class Pe{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pe(this.firestore,e,this._query)}}class ee{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ft(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ee(this.firestore,e,this._key)}toJSON(){return{type:ee._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(tn(t,ee._jsonSchema))return new ee(e,n||null,new F(H.fromString(t.referencePath)))}}ee._jsonSchemaVersion="firestore/documentReference/1.0",ee._jsonSchema={type:Te("string",ee._jsonSchemaVersion),referencePath:Te("string")};class ft extends Pe{constructor(e,t,n){super(e,t,Hn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ee(this.firestore,null,new F(e))}withConverter(e){return new ft(this.firestore,e,this._path)}}function Ff(r,e,...t){if(r=(0,W.Ku)(r),Do("collection","path",e),r instanceof di){const n=H.fromString(e,...t);return al(n),new ft(r,null,n)}{if(!(r instanceof ee||r instanceof ft))throw new C(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(H.fromString(e,...t));return al(n),new ft(r.firestore,null,n)}}function zs(r,e,...t){if(r=(0,W.Ku)(r),1===arguments.length&&(e=bo.newId()),Do("doc","path",e),r instanceof di){const n=H.fromString(e,...t);return ol(n),new ee(r,null,new F(n))}{if(!(r instanceof ee||r instanceof ft))throw new C(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(H.fromString(e,...t));return ol(n),new ee(r.firestore,r instanceof ft?r.converter:null,new F(n))}}function Of(r,e){return r=(0,W.Ku)(r),e=(0,W.Ku)(e),(r instanceof ee||r instanceof ft)&&(e instanceof ee||e instanceof ft)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Hu(r,e){return r=(0,W.Ku)(r),e=(0,W.Ku)(e),r instanceof Pe&&e instanceof Pe&&r.firestore===e.firestore&&Qr(r._query,e._query)&&r.converter===e.converter}const Mf="AsyncQueue";class Lf{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new La(this,"async_queue_retry"),this.oc=()=>{const n=Os();n&&k(Mf,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=e;const t=Os();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Os();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new we;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){var e=this;return(0,x.A)(function*(){if(0!==e.Zu.length){try{yield e.Zu[0](),e.Zu.shift(),e.F_.reset()}catch(t){if(!xt(t))throw t;k(Mf,"Operation failed with retryable error: "+t)}e.Zu.length>0&&e.F_.g_(()=>e.cc())}})()}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(n=>{throw this.tc=n,this.nc=!1,ye("INTERNAL UNHANDLED ERROR: ",qf(n)),n}).then(n=>(this.nc=!1,n))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const i=ru.createAndSchedule(this,e,t,n,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&q(47125,{hc:qf(this.tc)})}verifyOperationInProgress(){}Pc(){var e=this;return(0,x.A)(function*(){let t;do{t=e._c,yield t}while(t!==e._c)})()}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function qf(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+"\n"+r.stack),e}function Tr(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class tI{constructor(){this._progressObserver={},this._taskCompletionResolver=new we,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ae extends di{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Lf,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,x.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new Lf(t),e._firestoreClient=void 0,yield t}})()}}function ge(r){if(r._terminated)throw new C(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Bf(r),r._firestoreClient}function Bf(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Pp(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,bf(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator));var c,f;r._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new jy(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){const c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function Xu(){return(Xu=(0,x.A)(function*(r){xe("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();Uf(r,_r.provider,{build:t=>new Tf(t,e.cacheSizeBytes)})})).apply(this,arguments)}function Uf(r,e,t){if((r=X(r,ae))._firestoreClient||r._terminated)throw new C(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(P.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},Bf(r)}function Ju(r,e){const t=ge(r=X(r,ae)),n=new tI;return function Hy(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?So().encode(a):a,f=function(f,m){if(f instanceof Uint8Array)return Ef(f,m);if(f instanceof ArrayBuffer)return Ef(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Ly(f,u);var f}(t,Tn(e));r.asyncQueue.enqueueAndForget((0,x.A)(function*(){!function My(r,e,t){const n=O(r);var i;(i=(0,x.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(b,N){const D=O(b),L=Ie(N.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",j=>D.Ti.getBundleMetadata(j,N.id)).then(j=>!!j&&j.createTime.compareTo(L)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(b=h).totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}),Promise.resolve(new Set);c._updateProgress(lf(h));const f=new hu(h,u.serializer);let m=yield u.Su();for(;m;){const A=yield f.Wa(m);A&&c._updateProgress(A),m=yield u.Su()}const p=yield f.za(a.localStore);return yield Et(a,p.Ja,void 0),yield function(b,N){const D=O(b);return D.persistence.runTransaction("Save bundle","readwrite",L=>D.Ti.saveBundleMetadata(L,N))}(a.localStore,h),c._completeWith(p.progress),Promise.resolve(p.ja)}catch(h){return xe(Gt,`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var b}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield Qu(r),i,n)}))}(t,r._databaseId,e,n),n}class Fe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fe(pe.fromBase64String(e))}catch(t){throw new C(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fe(pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(tn(e,Fe._jsonSchema))return Fe.fromBase64String(e.bytes)}}Fe._jsonSchemaVersion="firestore/bytes/1.0",Fe._jsonSchema={type:Te("string",Fe._jsonSchemaVersion),bytes:Te("string")};class vt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class wn{constructor(e){this._methodName=e}}class tt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:tt._jsonSchemaVersion}}static fromJSON(e){if(tn(e,tt._jsonSchema))return new tt(e.latitude,e.longitude)}}tt._jsonSchemaVersion="firestore/geoPoint/1.0",tt._jsonSchema={type:Te("string",tt._jsonSchemaVersion),latitude:Te("number"),longitude:Te("number")};class nt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(tn(e,nt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>"number"==typeof t))return new nt(e.vectorValues);throw new C(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}nt._jsonSchemaVersion="firestore/vectorValue/1.0",nt._jsonSchema={type:Te("string",nt._jsonSchemaVersion),vectorValues:Te("object")};const lI=/^__.*__$/;class hI{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new It(e,this.data,this.fieldMask,t,this.fieldTransforms):new er(e,this.data,t,this.fieldTransforms)}}class zf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new It(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Kf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ec:r})}}class Ks{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Ks(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.fc(e),i}gc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Qs(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(Kf(this.Ec)&&lI.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class dI{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Tn(e)}Dc(e,t,n,i=!1){return new Ks({Ec:e,methodName:t,bc:n,path:le.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rn(r){const e=r._freezeSettings(),t=Tn(r._databaseId);return new dI(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Gs(r,e,t,n,i,s={}){const a=r.Dc(s.merge||s.mergeFields?2:0,e,t,i);ic("Data must be an object, but it was:",a,n);const u=Qf(n,a);let c,h;if(s.merge)c=new $e(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const m of s.mergeFields){const p=gi(e,m,t);if(!a.contains(p))throw new C(P.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Hf(f,p)||f.push(p)}c=new $e(f),h=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=a.fieldTransforms;return new hI(new Se(u),c,h)}class mi extends wn{_toFieldTransform(e){if(2!==e.Ec)throw e.wc(1===e.Ec?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mi}}function Gf(r,e,t){return new Ks({Ec:3,bc:e.settings.bc,methodName:r._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Yu extends wn{_toFieldTransform(e){return new Jr(e.path,new Yn)}isEqual(e){return e instanceof Yu}}class Zu extends wn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Gf(this,e,!0),n=this.vc.map(s=>Pn(s,t)),i=new hn(n);return new Jr(e.path,i)}isEqual(e){return e instanceof Zu&&(0,W.bD)(this.vc,e.vc)}}class ec extends wn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Gf(this,e,!0),n=this.vc.map(s=>Pn(s,t)),i=new dn(n);return new Jr(e.path,i)}isEqual(e){return e instanceof ec&&(0,W.bD)(this.vc,e.vc)}}class tc extends wn{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){const t=new Zn(e.serializer,Ih(e.serializer,this.Cc));return new Jr(e.path,t)}isEqual(e){return e instanceof tc&&this.Cc===e.Cc}}function nc(r,e,t,n){const i=r.Dc(1,e,t);ic("Data must be an object, but it was:",i,n);const s=[],a=Se.empty();Dt(n,(c,h)=>{const f=$s(e,c,t);h=(0,W.Ku)(h);const m=i.gc(f);if(h instanceof mi)s.push(f);else{const p=Pn(h,m);null!=p&&(s.push(f),a.set(f,p))}});const u=new $e(s);return new zf(a,u,i.fieldTransforms)}function rc(r,e,t,n,i,s){const a=r.Dc(1,e,t),u=[gi(e,n,t)],c=[i];if(s.length%2!=0)throw new C(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)u.push(gi(e,s[p])),c.push(s[p+1]);const h=[],f=Se.empty();for(let p=u.length-1;p>=0;--p)if(!Hf(h,u[p])){const A=u[p];let b=c[p];b=(0,W.Ku)(b);const N=a.gc(A);if(b instanceof mi)h.push(A);else{const D=Pn(b,N);null!=D&&(h.push(A),f.set(A,D))}}const m=new $e(h);return new zf(f,m,a.fieldTransforms)}function $f(r,e,t,n=!1){return Pn(t,r.Dc(n?4:3,e))}function Pn(r,e){if(Wf(r=(0,W.Ku)(r)))return ic("Unsupported field value:",e,r),Qf(r,e);if(r instanceof wn)return function(n,i){if(!Kf(i.Ec))throw i.wc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.mc&&4!==e.Ec)throw e.wc("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=Pn(u,i.yc(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,W.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Ih(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=ne.fromDate(n);return{timestampValue:nr(i.serializer,s)}}if(n instanceof ne){const s=new ne(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:nr(i.serializer,s)}}if(n instanceof tt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Fe)return{bytesValue:qh(i.serializer,n._byteString)};if(n instanceof ee){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ca(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof nt)return a=n,u=i,{mapValue:{fields:{[Go]:{stringValue:$o},[$n]:{arrayValue:{values:a.toArray().map(h=>{if("number"!=typeof h)throw u.wc("VectorValues must only contain numeric values.");return na(u.serializer,h)})}}}}};var a,u;throw i.wc(`Unsupported field value: ${$i(n)}`)}(r,e)}function Qf(r,e){const t={};return kl(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dt(r,(n,i)=>{const s=Pn(i,e.Vc(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function Wf(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof ne||r instanceof tt||r instanceof Fe||r instanceof ee||r instanceof wn||r instanceof nt)}function ic(r,e,t){if(!Wf(t)||!ul(t)){const n=$i(t);throw e.wc("an object"===n?r+" a custom object":r+" "+n)}}function gi(r,e,t){if((e=(0,W.Ku)(e))instanceof vt)return e._internalPath;if("string"==typeof e)return $s(r,e);throw Qs("Field path arguments must be of type string or ",r,!1,void 0,t)}const fI=new RegExp("[~\\*/\\[\\]]");function $s(r,e,t){if(e.search(fI)>=0)throw Qs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new vt(...e.split("."))._internalPath}catch{throw Qs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Qs(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new C(P.INVALID_ARGUMENT,u+r+c)}function Hf(r,e){return r.some(t=>t.isEqual(e))}class pi{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ee(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new mI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ws("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class mI extends pi{data(){return super.data()}}function Ws(r,e){return"string"==typeof e?$s(r,e):e instanceof vt?e._internalPath:e._delegate._internalPath}function Xf(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sc{}class _i extends sc{}function Qt(r,e,...t){let n=[];e instanceof sc&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Er).length,u=s.filter(c=>c instanceof yi).length;if(a>1||a>0&&u>0)throw new C(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class yi extends _i{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new yi(e,t,n)}_apply(e){const t=this._parse(e);return em(e._query,t),new Pe(e.firestore,e.converter,ea(e._query,t))}_parse(e){const t=Rn(e.firestore);return function(s,a,u,c,h,f,m){let p;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){Zf(m,f);const b=[];for(const N of m)b.push(Yf(c,s,N));p={arrayValue:{values:b}}}else p=Yf(c,s,m)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||Zf(m,f),p=$f(u,"where",m,"in"===f||"not-in"===f);return Y.create(h,f,p)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Er extends sc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Er(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:se.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)em(a,c),a=ea(a,c)}(e._query,t),new Pe(e.firestore,e.converter,ea(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class oc extends _i{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oc(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Gr(s,a)}(e._query,this._field,this._direction);return new Pe(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new _t(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Hs extends _i{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Hs(e,t,n)}_apply(e){return new Pe(e.firestore,e.converter,hs(e._query,this._limit,this._limitType))}}class Xs extends _i{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Xs(e,t,n)}_apply(e){const t=Jf(e,this.type,this._docOrFields,this._inclusive);return new Pe(e.firestore,e.converter,(s=t,new _t((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class Js extends _i{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Js(e,t,n)}_apply(e){const t=Jf(e,this.type,this._docOrFields,this._inclusive);return new Pe(e.firestore,e.converter,(s=t,new _t((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Jf(r,e,t,n){if(t[0]=(0,W.Ku)(t[0]),t[0]instanceof pi)return function(s,a,u,c,h){if(!c)throw new C(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const m of Xn(s))if(m.field.isKeyField())f.push(cn(a,c.key));else{const p=c.data.field(m.field);if(rs(p))throw new C(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===p){const A=m.field.canonicalString();throw new C(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(p)}return new Mt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=Rn(r.firestore);return function(a,u,c,h,f,m){const p=a.explicitOrderBy;if(f.length>p.length)throw new C(P.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let b=0;b<f.length;b++){const N=f[b];if(p[b].field.isKeyField()){if("string"!=typeof N)throw new C(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof N}`);if(!Zo(a)&&-1!==N.indexOf("/"))throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${N}' contains a slash.`);const D=a.path.child(H.fromString(N));if(!F.isDocumentKey(D))throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const L=new F(D);A.push(cn(u,L))}else{const D=$f(c,h,N);A.push(D)}}return new Mt(A,m)}(r._query,r.firestore._databaseId,i,e,t,n)}}function Yf(r,e,t){if("string"==typeof(t=(0,W.Ku)(t))){if(""===t)throw new C(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zo(e)&&-1!==t.indexOf("/"))throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(H.fromString(t));if(!F.isDocumentKey(n))throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return cn(r,new F(n))}if(t instanceof ee)return cn(r,t._key);throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$i(t)}.`)}function Zf(r,e){if(!Array.isArray(r)||0===r.length)throw new C(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function em(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(P.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class ac{convertValue(e,t="none"){switch(Ft(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Dt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t[$n].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>fe(a.doubleValue));return new nt(s)}convertGeoPoint(e){return new tt(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=is(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Br(e));default:return null}}convertTimestamp(e){const t=gt(e);return new ne(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=H.fromString(e);U(Xh(n),9688,{name:e});const i=new Nt(n.get(1),n.get(3)),s=new F(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Ys(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class uc extends ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ee(this.firestore,null,t)}}class Wt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Oe extends pi{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ws("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Oe._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle="NOT SUPPORTED",t):t}}Oe._jsonSchemaVersion="firestore/documentSnapshot/1.0",Oe._jsonSchema={type:Te("string",Oe._jsonSchemaVersion),bundleSource:Te("string","DocumentSnapshot"),bundleName:Te("string"),bundle:Te("string")};class Ii extends Oe{data(e={}){return super.data(e)}}class Ue{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Wt(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Ii(this._firestore,this._userDataWriter,n.key,n,new Wt(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Ii(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Wt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Ii(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Wt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:wI(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ue._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=bo.newId();const t=[],n=[],i=[];return this.docs.forEach(s=>{null!==s._document&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle="NOT SUPPORTED",e}}function wI(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:r})}}function rm(r,e){return r instanceof Oe&&e instanceof Oe?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ue&&e instanceof Ue&&r._firestore===e._firestore&&Hu(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}Ue._jsonSchemaVersion="firestore/querySnapshot/1.0",Ue._jsonSchema={type:Te("string",Ue._jsonSchemaVersion),bundleSource:Te("string","QuerySnapshot"),bundleName:Te("string"),bundle:Te("string")};class Ht extends ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ee(this.firestore,null,t)}}function im(r,e,t){r=X(r,ee);const n=X(r.firestore,ae),i=Ys(r.converter,e,t);return vr(n,[Gs(Rn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,me.none())])}function sm(r,e,t,...n){r=X(r,ee);const i=X(r.firestore,ae),s=Rn(i);let a;return a="string"==typeof(e=(0,W.Ku)(e))||e instanceof vt?rc(s,"updateDoc",r._key,e,t,n):nc(s,"updateDoc",r._key,e),vr(i,[a.toMutation(r._key,me.exists(!0))])}function Zs(r,...e){var t,n,i;r=(0,W.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Tr(e[a])||(s=e[a++]);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Tr(e[a])){const m=e[a];e[a]=null===(t=m.next)||void 0===t?void 0:t.bind(m),e[a+1]=null===(n=m.error)||void 0===n?void 0:n.bind(m),e[a+2]=null===(i=m.complete)||void 0===i?void 0:i.bind(m)}let c,h,f;if(r instanceof ee)h=X(r.firestore,ae),f=Hn(r._key.path),c={next:m=>{e[a]&&e[a](cc(h,r,m))},error:e[a+1],complete:e[a+2]};else{const m=X(r,Pe);h=X(m.firestore,ae),f=m._query;const p=new Ht(h);c={next:A=>{e[a]&&e[a](new Ue(h,p,m,A))},error:e[a+1],complete:e[a+2]},Xf(r._query)}return function(p,A,b,N){const D=new Us(N),L=new lu(A,D,b);return p.asyncQueue.enqueueAndForget((0,x.A)(function*(){return iu(yield Ir(p),L)})),()=>{D.Ou(),p.asyncQueue.enqueueAndForget((0,x.A)(function*(){return ou(yield Ir(p),L)}))}}(ge(h),f,u,c)}function vr(r,e){return function(n,i){const s=new we;return n.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function vy(r,e,t){return Iu.apply(this,arguments)}(yield Qu(n),i,s)})),s.promise}(ge(r),e)}function cc(r,e,t){const n=t.docs.get(e._key),i=new Ht(r);return new Oe(r,i,e._key,n,new Wt(t.hasPendingWrites,t.fromCache),e.converter)}const jI={maxAttempts:5};class om{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Rn(e)}set(e,t,n){this._verifyNotCommitted();const i=Xt(e,this._firestore),s=Ys(i.converter,t,n),a=Gs(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,me.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Xt(e,this._firestore);let a;return a="string"==typeof(t=(0,W.Ku)(t))||t instanceof vt?rc(this._dataReader,"WriteBatch.update",s._key,t,n,i):nc(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Xt(e,this._firestore);return this._mutations=this._mutations.concat(new tr(t._key,me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Xt(r,e){if((r=(0,W.Ku)(r)).firestore!==e)throw new C(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class zI{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Rn(e)}get(e){const t=Xt(e,this._firestore),n=new uc(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return q(24041);const s=i[0];if(s.isFoundDocument())return new pi(this._firestore,n,s.key,s,t.converter);if(s.isNoDocument())return new pi(this._firestore,n,t._key,null,t.converter);throw q(18433,{doc:s})})}set(e,t,n){const i=Xt(e,this._firestore),s=Ys(i.converter,t,n),a=Gs(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,n);return this._transaction.set(i._key,a),this}update(e,t,n,...i){const s=Xt(e,this._firestore);let a;return a="string"==typeof(t=(0,W.Ku)(t))||t instanceof vt?rc(this._dataReader,"Transaction.update",s._key,t,n,i):nc(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,a),this}delete(e){const t=Xt(e,this._firestore);return this._transaction.delete(t._key),this}}class KI extends zI{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Xt(e,this._firestore),n=new Ht(this._firestore);return super.get(e).then(i=>new Oe(this._firestore,n,t._key,i._document,new Wt(!1,!1),t.converter))}}function hc(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function lm(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function hm(){if(!function wp(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){kn=Sr.SDK_VERSION,(0,Sr._registerComponent)(new Kc.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new ae(new qg(n.getProvider("auth-internal")),new jg(a,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Nt(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,Sr.registerVersion)(Zc,"4.8.0",e),(0,Sr.registerVersion)(Zc,"4.8.0","esm2017")}();class Ti{constructor(e){this._delegate=e}static fromBase64String(e){return hm(),new Ti(Fe.fromBase64String(e))}static fromUint8Array(e){return lm(),new Ti(Fe.fromUint8Array(e))}toBase64(){return hm(),this._delegate.toBase64()}toUint8Array(){return lm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function dc(r){return function eT(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class tT{enableIndexedDbPersistence(e,t){return function rI(r,e){xe("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings();return Uf(r,_r.provider,{build:n=>new Bu(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function iI(r){return Xu.apply(this,arguments)}(e._delegate)}clearIndexedDbPersistence(e){return function sI(r){if(r._initialized&&!r._terminated)throw new C(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new we;return r._queue.enqueueAndForgetEvenWhileRestricted((0,x.A)(function*(){try{yield(t=(0,x.A)(function*(i){if(!at.C())return Promise.resolve();const s=i+"main";yield at.delete(s)}),function n(i){return t.apply(this,arguments)})(Ra(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class dm{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Nt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&xe("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function kf(r,e,t,n={}){var i;r=X(r,di);const s=(0,W.zJ)(e),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),c=`${e}:${t}`;s&&((0,W.gE)(`https://${c}`),(0,W.P1)("Firestore",!0)),a.host!==Cf&&a.host!==c&&xe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},a),{host:c,ssl:s,emulatorOptions:n});if(!(0,W.bD)(h,u)&&(r._setSettings(h),n.mockUserToken)){let f,m;if("string"==typeof n.mockUserToken)f=n.mockUserToken,m=Ae.MOCK_USER;else{f=(0,W.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new C(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Ae(p)}r._authCredentials=new Lg(new nl(f,m))}}(this._delegate,e,t,n)}enableNetwork(){return function aI(r){return function zy(r){return r.asyncQueue.enqueue((0,x.A)(function*(){const e=yield Af(r),t=yield wf(r);return e.setNetworkEnabled(!0),function(i){const s=O(i);return s.Ia.delete(0),hi(s)}(t)}))}(ge(r=X(r,ae)))}(this._delegate)}disableNetwork(){return function uI(r){return function Ky(r){return r.asyncQueue.enqueue((0,x.A)(function*(){const e=yield Af(r),t=yield wf(r);return e.setNetworkEnabled(!1),(n=(0,x.A)(function*(s){const a=O(s);a.Ia.add(0),yield hr(a),a.Aa.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(ge(r=X(r,ae)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,sl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function oI(r){return function(t){const n=new we;return t.asyncQueue.enqueueAndForget((0,x.A)(function*(){return function Py(r,e){return wu.apply(this,arguments)}(yield Qu(t),n)})),n.promise}(ge(r=X(r,ae)))}(this._delegate)}onSnapshotsInSync(e){return function NI(r,e){return function Wy(r,e){const t=new Us(e);return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return i=yield Ir(r),s=t,O(i).Da.add(s),void s.next();var i,s})),()=>{t.Ou(),r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return i=yield Ir(r),s=t,void O(i).Da.delete(s);var i,s}))}}(ge(r=X(r,ae)),Tr(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ar(this,Ff(this._delegate,e))}catch(t){throw je(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ye(this,zs(this._delegate,e))}catch(t){throw je(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ze(this,function eI(r,e){if(r=X(r,di),Do("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pe(r,null,(n=e,new _t(H.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw je(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function GI(r,e,t){r=X(r,ae);const n=Object.assign(Object.assign({},jI),t);return function(s){if(s.maxAttempts<1)throw new C(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new we;return s.asyncQueue.enqueueAndForget((0,x.A)(function*(){const h=yield function Rf(r){return js(r).then(e=>e.datastore)}(s);new Uy(s.asyncQueue,h,u,a,c).zu()})),c.promise}(ge(r),i=>e(new KI(r,i)),n)}(this._delegate,t=>e(new fm(this,t)))}batch(){return ge(this._delegate),new mm(new om(this._delegate,e=>vr(this._delegate,e)))}loadBundle(e){return Ju(this._delegate,e)}namedQuery(e){return function jf(r,e){return function Xy(r,e){return r.asyncQueue.enqueue((0,x.A)(function*(){return function(n,i){const s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Ti.getNamedQuery(a,i))}(yield yr(r),e)}))}(ge(r=X(r,ae)),e).then(t=>t?new Pe(r,null,t.query):null)}(this._delegate,e).then(t=>t?new ze(this,t):null)}}class to extends ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ti(new Fe(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ye.forKey(t,this.firestore,null)}}class fm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new to(e)}get(e){const t=Sn(e);return this._delegate.get(t).then(n=>new Ei(this._firestore,new Oe(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=Sn(e);return n?(hc("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=Sn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=Sn(e);return this._delegate.delete(t),this}}class mm{constructor(e){this._delegate=e}set(e,t,n){const i=Sn(e);return n?(hc("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=Sn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=Sn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Vn{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Ii(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vi(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Vn.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new Vn(e,new to(e),t),i.set(t,s)),s}}Vn.INSTANCES=new WeakMap;class Ye{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new to(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ye(t,new ee(t._delegate,n,new F(e)))}static forKey(e,t,n){return new Ye(t,new ee(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Ar(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ar(this.firestore,Ff(this._delegate,e))}catch(t){throw je(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,W.Ku)(e))instanceof ee&&Of(this._delegate,e)}set(e,t){t=hc("DocumentReference.set",t);try{return t?im(this._delegate,e,t):im(this._delegate,e)}catch(n){throw je(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?sm(this._delegate,e):sm(this._delegate,e,t,...n)}catch(i){throw je(i,"updateDoc()","DocumentReference.update()")}}delete(){return function CI(r){return vr(X(r.firestore,ae),[new tr(r._key,me.none())])}(this._delegate)}onSnapshot(...e){const t=gm(e),n=pm(e,i=>new Ei(this.firestore,new Oe(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Zs(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function PI(r){r=X(r,ee);const e=X(r.firestore,ae),t=ge(e),n=new Ht(e);return function Gy(r,e){const t=new we;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return(n=(0,x.A)(function*(s,a,u){try{const c=yield function(f,m){const p=O(f);return p.persistence.runTransaction("read document","readonly",A=>p.localDocuments.getDocument(A,m))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new C(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=gr(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield yr(r),e,t);var n})),t.promise}(t,r._key).then(i=>new Oe(e,n,r._key,i,new Wt(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function VI(r){r=X(r,ee);const e=X(r.firestore,ae);return Pf(ge(e),r._key,{source:"server"}).then(t=>cc(e,r,t))}(this._delegate):function RI(r){r=X(r,ee);const e=X(r.firestore,ae);return Pf(ge(e),r._key).then(t=>cc(e,r,t))}(this._delegate),t.then(n=>new Ei(this.firestore,new Oe(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new Ye(this.firestore,this._delegate.withConverter(e?Vn.getInstance(this.firestore,e):null))}}function je(r,e,t){return r.message=r.message.replace(e,t),r}function gm(r){for(const e of r)if("object"==typeof e&&!dc(e))return e;return{}}function pm(r,e){var t,n;let i;return i=dc(r[0])?r[0]:dc(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Ei{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ye(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return rm(this._delegate,e._delegate)}}class vi extends Ei{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Og(r,e){r||q(57014,e)}(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}class ze{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new to(e)}where(e,t,n){try{return new ze(this.firestore,Qt(this._delegate,function gI(r,e,t){const n=e,i=Ws("where",r);return yi._create(i,n,t)}(e,t,n)))}catch(i){throw je(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ze(this.firestore,Qt(this._delegate,function pI(r,e="asc"){const t=e,n=Ws("orderBy",r);return oc._create(n,t)}(e,t)))}catch(n){throw je(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ze(this.firestore,Qt(this._delegate,function _I(r){return cl("limit",r),Hs._create("limit",r,"F")}(e)))}catch(t){throw je(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ze(this.firestore,Qt(this._delegate,function yI(r){return cl("limitToLast",r),Hs._create("limitToLast",r,"L")}(e)))}catch(t){throw je(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ze(this.firestore,Qt(this._delegate,function II(...r){return Xs._create("startAt",r,!0)}(...e)))}catch(t){throw je(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ze(this.firestore,Qt(this._delegate,function TI(...r){return Xs._create("startAfter",r,!1)}(...e)))}catch(t){throw je(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ze(this.firestore,Qt(this._delegate,function EI(...r){return Js._create("endBefore",r,!1)}(...e)))}catch(t){throw je(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ze(this.firestore,Qt(this._delegate,function vI(...r){return Js._create("endAt",r,!0)}(...e)))}catch(t){throw je(t,"endAt()","Query.endAt()")}}isEqual(e){return Hu(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function bI(r){r=X(r,Pe);const e=X(r.firestore,ae),t=ge(e),n=new Ht(e);return function $y(r,e){const t=new we;return r.asyncQueue.enqueueAndForget((0,x.A)(function*(){return(n=(0,x.A)(function*(s,a,u){try{const c=yield Ds(s,a,!0),h=new ff(a,c.qs),f=h.nu(c.documents),m=h.applyChanges(f,!1);u.resolve(m.snapshot)}catch(c){const h=gr(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield yr(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ue(e,n,r,i))}(this._delegate):"server"===e?.source?function xI(r){r=X(r,Pe);const e=X(r.firestore,ae),t=ge(e),n=new Ht(e);return Vf(t,r._query,{source:"server"}).then(i=>new Ue(e,n,r,i))}(this._delegate):function SI(r){r=X(r,Pe);const e=X(r.firestore,ae),t=ge(e),n=new Ht(e);return Xf(r._query),Vf(t,r._query).then(i=>new Ue(e,n,r,i))}(this._delegate),t.then(n=>new fc(this.firestore,new Ue(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=gm(e),n=pm(e,i=>new fc(this.firestore,new Ue(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Zs(this._delegate,t,n)}withConverter(e){return new ze(this.firestore,this._delegate.withConverter(e?Vn.getInstance(this.firestore,e):null))}}class rT{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class fc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ze(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new vi(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new rT(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new vi(this._firestore,n))})}isEqual(e){return rm(this._delegate,e._delegate)}}class Ar extends ze{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ye(this.firestore,e):null}doc(e){try{return new Ye(this.firestore,void 0===e?zs(this._delegate):zs(this._delegate,e))}catch(t){throw je(t,"doc()","CollectionReference.doc()")}}add(e){return function DI(r,e){const t=X(r.firestore,ae),n=zs(r),i=Ys(r.converter,e);return vr(t,[Gs(Rn(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,me.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new Ye(this.firestore,t))}isEqual(e){return Of(this._delegate,e._delegate)}withConverter(e){return new Ar(this.firestore,this._delegate.withConverter(e?Vn.getInstance(this.firestore,e):null))}}function Sn(r){return X(r,ee)}class mc{constructor(...e){this._delegate=new vt(...e)}static documentId(){return new mc(le.keyField().canonicalString())}isEqual(e){return(e=(0,W.Ku)(e))instanceof vt&&this._delegate._internalPath.isEqual(e._internalPath)}}class bn{static serverTimestamp(){const e=function QI(){return new Yu("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new bn(e)}static delete(){const e=function $I(){return new mi("deleteField")}();return e._methodName="FieldValue.delete",new bn(e)}static arrayUnion(...e){const t=function WI(...r){return new Zu("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new bn(t)}static arrayRemove(...e){const t=function HI(...r){return new ec("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new bn(t)}static increment(e){const t=function XI(r){return new tc("increment",r)}(e);return t._methodName="FieldValue.increment",new bn(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}}const iT={Firestore:dm,GeoPoint:tt,Timestamp:ne,Blob:Ti,Transaction:fm,WriteBatch:mm,DocumentReference:Ye,DocumentSnapshot:Ei,Query:ze,QueryDocumentSnapshot:vi,QuerySnapshot:fc,CollectionReference:Ar,FieldPath:mc,FieldValue:bn,setLogLevel:function nT(r){!function Fg(r){St.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function _m(r,e){return function aT(r,e=Sg.E){return new bg.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function gc(r,e){return _m(r,e).pipe((0,it.T)(t=>({payload:t,type:"query"})))}!function oT(r){(function sT(r,e){r.INTERNAL.registerComponent(new Kc.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},iT)))})(r,(e,t)=>new dm(e,t,new tT)),r.registerVersion("@firebase/firestore-compat","0.3.53")}(Ng.A),oe(762);class ym{ref;afs;injector=(0,re.WQX)(re.uvJ);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=vm(n,t);return new Em(i,s,this.afs)}snapshotChanges(){return function uT(r,e){return _m(r,e).pipe((0,vo.Z)(void 0),Ao(),(0,it.T)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe((0,Ze.YV)(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe((0,it.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,zi.H)(this.ref.get(e)).pipe((0,Ze.YV)(this.injector))}}function no(r,e){return gc(r,e).pipe((0,vo.Z)(void 0),Ao(),(0,it.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(m=>m.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(m=>m.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Im(r,e,t){return no(r,t).pipe((0,wo.S)((n,i)=>function cT(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function lT(r,e){switch(e.type){case"added":if(!r[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return pc(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return pc(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return pc(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,Dg.F)(),(0,it.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function pc(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Tm(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Em{ref;query;afs;injector=(0,re.WQX)(re.uvJ);constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=no(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,it.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,vo.Z)(void 0),Ao(),(0,zc.p)(([n,i])=>i.length>0||!n),(0,it.T)(([,n])=>n),(0,Ze.YV)(this.injector))}auditTrail(e){return this.stateChanges(e).pipe((0,wo.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Tm(e);return Im(this.query,t,this.afs.schedulers.outsideAngular).pipe((0,Ze.YV)(this.injector))}valueChanges(e={}){return gc(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),(0,Ze.YV)(this.injector))}get(e){return(0,zi.H)(this.query.get(e)).pipe((0,Ze.YV)(this.injector))}add(e){return this.ref.add(e)}doc(e){return new ym(this.ref.doc(e),this.afs)}}class hT{query;afs;injector=(0,re.WQX)(re.uvJ);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?no(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,zc.p)(t=>t.length>0),(0,Ze.YV)(this.injector)):no(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ze.YV)(this.injector))}auditTrail(e){return this.stateChanges(e).pipe((0,wo.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Tm(e);return Im(this.query,t,this.afs.schedulers.outsideAngular).pipe((0,Ze.YV)(this.injector))}valueChanges(e={}){return gc(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),(0,Ze.YV)(this.injector))}get(e){return(0,zi.H)(this.query.get(e)).pipe((0,Ze.YV)(this.injector))}}const dT=new re.nKC("angularfire2.enableFirestorePersistence"),fT=new re.nKC("angularfire2.firestore.persistenceSettings"),mT=new re.nKC("angularfire2.firestore.settings"),gT=new re.nKC("angularfire2.firestore.use-emulator");function vm(r,e=t=>t){return{query:e(r),ref:r}}let pT=(()=>{class r{schedulers;firestore;persistenceEnabled$;ngZone=(0,re.WQX)(Eo.SKi);constructor(t,n,i,s,a,u,c,h,f,m,p,A,b,N,D,L,j){this.schedulers=c;const B=(0,ji.iB)(t,u,n),G=f;m&&(0,Pt.gF)(B,u,p,b,N,D,A,L),[this.firestore,this.persistenceEnabled$]=(0,ji.BM)(`${B.name}.firestore`,"AngularFirestore",B.name,()=>{const J=u.runOutsideAngular(()=>B.firestore());if(s&&J.settings(s),G&&J.useEmulator(...G),i&&!(0,Rg.Vy)(a)){const Q=()=>{try{return(0,zi.H)(J.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),(0,jc.of)(!1)}};return[J,u.runOutsideAngular(Q)]}return[J,(0,jc.of)(!1)]},[s,G,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:a}=vm(i,n),u=this.ngZone.run(()=>s);return new Em(u,a,this)}collectionGroup(t,n){const i=n||(a=>a),s=this.firestore.collectionGroup(t);return new hT(i(s),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.ngZone.run(()=>n);return new ym(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(re.KVO(ji.rx),re.KVO(ji.uP,8),re.KVO(dT,8),re.KVO(mT,8),re.KVO(Eo.Agw),re.KVO(Eo.SKi),re.KVO(Pg.u0),re.KVO(fT,8),re.KVO(gT,8),re.KVO(Pt.DS,8),re.KVO(Pt.CP,8),re.KVO(Pt.yy,8),re.KVO(Pt.ZP,8),re.KVO(Pt.$z,8),re.KVO(Pt.AU,8),re.KVO(Pt.UB,8),re.KVO(Vg.kR,8))};static \u0275prov=re.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})()}}]);