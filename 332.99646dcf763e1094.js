"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[332],{6332:(R,_,r)=>{r.r(_),r.d(_,{UserStatusComponent:()=>y});var l=r(467),p=r(1413),m=r(6977),d=r(5312),h=r(7935),t=r(4438),f=r(1152),E=r(9182),C=r(5794),g=r(1188),c=r(177),a=r(9417),v=r(386);const D=["loginForm"];function M(s,u){1&s&&(t.qex(0),t.nrm(1,"span",4),t.bVm())}function P(s,u){1&s&&(t.j41(0,"div",15),t.nrm(1,"app-oauth-federations",16),t.k0s()),2&s&&(t.R7$(),t.Y8G("isTiny",!0))}function I(s,u){if(1&s){const n=t.RV6();t.qex(0),t.j41(1,"form",5,0)(3,"div",6)(4,"label",7),t.EFF(5,"Email"),t.k0s(),t.j41(6,"input",8),t.mxI("ngModelChange",function(e){t.eBV(n);const i=t.XpG();return t.DH7(i.emailInput,e)||(i.emailInput=e),t.Njj(e)}),t.k0s()(),t.j41(7,"div",6)(8,"label",9),t.EFF(9,"Password"),t.k0s(),t.j41(10,"input",10),t.mxI("ngModelChange",function(e){t.eBV(n);const i=t.XpG();return t.DH7(i.passwordInput,e)||(i.passwordInput=e),t.Njj(e)}),t.k0s()(),t.j41(11,"div",6)(12,"button",11),t.bIt("click",function(e){t.eBV(n);const i=t.XpG();return t.Njj(i.doLogin(e))}),t.EFF(13,"Login"),t.k0s(),t.DNE(14,P,2,1,"div",12),t.k0s()(),t.nrm(15,"hr"),t.j41(16,"div",13)(17,"a",14),t.EFF(18,"\u305d\u306e\u4ed6\u306e\u6a5f\u80fd"),t.k0s()(),t.bVm()}if(2&s){const n=t.XpG();t.R7$(6),t.R50("ngModel",n.emailInput),t.R7$(4),t.R50("ngModel",n.passwordInput),t.R7$(4),t.Y8G("ngIf",!1)}}function U(s,u){if(1&s&&t.nrm(0,"img",33),2&s){const n=t.XpG(3);t.FS9("src",n.status.photoUrl,t.B4B)}}function x(s,u){1&s&&t.nrm(0,"span",34)}function S(s,u){if(1&s){const n=t.RV6();t.qex(0),t.j41(1,"div",13)(2,"div")(3,"div",18),t.EFF(4),t.k0s(),t.j41(5,"div",13),t.DNE(6,U,1,1,"img",19)(7,x,1,0,"span",20),t.k0s(),t.j41(8,"div",21)(9,"div",22)(10,"a",23),t.nrm(11,"img",24),t.EFF(12,"Chat"),t.k0s()(),t.j41(13,"div",22)(14,"a",25),t.nrm(15,"img",26),t.EFF(16,"Post"),t.k0s()()(),t.j41(17,"div",18)(18,"a",27),t.nrm(19,"img",28),t.EFF(20,"\u8a2d\u5b9a"),t.k0s()(),t.j41(21,"div",18)(22,"button",11),t.bIt("click",function(e){t.eBV(n);const i=t.XpG(2);return t.Njj(i.doLogout(e))}),t.nrm(23,"img",29),t.EFF(24,"\u30ed\u30b0\u30a2\u30a6\u30c8"),t.k0s()()(),t.nrm(25,"hr"),t.j41(26,"div",30)(27,"div")(28,"a",31),t.EFF(29,"\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc"),t.k0s(),t.EFF(30,"\u30fb"),t.j41(31,"a",32),t.EFF(32,"\u5229\u7528\u898f\u7d04"),t.k0s()()()(),t.bVm()}if(2&s){const n=u.$implicit,o=t.XpG(2);t.R7$(4),t.JRh(n.displayName),t.R7$(2),t.Y8G("ngIf",o.status.photoUrl),t.R7$(),t.Y8G("ngIf",!o.status.photoUrl)}}function F(s,u){if(1&s&&(t.qex(0),t.DNE(1,S,33,3,"ng-container",17),t.bVm()),2&s){const n=t.XpG();t.R7$(),t.Y8G("ngIf",n.status.user)}}class O{state="checking";user;photoUrl}let y=(()=>{class s{auth;localSession;toastr;router;status=new O;destroy$=new p.B;emailInput;passwordInput;loginForm;constructor(n,o,e,i){this.auth=n,this.localSession=o,this.toastr=e,this.router=i}ngOnDestroy(){this.destroy$.next()}ngOnInit(){this.auth.user.pipe((0,m.Q)(this.destroy$)).subscribe(n=>{this.status.state=n&&this.localSession.isSeemsLogin?"login":"logout",this.status.user=n}),this.localSession.loginPhoto$().pipe((0,m.Q)(this.destroy$)).subscribe(n=>{this.status.photoUrl=n})}doLogin(n){var o=this;return(0,l.A)(function*(){if(n.preventDefault(),n.stopPropagation(),o.loginForm.invalid)o.toastr.error("\u5165\u529b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else try{yield o.auth.setPersistence(h.A.auth.Auth.Persistence.SESSION),yield o.auth.signInWithEmailAndPassword(o.emailInput,o.passwordInput)}catch(e){o.toastr.error(`Login \u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002(${e.code}: ${e.message})`)}})()}doLogout(n){var o=this;return(0,l.A)(function*(){n.preventDefault();try{yield o.auth.signOut(),o.router.navigate(["/"])}catch(e){(0,d.sJ)("UserStatusComponent.doLogout() is failed",e)}})()}static \u0275fac=function(o){return new(o||s)(t.rXU(f.DS),t.rXU(E.Q),t.rXU(C.tw),t.rXU(g.Ix))};static \u0275cmp=t.VBU({type:s,selectors:[["ng-component"]],viewQuery:function(o,e){if(1&o&&t.GBs(D,5),2&o){let i;t.mGM(i=t.lsd())&&(e.loginForm=i.first)}},decls:5,vars:4,consts:[["loginForm","ngForm"],[1,"px-2","py-3"],[3,"ngSwitch"],[4,"ngSwitchCase"],["role","status",1,"spinner-border","text-primary"],[1,"form-group"],[1,"my-1"],["for","appGitfireUserStatusEmailInput",1,"visually-hidden"],["id","appGitfireUserStatusEmailInput","name","email","placeholder","email@example.com","type","email","required","","autocomplete","email","autofill","",1,"form-control",3,"ngModelChange","ngModel"],["for","appGitfireUserStatusPasswordInput",1,"visually-hidden"],["id","appGitfireUserStatusPasswordInput","name","password","placeholder","Password","type","password","autocomplete","current-password","required","","autofill","",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["class","my-2",4,"ngIf"],[1,"text-center"],["routerLink","/Gitfire/login",1,"text-muted","fw-light","footnote"],[1,"my-2"],[3,"isTiny"],[4,"ngIf"],[1,"m-3"],["class","rounded user-icon",3,"src",4,"ngIf"],["class","spinner-border text-primary user-icon","role","status",4,"ngIf"],[1,"m-3","row"],[1,"col-6"],["routerLink","/Gitfire/chat"],["src","/assets/octicons/comment-discussion.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/post"],["src","/assets/octicons/cloud-upload.svg",1,"m-1","gitfire-link-icon","octicon-info"],["routerLink","/Gitfire/settings"],["src","/assets/octicons/tools.svg",1,"m-1","gitfire-link-icon","octicon-info"],["src","/assets/octicons/sign-out.svg",1,"m-1","gitfire-link-icon","octicon-info"],[1,"m-3","footnote"],["href","/policy.htm","about","_blank",1,"text-muted","fw-light"],["href","/terms.htm","about","_blank",1,"text-muted","fw-light"],[1,"rounded","user-icon",3,"src"],["role","status",1,"spinner-border","text-primary","user-icon"]],template:function(o,e){1&o&&(t.j41(0,"div",1),t.qex(1,2),t.DNE(2,M,2,0,"ng-container",3)(3,I,19,3,"ng-container",3)(4,F,2,1,"ng-container",3),t.bVm(),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngSwitch",e.status.state),t.R7$(),t.Y8G("ngSwitchCase","checking"),t.R7$(),t.Y8G("ngSwitchCase","logout"),t.R7$(),t.Y8G("ngSwitchCase","login"))},dependencies:[c.bT,c.ux,c.e1,a.qT,a.me,a.BC,a.cb,a.YS,a.vS,a.cV,g.Wk,v.d],styles:["[_nghost-%COMP%]{cursor:initial}.footnote[_ngcontent-%COMP%]{font-size:.7rem}.user-icon[_ngcontent-%COMP%]{width:128px;height:128px}.gitfire-link-icon[_ngcontent-%COMP%]{width:24px;height:24px}.oauth-tiny-wide-img[_ngcontent-%COMP%]{height:30px}.oauth-tiny-circle-img[_ngcontent-%COMP%]{width:30px}"]})}return s})()}}]);