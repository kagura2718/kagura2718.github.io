import{a as X}from"./chunk-D34DU4NH.js";import{a as Y}from"./chunk-EJOY4MMD.js";import{a as V}from"./chunk-RYEPP2DX.js";import{a as G,b as B,c as K,d as Z,e as q,f as J,h as Q,p as W}from"./chunk-XZ4LEBLW.js";import{$ as y,E as O,G as $,H as M,M as S,Oc as R,P as s,Qc as m,R as h,Rc as c,S as k,Tc as g,Z as d,aa as t,b as E,ba as C,d as D,da as L,ea as N,j as x,l as w,m as U,ma as P,o as F,z as T}from"./chunk-Y4TIFGVV.js";var re=new y("angularfire2.functions.origin"),ne=new y("angularfire2.functions.region"),se=new y("angularfire2.functions.use-emulator"),ee=(()=>{class e{httpsCallable;constructor(n,p,f,v,r,o,i,a){let l=i,H=U(void 0).pipe(x(v.outsideAngular),s(()=>import("./chunk-NCRFWMCB.js")),F(()=>J(n,f,p)),F(b=>Q(`${b.name}.functions.${r||o}`,"AngularFireFunctions",b.name,()=>{let A;if(r&&o)throw new Error("REGION and ORIGIN can't be used at the same time.");return A=b.functions(r||o||void 0),l&&A.useEmulator(...l),A},[r,o,l])),S({bufferSize:1,refCount:!1}));return this.httpsCallable=(b,A)=>te=>w(H).pipe(x(v.insideAngular),s(j=>j.httpsCallable(b,A)(te)),F(j=>j.data)),K(this,H,f)}static \u0275fac=function(p){return new(p||e)(t(Z),t(q,8),t(P),t(G),t(ne,8),t(re,8),t(se,8),t(B,8))};static \u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"any"})}return e})();var I=class e{constructor(u){this.remote=u;m("LocalFunctionsService.constructor()")}async call(u,n){return await this.remote.httpsCallable(u)(n).pipe($(1)).toPromise()}static \u0275fac=function(n){return new(n||e)(t(ee))};static \u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"})};var z=class{constructor(u,n,p,f,v){this.auth=u;this.funcs=n;this.localSession=p;this.store=f;this.dom=v;m("SingletonAuth.constructor()"),this.dom.addResourceHint("https://identitytoolkit.googleapis.com","preconnect"),this.dom.addResourceHint("https://firebaseinstallations.googleapis.com","preconnect"),this.dom.addResourceHint("https://firestore.googleapis.com","preconnect"),this.dom.addResourceHint("https://apis.google.com","preconnect"),this.dom.addResourceHint(`https://${R.firebaseConfig.authDomain}`,"preconnect"),this.dom.addResourceHint(`https://${R.FirebaseCloudFunctionsHost}`,"preconnect");let r=this.auth.user.pipe(M());r.pipe(M(),h(this.finalize$)).subscribe(i=>{this.sourceValue$.next()}),this.state$=r.pipe(T(i=>i!==null)),this.localSession.markedLogout$.pipe(h(this.finalize$)).subscribe(()=>{this.sourceValue$.next()}),this.state$.pipe(h(this.finalize$)).subscribe({error:i=>{g("AuthService.state$ error",i),this.doFinalize()},complete:()=>{c("AuthService.state$ completed."),this.doFinalize()}}),this.state$.pipe(s(i=>N(this.env,()=>this.store.collection(`/users/v1/protected/${i.uid}/fcm`).valueChanges().pipe(k(a=>m("UserProtectedStore has changed.",a))))),h(this.finalize$)).subscribe({next:i=>{this.sourceValue$.next()},error:i=>{g("AuthService.state$ Maybe after logout permission error. Ignore it.",i),this.doFinalize()},complete:()=>{c("AuthService.state$ completed."),this.doFinalize()}});let o=this.state$.pipe(s(async i=>{try{let a=await this.funcs.call("readUserSettings"),l=i;return l.isAdmin=a.isAdmin,l.isDeveloper=a.isDeveloper,l.hasMessaging=a.hasMessaging,l}catch(a){return g("AuthService while check user settings.",a),null}}));this.localUser$=this.sourceValue$.pipe(O(100),s(()=>r.pipe(s(i=>i===null?U(null):o))),S(1)),this.localUser$.pipe(h(this.finalize$)).subscribe({next:async i=>{m("AuthService.localUser$.subscribe()",i),i?(this.loginUid=i.uid,this.isAdminUser=!!i.isAdmin,this.isDevelopUser=!!i.isDeveloper,this.hasMessagingDevice=!!i.hasMessaging,this.localSession.updateLoginPhoto(i.photoURL),this.localSession.markLogin()):(this.localSession.unmarkLogin(),this.localSession.updateLoginPhoto(null),this.loginUid=null,this.isAdminUser=!1,this.isDevelopUser=!1,this.hasMessagingDevice=!1,c("Explicitly logout on client sdk."),await this.auth.signOut())},complete:()=>{c("AuthService.localUser$ complete."),this.doFinalize()},error:i=>{g("AuthService.localUser$ error while retrieving.",i),this.doFinalize()}})}finalize$=new E;state$;localUser$;isAdminUser=!1;isDevelopUser=!1;hasMessagingDevice=!1;loginUid=null;env=C(L);sourceValue$=new D;doFinalize(){this.finalize$.isStopped||(c("Do finalize Singleton Auth"),this.finalize$.next(),this.finalize$.complete())}},ie=class e{constructor(u,n,p,f,v){this.auth=u;this.funcs=n;this.localSession=p;this.store=f;this.dom=v;m("AuthService.constructor()");let r=new D;e.AUTH===null&&(e.AUTH=new z(u,n,p,f,v),e.AUTH.finalize$.pipe($(1)).subscribe({next:()=>{c("Finalize singleton auth continue..")},complete:()=>{c("Finalizing singleton auth completed."),e.AUTH=null,r.next()},error:o=>{g("Finalizing singleton auth cause by error.",o),e.AUTH=null,r.next()}})),this._clientSideUser$=r.pipe(s(()=>e.AUTH===null?U(null):e.AUTH.localUser$),S(1)),r.next()}static AUTH=null;_clientSideUser$;get clientSideUser$(){return this._clientSideUser$}get isAdmin(){return e.AUTH?e.AUTH.isAdminUser:!1}get isDeveloper(){return e.AUTH?e.AUTH.isDevelopUser:!1}get hasMessaging(){return e.AUTH?e.AUTH.hasMessagingDevice:!1}get myUid(){return e.AUTH?e.AUTH.loginUid:null}static \u0275fac=function(n){return new(n||e)(t(W),t(I),t(V),t(X),t(Y))};static \u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"})};export{ne as a,I as b,ie as c};
