import{a as Sd,b as Rd,d as Pd,e as Vd,f as Cd,h as xd,i as Dd,j as Nd,k as kd,l as Fd,m as Od,n as Md,o as Ld,p as qd}from"./chunk-XZ4LEBLW.js";import{c as Qt}from"./chunk-UUDJPQGG.js";import{$ as ti,H as dd,J as _s,L as ys,O as ws,Z as fd,a as ld,aa as Tt,ba as ei,da as vs,f as hd,l as Zr,m as Na,ma as Is,o as Xt,va as md,xc as gd,z as ka}from"./chunk-Y4TIFGVV.js";import{D as ct,E as Es,F as ne,G as Td,J as Ed,L as Ad,M as bd,O as La,P as qa,c as pd,f as Fa,g as _d,h as yd,i as wd,j as ni,q as Oa,r as Ma,s as vd,v as Id,y as Ts}from"./chunk-GJFX5N3M.js";import{a as ps,b as Da}from"./chunk-VB56BUGO.js";var Ud=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bd={};var pe,Ua;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(I,T,A){for(var y=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)y[fe-2]=arguments[fe];return p.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var I=Array(16);if(typeof p=="string")for(var T=0;16>T;++T)I[T]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],T=v.g[2];var A=v.g[3],y=p+(A^w&(T^A))+I[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[3]+3250441966&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[7]+4249261313&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[11]+2304563134&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[15]+1236535329&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(T^A&(w^T))+I[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[0]+3921069994&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[4]+3889429448&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[8]+1163531501&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[12]+2368359562&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(w^T^A)+I[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[14]+4259657740&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[10]+3200236656&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[6]+76029189&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[2]+3299628645&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(T^(w|~A))+I[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[5]+4237533241&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[1]+2240044497&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[13]+1309151649&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,I=this.B,T=this.h,A=0;A<p;){if(T==0)for(;A<=w;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(I[T++]=v.charCodeAt(A++),T==this.blockSize){i(this,I),T=0;break}}else for(;A<p;)if(I[T++]=v[A++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var I=0;32>I;I+=8)v[w++]=this.g[p]>>>I&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],I=!0,T=v.length-1;0<=T;T--){var A=v[T]|0;I&&A==p||(w[T]=A,I=!1)}this.g=w}var u={};function l(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return D(d(-v));for(var p=[],w=1,I=0;v>=w;I++)p[I]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return D(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),I=g,T=0;T<v.length;T+=8){var A=Math.min(8,v.length-T),y=parseInt(v.substring(T,T+A),p);8>A?(A=d(Math.pow(p,A)),I=I.j(A).add(d(y))):(I=I.j(w),I=I.add(d(y)))}return I}var g=l(0),_=l(1),S=l(16777216);r=a.prototype,r.m=function(){if(N(this))return-D(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var I=this.i(w);v+=(0<=I?I:4294967296+I)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(C(this))return"0";if(N(this))return"-"+D(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,I="";;){var T=$(w,p).g;w=j(w,T.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=T,C(w))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function C(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function N(v){return v.h==-1}r.l=function(v){return v=j(this,v),N(v)?-1:C(v)?0:1};function D(v){for(var p=v.g.length,w=[],I=0;I<p;I++)w[I]=~v.g[I];return new a(w,~v.h).add(_)}r.abs=function(){return N(this)?D(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0,T=0;T<=p;T++){var A=I+(this.i(T)&65535)+(v.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,w[T]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function j(v,p){return v.add(D(p))}r.j=function(v){if(C(this)||C(v))return g;if(N(this))return N(v)?D(this).j(D(v)):D(D(this).j(v));if(N(v))return D(this.j(D(v)));if(0>this.l(S)&&0>v.l(S))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],I=0;I<2*p;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<v.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,fe=v.i(T)>>>16,kr=v.i(T)&65535;w[2*I+2*T]+=y*kr,B(w,2*I+2*T),w[2*I+2*T+1]+=A*kr,B(w,2*I+2*T+1),w[2*I+2*T+1]+=y*fe,B(w,2*I+2*T+1),w[2*I+2*T+2]+=A*fe,B(w,2*I+2*T+2)}for(I=0;I<p;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=p;I<2*p;I++)w[I]=0;return new a(w,0)};function B(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function q(v,p){this.g=v,this.h=p}function $(v,p){if(C(p))throw Error("division by zero");if(C(v))return new q(g,g);if(N(v))return p=$(D(v),p),new q(D(p.g),D(p.h));if(N(p))return p=$(v,D(p)),new q(D(p.g),p.h);if(30<v.g.length){if(N(v)||N(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,I=p;0>=I.l(v);)w=W(w),I=W(I);var T=G(w,1),A=G(I,1);for(I=G(I,2),w=G(w,2);!C(I);){var y=A.add(I);0>=y.l(v)&&(T=T.add(w),A=y),I=G(I,1),w=G(w,1)}return p=j(v,T.j(p)),new q(T,p)}for(T=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(w),y=A.j(p);N(y)||0<y.l(v);)w-=I,A=d(w),y=A.j(p);C(A)&&(A=_),T=T.add(A),v=j(v,y)}return new q(T,v)}r.A=function(v){return $(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)&v.i(I);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)|v.i(I);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)^v.i(I);return new a(w,this.h^v.h)};function W(v){for(var p=v.g.length+1,w=[],I=0;I<p;I++)w[I]=v.i(I)<<1|v.i(I-1)>>>31;return new a(w,v.h)}function G(v,p){var w=p>>5;p%=32;for(var I=v.g.length-w,T=[],A=0;A<I;A++)T[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ua=Bd.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,pe=Bd.Integer=a}).apply(typeof Ud<"u"?Ud:typeof self<"u"?self:typeof window<"u"?window:{});var As=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_e={};var Ba,D_,qn,ja,ri,bs,za,Ga,Ka;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof As=="object"&&As];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:c(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function _(o,c,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function S(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function C(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var k=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)k[nt-2]=arguments[nt];return c.prototype[E].apply(m,k)}}function N(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function D(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let k=0;k<P;k++)o[E+k]=m[k]}else o.push(m)}}class j{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function B(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function $(o){return $[" "](o),o}$[" "]=function(){};var W=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function G(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function v(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=aa;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class fe{constructor(){this.h=this.g=null}add(c,h){let m=kr.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var kr=new j(()=>new Yp,o=>o.reset());class Yp{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Fr,Or=!1,aa=new fe,ch=()=>{let o=u.Promise.resolve(void 0);Fr=()=>{o.then(Zp)}};var Zp=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=kr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Or=!1};function Pe(){this.s=this.s,this.C=this.C}Pe.prototype.s=!1,Pe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Pe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function St(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var t_=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o})();function Mr(o,c){if(St.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(W){t:{try{$(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:e_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Mr.aa.h.call(this)}}C(Mr,St);var e_={2:"touch",3:"pen",4:"mouse"};Mr.prototype.h=function(){Mr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Lr="closure_listenable_"+(1e6*Math.random()|0),n_=0;function r_(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++n_,this.da=this.fa=!1}function Zi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ts(o){this.src=o,this.g={},this.h=0}ts.prototype.add=function(o,c,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var k=ca(o,c,m,E);return-1<k?(c=o[k],h||(c.fa=!1)):(c=new r_(c,this.src,P,!!m,E),c.fa=h,o.push(c)),c};function ua(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(Zi(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ca(o,c,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==m)return E}return-1}var la="closure_lm_"+(1e6*Math.random()|0),ha={};function lh(o,c,h,m,E){if(m&&m.once)return dh(o,c,h,m,E);if(Array.isArray(c)){for(var P=0;P<c.length;P++)lh(o,c[P],h,m,E);return null}return h=ga(h),o&&o[Lr]?o.K(c,h,d(m)?!!m.capture:!!m,E):hh(o,c,h,!1,m,E)}function hh(o,c,h,m,E,P){if(!c)throw Error("Invalid event type");var k=d(E)?!!E.capture:!!E,nt=fa(o);if(nt||(o[la]=nt=new ts(o)),h=nt.add(c,h,m,k,P),h.proxy)return h;if(m=i_(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)t_||(E=k),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(mh(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function i_(){function o(h){return c.call(o.src,o.listener,h)}let c=s_;return o}function dh(o,c,h,m,E){if(Array.isArray(c)){for(var P=0;P<c.length;P++)dh(o,c[P],h,m,E);return null}return h=ga(h),o&&o[Lr]?o.L(c,h,d(m)?!!m.capture:!!m,E):hh(o,c,h,!0,m,E)}function fh(o,c,h,m,E){if(Array.isArray(c))for(var P=0;P<c.length;P++)fh(o,c[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=ga(h),o&&o[Lr]?(o=o.i,c=String(c).toString(),c in o.g&&(P=o.g[c],h=ca(P,h,m,E),-1<h&&(Zi(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[c],o.h--)))):o&&(o=fa(o))&&(c=o.g[c.toString()],o=-1,c&&(o=ca(c,h,m,E)),(h=-1<o?c[o]:null)&&da(h))}function da(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Lr])ua(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(mh(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=fa(c))?(ua(h,o),h.h==0&&(h.src=null,c[la]=null)):Zi(o)}}}function mh(o){return o in ha?ha[o]:ha[o]="on"+o}function s_(o,c){if(o.da)o=!0;else{c=new Mr(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&da(o),o=h.call(m,c)}return o}function fa(o){return o=o[la],o instanceof ts?o:null}var ma="__closure_events_fn_"+(1e9*Math.random()>>>0);function ga(o){return typeof o=="function"?o:(o[ma]||(o[ma]=function(c){return o.handleEvent(c)}),o[ma])}function Rt(){Pe.call(this),this.i=new ts(this),this.M=this,this.F=null}C(Rt,Pe),Rt.prototype[Lr]=!0,Rt.prototype.removeEventListener=function(o,c,h,m){fh(this,o,c,h,m)};function Nt(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new St(c,o);else if(c instanceof St)c.target=c.target||o;else{var E=c;c=new St(m,o),I(c,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var k=c.g=h[P];E=es(k,m,!0,c)&&E}if(k=c.g=o,E=es(k,m,!0,c)&&E,E=es(k,m,!1,c)&&E,h)for(P=0;P<h.length;P++)k=c.g=h[P],E=es(k,m,!1,c)&&E}Rt.prototype.N=function(){if(Rt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)Zi(h[m]);delete o.g[c],o.h--}}this.F=null},Rt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},Rt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function es(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,P=0;P<c.length;++P){var k=c[P];if(k&&!k.da&&k.capture==h){var nt=k.listener,Et=k.ha||k.src;k.fa&&ua(o.i,k),E=nt.call(Et,m)!==!1&&E}}return E&&!m.defaultPrevented}function gh(o,c,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function ph(o){o.g=gh(()=>{o.g=null,o.i&&(o.i=!1,ph(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class o_ extends Pe{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ph(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qr(o){Pe.call(this),this.h=o,this.g={}}C(qr,Pe);var _h=[];function yh(o){G(o.g,function(c,h){this.g.hasOwnProperty(h)&&da(c)},o),o.g={}}qr.prototype.N=function(){qr.aa.N.call(this),yh(this)},qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pa=u.JSON.stringify,a_=u.JSON.parse,u_=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function _a(){}_a.prototype.h=null;function wh(o){return o.h||(o.h=o.i())}function vh(){}var Ur={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ya(){St.call(this,"d")}C(ya,St);function wa(){St.call(this,"c")}C(wa,St);var rn={},Ih=null;function ns(){return Ih=Ih||new Rt}rn.La="serverreachability";function Th(o){St.call(this,rn.La,o)}C(Th,St);function Br(o){let c=ns();Nt(c,new Th(c))}rn.STAT_EVENT="statevent";function Eh(o,c){St.call(this,rn.STAT_EVENT,o),this.stat=c}C(Eh,St);function kt(o){let c=ns();Nt(c,new Eh(c,o))}rn.Ma="timingevent";function Ah(o,c){St.call(this,rn.Ma,o),this.size=c}C(Ah,St);function jr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function zr(){this.g=!0}zr.prototype.xa=function(){this.g=!1};function c_(o,c,h,m,E,P){o.info(function(){if(o.g)if(P)for(var k="",nt=P.split("&"),Et=0;Et<nt.length;Et++){var Y=nt[Et].split("=");if(1<Y.length){var Pt=Y[0];Y=Y[1];var Vt=Pt.split("_");k=2<=Vt.length&&Vt[1]=="type"?k+(Pt+"="+Y+"&"):k+(Pt+"=redacted&")}}else k=null;else k=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+k})}function l_(o,c,h,m,E,P,k){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+P+" "+k})}function Fn(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+d_(o,h)+(m?" "+m:"")})}function h_(o,c){o.info(function(){return"TIMEOUT: "+c})}zr.prototype.info=function(){};function d_(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var k=1;k<E.length;k++)E[k]=""}}}}return pa(h)}catch{return c}}var rs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},bh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},va;function is(){}C(is,_a),is.prototype.g=function(){return new XMLHttpRequest},is.prototype.i=function(){return{}},va=new is;function Ve(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new qr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Sh}function Sh(){this.i=null,this.g="",this.h=!1}var Rh={},Ia={};function Ta(o,c,h){o.L=1,o.v=us(me(c)),o.m=h,o.P=!0,Ph(o,null)}function Ph(o,c){o.F=Date.now(),ss(o),o.A=me(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),jh(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Sh,o.g=od(o.j,h?c:null,!o.m),0<o.O&&(o.M=new o_(_(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(_h[0]=E.toString()),E=_h);for(var P=0;P<E.length;P++){var k=lh(h,E[P],m||c.handleEvent,!1,c.h||c);if(!k)break;c.g[k.key]=k}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Br(),c_(o.i,o.u,o.A,o.l,o.R,o.m)}Ve.prototype.ca=function(o){o=o.target;let c=this.M;c&&ge(o)==3?c.j():this.Y(o)},Ve.prototype.Y=function(o){try{if(o==this.g)t:{let Vt=ge(this.g);var c=this.g.Ba();let Ln=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||Hh(this.g)))){this.J||Vt!=4||c==7||(c==8||0>=Ln?Br(3):Br(2)),Ea(this);var h=this.g.Z();this.X=h;e:if(Vh(this)){var m=Hh(this.g);o="";var E=m.length,P=ge(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){sn(this),Gr(this);var k="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(P&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=h==200,l_(this.i,this.u,this.A,this.l,this.R,Vt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,Et=this.g;if((nt=Et.g?Et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(nt)){var Y=nt;break e}}Y=null}if(h=Y)Fn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Aa(this,h);else{this.o=!1,this.s=3,kt(12),sn(this),Gr(this);break t}}if(this.P){h=!0;let Ht;for(;!this.J&&this.C<k.length;)if(Ht=f_(this,k),Ht==Ia){Vt==4&&(this.s=4,kt(14),h=!1),Fn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ht==Rh){this.s=4,kt(15),Fn(this.i,this.l,k,"[Invalid Chunk]"),h=!1;break}else Fn(this.i,this.l,Ht,null),Aa(this,Ht);if(Vh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||k.length!=0||this.h.h||(this.s=1,kt(16),h=!1),this.o=this.o&&h,!h)Fn(this.i,this.l,k,"[Invalid Chunked Response]"),sn(this),Gr(this);else if(0<k.length&&!this.W){this.W=!0;var Pt=this.j;Pt.g==this&&Pt.ba&&!Pt.M&&(Pt.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),Ca(Pt),Pt.M=!0,kt(11))}}else Fn(this.i,this.l,k,null),Aa(this,k);Vt==4&&sn(this),this.o&&!this.J&&(Vt==4?nd(this.j,this):(this.o=!1,ss(this)))}else C_(this.g),h==400&&0<k.indexOf("Unknown SID")?(this.s=3,kt(12)):(this.s=0,kt(13)),sn(this),Gr(this)}}}catch{}};function Vh(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function f_(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Ia:(h=Number(c.substring(h,m)),isNaN(h)?Rh:(m+=1,m+h>c.length?Ia:(c=c.slice(m,m+h),o.C=m+h,c)))}Ve.prototype.cancel=function(){this.J=!0,sn(this)};function ss(o){o.S=Date.now()+o.I,Ch(o,o.I)}function Ch(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=jr(_(o.ba,o),c)}function Ea(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ve.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(h_(this.i,this.A),this.L!=2&&(Br(),kt(17)),sn(this),this.s=2,Gr(this)):Ch(this,this.S-o)};function Gr(o){o.j.G==0||o.J||nd(o.j,o)}function sn(o){Ea(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,yh(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Aa(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||ba(h.h,o))){if(!o.K&&ba(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)fs(h),hs(h);else break t;Va(h),kt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=jr(_(h.Za,h),6e3));if(1>=Nh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else an(h,11)}else if((o.K||h.g==o)&&fs(h),!B(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let Y=E[c];if(h.T=Y[0],Y=Y[1],h.G==2)if(Y[0]=="c"){h.K=Y[1],h.ia=Y[2];let Pt=Y[3];Pt!=null&&(h.la=Pt,h.j.info("VER="+h.la));let Vt=Y[4];Vt!=null&&(h.Aa=Vt,h.j.info("SVER="+h.Aa));let Ln=Y[5];Ln!=null&&typeof Ln=="number"&&0<Ln&&(m=1.5*Ln,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Ht=o.g;if(Ht){let gs=Ht.g?Ht.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gs){var P=m.h;P.g||gs.indexOf("spdy")==-1&&gs.indexOf("quic")==-1&&gs.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Sa(P,P.h),P.h=null))}if(m.D){let xa=Ht.g?Ht.g.getResponseHeader("X-HTTP-Session-Id"):null;xa&&(m.ya=xa,it(m.I,m.D,xa))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var k=o;if(m.qa=sd(m,m.J?m.ia:null,m.W),k.K){kh(m.h,k);var nt=k,Et=m.L;Et&&(nt.I=Et),nt.B&&(Ea(nt),ss(nt)),m.g=k}else td(m);0<h.i.length&&ds(h)}else Y[0]!="stop"&&Y[0]!="close"||an(h,7);else h.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?an(h,7):Pa(h):Y[0]!="noop"&&h.l&&h.l.ta(Y),h.v=0)}}Br(4)}catch{}}var m_=class{constructor(o,c){this.g=o,this.map=c}};function xh(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Dh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Nh(o){return o.h?1:o.g?o.g.size:0}function ba(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Sa(o,c){o.g?o.g.add(c):o.h=c}function kh(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}xh.prototype.cancel=function(){if(this.i=Fh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Fh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return N(o.i)}function g_(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function p_(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function Oh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=p_(o),m=g_(o),E=m.length,P=0;P<E;P++)c.call(void 0,m[P],h&&h[P],o)}var Mh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function __(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];c(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function on(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof on){this.h=o.h,os(this,o.j),this.o=o.o,this.g=o.g,as(this,o.s),this.l=o.l;var c=o.i,h=new Qr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),Lh(this,h),this.m=o.m}else o&&(c=String(o).match(Mh))?(this.h=!1,os(this,c[1]||"",!0),this.o=Kr(c[2]||""),this.g=Kr(c[3]||"",!0),as(this,c[4]),this.l=Kr(c[5]||"",!0),Lh(this,c[6]||"",!0),this.m=Kr(c[7]||"")):(this.h=!1,this.i=new Qr(null,this.h))}on.prototype.toString=function(){var o=[],c=this.j;c&&o.push($r(c,qh,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push($r(c,qh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push($r(h,h.charAt(0)=="/"?v_:w_,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",$r(h,T_)),o.join("")};function me(o){return new on(o)}function os(o,c,h){o.j=h?Kr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function as(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Lh(o,c,h){c instanceof Qr?(o.i=c,E_(o.i,o.h)):(h||(c=$r(c,I_)),o.i=new Qr(c,o.h))}function it(o,c,h){o.i.set(c,h)}function us(o){return it(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Kr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function $r(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,y_),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function y_(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var qh=/[#\/\?@]/g,w_=/[#\?:]/g,v_=/[#\?]/g,I_=/[#\?@]/g,T_=/#/g;function Qr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ce(o){o.g||(o.g=new Map,o.h=0,o.i&&__(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Qr.prototype,r.add=function(o,c){Ce(this),this.i=null,o=On(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Uh(o,c){Ce(o),c=On(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Bh(o,c){return Ce(o),c=On(o,c),o.g.has(c)}r.forEach=function(o,c){Ce(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){Ce(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(c[m])}return h},r.V=function(o){Ce(this);let c=[];if(typeof o=="string")Bh(this,o)&&(c=c.concat(this.g.get(On(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return Ce(this),this.i=null,o=On(this,o),Bh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function jh(o,c,h){Uh(o,c),0<h.length&&(o.i=null,o.g.set(On(o,c),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let P=encodeURIComponent(String(m)),k=this.V(m);for(m=0;m<k.length;m++){var E=P;k[m]!==""&&(E+="="+encodeURIComponent(String(k[m]))),o.push(E)}}return this.i=o.join("&")};function On(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function E_(o,c){c&&!o.j&&(Ce(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(Uh(this,m),jh(this,E,h))},o)),o.j=c}function A_(o,c){let h=new zr;if(u.Image){let m=new Image;m.onload=S(xe,h,"TestLoadImage: loaded",!0,c,m),m.onerror=S(xe,h,"TestLoadImage: error",!1,c,m),m.onabort=S(xe,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=S(xe,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function b_(o,c){let h=new zr,m=new AbortController,E=setTimeout(()=>{m.abort(),xe(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?xe(h,"TestPingServer: ok",!0,c):xe(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),xe(h,"TestPingServer: error",!1,c)})}function xe(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function S_(){this.g=new u_}function R_(o,c,h){let m=h||"";try{Oh(o,function(E,P){let k=E;d(E)&&(k=pa(E)),c.push(m+P+"="+encodeURIComponent(k))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function Wr(o){this.l=o.Ub||null,this.j=o.eb||!1}C(Wr,_a),Wr.prototype.g=function(){return new cs(this.l,this.j)},Wr.prototype.i=(function(o){return function(){return o}})({});function cs(o,c){Rt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(cs,Rt),r=cs.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Xr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function zh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Hr(this):Xr(this),this.readyState==3&&zh(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Hr(this))},r.Qa=function(o){this.g&&(this.response=o,Hr(this))},r.ga=function(){this.g&&Hr(this)};function Hr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Xr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Xr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(cs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Gh(o){let c="";return G(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function Ra(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=Gh(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):it(o,c,h))}function ut(o){Rt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(ut,Rt);var P_=/^https?$/i,V_=["POST","PUT"];r=ut.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():va.g(),this.v=this.o?wh(this.o):wh(va),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(P){Kh(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(V_,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,k]of h)this.g.setRequestHeader(P,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wh(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Kh(this,P)}};function Kh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,$h(o),ls(o)}function $h(o){o.A||(o.A=!0,Nt(o,"complete"),Nt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Nt(this,"complete"),Nt(this,"abort"),ls(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ls(this,!0)),ut.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Qh(this):this.bb())},r.bb=function(){Qh(this)};function Qh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ge(o)!=4||o.Z()!=2)){if(o.u&&ge(o)==4)gh(o.Ea,0,o);else if(Nt(o,"readystatechange"),ge(o)==4){o.h=!1;try{let k=o.Z();t:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=k===0){var E=String(o.D).match(Mh)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!P_.test(E?E.toLowerCase():"")}h=m}if(h)Nt(o,"complete"),Nt(o,"success");else{o.m=6;try{var P=2<ge(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",$h(o)}}finally{ls(o)}}}}function ls(o,c){if(o.g){Wh(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Nt(o,"ready");try{h.onreadystatechange=m}catch{}}}function Wh(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ge(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ge(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),a_(c)}};function Hh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function C_(o){let c={};o=(o.g&&2<=ge(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(B(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=c[E]||[];c[E]=P,P.push(h)}v(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Jr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Xh(o){this.Aa=0,this.i=[],this.j=new zr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Jr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Jr("baseRetryDelayMs",5e3,o),this.cb=Jr("retryDelaySeedMs",1e4,o),this.Wa=Jr("forwardChannelMaxRetries",2,o),this.wa=Jr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new xh(o&&o.concurrentRequestLimit),this.Da=new S_,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Xh.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){kt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=sd(this,null,this.W),ds(this)};function Pa(o){if(Jh(o),o.G==3){var c=o.U++,h=me(o.I);if(it(h,"SID",o.K),it(h,"RID",c),it(h,"TYPE","terminate"),Yr(o,h),c=new Ve(o,o.j,c),c.L=2,c.v=us(me(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=od(c.j,null),c.g.ea(c.v)),c.F=Date.now(),ss(c)}id(o)}function hs(o){o.g&&(Ca(o),o.g.cancel(),o.g=null)}function Jh(o){hs(o),o.u&&(u.clearTimeout(o.u),o.u=null),fs(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function ds(o){if(!Dh(o.h)&&!o.s){o.s=!0;var c=o.Ga;Fr||ch(),Or||(Fr(),Or=!0),aa.add(c,o),o.B=0}}function x_(o,c){return Nh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=jr(_(o.Ga,o,c),rd(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new Ve(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=Zh(this,E,c),h=me(this.I),it(h,"RID",o),it(h,"CVER",22),this.D&&it(h,"X-HTTP-Session-Id",this.D),Yr(this,h),P&&(this.O?c="headers="+encodeURIComponent(String(Gh(P)))+"&"+c:this.m&&Ra(h,this.m,P)),Sa(this.h,E),this.Ua&&it(h,"TYPE","init"),this.P?(it(h,"$req",c),it(h,"SID","null"),E.T=!0,Ta(E,h,null)):Ta(E,h,c),this.G=2}}else this.G==3&&(o?Yh(this,o):this.i.length==0||Dh(this.h)||Yh(this))};function Yh(o,c){var h;c?h=c.l:h=o.U++;let m=me(o.I);it(m,"SID",o.K),it(m,"RID",h),it(m,"AID",o.T),Yr(o,m),o.m&&o.o&&Ra(m,o.m,o.o),h=new Ve(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Zh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Sa(o.h,h),Ta(h,m,c)}function Yr(o,c){o.H&&G(o.H,function(h,m){it(c,m,h)}),o.l&&Oh({},function(h,m){it(c,m,h)})}function Zh(o,c,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let k=["count="+h];P==-1?0<h?(P=E[0].g,k.push("ofs="+P)):P=0:k.push("ofs="+P);let nt=!0;for(let Et=0;Et<h;Et++){let Y=E[Et].g,Pt=E[Et].map;if(Y-=P,0>Y)P=Math.max(0,E[Et].g-100),nt=!1;else try{R_(Pt,k,"req"+Y+"_")}catch{m&&m(Pt)}}if(nt){m=k.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function td(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Fr||ch(),Or||(Fr(),Or=!0),aa.add(c,o),o.v=0}}function Va(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=jr(_(o.Fa,o),rd(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,ed(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=jr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,kt(10),hs(this),ed(this))};function Ca(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function ed(o){o.g=new Ve(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=me(o.qa);it(c,"RID","rpc"),it(c,"SID",o.K),it(c,"AID",o.T),it(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&it(c,"TO",o.ja),it(c,"TYPE","xmlhttp"),Yr(o,c),o.m&&o.o&&Ra(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=us(me(c)),h.m=null,h.P=!0,Ph(h,o)}r.Za=function(){this.C!=null&&(this.C=null,hs(this),Va(this),kt(19))};function fs(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function nd(o,c){var h=null;if(o.g==c){fs(o),Ca(o),o.g=null;var m=2}else if(ba(o.h,c))h=c.D,kh(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=ns(),Nt(m,new Ah(m,h)),ds(o)}else td(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&x_(o,c)||m==2&&Va(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:an(o,5);break;case 4:an(o,10);break;case 3:an(o,6);break;default:an(o,2)}}}function rd(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function an(o,c){if(o.j.info("Error code "+c),c==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new on(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||os(m,"https"),us(m),E?A_(m.toString(),h):b_(m.toString(),h)}else kt(2);o.G=0,o.l&&o.l.sa(c),id(o),Jh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),kt(2)):(this.j.info("Failed to ping google.com"),kt(1))};function id(o){if(o.G=0,o.ka=[],o.l){let c=Fh(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function sd(o,c,h){var m=h instanceof on?me(h):new on(h);if(m.g!="")c&&(m.g=c+"."+m.g),as(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var P=new on(null);m&&os(P,m),c&&(P.g=c),E&&as(P,E),h&&(P.l=h),m=P}return h=o.D,c=o.ya,h&&c&&it(m,h,c),it(m,"VER",o.la),Yr(o,m),m}function od(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ut(new Wr({eb:h})):new ut(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ad(){}r=ad.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function ms(){}ms.prototype.g=function(o,c){return new jt(o,c)};function jt(o,c){Rt.call(this),this.g=new Xh(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!B(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!B(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Mn(this)}C(jt,Rt),jt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jt.prototype.close=function(){Pa(this.g)},jt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=pa(o),o=h);c.i.push(new m_(c.Ya++,o)),c.G==3&&ds(c)},jt.prototype.N=function(){this.g.l=null,delete this.j,Pa(this.g),delete this.g,jt.aa.N.call(this)};function ud(o){ya.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}C(ud,ya);function cd(){wa.call(this),this.status=1}C(cd,wa);function Mn(o){this.g=o}C(Mn,ad),Mn.prototype.ua=function(){Nt(this.g,"a")},Mn.prototype.ta=function(o){Nt(this.g,new ud(o))},Mn.prototype.sa=function(o){Nt(this.g,new cd)},Mn.prototype.ra=function(){Nt(this.g,"b")},ms.prototype.createWebChannel=ms.prototype.g,jt.prototype.send=jt.prototype.o,jt.prototype.open=jt.prototype.m,jt.prototype.close=jt.prototype.close,Ka=_e.createWebChannelTransport=function(){return new ms},Ga=_e.getStatEventTarget=function(){return ns()},za=_e.Event=rn,bs=_e.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},rs.NO_ERROR=0,rs.TIMEOUT=8,rs.HTTP_ERROR=6,ri=_e.ErrorCode=rs,bh.COMPLETE="complete",ja=_e.EventType=bh,vh.EventType=Ur,Ur.OPEN="a",Ur.CLOSE="b",Ur.ERROR="c",Ur.MESSAGE="d",Rt.prototype.listen=Rt.prototype.K,qn=_e.WebChannel=vh,D_=_e.FetchXmlHttpFactory=Wr,ut.prototype.listenOnce=ut.prototype.L,ut.prototype.getLastError=ut.prototype.Ka,ut.prototype.getLastErrorCode=ut.prototype.Ba,ut.prototype.getStatus=ut.prototype.Z,ut.prototype.getResponseJson=ut.prototype.Oa,ut.prototype.getResponseText=ut.prototype.oa,ut.prototype.send=ut.prototype.ea,ut.prototype.setWithCredentials=ut.prototype.Ha,Ba=_e.XhrIo=ut}).apply(typeof As<"u"?As:typeof self<"u"?self:typeof window<"u"?window:{});var jd="@firebase/firestore",zd="4.8.0";var _t=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};_t.UNAUTHENTICATED=new _t(null),_t.GOOGLE_CREDENTIALS=new _t("google-credentials-uid"),_t.FIRST_PARTY=new _t("first-party-uid"),_t.MOCK_USER=new _t("mock-user");var Ar="11.10.0";var Be=new Td("@firebase/firestore");function $n(){return Be.logLevel}function sm(r){Be.setLogLevel(r)}function x(r,...t){if(Be.logLevel<=ne.DEBUG){let e=t.map(sl);Be.debug(`Firestore (${Ar}): ${r}`,...e)}}function ht(r,...t){if(Be.logLevel<=ne.ERROR){let e=t.map(sl);Be.error(`Firestore (${Ar}): ${r}`,...e)}}function Bt(r,...t){if(Be.logLevel<=ne.WARN){let e=t.map(sl);Be.warn(`Firestore (${Ar}): ${r}`,...e)}}function sl(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function M(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,om(r,n,e)}function om(r,t,e){let n=`FIRESTORE (${Ar}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ht(n),new Error(n)}function L(r,t,e,n){let i="Unexpected state";typeof e=="string"?i=e:n=e,r||om(t,i,n)}function am(r,t){r||M(57014,t)}function O(r,t){return r}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Id{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var vt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var qs=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Za=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(_t.UNAUTHENTICATED))}shutdown(){}},tu=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},eu=class{constructor(t){this.t=t,this.currentUser=_t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){L(this.o===void 0,42304);let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new vt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new vt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},u=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new vt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(L(typeof n.accessToken=="string",31837,{l:n}),new qs(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return L(t===null||typeof t=="string",2055,{h:t}),new _t(t)}},nu=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_t.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},ru=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new nu(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(_t.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Us=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},iu=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ad(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){L(this.o===void 0,3512);let n=s=>{s.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Us(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(L(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Us(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function N_(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function ol(){return new TextEncoder}var yi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=N_(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%62))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function su(r,t){let e=0;for(;e<r.length&&e<t.length;){let n=r.codePointAt(e),i=t.codePointAt(e);if(n!==i){if(n<128&&i<128)return z(n,i);{let s=ol(),a=k_(s.encode(Gd(r,e)),s.encode(Gd(t,e)));return a!==0?a:z(n,i)}}e+=n>65535?2:1}return z(r.length,t.length)}function Gd(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function k_(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return z(r[e],t[e]);return z(r.length,t.length)}function er(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function um(r){return r+"\0"}var Kd="__name__",Bs=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&M(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&M(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=r.compareSegments(t.get(i),e.get(i));if(s!==0)return s}return z(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),i=r.isNumericId(e);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(t).compare(r.extractNumericId(e)):su(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return pe.fromString(t.substring(4,t.length-2))}},H=class r extends Bs{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new V(R.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},F_=/^[_a-zA-Z][_a-zA-Z0-9]*$/,dt=class r extends Bs{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return F_.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kd}static keyField(){return new r([Kd])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new V(R.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new V(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new V(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new V(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var F=class r{constructor(t){this.path=t}static fromPath(t){return new r(H.fromString(t))}static fromName(t){return new r(H.fromString(t).popFirst(5))}static empty(){return new r(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&H.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return H.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new H(t.slice()))}};function al(r,t,e){if(!e)throw new V(R.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function ul(r,t,e,n){if(t===!0&&n===!0)throw new V(R.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function $d(r){if(!F.isDocumentKey(r))throw new V(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Qd(r){if(F.isDocumentKey(r))throw new V(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function cm(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Bo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":M(12329,{type:typeof r})}function J(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new V(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Bo(r);throw new V(R.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function lm(r,t){if(t<=0)throw new V(R.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function yt(r,t){let e={typeString:r};return t&&(e.value=t),e}function zi(r,t){if(!cm(r))throw new V(R.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(i&&typeof a!==i){e=`JSON field '${n}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){e=`Expected '${n}' field to equal '${s.value}'`;break}}if(e)throw new V(R.INVALID_ARGUMENT,e);return!0}var Wd=-62135596800,Hd=1e6,rt=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Hd);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Wd)throw new V(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hd}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(zi(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-Wd;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};rt._jsonSchemaVersion="firestore/timestamp/1.0",rt._jsonSchema={type:yt("string",rt._jsonSchemaVersion),seconds:yt("number"),nanoseconds:yt("number")};var U=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new rt(0,0))}static max(){return new r(new rt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var nr=-1,rr=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function ou(r){return r.fields.find(t=>t.kind===2)}function cn(r){return r.fields.filter(t=>t.kind!==2)}rr.UNKNOWN_ID=-1;var Yn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var wi=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Wt.min())}};function hm(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new rt(e+1,0):new rt(e,n));return new Wt(i,F.empty(),t)}function dm(r){return new Wt(r.readTime,r.key,nr)}var Wt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),F.empty(),nr)}static max(){return new r(U.max(),F.empty(),nr)}};function cl(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var fm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",js=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};async function Ye(r){if(r.code!==R.FAILED_PRECONDITION||r.message!==fm)throw r;x("LocalStore","Unexpectedly lost primary lease")}var b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var zt="SimpleDb",zs=class r{static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new _n(e,s)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new vt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new _n(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=ll(n.target.error);this.S.reject(new _n(t,i))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(x(zt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new uu(e)}},je=class r{static delete(t){return x(zt,"Removing database:",t),hn(pd().indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!vd())return!1;if(r.F())return!0;let t=ni(),e=r.M(t),n=0<e&&e<10,i=mm(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.O)==="YES"}static N(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.B=n,this.L=null,r.M(ni())===12.2&&ht("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(t){return this.db||(x(zt,"Opening database:",this.name),this.db=await new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new _n(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new V(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new V(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new _n(t,a))},i.onupgradeneeded=s=>{x(zt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${a.version}`);this.B.q(a,i.transaction,s.oldVersion,this.version).next(()=>{x(zt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let n=e.target;this.L=n.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var n;e.newVersion===null&&(Bt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(n=this.databaseDeletedListener)===null||n===void 0||n.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(t){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=t}async runTransaction(t,e,n,i){let s=e==="readonly",a=0;for(;;){++a;try{this.db=await this.k(t);let u=zs.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.v(),d)).catch(d=>(u.abort(d),b.reject(d))).toPromise();return l.catch(()=>{}),await u.D,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(x(zt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}};function mm(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var au=class{constructor(t){this.$=t,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(t){this.$=t}done(){this.U=!0}G(t){this.K=t}delete(){return hn(this.$.delete())}},_n=class extends V{constructor(t,e){super(R.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Ze(r){return r.name==="IndexedDbTransactionError"}var uu=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(x(zt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(x(zt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),hn(n)}add(t){return x(zt,"ADD",this.store.name,t,t),hn(this.store.add(t))}get(t){return hn(this.store.get(t)).next(e=>(e===void 0&&(e=null),x(zt,"GET",this.store.name,t,e),e))}delete(t){return x(zt,"DELETE",this.store.name,t),hn(this.store.delete(t))}count(){return x(zt,"COUNT",this.store.name),hn(this.store.count())}j(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new b((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.J(s,(u,l)=>{a.push(l)}).next(()=>a)}}H(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}Y(t,e){x(zt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.Z=!1;let i=this.cursor(n);return this.J(i,(s,a,u)=>u.delete())}X(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.J(i,e)}ee(t){let e=this.cursor({});return new b((n,i)=>{e.onerror=s=>{let a=ll(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(t,e){let n=[];return new b((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new au(u),d=e(u.primaryKey,u.value,l);if(d instanceof b){let f=d.catch(g=>(l.done(),b.reject(g)));n.push(f)}l.isDone?i():l.W===null?u.continue():u.continue(l.W)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function hn(r){return new b((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=ll(n.target.error);e(i)}})}var Xd=!1;function ll(r){let t=je.M(ni());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Xd||(Xd=!0,setTimeout(()=>{throw n},0)),n}}return r}var li="IndexBackfiller",cu=class{constructor(t,e){this.asyncQueue=t,this.te=e,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(t){x(li,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,async()=>{this.task=null;try{let e=await this.te.re();x(li,`Documents written: ${e}`)}catch(e){Ze(e)?x(li,"Ignoring IndexedDB error during index backfill: ",e):await Ye(e)}await this.ne(6e4)})}},lu=class{constructor(t,e){this.localStore=t,this.persistence=e}async re(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ie(e,t))}ie(t,e){let n=new Set,i=e,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return x(li,`Processing collection: ${a}`),this.se(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}se(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.oe(i,s)).next(u=>(x(li,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}oe(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=dm(s);cl(a,n)>0&&(n=a)}),new Wt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Gt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this._e(i),this.ae=i=>n.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}r.ue=-1;return r})(),Le=-1;function Gi(r){return r==null}function vi(r){return r===0&&1/r==-1/0}function gm(r){return typeof r=="number"&&Number.isInteger(r)&&!vi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var Gs="";function Dt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Jd(t)),t=O_(r.get(e),t);return Jd(t)}function O_(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case Gs:e+="";break;default:e+=s}}return e}function Jd(r){return r+Gs+""}function ie(r){let t=r.length;if(L(t>=2,64408,{path:r}),t===2)return L(r.charAt(0)===Gs&&r.charAt(1)==="",56145,{path:r}),H.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf(Gs,s);switch((a<0||a>e)&&M(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:M(61167,{path:r})}s=a+2}return new H(n)}var ln="remoteDocuments",Ki="owner",Un="owner",Ii="mutationQueues",M_="userId",Jt="mutations",Yd="batchId",gn="userMutationsIndex",Zd=["userId","batchId"];function xs(r,t){return[r,Dt(t)]}function pm(r,t,e){return[r,Dt(t),e]}var L_={},ir="documentMutations",Ks="remoteDocumentsV14",q_=["prefixPath","collectionGroup","readTime","documentId"],Ds="documentKeyIndex",U_=["prefixPath","collectionGroup","documentId"],_m="collectionGroupIndex",B_=["collectionGroup","readTime","prefixPath","documentId"],Ti="remoteDocumentGlobal",hu="remoteDocumentGlobalKey",sr="targets",ym="queryTargetsIndex",j_=["canonicalId","targetId"],or="targetDocuments",z_=["targetId","path"],hl="documentTargetsIndex",G_=["path","targetId"],$s="targetGlobalKey",yn="targetGlobal",Ei="collectionParents",K_=["collectionId","parent"],ar="clientMetadata",$_="clientId",jo="bundles",Q_="bundleId",zo="namedQueries",W_="name",dl="indexConfiguration",H_="indexId",du="collectionGroupIndex",X_="collectionGroup",hi="indexState",J_=["indexId","uid"],wm="sequenceNumberIndex",Y_=["uid","sequenceNumber"],di="indexEntries",Z_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vm="documentKeyIndex",ty=["indexId","uid","orderedDocumentKey"],Go="documentOverlays",ey=["userId","collectionPath","documentId"],fu="collectionPathOverlayIndex",ny=["userId","collectionPath","largestBatchId"],Im="collectionGroupOverlayIndex",ry=["userId","collectionGroup","largestBatchId"],fl="globals",iy="name",Tm=[Ii,Jt,ir,ln,sr,Ki,yn,or,ar,Ti,Ei,jo,zo],sy=[...Tm,Go],Em=[Ii,Jt,ir,Ks,sr,Ki,yn,or,ar,Ti,Ei,jo,zo,Go],Am=Em,ml=[...Am,dl,hi,di],oy=ml,bm=[...ml,fl],ay=bm;var Ai=class extends js{constructor(t,e){super(),this.ce=t,this.currentSequenceNumber=e}};function It(r,t){let e=O(r);return je.N(e.ce,t)}function tf(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function tn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Sm(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var st=class r{constructor(t,e){this.comparator=t,this.root=e||oe.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,oe.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,oe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Jn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Jn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Jn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Jn(this.root,t,this.comparator,!0)}},Jn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},oe=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw M(27949);return t+(this.isRed()?0:1)}};oe.EMPTY=null,oe.RED=!0,oe.BLACK=!1;oe.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(t,e,n,i,s){return this}insert(t,e,n){return new oe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var et=class r{constructor(t){this.comparator=t,this.data=new st(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Qs(this.data.getIterator())}getIteratorFrom(t){return new Qs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Qs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Bn(r){return r.hasNext()?r.getNext():void 0}var Kt=class r{constructor(t){this.fields=t,t.sort(dt.comparator)}static empty(){return new r([])}unionWith(t){let e=new et(dt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return er(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Ws=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Rm(){return typeof atob<"u"}var mt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ws("Invalid base64 string: "+s):s}})(t);return new r(e)}static fromUint8Array(t){let e=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");var uy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ve(r){if(L(!!r,39018),typeof r=="string"){let t=0,e=uy.exec(r);if(L(!!e,46558,{timestamp:r}),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ot(r.seconds),nanos:ot(r.nanos)}}function ot(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Ie(r){return typeof r=="string"?mt.fromBase64String(r):mt.fromUint8Array(r)}var Pm="server_timestamp",Vm="__type__",Cm="__previous_value__",xm="__local_write_time__";function Ko(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Vm])===null||e===void 0?void 0:e.stringValue)===Pm}function $o(r){let t=r.mapValue.fields[Cm];return Ko(t)?$o(t):t}function bi(r){let t=ve(r.mapValue.fields[xm].timestampValue);return new rt(t.seconds,t.nanos)}var mu=class{constructor(t,e,n,i,s,a,u,l,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=f}},gu="(default)",ze=class r{constructor(t,e){this.projectId=t,this.database=e||gu}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===gu}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var gl="__type__",Dm="__max__",Oe={mapValue:{fields:{__type__:{stringValue:Dm}}}},pl="__vector__",ur="value",Ns={nullValue:"NULL_VALUE"};function Ge(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ko(r)?4:Nm(r)?9007199254740991:Qo(r)?10:11:M(28295,{value:r})}function le(r,t){if(r===t)return!0;let e=Ge(r);if(e!==Ge(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return bi(r).isEqual(bi(t));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=ve(i.timestampValue),u=ve(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(i,s){return Ie(i.bytesValue).isEqual(Ie(s.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(i,s){return ot(i.geoPointValue.latitude)===ot(s.geoPointValue.latitude)&&ot(i.geoPointValue.longitude)===ot(s.geoPointValue.longitude)})(r,t);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ot(i.integerValue)===ot(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ot(i.doubleValue),u=ot(s.doubleValue);return a===u?vi(a)===vi(u):isNaN(a)&&isNaN(u)}return!1})(r,t);case 9:return er(r.arrayValue.values||[],t.arrayValue.values||[],le);case 10:case 11:return(function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(tf(a)!==tf(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!le(a[l],u[l])))return!1;return!0})(r,t);default:return M(52216,{left:r})}}function Si(r,t){return(r.values||[]).find(e=>le(e,t))!==void 0}function Ke(r,t){if(r===t)return 0;let e=Ge(r),n=Ge(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return(function(s,a){let u=ot(s.integerValue||s.doubleValue),l=ot(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1})(r,t);case 3:return ef(r.timestampValue,t.timestampValue);case 4:return ef(bi(r),bi(t));case 5:return su(r.stringValue,t.stringValue);case 6:return(function(s,a){let u=Ie(s),l=Ie(a);return u.compareTo(l)})(r.bytesValue,t.bytesValue);case 7:return(function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=z(u[d],l[d]);if(f!==0)return f}return z(u.length,l.length)})(r.referenceValue,t.referenceValue);case 8:return(function(s,a){let u=z(ot(s.latitude),ot(a.latitude));return u!==0?u:z(ot(s.longitude),ot(a.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return nf(r.arrayValue,t.arrayValue);case 10:return(function(s,a){var u,l,d,f;let g=s.fields||{},_=a.fields||{},S=(u=g[ur])===null||u===void 0?void 0:u.arrayValue,C=(l=_[ur])===null||l===void 0?void 0:l.arrayValue,N=z(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((f=C?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:nf(S,C)})(r.mapValue,t.mapValue);case 11:return(function(s,a){if(s===Oe.mapValue&&a===Oe.mapValue)return 0;if(s===Oe.mapValue)return 1;if(a===Oe.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let _=su(l[g],f[g]);if(_!==0)return _;let S=Ke(u[l[g]],d[f[g]]);if(S!==0)return S}return z(l.length,f.length)})(r.mapValue,t.mapValue);default:throw M(23264,{le:e})}}function ef(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ve(r),n=ve(t),i=z(e.seconds,n.seconds);return i!==0?i:z(e.nanos,n.nanos)}function nf(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=Ke(e[i],n[i]);if(s)return s}return z(e.length,n.length)}function cr(r){return pu(r)}function pu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){let n=ve(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return Ie(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return F.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=pu(s);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${pu(e.fields[a])}`;return i+"}"})(r.mapValue):M(61005,{value:r})}function ks(r){switch(Ge(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=$o(r);return t?16+ks(t):16;case 5:return 2*r.stringValue.length;case 6:return Ie(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce((i,s)=>i+ks(s),0)})(r.arrayValue);case 10:case 11:return(function(n){let i=0;return tn(n.fields,(s,a)=>{i+=s.length+ks(a)}),i})(r.mapValue);default:throw M(13486,{value:r})}}function wn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function _u(r){return!!r&&"integerValue"in r}function Ri(r){return!!r&&"arrayValue"in r}function rf(r){return!!r&&"nullValue"in r}function sf(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Fs(r){return!!r&&"mapValue"in r}function Qo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[gl])===null||e===void 0?void 0:e.stringValue)===pl}function fi(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return tn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=fi(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=fi(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Nm(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Dm}var km={mapValue:{fields:{[gl]:{stringValue:pl},[ur]:{arrayValue:{}}}}};function cy(r){return"nullValue"in r?Ns:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?wn(ze.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Qo(r)?km:{mapValue:{}}:M(35942,{value:r})}function ly(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?wn(ze.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?km:"mapValue"in r?Qo(r)?{mapValue:{}}:Oe:M(61959,{value:r})}function of(r,t){let e=Ke(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function af(r,t){let e=Ke(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var xt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Fs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=fi(e)}setAll(t){let e=dt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=fi(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Fs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return le(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Fs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){tn(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(fi(this.value))}};function Fm(r){let t=[];return tn(r.fields,(e,n)=>{let i=new dt([e]);if(Fs(n)){let s=Fm(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Kt(t)}var wt=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),xt.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),xt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),xt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=xt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var he=class{constructor(t,e){this.position=t,this.inclusive=e}};function uf(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),e.key):n=Ke(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function cf(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!le(r.position[e],t.position[e]))return!1;return!0}var vn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function hy(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Hs=class{},Q=class r extends Hs{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new vu(t,e,n):e==="array-contains"?new Eu(t,n):e==="in"?new Xs(t,n):e==="not-in"?new Au(t,n):e==="array-contains-any"?new bu(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Iu(t,n):new Tu(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ke(e,this.value)):e!==null&&Ge(this.value)===Ge(e)&&this.matchesComparison(Ke(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Z=class r extends Hs{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new r(t,e)}matches(t){return lr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function lr(r){return r.op==="and"}function yu(r){return r.op==="or"}function _l(r){return Om(r)&&lr(r)}function Om(r){for(let t of r.filters)if(t instanceof Z)return!1;return!0}function wu(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+cr(r.value);if(_l(r))return r.filters.map(t=>wu(t)).join(",");{let t=r.filters.map(e=>wu(e)).join(",");return`${r.op}(${t})`}}function Mm(r,t){return r instanceof Q?(function(n,i){return i instanceof Q&&n.op===i.op&&n.field.isEqual(i.field)&&le(n.value,i.value)})(r,t):r instanceof Z?(function(n,i){return i instanceof Z&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Mm(a,i.filters[u]),!0):!1})(r,t):void M(19439)}function Lm(r,t){let e=r.filters.concat(t);return Z.create(e,r.op)}function qm(r){return r instanceof Q?(function(e){return`${e.field.canonicalString()} ${e.op} ${cr(e.value)}`})(r):r instanceof Z?(function(e){return e.op.toString()+" {"+e.getFilters().map(qm).join(" ,")+"}"})(r):"Filter"}var vu=class extends Q{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},Iu=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Um("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Tu=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Um("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Um(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>F.fromName(n.referenceValue))}var Eu=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Ri(e)&&Si(e.arrayValue,this.value)}},Xs=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Si(this.value.arrayValue,e)}},Au=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(Si(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Si(this.value.arrayValue,e)}},bu=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Ri(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Si(this.value.arrayValue,n))}};var Su=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Pe=null}};function Ru(r,t=null,e=[],n=[],i=null,s=null,a=null){return new Su(r,t,e,n,i,s,a)}function In(r){let t=O(r);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>wu(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>(function(s){return s.field.canonicalString()+s.dir})(n)).join(","),Gi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>cr(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>cr(n)).join(",")),t.Pe=e}return t.Pe}function $i(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!hy(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Mm(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!cf(r.startAt,t.startAt)&&cf(r.endAt,t.endAt)}function Js(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ys(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function lf(r,t,e){let n=Ns,i=!0;for(let s of Ys(r,t)){let a=Ns,u=!0;switch(s.op){case"<":case"<=":a=cy(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ns}of({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];of({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function hf(r,t,e){let n=Oe,i=!0;for(let s of Ys(r,t)){let a=Oe,u=!0;switch(s.op){case">=":case">":a=ly(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Oe}af({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];af({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var Yt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Bm(r,t,e,n,i,s,a,u){return new Yt(r,t,e,n,i,s,a,u)}function br(r){return new Yt(r)}function df(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function yl(r){return r.collectionGroup!==null}function Zn(r){let t=O(r);if(t.Te===null){t.Te=[];let e=new Set;for(let s of t.explicitOrderBy)t.Te.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new et(dt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Te.push(new vn(s,n))}),e.has(dt.keyField().canonicalString())||t.Te.push(new vn(dt.keyField(),n))}return t.Te}function Ft(r){let t=O(r);return t.Ie||(t.Ie=dy(t,Zn(r))),t.Ie}function dy(r,t){if(r.limitType==="F")return Ru(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new vn(i.field,s)});let e=r.endAt?new he(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new he(r.startAt.position,r.startAt.inclusive):null;return Ru(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Pu(r,t){let e=r.filters.concat([t]);return new Yt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Zs(r,t,e){return new Yt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Qi(r,t){return $i(Ft(r),Ft(t))&&r.limitType===t.limitType}function jm(r){return`${In(Ft(r))}|lt:${r.limitType}`}function Qn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>qm(i)).join(", ")}]`),Gi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>cr(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>cr(i)).join(",")),`Target(${n})`})(Ft(r))}; limitType=${r.limitType})`}function Wi(r,t){return t.isFoundDocument()&&(function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):F.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)})(r,t)&&(function(n,i){for(let s of Zn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(r,t)&&(function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0})(r,t)&&(function(n,i){return!(n.startAt&&!(function(a,u,l){let d=uf(a,u,l);return a.inclusive?d<=0:d<0})(n.startAt,Zn(n),i)||n.endAt&&!(function(a,u,l){let d=uf(a,u,l);return a.inclusive?d>=0:d>0})(n.endAt,Zn(n),i))})(r,t)}function zm(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Gm(r){return(t,e)=>{let n=!1;for(let i of Zn(r)){let s=fy(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function fy(r,t,e){let n=r.field.isKeyField()?F.comparator(t.key,e.key):(function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Ke(l,d):M(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return M(19790,{direction:r.dir})}}var Zt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){tn(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Sm(this.inner)}size(){return this.innerSize}};var my=new st(F.comparator);function qt(){return my}var Km=new st(F.comparator);function ui(...r){let t=Km;for(let e of r)t=t.insert(e.key,e);return t}function $m(r){let t=Km;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function se(){return mi()}function Qm(){return mi()}function mi(){return new Zt(r=>r.toString(),(r,t)=>r.isEqual(t))}var gy=new st(F.comparator),py=new et(F.comparator);function K(...r){let t=py;for(let e of r)t=t.add(e);return t}var _y=new et(z);function wl(){return _y}function vl(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(t)?"-0":t}}function Wm(r){return{integerValue:""+r}}function Hm(r,t){return gm(t)?Wm(t):vl(r,t)}var hr=class{constructor(){this._=void 0}};function yy(r,t,e){return r instanceof $e?(function(i,s){let a={fields:{[Vm]:{stringValue:Pm},[xm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ko(s)&&(s=$o(s)),s&&(a.fields[Cm]=s),{mapValue:a}})(e,t):r instanceof Te?Jm(r,t):r instanceof Ee?Ym(r,t):(function(i,s){let a=Xm(i,s),u=ff(a)+ff(i.Ee);return _u(a)&&_u(i.Ee)?Wm(u):vl(i.serializer,u)})(r,t)}function wy(r,t,e){return r instanceof Te?Jm(r,t):r instanceof Ee?Ym(r,t):e}function Xm(r,t){return r instanceof Qe?(function(n){return _u(n)||(function(s){return!!s&&"doubleValue"in s})(n)})(t)?t:{integerValue:0}:null}var $e=class extends hr{},Te=class extends hr{constructor(t){super(),this.elements=t}};function Jm(r,t){let e=Zm(t);for(let n of r.elements)e.some(i=>le(i,n))||e.push(n);return{arrayValue:{values:e}}}var Ee=class extends hr{constructor(t){super(),this.elements=t}};function Ym(r,t){let e=Zm(t);for(let n of r.elements)e=e.filter(i=>!le(i,n));return{arrayValue:{values:e}}}var Qe=class extends hr{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function ff(r){return ot(r.integerValue||r.doubleValue)}function Zm(r){return Ri(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Tn=class{constructor(t,e){this.field=t,this.transform=e}};function vy(r,t){return r.field.isEqual(t.field)&&(function(n,i){return n instanceof Te&&i instanceof Te||n instanceof Ee&&i instanceof Ee?er(n.elements,i.elements,le):n instanceof Qe&&i instanceof Qe?le(n.Ee,i.Ee):n instanceof $e&&i instanceof $e})(r.transform,t.transform)}var Vu=class{constructor(t,e){this.version=t,this.transformResults=e}},lt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Os(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var dr=class{};function tg(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new He(r.key,lt.none()):new We(r.key,r.data,lt.none());{let e=r.data,n=xt.empty(),i=new et(dt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new te(r.key,n,new Kt(i.toArray()),lt.none())}}function Iy(r,t,e){r instanceof We?(function(i,s,a){let u=i.value.clone(),l=gf(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(r,t,e):r instanceof te?(function(i,s,a){if(!Os(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=gf(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(eg(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(r,t,e):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function gi(r,t,e,n){return r instanceof We?(function(s,a,u,l){if(!Os(s.precondition,a))return u;let d=s.value.clone(),f=pf(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(r,t,e,n):r instanceof te?(function(s,a,u,l){if(!Os(s.precondition,a))return u;let d=pf(s.fieldTransforms,l,a),f=a.data;return f.setAll(eg(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))})(r,t,e,n):(function(s,a,u){return Os(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(r,t,e)}function Ty(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=Xm(n.transform,i||null);s!=null&&(e===null&&(e=xt.empty()),e.set(n.field,s))}return e||null}function mf(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&er(n,i,(s,a)=>vy(s,a))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var We=class extends dr{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},te=class extends dr{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function eg(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function gf(r,t,e){let n=new Map;L(r.length===e.length,32656,{Ae:e.length,Re:r.length});for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,wy(a,u,e[i]))}return n}function pf(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,yy(s,a,t))}return n}var He=class extends dr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Pi=class extends dr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Vi=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Iy(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=gi(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=gi(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Qm();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=tg(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&er(this.mutations,t.mutations,(e,n)=>mf(e,n))&&er(this.baseMutations,t.baseMutations,(e,n)=>mf(e,n))}},Cu=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){L(t.mutations.length===n.length,58842,{Ve:t.mutations.length,me:n.length});let i=(function(){return gy})(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var Ci=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var xu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var gt,X;function ng(r){switch(r){case R.OK:return M(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return M(15467,{code:r})}}function rg(r){if(r===void 0)return ht("GRPC error has no .code"),R.UNKNOWN;switch(r){case gt.OK:return R.OK;case gt.CANCELLED:return R.CANCELLED;case gt.UNKNOWN:return R.UNKNOWN;case gt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case gt.INTERNAL:return R.INTERNAL;case gt.UNAVAILABLE:return R.UNAVAILABLE;case gt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case gt.NOT_FOUND:return R.NOT_FOUND;case gt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case gt.ABORTED:return R.ABORTED;case gt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case gt.DATA_LOSS:return R.DATA_LOSS;default:return M(39323,{code:r})}}(X=gt||(gt={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var _f=null;var Ey=new pe([4294967295,4294967295],0);function yf(r){let t=ol().encode(r),e=new Ua;return e.update(t),new Uint8Array(e.digest())}function wf(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new pe([e,n],0),new pe([i,s],0)]}var Du=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new pn(`Invalid padding: ${e}`);if(n<0)throw new pn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new pn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new pn(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=pe.fromNumber(this.fe)}pe(t,e,n){let i=t.add(e.multiply(pe.fromNumber(n)));return i.compare(Ey)===1&&(i=new pe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=yf(t),[n,i]=wf(e);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);if(!this.ye(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.fe===0)return;let e=yf(t),[n,i]=wf(e);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);this.we(a)}}we(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},pn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var xi=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,Di.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new st(z),qt(),K())}},Di=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var tr=class{constructor(t,e,n,i){this.Se=t,this.removedTargetIds=e,this.key=n,this.be=i}},to=class{constructor(t,e){this.targetId=t,this.De=e}},eo=class{constructor(t,e,n=mt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},no=class{constructor(){this.ve=0,this.Ce=vf(),this.Fe=mt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=K(),e=K(),n=K();return this.Ce.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:M(38017,{changeType:s})}}),new Di(this.Fe,this.Me,t,e,n)}ke(){this.xe=!1,this.Ce=vf()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Nu=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=qt(),this.je=Ss(),this.Je=Ss(),this.He=new st(z)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let n=this.tt(e);switch(t.state){case 0:this.nt(e)&&n.Be(t.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(t.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(n.Ke(),n.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),n.Be(t.resumeToken));break;default:M(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((n,i)=>{this.nt(i)&&e(i)})}it(t){let e=t.targetId,n=t.De.count,i=this.st(e);if(i){let s=i.target;if(Js(s))if(n===0){let a=new F(s.path);this.Xe(e,a,wt.newNoDocument(a,U.min()))}else L(n===1,20013,{expectedCount:n});else{let a=this.ot(e);if(a!==n){let u=this._t(t),l=u?this.ut(u,t,a):1;if(l!==0){this.rt(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,d)}_f?.ct((function(f,g,_,S,C){var N,D,j,B,q,$;let W={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},G=g.unchangedNames;return G&&(W.bloomFilter={applied:C===0,hashCount:(N=G?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(B=(j=(D=G?.bits)===null||D===void 0?void 0:D.bitmap)===null||j===void 0?void 0:j.length)!==null&&B!==void 0?B:0,padding:($=(q=G?.bits)===null||q===void 0?void 0:q.padding)!==null&&$!==void 0?$:0,mightContain:v=>{var p;return(p=S?.mightContain(v))!==null&&p!==void 0&&p}}),W})(a,t.De,this.We.lt(),u,l))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=Ie(n).toUint8Array()}catch(l){if(l instanceof Ws)return Bt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Du(a,i,s)}catch(l){return Bt(l instanceof pn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.fe===0?null:u}ut(t,e,n){return e.De.count===n-this.ht(t,e.targetId)?0:2}ht(t,e){let n=this.We.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Xe(e,s,null),i++)}),i}Pt(t){let e=new Map;this.Ge.forEach((s,a)=>{let u=this.st(a);if(u){if(s.current&&Js(u.target)){let l=new F(u.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,wt.newNoDocument(l,t))}s.Ne&&(e.set(a,s.Le()),s.ke())}});let n=K();this.Je.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(t));let i=new xi(t,e,this.He,this.ze,n);return this.ze=qt(),this.je=Ss(),this.Je=Ss(),this.He=new st(z),i}Ze(t,e){if(!this.nt(t))return;let n=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,n),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,n){if(!this.nt(t))return;let i=this.tt(t);this.It(t,e)?i.qe(e,1):i.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),n&&(this.ze=this.ze.insert(e,n))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new no,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new et(z),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new et(z),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||x("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new no),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function Ss(){return new st(F.comparator)}function vf(){return new st(F.comparator)}var Ay={asc:"ASCENDING",desc:"DESCENDING"},by={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sy={and:"AND",or:"OR"},ku=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Fu(r,t){return r.useProto3Json||Gi(t)?t:{value:t}}function fr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ig(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Ry(r,t){return fr(r,t.toTimestamp())}function ft(r){return L(!!r,49232),U.fromTimestamp((function(e){let n=ve(e);return new rt(n.seconds,n.nanos)})(r))}function Il(r,t){return Ou(r,t).canonicalString()}function Ou(r,t){let e=(function(i){return new H(["projects",i.projectId,"databases",i.database])})(r).child("documents");return t===void 0?e:e.child(t)}function sg(r){let t=H.fromString(r);return L(gg(t),10190,{key:t.toString()}),t}function Ni(r,t){return Il(r.databaseId,t.path)}function ae(r,t){let e=sg(t);if(e.get(1)!==r.databaseId.projectId)throw new V(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new V(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(ug(e))}function og(r,t){return Il(r.databaseId,t)}function ag(r){let t=sg(r);return t.length===4?H.emptyPath():ug(t)}function Mu(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ug(r){return L(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function If(r,t,e){return{name:Ni(r,t),fields:e.value.mapValue.fields}}function cg(r,t,e){let n=ae(r,t.name),i=ft(t.updateTime),s=t.createTime?ft(t.createTime):U.min(),a=new xt({mapValue:{fields:t.fields}}),u=wt.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Py(r,t){return"found"in t?(function(n,i){L(!!i.found,43571),i.found.name,i.found.updateTime;let s=ae(n,i.found.name),a=ft(i.found.updateTime),u=i.found.createTime?ft(i.found.createTime):U.min(),l=new xt({mapValue:{fields:i.found.fields}});return wt.newFoundDocument(s,a,u,l)})(r,t):"missing"in t?(function(n,i){L(!!i.missing,3894),L(!!i.readTime,22933);let s=ae(n,i.missing),a=ft(i.readTime);return wt.newNoDocument(s,a)})(r,t):M(7234,{result:t})}function Vy(r,t){let e;if("targetChange"in t){t.targetChange;let n=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=(function(d,f){return d.useProto3Json?(L(f===void 0||typeof f=="string",58123),mt.fromBase64String(f||"")):(L(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),mt.fromUint8Array(f||new Uint8Array))})(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){let f=d.code===void 0?R.UNKNOWN:rg(d.code);return new V(f,d.message||"")})(a);e=new eo(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=ae(r,n.document.name),s=ft(n.document.updateTime),a=n.document.createTime?ft(n.document.createTime):U.min(),u=new xt({mapValue:{fields:n.document.fields}}),l=wt.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new tr(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=ae(r,n.document),s=n.readTime?ft(n.readTime):U.min(),a=wt.newNoDocument(i,s),u=n.removedTargetIds||[];e=new tr([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=ae(r,n.document),s=n.removedTargetIds||[];e=new tr([],s,i,null)}else{if(!("filter"in t))return M(11601,{At:t});{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new xu(i,s),u=n.targetId;e=new to(u,a)}}return e}function ki(r,t){let e;if(t instanceof We)e={update:If(r,t.key,t.value)};else if(t instanceof He)e={delete:Ni(r,t.key)};else if(t instanceof te)e={update:If(r,t.key,t.data),updateMask:Fy(t.fieldMask)};else{if(!(t instanceof Pi))return M(16599,{Rt:t.type});e={verify:Ni(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>(function(s,a){let u=a.transform;if(u instanceof $e)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Te)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ee)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Qe)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw M(20930,{transform:a.transform})})(0,n))),t.precondition.isNone||(e.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:Ry(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)})(r,t.precondition)),e}function Lu(r,t){let e=t.currentDocument?(function(s){return s.updateTime!==void 0?lt.updateTime(ft(s.updateTime)):s.exists!==void 0?lt.exists(s.exists):lt.none()})(t.currentDocument):lt.none(),n=t.updateTransforms?t.updateTransforms.map(i=>(function(a,u){let l=null;if("setToServerValue"in u)L(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),l=new $e;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new Te(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new Ee(f)}else"increment"in u?l=new Qe(a,u.increment):M(16584,{proto:u});let d=dt.fromServerFormat(u.fieldPath);return new Tn(d,l)})(r,i)):[];if(t.update){t.update.name;let i=ae(r,t.update.name),s=new xt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=(function(l){let d=l.fieldPaths||[];return new Kt(d.map(f=>dt.fromServerFormat(f)))})(t.updateMask);return new te(i,s,a,e,n)}return new We(i,s,e,n)}if(t.delete){let i=ae(r,t.delete);return new He(i,e)}if(t.verify){let i=ae(r,t.verify);return new Pi(i,e)}return M(1463,{proto:t})}function Cy(r,t){return r&&r.length>0?(L(t!==void 0,14353),r.map(e=>(function(i,s){let a=i.updateTime?ft(i.updateTime):ft(s);return a.isEqual(U.min())&&(a=ft(s)),new Vu(a,i.transformResults||[])})(e,t))):[]}function lg(r,t){return{documents:[og(r,t.path)]}}function hg(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=og(r,i);let s=(function(d){if(d.length!==0)return mg(Z.create(d,"and"))})(t.filters);s&&(e.structuredQuery.where=s);let a=(function(d){if(d.length!==0)return d.map(f=>(function(_){return{field:Wn(_.field),direction:Dy(_.dir)}})(f))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Fu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{Vt:e,parent:i}}function dg(r){let t=ag(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){L(n===1,65062);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=(function(g){let _=fg(g);return _ instanceof Z&&_l(_)?_.getFilters():[_]})(e.where));let a=[];e.orderBy&&(a=(function(g){return g.map(_=>(function(C){return new vn(Hn(C.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(_))})(e.orderBy));let u=null;e.limit&&(u=(function(g){let _;return _=typeof g=="object"?g.value:g,Gi(_)?null:_})(e.limit));let l=null;e.startAt&&(l=(function(g){let _=!!g.before,S=g.values||[];return new he(S,_)})(e.startAt));let d=null;return e.endAt&&(d=(function(g){let _=!g.before,S=g.values||[];return new he(S,_)})(e.endAt)),Bm(t,i,a,s,u,"F",l,d)}function xy(r,t){let e=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function fg(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Hn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Hn(e.unaryFilter.field);return Q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Hn(e.unaryFilter.field);return Q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Hn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(r):r.fieldFilter!==void 0?(function(e){return Q.create(Hn(e.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return Z.create(e.compositeFilter.filters.map(n=>fg(n)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(e.compositeFilter.op))})(r):M(30097,{filter:r})}function Dy(r){return Ay[r]}function Ny(r){return by[r]}function ky(r){return Sy[r]}function Wn(r){return{fieldPath:r.canonicalString()}}function Hn(r){return dt.fromServerFormat(r.fieldPath)}function mg(r){return r instanceof Q?(function(e){if(e.op==="=="){if(sf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NAN"}};if(rf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(sf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NAN"}};if(rf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wn(e.field),op:Ny(e.op),value:e.value}}})(r):r instanceof Z?(function(e){let n=e.getFilters().map(i=>mg(i));return n.length===1?n[0]:{compositeFilter:{op:ky(e.op),filters:n}}})(r):M(54877,{filter:r})}function Fy(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function gg(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var mr=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=mt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var ro=class{constructor(t){this.gt=t}};function Oy(r,t){let e;if(t.document)e=cg(r.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=F.fromSegments(t.noDocument.path),i=An(t.noDocument.readTime);e=wt.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return M(56709);{let n=F.fromSegments(t.unknownDocument.path),i=An(t.unknownDocument.version);e=wt.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime((function(i){let s=new rt(i[0],i[1]);return U.fromTimestamp(s)})(t.readTime)),e}function Tf(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:io(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(s,a){return{name:Ni(s,a.key),fields:a.data.value.mapValue.fields,updateTime:fr(s,a.version.toTimestamp()),createTime:fr(s,a.createTime.toTimestamp())}})(r.gt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:En(t.version)};else{if(!t.isUnknownDocument())return M(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:En(t.version)}}return n}function io(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function En(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function An(r){let t=new rt(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function dn(r,t){let e=(t.baseMutations||[]).map(s=>Lu(r.gt,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>Lu(r.gt,s)),i=rt.fromMillis(t.localWriteTimeMs);return new Vi(t.batchId,i,e,n)}function ci(r){let t=An(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?An(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=(function(s){return s.documents!==void 0})(r.query)?(function(s){let a=s.documents.length;return L(a===1,1966,{count:a}),Ft(br(ag(s.documents[0])))})(r.query):(function(s){return Ft(dg(s))})(r.query),new mr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,mt.fromBase64String(r.resumeToken))}function pg(r,t){let e=En(t.snapshotVersion),n=En(t.lastLimboFreeSnapshotVersion),i;i=Js(t.target)?lg(r.gt,t.target):hg(r.gt,t.target).Vt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:In(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Tl(r){let t=dg({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Zs(t,t.limit,"L"):t}function $a(r,t){return new Ci(t.largestBatchId,Lu(r.gt,t.overlayMutation))}function Ef(r,t){let e=t.path.lastSegment();return[r,Dt(t.path.popLast()),e]}function Af(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:En(n.readTime),documentKey:Dt(n.documentKey.path),largestBatchId:n.largestBatchId}}var qu=class{getBundleMetadata(t,e){return bf(t).get(e).next(n=>{if(n)return(function(s){return{id:s.bundleId,createTime:An(s.createTime),version:s.version}})(n)})}saveBundleMetadata(t,e){return bf(t).put((function(i){return{bundleId:i.id,createTime:En(ft(i.createTime)),version:i.version}})(e))}getNamedQuery(t,e){return Sf(t).get(e).next(n=>{if(n)return(function(s){return{name:s.name,query:Tl(s.bundledQuery),readTime:An(s.readTime)}})(n)})}saveNamedQuery(t,e){return Sf(t).put((function(i){return{name:i.name,readTime:En(ft(i.readTime)),bundledQuery:i.bundledQuery}})(e))}};function bf(r){return It(r,jo)}function Sf(r){return It(r,zo)}var so=class r{constructor(t,e){this.serializer=t,this.userId=e}static yt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return ii(t).get(Ef(this.userId,e)).next(n=>n?$a(this.serializer,n):null)}getOverlays(t,e){let n=se();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new Ci(e,a);i.push(this.wt(t,u))}),b.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(Dt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(ii(t).Y(fu,u))}),b.waitFor(s)}getOverlaysForCollection(t,e,n){let i=se(),s=Dt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ii(t).j(fu,a).next(u=>{for(let l of u){let d=$a(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=se(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ii(t).X({index:Im,range:u},(l,d,f)=>{let g=$a(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}wt(t,e){return ii(t).put((function(i,s,a){let[u,l,d]=Ef(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:ki(i.gt,a.mutation)}})(this.serializer,this.userId,e))}};function ii(r){return It(r,Go)}var Uu=class{St(t){return It(t,fl)}getSessionToken(t){return this.St(t).get("sessionToken").next(e=>{let n=e?.value;return n?mt.fromUint8Array(n):mt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}};var ye=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(ot(t.integerValue));else if("doubleValue"in t){let n=ot(t.doubleValue);isNaN(n)?this.Ct(e,13):(this.Ct(e,15),vi(n)?e.Ft(0):e.Ft(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ct(e,20),typeof n=="string"&&(n=ve(n)),e.Mt(`${n.seconds||""}`),e.Ft(n.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(Ie(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ct(e,45),e.Ft(n.latitude||0),e.Ft(n.longitude||0)}else"mapValue"in t?Nm(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):Qo(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):M(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let n=t.fields||{};this.Ct(e,55);for(let i of Object.keys(n))this.xt(i,e),this.Dt(n[i],e)}Lt(t,e){var n,i;let s=t.fields||{};this.Ct(e,53);let a=ur,u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Ct(e,15),e.Ft(ot(u)),this.xt(a,e),this.Dt(s[a],e)}qt(t,e){let n=t.values||[];this.Ct(e,50);for(let i of n)this.Dt(i,e)}Bt(t,e){this.Ct(e,37),F.fromName(t).path.forEach(n=>{this.Ct(e,60),this.$t(n,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};ye.Ut=new ye;var jn=255;function My(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Rf(r){let t=64-(function(n){let i=0;for(let s=0;s<8;++s){let a=My(255&n[s]);if(i+=a,a!==8)break}return i})(r);return Math.ceil(t/8)}var Bu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Wt(n.value),n=e.next();this.Gt()}zt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.jt(n.value),n=e.next();this.Jt()}Ht(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{let i=e.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{let i=e.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(t){let e=this.Xt(t),n=Rf(e);this.en(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}tn(t){let e=this.Xt(t),n=Rf(e);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}nn(){this.rn(jn),this.rn(255)}sn(){this._n(jn),this._n(255)}reset(){this.position=0}seed(t){this.en(t.length),this.buffer.set(t,this.position),this.position+=t.length}an(){return this.buffer.slice(0,this.position)}Xt(t){let e=(function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Wt(t){let e=255&t;e===0?(this.rn(0),this.rn(255)):e===jn?(this.rn(jn),this.rn(0)):this.rn(e)}jt(t){let e=255&t;e===0?(this._n(0),this._n(255)):e===jn?(this._n(jn),this._n(0)):this._n(t)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(t){this.en(1),this.buffer[this.position++]=t}_n(t){this.en(1),this.buffer[this.position++]=~t}en(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},ju=class{constructor(t){this.un=t}Nt(t){this.un.Kt(t)}Mt(t){this.un.Ht(t)}Ft(t){this.un.Zt(t)}vt(){this.un.nn()}},zu=class{constructor(t){this.un=t}Nt(t){this.un.zt(t)}Mt(t){this.un.Yt(t)}Ft(t){this.un.tn(t)}vt(){this.un.sn()}},fn=class{constructor(){this.un=new Bu,this.cn=new ju(this.un),this.ln=new zu(this.un)}seed(t){this.un.seed(t)}hn(t){return t===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var mn=class r{constructor(t,e,n,i){this.Pn=t,this.Tn=e,this.In=n,this.dn=i}En(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Pn,this.Tn,this.In,n)}An(t,e,n){return{indexId:this.Pn,uid:t,arrayValue:Ms(this.In),directionalValue:Ms(this.dn),orderedDocumentKey:Ms(e),documentKey:n.path.toArray()}}Rn(t,e,n){let i=this.An(t,e,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function De(r,t){let e=r.Pn-t.Pn;return e!==0?e:(e=Pf(r.In,t.In),e!==0?e:(e=Pf(r.dn,t.dn),e!==0?e:F.comparator(r.Tn,t.Tn)))}function Pf(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function Ms(r){return Ma()?(function(e){let n="";for(let i=0;i<e.length;i++)n+=String.fromCharCode(e[i]);return n})(r):r}function Vf(r){return typeof r!="string"?r:(function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n})(r)}var oo=class{constructor(t){this.Vn=new et((e,n)=>dt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.mn=t.orderBy,this.fn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(t){if(L(t.collectionGroup===this.collectionId,49279),this.gn)return!1;let e=ou(t);if(e!==void 0&&!this.yn(e))return!1;let n=cn(t),i=new Set,s=0,a=0;for(;s<n.length&&this.yn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.wn(u,l)||!this.Sn(this.mn[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.mn.length||!this.Sn(this.mn[a++],u))return!1}return!0}bn(){if(this.gn)return null;let t=new et(dt.comparator),e=[];for(let n of this.fn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Yn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Yn(n.field,0))}for(let n of this.mn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Yn(n.field,n.dir==="asc"?0:1)));return new rr(rr.UNKNOWN_ID,this.collectionId,e,wi.empty())}yn(t){for(let e of this.fn)if(this.wn(e,t))return!0;return!1}wn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}Sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function _g(r){var t,e;if(L(r instanceof Q||r instanceof Z,20012),r instanceof Q){if(r instanceof Xs){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>Q.create(r.field,"==",s)))||[];return Z.create(i,"or")}return r}let n=r.filters.map(i=>_g(i));return Z.create(n,r.op)}function Ly(r){if(r.getFilters().length===0)return[];let t=$u(_g(r));return L(yg(t),7391),Gu(t)||Ku(t)?[t]:t.getFilters()}function Gu(r){return r instanceof Q}function Ku(r){return r instanceof Z&&_l(r)}function yg(r){return Gu(r)||Ku(r)||(function(e){if(e instanceof Z&&yu(e)){for(let n of e.getFilters())if(!Gu(n)&&!Ku(n))return!1;return!0}return!1})(r)}function $u(r){if(L(r instanceof Q||r instanceof Z,34018),r instanceof Q)return r;if(r.filters.length===1)return $u(r.filters[0]);let t=r.filters.map(n=>$u(n)),e=Z.create(t,r.op);return e=ao(e),yg(e)?e:(L(e instanceof Z,64498),L(lr(e),40251),L(e.filters.length>1,57927),e.filters.reduce((n,i)=>El(n,i)))}function El(r,t){let e;return L(r instanceof Q||r instanceof Z,38388),L(t instanceof Q||t instanceof Z,25473),e=r instanceof Q?t instanceof Q?(function(i,s){return Z.create([i,s],"and")})(r,t):Cf(r,t):t instanceof Q?Cf(t,r):(function(i,s){if(L(i.filters.length>0&&s.filters.length>0,48005),lr(i)&&lr(s))return Lm(i,s.getFilters());let a=yu(i)?i:s,u=yu(i)?s:i,l=a.filters.map(d=>El(d,u));return Z.create(l,"or")})(r,t),ao(e)}function Cf(r,t){if(lr(t))return Lm(t,r.getFilters());{let e=t.filters.map(n=>El(r,n));return Z.create(e,"or")}}function ao(r){if(L(r instanceof Q||r instanceof Z,11850),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return ao(t[0]);if(Om(r))return r;let e=t.map(i=>ao(i)),n=[];return e.forEach(i=>{i instanceof Q?n.push(i):i instanceof Z&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:Z.create(n,r.op)}var Qu=class{constructor(){this.Dn=new Fi}addToCollectionParentIndex(t,e){return this.Dn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(Wt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(Wt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},Fi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new et(H.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new et(H.comparator)).toArray()}};var xf="IndexedDbIndexManager",Rs=new Uint8Array(0),Wu=class{constructor(t,e){this.databaseId=e,this.vn=new Fi,this.Cn=new Zt(n=>In(n),(n,i)=>$i(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let s={collectionId:n,parent:Dt(i)};return Df(t).put(s)}return b.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[um(e),""],!1,!0);return Df(t).j(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(ie(a.parent))}return n})}addFieldIndex(t,e){let n=si(t),i=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}})(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=Gn(t);return s.next(u=>{a.put(Af(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=si(t),i=Gn(t),s=zn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=si(t),n=zn(t),i=Gn(t);return e.Y().next(()=>n.Y()).next(()=>i.Y())}createTargetIndexes(t,e){return b.forEach(this.Fn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new oo(n).bn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=zn(t),i=!0,s=new Map;return b.forEach(this.Fn(e),a=>this.Mn(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=K(),u=[];return b.forEach(s,(l,d)=>{x(xf,`Using index ${(function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`})(l)} to execute ${In(e)}`);let f=(function(q,$){let W=ou($);if(W===void 0)return null;for(let G of Ys(q,W.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null})(d,l),g=(function(q,$){let W=new Map;for(let G of cn($))for(let v of Ys(q,G.fieldPath))switch(v.op){case"==":case"in":W.set(G.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return W.set(G.fieldPath.canonicalString(),v.value),Array.from(W.values())}return null})(d,l),_=(function(q,$){let W=[],G=!0;for(let v of cn($)){let p=v.kind===0?lf(q,v.fieldPath,q.startAt):hf(q,v.fieldPath,q.startAt);W.push(p.value),G&&(G=p.inclusive)}return new he(W,G)})(d,l),S=(function(q,$){let W=[],G=!0;for(let v of cn($)){let p=v.kind===0?hf(q,v.fieldPath,q.endAt):lf(q,v.fieldPath,q.endAt);W.push(p.value),G&&(G=p.inclusive)}return new he(W,G)})(d,l),C=this.xn(l,d,_),N=this.xn(l,d,S),D=this.On(l,d,g),j=this.Nn(l.indexId,f,C,_.inclusive,N,S.inclusive,D);return b.forEach(j,B=>n.H(B,e.limit).next(q=>{q.forEach($=>{let W=F.fromSegments($.documentKey);a.has(W)||(a=a.add(W),u.push(W))})}))}).next(()=>u)}return b.resolve(null)})}Fn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=Ly(Z.create(t.filters,"and")).map(n=>Ru(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Cn.set(t,e),e)}Nn(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let _=e?this.Bn(e[g/d]):Rs,S=this.Ln(t,_,n[g%d],i),C=this.kn(t,_,s[g%d],a),N=u.map(D=>this.Ln(t,_,D,!0));f.push(...this.createRange(S,C,N))}return f}Ln(t,e,n,i){let s=new mn(t,F.empty(),e,n);return i?s:s.En()}kn(t,e,n,i){let s=new mn(t,F.empty(),e,n);return i?s.En():s}Mn(t,e){let n=new oo(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.Fn(e);return b.forEach(i,s=>this.Mn(t,s).next(a=>{a?n!==0&&a.fields.length<(function(l){let d=new et(dt.comparator),f=!1;for(let g of l.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)})(s)&&(n=1):n=0})).next(()=>(function(a){return a.limit!==null})(e)&&i.length>1&&n===2?1:n)}qn(t,e){let n=new fn;for(let i of cn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.hn(i.kind);ye.Ut.bt(s,a)}return n.an()}Bn(t){let e=new fn;return ye.Ut.bt(t,e.hn(0)),e.an()}Qn(t,e){let n=new fn;return ye.Ut.bt(wn(this.databaseId,e),n.hn((function(s){let a=cn(s);return a.length===0?0:a[a.length-1].kind})(t))),n.an()}On(t,e,n){if(n===null)return[];let i=[];i.push(new fn);let s=0;for(let a of cn(t)){let u=n[s++];for(let l of i)if(this.$n(e,a.fieldPath)&&Ri(u))i=this.Un(i,a,u);else{let d=l.hn(a.kind);ye.Ut.bt(u,d)}}return this.Kn(i)}xn(t,e,n){return this.On(t,e,n.position)}Kn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].an();return e}Un(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new fn;l.seed(u.an()),ye.Ut.bt(a,l.hn(e.kind)),s.push(l)}return s}$n(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=si(t),i=Gn(t);return(e?n.j(du,IDBKeyRange.bound(e,e)):n.j()).next(s=>{let a=[];return b.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push((function(f,g){let _=g?new wi(g.sequenceNumber,new Wt(An(g.readTime),new F(ie(g.documentKey)),g.largestBatchId)):wi.empty(),S=f.fields.map(([C,N])=>new Yn(dt.fromServerFormat(C),N));return new rr(f.indexId,f.collectionGroup,S,_)})(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=si(t),s=Gn(t);return this.Wn(t).next(a=>i.j(du,IDBKeyRange.bound(e,e)).next(u=>b.forEach(u,l=>s.put(Af(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),b.forEach(u,l=>this.Gn(t,i,l).next(d=>{let f=this.zn(s,l);return d.isEqual(f)?b.resolve():this.jn(t,s,l,d,f)}))))})}Jn(t,e,n,i){return zn(t).put(i.An(this.uid,this.Qn(n,e.key),e.key))}Hn(t,e,n,i){return zn(t).delete(i.Rn(this.uid,this.Qn(n,e.key),e.key))}Gn(t,e,n){let i=zn(t),s=new et(De);return i.X({index:vm,range:IDBKeyRange.only([n.indexId,this.uid,Ms(this.Qn(n,e))])},(a,u)=>{s=s.add(new mn(n.indexId,e,Vf(u.arrayValue),Vf(u.directionalValue)))}).next(()=>s)}zn(t,e){let n=new et(De),i=this.qn(e,t);if(i==null)return n;let s=ou(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Ri(a))for(let u of a.arrayValue.values||[])n=n.add(new mn(e.indexId,t.key,this.Bn(u),i))}else n=n.add(new mn(e.indexId,t.key,Rs,i));return n}jn(t,e,n,i,s){x(xf,"Updating index entries for document '%s'",e.key);let a=[];return(function(l,d,f,g,_){let S=l.getIterator(),C=d.getIterator(),N=Bn(S),D=Bn(C);for(;N||D;){let j=!1,B=!1;if(N&&D){let q=f(N,D);q<0?B=!0:q>0&&(j=!0)}else N!=null?B=!0:j=!0;j?(g(D),D=Bn(C)):B?(_(N),N=Bn(S)):(N=Bn(S),D=Bn(C))}})(i,s,De,u=>{a.push(this.Jn(t,e,n,u))},u=>{a.push(this.Hn(t,e,n,u))}),b.waitFor(a)}Wn(t){let e=1;return Gn(t).X({index:wm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>De(a,u)).filter((a,u,l)=>!u||De(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=De(a,t),l=De(a,e);if(u===0)i[0]=t.En();else if(u>0&&l<0)i.push(a),i.push(a.En());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Yn(i[a],i[a+1]))return[];let u=i[a].Rn(this.uid,Rs,F.empty()),l=i[a+1].Rn(this.uid,Rs,F.empty());s.push(IDBKeyRange.bound(u,l))}return s}Yn(t,e){return De(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Nf)}getMinOffset(t,e){return b.mapArray(this.Fn(e),n=>this.Mn(t,n).next(i=>i||M(44426))).next(Nf)}};function Df(r){return It(r,Ei)}function zn(r){return It(r,di)}function si(r){return It(r,dl)}function Gn(r){return It(r,hi)}function Nf(r){L(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;cl(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Wt(t.readTime,t.documentKey,e)}var kf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wg=41943040,Lt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function vg(r,t,e){let n=r.store(Jt),i=r.store(ir),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.X({range:a},(f,g,_)=>(u++,_.delete()));s.push(l.next(()=>{L(u===1,47070,{batchId:e.batchId})}));let d=[];for(let f of e.mutations){let g=pm(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return b.waitFor(s).next(()=>d)}function uo(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw M(14731);t=r.noDocument}return JSON.stringify(t).length}Lt.DEFAULT_COLLECTION_PERCENTILE=10,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lt.DEFAULT=new Lt(wg,Lt.DEFAULT_COLLECTION_PERCENTILE,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lt.DISABLED=new Lt(-1,0,0);var co=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Zn={}}static yt(t,e,n,i){L(t.uid!=="",64387);let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ne(t).X({index:gn,range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Xn(t),a=Ne(t);return a.add({}).next(u=>{L(typeof u=="number",49019);let l=new Vi(u,e,n,i),d=(function(S,C,N){let D=N.baseMutations.map(B=>ki(S.gt,B)),j=N.mutations.map(B=>ki(S.gt,B));return{userId:C,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:j}})(this.serializer,this.userId,l),f=[],g=new et((_,S)=>z(_.canonicalString(),S.canonicalString()));for(let _ of i){let S=pm(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(S,L_))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Zn[u]=l.keys()}),b.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Ne(t).get(e).next(n=>n?(L(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),dn(this.serializer,n)):null)}Xn(t,e){return this.Zn[e]?b.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Zn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Ne(t).X({index:gn,range:i},(a,u,l)=>{u.userId===this.userId&&(L(u.batchId>=n,47524,{er:n}),s=dn(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=Le;return Ne(t).X({index:gn,range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,Le],[this.userId,Number.POSITIVE_INFINITY]);return Ne(t).j(gn,e).next(n=>n.map(i=>dn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=xs(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Xn(t).X({range:i},(a,u,l)=>{let[d,f,g]=a,_=ie(f);if(d===this.userId&&e.path.isEqual(_))return Ne(t).get(g).next(S=>{if(!S)throw M(61480,{tr:a,batchId:g});L(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:g}),s.push(dn(this.serializer,S))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z),i=[];return e.forEach(s=>{let a=xs(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=Xn(t).X({range:u},(d,f,g)=>{let[_,S,C]=d,N=ie(S);_===this.userId&&s.path.isEqual(N)?n=n.add(C):g.done()});i.push(l)}),b.waitFor(i).next(()=>this.nr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=xs(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new et(z);return Xn(t).X({range:a},(l,d,f)=>{let[g,_,S]=l,C=ie(_);g===this.userId&&n.isPrefixOf(C)?C.length===i&&(u=u.add(S)):f.done()}).next(()=>this.nr(t,u))}nr(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Ne(t).get(s).next(a=>{if(a===null)throw M(35274,{batchId:s});L(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:s}),n.push(dn(this.serializer,a))}))}),b.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return vg(t.ce,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.rr(e.batchId)}),b.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}rr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),i=[];return Xn(t).X({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=ie(s[1]);i.push(l)}else u.done()}).next(()=>{L(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(t,e){return Ig(t,this.userId,e)}sr(t){return Tg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Le,lastStreamToken:""})}};function Ig(r,t,e){let n=xs(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Xn(r).X({range:s,Z:!0},(u,l,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function Ne(r){return It(r,Jt)}function Xn(r){return It(r,ir)}function Tg(r){return It(r,Ii)}var gr=class r{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new r(0)}static ur(){return new r(-1)}};var Hu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.cr(t).next(e=>{let n=new gr(e.highestTargetId);return e.highestTargetId=n.next(),this.lr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.cr(t).next(e=>U.fromTimestamp(new rt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.cr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.cr(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.lr(t,i)))}addTargetData(t,e){return this.hr(t,e).next(()=>this.cr(t).next(n=>(n.targetCount+=1,this.Pr(e,n),this.lr(t,n))))}updateTargetData(t,e){return this.hr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Kn(t).delete(e.targetId)).next(()=>this.cr(t)).next(n=>(L(n.targetCount>0,8065),n.targetCount-=1,this.lr(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Kn(t).X((a,u)=>{let l=ci(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Kn(t).X((n,i)=>{let s=ci(i);e(s)})}cr(t){return Ff(t).get($s).next(e=>(L(e!==null,2888),e))}lr(t,e){return Ff(t).put($s,e)}hr(t,e){return Kn(t).put(pg(this.serializer,e))}Pr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.cr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=In(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Kn(t).X({range:i,index:ym},(a,u,l)=>{let d=ci(u);$i(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Fe(t);return e.forEach(a=>{let u=Dt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(i)}removeMatchingKeys(t,e,n){let i=Fe(t);return b.forEach(e,s=>{let a=Dt(s.path);return b.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Fe(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Fe(t),s=K();return i.X({range:n,Z:!0},(a,u,l)=>{let d=ie(a[1]),f=new F(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=Dt(e.path),i=IDBKeyRange.bound([n],[um(n)],!1,!0),s=0;return Fe(t).X({index:hl,Z:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}Et(t,e){return Kn(t).get(e).next(n=>n?ci(n):null)}};function Kn(r){return It(r,sr)}function Ff(r){return It(r,yn)}function Fe(r){return It(r,or)}var Of="LruGarbageCollector",qy=1048576;function Mf([r,t],[e,n]){let i=z(r,e);return i===0?z(t,n):i}var Xu=class{constructor(t){this.Tr=t,this.buffer=new et(Mf),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Mf(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},lo=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){x(Of,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ze(e)?x(Of,"Ignoring IndexedDB error during garbage collection: ",e):await Ye(e)}await this.Rr(3e5)})}},Ju=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Gt.ue);let n=new Xu(e);return this.Vr.forEachTarget(t,i=>n.Er(i.sequenceNumber)).next(()=>this.Vr.gr(t,i=>n.Er(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(kf)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kf):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),$n()<=ne.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Eg(r,t){return new Ju(r,t)}var Yu=class{constructor(t,e){this.db=t,this.garbageCollector=Eg(this,e)}mr(t){let e=this.yr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}gr(t,e){return this.wr(t,(n,i)=>e(i))}addReference(t,e,n){return Ps(t,n)}removeReference(t,e,n){return Ps(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ps(t,e)}Sr(t,e){return(function(i,s){let a=!1;return Tg(i).ee(u=>Ig(i,u,s).next(l=>(l&&(a=!0),b.resolve(!l)))).next(()=>a)})(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(t,(a,u)=>{if(u<=e){let l=this.Sr(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Fe(t).delete((function(g){return[0,Dt(g.path)]})(a))))});i.push(l)}}).next(()=>b.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ps(t,e)}wr(t,e){let n=Fe(t),i,s=Gt.ue;return n.X({index:hl},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Gt.ue&&e(new F(ie(i)),s),s=d,i=l):s=Gt.ue}).next(()=>{s!==Gt.ue&&e(new F(ie(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Ps(r,t){return Fe(r).put((function(n,i){return{targetId:0,path:Dt(n.path),sequenceNumber:i}})(t,r.currentSequenceNumber))}var ho=class{constructor(){this.changes=new Zt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,wt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Zu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return un(t).put(n)}removeEntry(t,e,n){return un(t).delete((function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],io(a),u[u.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.br(t,n)))}getEntry(t,e){let n=wt.newInvalidDocument(e);return un(t).X({index:Ds,range:IDBKeyRange.only(oi(e))},(i,s)=>{n=this.Dr(e,s)}).next(()=>n)}vr(t,e){let n={size:0,document:wt.newInvalidDocument(e)};return un(t).X({index:Ds,range:IDBKeyRange.only(oi(e))},(i,s)=>{n={document:this.Dr(e,s),size:uo(s)}}).next(()=>n)}getEntries(t,e){let n=qt();return this.Cr(t,e,(i,s)=>{let a=this.Dr(i,s);n=n.insert(i,a)}).next(()=>n)}Fr(t,e){let n=qt(),i=new st(F.comparator);return this.Cr(t,e,(s,a)=>{let u=this.Dr(s,a);n=n.insert(s,u),i=i.insert(s,uo(a))}).next(()=>({documents:n,Mr:i}))}Cr(t,e,n){if(e.isEmpty())return b.resolve();let i=new et(Uf);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(oi(i.first()),oi(i.last())),a=i.getIterator(),u=a.getNext();return un(t).X({index:Ds,range:s},(l,d,f)=>{let g=F.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Uf(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.G(oi(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),io(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return un(t).j(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=qt();for(let g of d){let _=this.Dr(F.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(Wi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=qt(),a=qf(e,n),u=qf(e,Wt.max());return un(t).X({index:_m,range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.Dr(F.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new tc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Lf(t).get(hu).next(e=>(L(!!e,20021),e))}br(t,e){return Lf(t).put(hu,e)}Dr(t,e){if(e){let n=Oy(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return wt.newInvalidDocument(t)}};function Ag(r){return new Zu(r)}var tc=class extends ho{constructor(t,e){super(),this.Or=t,this.trackRemovals=e,this.Nr=new Zt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new et((s,a)=>z(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.Nr.get(s);if(e.push(this.Or.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=Tf(this.Or.serializer,a);i=i.add(s.path.popLast());let d=uo(l);n+=d-u.size,e.push(this.Or.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=Tf(this.Or.serializer,a.convertToNoDocument(U.min()));e.push(this.Or.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.Or.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.Or.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Or.vr(t,e).next(n=>(this.Nr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Or.Fr(t,e).next(({documents:n,Mr:i})=>(i.forEach((s,a)=>{this.Nr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Lf(r){return It(r,Ti)}function un(r){return It(r,Ks)}function oi(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function qf(r,t){let e=t.documentKey.path.toArray();return[r,io(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Uf(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=z(e[s],n[s]),i)return i;return i=z(e.length,n.length),i||(i=z(e[e.length-2],n[n.length-2]),i||z(e[e.length-1],n[n.length-1]))}var ec=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var fo=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&gi(n.mutation,i,Kt.empty(),rt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let i=se();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=ui();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=se();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=qt(),a=mi(),u=(function(){return mi()})();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof te)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),gi(f.mutation,d,f.mutation.getFieldMask(),rt.now())):a.set(d.key,Kt.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new ec(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=mi(),i=new st((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Kt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(i.get(u.batchId)||K()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=Qm();f.forEach(_=>{if(!s.has(_)){let S=tg(e.get(_),n.get(_));S!==null&&g.set(_,S),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return(function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):yl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):b.resolve(se()),u=nr,l=s;return a.next(d=>b.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,K())).next(f=>({batchId:u,changes:$m(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(n=>{let i=ui();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=ui();return this.indexManager.getCollectionParents(t,s).next(u=>b.forEach(u,l=>{let d=(function(g,_){return new Yt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,wt.newInvalidDocument(f)))});let u=ui();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&gi(f.mutation,d,Kt.empty(),rt.now()),Wi(e,d)&&(u=u.insert(l,d))}),u})}};var nc=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return b.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,(function(i){return{id:i.id,version:i.version,createTime:ft(i.createTime)}})(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,(function(i){return{name:i.name,query:Tl(i.bundledQuery),readTime:ft(i.readTime)}})(e)),b.resolve()}};var rc=class{constructor(){this.overlays=new st(F.comparator),this.kr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=se();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.wt(t,e,s)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.kr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let i=se(),s=e.length+1,a=new F(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return b.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new st((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=se(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=se(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return b.resolve(u)}wt(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(n.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ci(e,n));let s=this.kr.get(e);s===void 0&&(s=K(),this.kr.set(e,s)),this.kr.set(e,s.add(n.key))}};var ic=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var Oi=class{constructor(){this.qr=new et(pt.Qr),this.$r=new et(pt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let n=new pt(t,e);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Wr(new pt(t,e))}Gr(t,e){t.forEach(n=>this.removeReference(n,e))}zr(t){let e=new F(new H([])),n=new pt(e,t),i=new pt(e,t+1),s=[];return this.$r.forEachInRange([n,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new F(new H([])),n=new pt(e,t),i=new pt(e,t+1),s=K();return this.$r.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new pt(t,0),n=this.qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},pt=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return F.comparator(t.key,e.key)||z(t.Hr,e.Hr)}static Ur(t,e){return z(t.Hr,e.Hr)||F.comparator(t.key,e.key)}};var sc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new et(pt.Qr)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Vi(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.Yr=this.Yr.add(new pt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.Xr(n),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Le:this.er-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new pt(e,0),i=new pt(e,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([n,i],a=>{let u=this.Zr(a.Hr);s.push(u)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);return e.forEach(i=>{let s=new pt(i,0),a=new pt(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],u=>{n=n.add(u.Hr)})}),b.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;F.isDocumentKey(s)||(s=s.child(""));let a=new pt(new F(s),0),u=new et(z);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.Hr)),!0)},a),b.resolve(this.ei(u))}ei(t){let e=[];return t.forEach(n=>{let i=this.Zr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){L(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return b.forEach(e.mutations,i=>{let s=new pt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Yr=n})}rr(t){}containsKey(t,e){let n=new pt(e,0),i=this.Yr.firstAfterOrEqual(n);return b.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var oc=class{constructor(t){this.ni=t,this.docs=(function(){return new st(F.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.ni(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():wt.newInvalidDocument(e))}getEntries(t,e){let n=qt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():wt.newInvalidDocument(i))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=qt(),a=e.path,u=new F(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||cl(dm(f),n)<=0||(i.has(f.key)||Wi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(t,e,n,i){M(9500)}ri(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new ac(this)}getSize(t){return b.resolve(this.size)}},ac=class extends ho{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Or.addEntry(t,i)):this.Or.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var uc=class{constructor(t){this.persistence=t,this.ii=new Zt(e=>In(e),$i),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.si=0,this.oi=new Oi,this.targetCount=0,this._i=gr.ar()}forEachTarget(t,e){return this.ii.forEach((n,i)=>e(i)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.si&&(this.si=e),b.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new gr(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.hr(e),b.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.ii.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this.oi.Kr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this.oi.Gr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),b.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this.oi.Jr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this.oi.containsKey(e))}};var Mi=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new Gt(0),this.ci=!1,this.ci=!0,this.li=new ic,this.referenceDelegate=t(this),this.hi=new uc(this),this.indexManager=new Qu,this.remoteDocumentCache=(function(i){return new oc(i)})(n=>this.referenceDelegate.Pi(n)),this.serializer=new ro(e),this.Ti=new nc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new rc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ai[t.toKey()];return n||(n=new sc(e,this.referenceDelegate),this.ai[t.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,n){x("MemoryPersistence","Starting transaction:",t);let i=new cc(this.ui.next());return this.referenceDelegate.Ii(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(t,e){return b.or(Object.values(this.ai).map(n=>()=>n.containsKey(t,e)))}},cc=class extends js{constructor(t){super(),this.currentSequenceNumber=t}},mo=class r{constructor(t){this.persistence=t,this.Ai=new Oi,this.Ri=null}static Vi(t){return new r(t)}get mi(){if(this.Ri)return this.Ri;throw M(60996)}addReference(t,e,n){return this.Ai.addReference(n,e),this.mi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ai.removeReference(n,e),this.mi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(i=>this.mi.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.mi,n=>{let i=F.fromPath(n);return this.fi(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(n=>{n?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return b.or([()=>b.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},go=class r{constructor(t,e){this.persistence=t,this.gi=new Zt(n=>Dt(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=Eg(this,e)}static Vi(t,e){return new r(t,e)}Ii(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}gr(t,e){return b.forEach(this.gi,(n,i)=>this.Sr(t,n,i).next(s=>s?b.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(t,a=>this.Sr(t,a,e).next(u=>{u||(n++,s.removeEntry(a,U.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),b.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ks(t.data.value)),e}Sr(t,e,n){return b.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.gi.get(e);return b.resolve(i!==void 0&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var lc=class{constructor(t){this.serializer=t}q(t,e,n,i){let s=new zs("createOrUpgrade",e);n<1&&i>=1&&((function(l){l.createObjectStore(Ki)})(t),(function(l){l.createObjectStore(Ii,{keyPath:M_}),l.createObjectStore(Jt,{keyPath:Yd,autoIncrement:!0}).createIndex(gn,Zd,{unique:!0}),l.createObjectStore(ir)})(t),Bf(t),(function(l){l.createObjectStore(ln)})(t));let a=b.resolve();return n<3&&i>=3&&(n!==0&&((function(l){l.deleteObjectStore(or),l.deleteObjectStore(sr),l.deleteObjectStore(yn)})(t),Bf(t)),a=a.next(()=>(function(l){let d=l.store(yn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put($s,f)})(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>(function(l,d){return d.store(Jt).j().next(g=>{l.deleteObjectStore(Jt),l.createObjectStore(Jt,{keyPath:Yd,autoIncrement:!0}).createIndex(gn,Zd,{unique:!0});let _=d.store(Jt),S=g.map(C=>_.put(C));return b.waitFor(S)})})(t,s))),a=a.next(()=>{(function(l){l.createObjectStore(ar,{keyPath:$_})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.pi(s))),n<6&&i>=6&&(a=a.next(()=>((function(l){l.createObjectStore(Ti)})(t),this.yi(s)))),n<7&&i>=7&&(a=a.next(()=>this.wi(s))),n<8&&i>=8&&(a=a.next(()=>this.Si(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.bi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(jo,{keyPath:Q_})})(t),(function(l){l.createObjectStore(zo,{keyPath:W_})})(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(Go,{keyPath:ey});d.createIndex(fu,ny,{unique:!1}),d.createIndex(Im,ry,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>(function(l){let d=l.createObjectStore(Ks,{keyPath:q_});d.createIndex(Ds,U_),d.createIndex(_m,B_)})(t)).next(()=>this.Di(t,s)).next(()=>t.deleteObjectStore(ln))),n<14&&i>=14&&(a=a.next(()=>this.Ci(t,s))),n<15&&i>=15&&(a=a.next(()=>(function(l){l.createObjectStore(dl,{keyPath:H_,autoIncrement:!0}).createIndex(du,X_,{unique:!1}),l.createObjectStore(hi,{keyPath:J_}).createIndex(wm,Y_,{unique:!1}),l.createObjectStore(di,{keyPath:Z_}).createIndex(vm,ty,{unique:!1})})(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore(hi).clear()}).next(()=>{e.objectStore(di).clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(fl,{keyPath:iy})})(t)})),n<18&&i>=18&&Ma()&&(a=a.next(()=>{e.objectStore(hi).clear()}).next(()=>{e.objectStore(di).clear()})),a}yi(t){let e=0;return t.store(ln).X((n,i)=>{e+=uo(i)}).next(()=>{let n={byteSize:e};return t.store(Ti).put(hu,n)})}pi(t){let e=t.store(Ii),n=t.store(Jt);return e.j().next(i=>b.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,Le],[s.userId,s.lastAcknowledgedBatchId]);return n.j(gn,a).next(u=>b.forEach(u,l=>{L(l.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});let d=dn(this.serializer,l);return vg(t,s.userId,d).next(()=>{})}))}))}wi(t){let e=t.store(or),n=t.store(ln);return t.store(yn).get($s).next(i=>{let s=[];return n.X((a,u)=>{let l=new H(a),d=(function(g){return[0,Dt(g)]})(l);s.push(e.get(d).next(f=>f?b.resolve():(g=>e.put({targetId:0,path:Dt(g),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>b.waitFor(s))})}Si(t,e){t.createObjectStore(Ei,{keyPath:K_});let n=e.store(Ei),i=new Fi,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:Dt(l)})}};return e.store(ln).X({Z:!0},(a,u)=>{let l=new H(a);return s(l.popLast())}).next(()=>e.store(ir).X({Z:!0},([a,u,l],d)=>{let f=ie(u);return s(f.popLast())}))}bi(t){let e=t.store(sr);return e.X((n,i)=>{let s=ci(i),a=pg(this.serializer,s);return e.put(a)})}Di(t,e){let n=e.store(ln),i=[];return n.X((s,a)=>{let u=e.store(Ks),l=(function(g){return g.document?new F(H.fromString(g.document.name).popFirst(5)):g.noDocument?F.fromSegments(g.noDocument.path):g.unknownDocument?F.fromSegments(g.unknownDocument.path):M(36783)})(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>b.waitFor(i))}Ci(t,e){let n=e.store(Jt),i=Ag(this.serializer),s=new Mi(mo.Vi,this.serializer.gt);return n.j().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:K();dn(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),b.forEach(u,(l,d)=>{let f=new _t(d),g=so.yt(this.serializer,f),_=s.getIndexManager(f),S=co.yt(f,this.serializer,_,s.referenceDelegate);return new fo(i,S,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Ai(e,Gt.ue),l).next()})})}};function Bf(r){r.createObjectStore(or,{keyPath:z_}).createIndex(hl,G_,{unique:!0}),r.createObjectStore(sr,{keyPath:"targetId"}).createIndex(ym,j_,{unique:!0}),r.createObjectStore(yn)}var ke="IndexedDbPersistence",Qa=18e5,Wa=5e3,Ha="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bg="main",hc=class r{constructor(t,e,n,i,s,a,u,l,d,f,g=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fi=s,this.window=a,this.document=u,this.Mi=d,this.xi=f,this.Oi=g,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=_=>Promise.resolve(),!r.C())throw new V(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Yu(this,i),this.Qi=e+bg,this.serializer=new ro(l),this.$i=new je(this.Qi,this.Oi,new lc(this.serializer)),this.li=new Uu,this.hi=new Hu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ag(this.serializer),this.Ti=new qu,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ht(ke,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(R.FAILED_PRECONDITION,Ha);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.hi.getHighestSequenceNumber(t))}).then(t=>{this.ui=new Gt(t,this.Mi)}).then(()=>{this.ci=!0}).catch(t=>(this.$i&&this.$i.close(),Promise.reject(t)))}ji(t){return this.qi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.$i.setDatabaseDeletedListener(t)}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Vs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(t).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(t)).next(e=>this.isPrimary&&!e?this.Yi(t).next(()=>!1):!!e&&this.Zi(t).next(()=>!0))).catch(t=>{if(Ze(t))return x(ke,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return x(ke,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Fi.enqueueRetryable(()=>this.qi(t)),this.isPrimary=t})}Ji(t){return ai(t).get(Un).next(e=>b.resolve(this.Xi(e)))}es(t){return Vs(t).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,Qa)){this.ki=Date.now();let t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,ar);return n.j().next(i=>{let s=this.rs(i,Qa),a=i.filter(u=>s.indexOf(u)===-1);return b.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ui)for(let e of t)this.Ui.removeItem(this.ss(e.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.xi?b.resolve(!0):ai(t).get(Un).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,Wa)&&!this._s(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new V(R.FAILED_PRECONDITION,Ha);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vs(t).j().next(n=>this.rs(n,Wa).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&x(ke,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[Ki,ar],t=>{let e=new Ai(t,Gt.ue);return this.Yi(e).next(()=>this.es(e))}),this.$i.close(),this.hs()}rs(t,e){return t.filter(n=>this.ns(n.updateTimeMs,e)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",t=>Vs(t).j().next(e=>this.rs(e,Qa).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(t,e){return co.yt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Wu(t,this.serializer.gt.databaseId)}getDocumentOverlayCache(t){return so.yt(this.serializer,t)}getBundleCache(){return this.Ti}runTransaction(t,e,n){x(ke,"Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=(function(l){return l===18?ay:l===17?bm:l===16?oy:l===15?ml:l===14?Am:l===13?Em:l===12?sy:l===11?Tm:void M(60245)})(this.Oi),a;return this.$i.runTransaction(t,i,s,u=>(a=new Ai(u,this.ui?this.ui.next():Gt.ue),e==="readwrite-primary"?this.Ji(a).next(l=>!!l||this.Hi(a)).next(l=>{if(!l)throw ht(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new V(R.FAILED_PRECONDITION,fm);return n(a)}).next(l=>this.Zi(a).next(()=>l)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(t){return ai(t).get(Un).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,Wa)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new V(R.FAILED_PRECONDITION,Ha)})}Zi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ai(t).put(Un,e)}static C(){return je.C()}Yi(t){let e=ai(t);return e.get(Un).next(n=>this.Xi(n)?(x(ke,"Releasing primary lease."),e.delete(Un)):b.resolve())}ns(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ht(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;Oa()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(t){var e;try{let n=((e=this.Ui)===null||e===void 0?void 0:e.getItem(this.ss(t)))!==null;return x(ke,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ht(ke,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(t){ht("Failed to set zombie client id.",t)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function ai(r){return It(r,Ki)}function Vs(r){return It(r,ar)}function Al(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var dc=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Is=n,this.ds=i}static Es(t,e){let n=K(),i=K();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var fc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var po=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return Oa()?8:mm(ni())>0?6:4})()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.ps(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new fc;return this.ws(t,e,a).next(u=>{if(s.result=u,this.Rs)return this.Ss(t,e,a,u.size)})}).next(()=>s.result)}Ss(t,e,n,i){return n.documentReadCount<this.Vs?($n()<=ne.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Qn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):($n()<=ne.DEBUG&&x("QueryEngine","Query:",Qn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.fs*i?($n()<=ne.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Qn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ft(e))):b.resolve())}ps(t,e){if(df(e))return b.resolve(null);let n=Ft(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Zs(e,null,"F"),n=Ft(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=K(...s);return this.gs.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.bs(e,u);return this.Ds(e,d,a,l.readTime)?this.ps(t,Zs(e,null,"F")):this.vs(t,d,e,l)}))})))}ys(t,e,n,i){return df(e)||i.isEqual(U.min())?b.resolve(null):this.gs.getDocuments(t,n).next(s=>{let a=this.bs(e,s);return this.Ds(e,a,n,i)?b.resolve(null):($n()<=ne.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qn(e)),this.vs(t,a,e,hm(i,nr)).next(u=>u))})}bs(t,e){let n=new et(Gm(t));return e.forEach((i,s)=>{Wi(t,s)&&(n=n.add(s))}),n}Ds(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(t,e,n){return $n()<=ne.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Qn(e)),this.gs.getDocumentsMatchingQuery(t,e,Wt.min(),n)}vs(t,e,n,i){return this.gs.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var bl="LocalStore",Uy=3e8,mc=class{constructor(t,e,n,i){this.persistence=t,this.Cs=e,this.serializer=i,this.Fs=new st(z),this.Ms=new Zt(s=>In(s),$i),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(n)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new fo(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function Sg(r,t,e,n){return new mc(r,t,e,n)}async function Rg(r,t){let e=O(r);return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=K();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:u}))})})}function By(r,t){let e=O(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.Os.newChangeBuffer({trackRemovals:!0});return(function(u,l,d,f){let g=d.batch,_=g.keys(),S=b.resolve();return _.forEach(C=>{S=S.next(()=>f.getEntry(l,C)).next(N=>{let D=d.docVersions.get(C);L(D!==null,48541),N.version.compareTo(D)<0&&(g.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),S.next(()=>u.mutationQueue.removeMutationBatch(l,g))})(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l})(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Pg(r){let t=O(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function jy(r,t){let e=O(r),n=t.snapshotVersion,i=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.Os.newChangeBuffer({trackRemovals:!0});i=e.Fs;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.hi.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.hi.addMatchingKeys(s,f.addedDocuments,g)));let S=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?S=S.withResumeToken(mt.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,n)),i=i.insert(g,S),(function(N,D,j){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=Uy?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0})(_,S,f)&&u.push(e.hi.updateTargetData(s,S))});let l=qt(),d=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Vg(s,a,t.documentUpdates).next(f=>{l=f.Ls,d=f.ks})),!n.isEqual(U.min())){let f=e.hi.getLastRemoteSnapshotVersion(s).next(g=>e.hi.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.Fs=i,s))}function Vg(r,t,e){let n=K(),i=K();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=qt();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):x(bl,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function zy(r,t){let e=O(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=Le),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function pr(r,t){let e=O(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.hi.getTargetData(n,t).next(s=>s?(i=s,b.resolve(i)):e.hi.allocateTargetId(n).next(a=>(i=new mr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.hi.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.Fs.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(n.targetId,n),e.Ms.set(t,n.targetId)),n})}async function _r(r,t,e){let n=O(r),i=n.Fs.get(t),s=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Ze(a))throw a;x(bl,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(i.target)}function _o(r,t,e){let n=O(r),i=U.min(),s=K();return n.persistence.runTransaction("Execute query","readwrite",a=>(function(l,d,f){let g=O(l),_=g.Ms.get(f);return _!==void 0?b.resolve(g.Fs.get(_)):g.hi.getTargetData(d,f)})(n,a,Ft(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:K())).next(u=>(Dg(n,zm(t),u),{documents:u,qs:s})))}function Cg(r,t){let e=O(r),n=O(e.hi),i=e.Fs.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.Et(s,t).next(a=>a?a.target:null))}function xg(r,t){let e=O(r),n=e.xs.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.Os.getAllFromCollectionGroup(i,t,hm(n,nr),Number.MAX_SAFE_INTEGER)).then(i=>(Dg(e,t,i),i))}function Dg(r,t,e){let n=r.xs.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.xs.set(t,n)}async function Gy(r,t,e,n){let i=O(r),s=K(),a=qt();for(let d of e){let f=t.Qs(d.metadata.name);d.document&&(s=s.add(f));let g=t.$s(d);g.setReadTime(t.Us(d.metadata.readTime)),a=a.insert(f,g)}let u=i.Os.newChangeBuffer({trackRemovals:!0}),l=await pr(i,(function(f){return Ft(br(H.fromString(`__bundle__/docs/${f}`)))})(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Vg(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.hi.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.hi.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ls,f.ks)).next(()=>f.Ls)))}async function Ky(r,t,e=K()){let n=await pr(r,Ft(Tl(t.bundledQuery))),i=O(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{let a=ft(t.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Ti.saveNamedQuery(s,t);let u=n.withResumeToken(mt.EMPTY_BYTE_STRING,a);return i.Fs=i.Fs.insert(u.targetId,u),i.hi.updateTargetData(s,u).next(()=>i.hi.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.hi.addMatchingKeys(s,e,n.targetId)).next(()=>i.Ti.saveNamedQuery(s,t))})}var Ng="firestore_clients";function jf(r,t){return`${Ng}_${r}_${t}`}var kg="firestore_mutations";function zf(r,t,e){let n=`${kg}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var Fg="firestore_targets";function Xa(r,t){return`${Fg}_${r}_${t}`}var re="SharedClientState",yo=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Ks(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new V(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(ht(re,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},pi=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ks(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new V(n.error.code,n.error.message))),s?new r(t,n.state,i):(ht(re,`Failed to parse target state for ID '${t}': ${e}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},wo=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ks(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=wl();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=gm(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(ht(re,`Failed to parse client data for instance '${t}': ${e}`),null)}},gc=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ks(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ht(re,`Failed to parse online state: ${t}`),null)}},Li=class{constructor(){this.activeTargetIds=wl()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},_i=class{constructor(t,e,n,i,s){this.window=t,this.Fi=e,this.persistenceKey=n,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new st(z),this.started=!1,this.Zs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=jf(this.persistenceKey,this.js),this.eo=(function(l){return`firestore_sequence_number_${l}`})(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Li),this.no=new RegExp(`^${Ng}_${a}_([^_]*)$`),this.ro=new RegExp(`^${kg}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Fg}_${a}_(\\d+)$`),this.so=(function(l){return`firestore_online_state_${l}`})(this.persistenceKey),this.oo=(function(l){return`firestore_bundle_loaded_v2_${l}`})(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(t){return!(!t||!t.localStorage)}async start(){let t=await this.syncEngine.Ps();for(let n of t){if(n===this.js)continue;let i=this.getItem(jf(this.persistenceKey,n));if(i){let s=wo.Ks(n,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let e=this.storage.getItem(this.so);if(e){let n=this.ao(e);n&&this.uo(n)}for(let n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(t){this.setItem(this.eo,JSON.stringify(t))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(t){let e=!1;return this.Ys.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.lo(t,"pending")}updateMutationState(t,e,n){this.lo(t,e,n),this.ho(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(Xa(this.persistenceKey,t));if(i){let s=pi.Ks(t,i);s&&(n=s.state)}}return e&&this.Po.Gs(t),this._o(),n}removeLocalQueryTarget(t){this.Po.zs(t),this._o()}isLocalQueryTarget(t){return this.Po.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Xa(this.persistenceKey,t))}updateQueryState(t,e,n){this.To(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.ho(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Io(t)}notifyBundleLoaded(t){this.Eo(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return x(re,"READ",t,e),e}setItem(t,e){x(re,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){x(re,"REMOVE",t),this.storage.removeItem(t)}Hs(t){let e=t;if(e.storageArea===this.storage){if(x(re,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ht("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(e.key!==null){if(this.no.test(e.key)){if(e.newValue==null){let n=this.Ao(e.key);return this.Ro(n,null)}{let n=this.Vo(e.key,e.newValue);if(n)return this.Ro(n.clientId,n)}}else if(this.ro.test(e.key)){if(e.newValue!==null){let n=this.mo(e.key,e.newValue);if(n)return this.fo(n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.po(e.key,e.newValue);if(n)return this.yo(n)}}else if(e.key===this.so){if(e.newValue!==null){let n=this.ao(e.newValue);if(n)return this.uo(n)}}else if(e.key===this.eo){let n=(function(s){let a=Gt.ue;if(s!=null)try{let u=JSON.parse(s);L(typeof u=="number",30636,{wo:s}),a=u}catch(u){ht(re,"Failed to read sequence number from WebStorage",u)}return a})(e.newValue);n!==Gt.ue&&this.sequenceNumberHandler(n)}else if(e.key===this.oo){let n=this.So(e.newValue);await Promise.all(n.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(e)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(t,e,n){let i=new yo(this.currentUser,t,e,n),s=zf(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Ws())}ho(t){let e=zf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Io(t){let e={clientId:this.js,onlineState:t};this.storage.setItem(this.so,JSON.stringify(e))}To(t,e,n){let i=Xa(this.persistenceKey,t),s=new pi(t,e,n);this.setItem(i,s.Ws())}Eo(t){let e=JSON.stringify(Array.from(t));this.setItem(this.oo,e)}Ao(t){let e=this.no.exec(t);return e?e[1]:null}Vo(t,e){let n=this.Ao(t);return wo.Ks(n,e)}mo(t,e){let n=this.ro.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return yo.Ks(new _t(s),i,e)}po(t,e){let n=this.io.exec(t),i=Number(n[1]);return pi.Ks(i,e)}ao(t){return gc.Ks(t)}So(t){return JSON.parse(t)}async fo(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Do(t.batchId,t.state,t.error);x(re,`Ignoring mutation for non-active user ${t.user.uid}`)}yo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Ro(t,e){let n=e?this.Ys.insert(t,e):this.Ys.remove(t),i=this.co(this.Ys),s=this.co(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(t){this.Ys.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}co(t){let e=wl();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},vo=class{constructor(){this.Fo=new Li,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,n){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new Li,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var pc=class{xo(t){}shutdown(){}};var Gf="ConnectivityMonitor",Io=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){x(Gf,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){x(Gf,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Cs=null;function _c(){return Cs===null?Cs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Cs++,"0x"+Cs.toString(16)}var Ja="RestConnection",$y={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},yc=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${n}/databases/${i}`,this.Ko=this.databaseId.database===gu?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(t,e,n,i,s){let a=_c(),u=this.Go(t,e.toUriEncodedString());x(Ja,`Sending RPC '${t}' ${a}:`,u,n);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:d}=new URL(u),f=Fa(d);return this.jo(t,u,l,n,f).then(g=>(x(Ja,`Received RPC '${t}' ${a}: `,g),g),g=>{throw Bt(Ja,`RPC '${t}' ${a} failed with error: `,g,"url: ",u,"request:",n),g})}Jo(t,e,n,i,s,a){return this.Wo(t,e,n,i,s)}zo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ar})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((i,s)=>t[s]=i),n&&n.headers.forEach((i,s)=>t[s]=i)}Go(t,e){let n=$y[t];return`${this.$o}/v1/${e}:${n}`}terminate(){}};var wc=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Ct="WebChannelConnection",vc=class extends yc{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,n,i,s){let a=_c();return new Promise((u,l)=>{let d=new Ba;d.setWithCredentials(!0),d.listenOnce(ja.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ri.NO_ERROR:let g=d.getResponseJson();x(Ct,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(g)),u(g);break;case ri.TIMEOUT:x(Ct,`RPC '${t}' ${a} timed out`),l(new V(R.DEADLINE_EXCEEDED,"Request time out"));break;case ri.HTTP_ERROR:let _=d.getStatus();if(x(Ct,`RPC '${t}' ${a} failed with status:`,_,"response text:",d.getResponseText()),_>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);let C=S?.error;if(C&&C.status&&C.message){let N=(function(j){let B=j.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(B)>=0?B:R.UNKNOWN})(C.status);l(new V(N,C.message))}else l(new V(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new V(R.UNAVAILABLE,"Connection failed."));break;default:M(9055,{c_:t,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{x(Ct,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(i);x(Ct,`RPC '${t}' ${a} sending request:`,i),d.send(e,"POST",f,n,15)})}P_(t,e,n){let i=_c(),s=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ka(),u=Ga(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");x(Ct,`Creating RPC '${t}' stream ${i}: ${f}`,l);let g=a.createWebChannel(f,l);this.T_(g);let _=!1,S=!1,C=new wc({Ho:D=>{S?x(Ct,`Not sending because RPC '${t}' stream ${i} is closed:`,D):(_||(x(Ct,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),x(Ct,`RPC '${t}' stream ${i} sending:`,D),g.send(D))},Yo:()=>g.close()}),N=(D,j,B)=>{D.listen(j,q=>{try{B(q)}catch($){setTimeout(()=>{throw $},0)}})};return N(g,qn.EventType.OPEN,()=>{S||(x(Ct,`RPC '${t}' stream ${i} transport opened.`),C.s_())}),N(g,qn.EventType.CLOSE,()=>{S||(S=!0,x(Ct,`RPC '${t}' stream ${i} transport closed`),C.__(),this.I_(g))}),N(g,qn.EventType.ERROR,D=>{S||(S=!0,Bt(Ct,`RPC '${t}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),C.__(new V(R.UNAVAILABLE,"The operation could not be completed")))}),N(g,qn.EventType.MESSAGE,D=>{var j;if(!S){let B=D.data[0];L(!!B,16349);let q=B,$=q?.error||((j=q[0])===null||j===void 0?void 0:j.error);if($){x(Ct,`RPC '${t}' stream ${i} received error:`,$);let W=$.status,G=(function(w){let I=gt[w];if(I!==void 0)return rg(I)})(W),v=$.message;G===void 0&&(G=R.INTERNAL,v="Unknown error status: "+W+" with message "+$.message),S=!0,C.__(new V(G,v)),g.close()}else x(Ct,`RPC '${t}' stream ${i} received:`,B),C.a_(B)}}),N(u,za.STAT_EVENT,D=>{D.stat===bs.PROXY?x(Ct,`RPC '${t}' stream ${i} detected buffering proxy`):D.stat===bs.NOPROXY&&x(Ct,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{C.o_()},0),C}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function Og(){return typeof window<"u"?window:null}function Ls(){return typeof document<"u"?document:null}function Hi(r){return new ku(r,!0)}var qi=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Fi=t,this.timerId=e,this.d_=n,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),i=Math.max(0,e-n);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Kf="PersistentStream",To=class{constructor(t,e,n,i,s,a,u,l){this.Fi=t,this.w_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new qi(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(ht(e.toString()),ht("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.n_(e)}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.b_===e&&this.W_(n,i)},n=>{t(()=>{let i=new V(R.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(i)})})}W_(t,e){let n=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{n(()=>this.G_(i))}),this.stream.onMessage(i=>{n(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(t){return x(Kf,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(x(Kf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ic=class extends To{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=Vy(this.serializer,t),n=(function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?ft(a.readTime):U.min()})(t);return this.listener.J_(e,n)}H_(t){let e={};e.database=Mu(this.serializer),e.addTarget=(function(s,a){let u,l=a.target;if(u=Js(l)?{documents:lg(s,l)}:{query:hg(s,l).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ig(s,a.resumeToken);let d=Fu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=fr(s,a.snapshotVersion.toTimestamp());let d=Fu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);let n=xy(this.serializer,t);n&&(e.labels=n),this.k_(e)}Y_(t){let e={};e.database=Mu(this.serializer),e.removeTarget=t,this.k_(e)}},Tc=class extends To{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return L(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,L(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){L(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=Cy(t.writeResults,t.commitTime),n=ft(t.commitTime);return this.listener.ta(n,e)}na(){let t={};t.database=Mu(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>ki(this.serializer,n))};this.k_(e)}};var Ec=class{},Ac=class extends Ec{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new V(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(t,Ou(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(R.UNKNOWN,s.toString())})}Jo(t,e,n,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(t,Ou(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(R.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},bc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ht(e),this._a=!1):x("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var bn="RemoteStore",Sc=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{n.enqueueAndForget(async()=>{en(this)&&(x(bn,"Restarting streams for network reachability change."),await(async function(l){let d=O(l);d.Ia.add(4),await Sr(d),d.Aa.set("Unknown"),d.Ia.delete(4),await Xi(d)})(this))})}),this.Aa=new bc(n,i)}};async function Xi(r){if(en(r))for(let t of r.da)await t(!0)}async function Sr(r){for(let t of r.da)await t(!1)}function Wo(r,t){let e=O(r);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),Pl(e)?Rl(e):Pr(e).x_()&&Sl(e,t))}function yr(r,t){let e=O(r),n=Pr(e);e.Ta.delete(t),n.x_()&&Mg(e,t),e.Ta.size===0&&(n.x_()?n.B_():en(e)&&e.Aa.set("Unknown"))}function Sl(r,t){if(r.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Pr(r).H_(t)}function Mg(r,t){r.Ra.$e(t),Pr(r).Y_(t)}function Rl(r){r.Ra=new Nu({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>r.Ta.get(t)||null,lt:()=>r.datastore.serializer.databaseId}),Pr(r).start(),r.Aa.aa()}function Pl(r){return en(r)&&!Pr(r).M_()&&r.Ta.size>0}function en(r){return O(r).Ia.size===0}function Lg(r){r.Ra=void 0}async function Qy(r){r.Aa.set("Online")}async function Wy(r){r.Ta.forEach((t,e)=>{Sl(r,t)})}async function Hy(r,t){Lg(r),Pl(r)?(r.Aa.la(t),Rl(r)):r.Aa.set("Unknown")}async function Xy(r,t,e){if(r.Aa.set("Online"),t instanceof eo&&t.state===2&&t.cause)try{await(async function(i,s){let a=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.Ta.delete(u),i.Ra.removeTarget(u))})(r,t)}catch(n){x(bn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Eo(r,n)}else if(t instanceof tr?r.Ra.Ye(t):t instanceof to?r.Ra.it(t):r.Ra.et(t),!e.isEqual(U.min()))try{let n=await Pg(r.localStore);e.compareTo(n)>=0&&await(function(s,a){let u=s.Ra.Pt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.Ta.get(d);f&&s.Ta.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.Ta.get(l);if(!f)return;s.Ta.set(l,f.withResumeToken(mt.EMPTY_BYTE_STRING,f.snapshotVersion)),Mg(s,l);let g=new mr(f.target,l,d,f.sequenceNumber);Sl(s,g)}),s.remoteSyncer.applyRemoteEvent(u)})(r,e)}catch(n){x(bn,"Failed to raise snapshot:",n),await Eo(r,n)}}async function Eo(r,t,e){if(!Ze(t))throw t;r.Ia.add(1),await Sr(r),r.Aa.set("Offline"),e||(e=()=>Pg(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{x(bn,"Retrying IndexedDB access"),await e(),r.Ia.delete(1),await Xi(r)})}function qg(r,t){return t().catch(e=>Eo(r,e,t))}async function Rr(r){let t=O(r),e=Xe(t),n=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:Le;for(;Jy(t);)try{let i=await zy(t.localStore,n);if(i===null){t.Pa.length===0&&e.B_();break}n=i.batchId,Yy(t,i)}catch(i){await Eo(t,i)}Ug(t)&&Bg(t)}function Jy(r){return en(r)&&r.Pa.length<10}function Yy(r,t){r.Pa.push(t);let e=Xe(r);e.x_()&&e.Z_&&e.X_(t.mutations)}function Ug(r){return en(r)&&!Xe(r).M_()&&r.Pa.length>0}function Bg(r){Xe(r).start()}async function Zy(r){Xe(r).na()}async function tw(r){let t=Xe(r);for(let e of r.Pa)t.X_(e.mutations)}async function ew(r,t,e){let n=r.Pa.shift(),i=Cu.from(n,t,e);await qg(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await Rr(r)}async function nw(r,t){t&&Xe(r).Z_&&await(async function(n,i){if((function(a){return ng(a)&&a!==R.ABORTED})(i.code)){let s=n.Pa.shift();Xe(n).N_(),await qg(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Rr(n)}})(r,t),Ug(r)&&Bg(r)}async function $f(r,t){let e=O(r);e.asyncQueue.verifyOperationInProgress(),x(bn,"RemoteStore received new credentials");let n=en(e);e.Ia.add(3),await Sr(e),n&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await Xi(e)}async function Rc(r,t){let e=O(r);t?(e.Ia.delete(2),await Xi(e)):t||(e.Ia.add(2),await Sr(e),e.Aa.set("Unknown"))}function Pr(r){return r.Va||(r.Va=(function(e,n,i){let s=O(e);return s.ia(),new Ic(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Zo:Qy.bind(null,r),e_:Wy.bind(null,r),n_:Hy.bind(null,r),J_:Xy.bind(null,r)}),r.da.push(async t=>{t?(r.Va.N_(),Pl(r)?Rl(r):r.Aa.set("Unknown")):(await r.Va.stop(),Lg(r))})),r.Va}function Xe(r){return r.ma||(r.ma=(function(e,n,i){let s=O(e);return s.ia(),new Tc(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:Zy.bind(null,r),n_:nw.bind(null,r),ea:tw.bind(null,r),ta:ew.bind(null,r)}),r.da.push(async t=>{t?(r.ma.N_(),await Rr(r)):(await r.ma.stop(),r.Pa.length>0&&(x(bn,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))})),r.ma}var Pc=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Vr(r,t){if(ht("AsyncQueue",`${t}: ${r}`),Ze(r))return new V(R.UNAVAILABLE,`${t}: ${r}`);throw r}var Ao=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=ui(),this.sortedSet=new st(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var bo=class{constructor(){this.fa=new st(F.comparator)}track(t){let e=t.doc.key,n=this.fa.get(e);n?t.type!==0&&n.type===3?this.fa=this.fa.insert(e,t):t.type===3&&n.type!==1?this.fa=this.fa.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.fa=this.fa.remove(e):t.type===1&&n.type===2?this.fa=this.fa.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):M(63341,{At:t,ga:n}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,n)=>{t.push(n)}),t}},wr=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Ao.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Qi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var Vc=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},Cc=class{constructor(){this.queries=Qf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,n){let i=O(e),s=i.queries;i.queries=Qf(),s.forEach((a,u)=>{for(let l of u.wa)l.onError(n)})})(this,new V(R.ABORTED,"Firestore shutting down"))}};function Qf(){return new Zt(r=>jm(r),Qi)}async function Vl(r,t){let e=O(r),n=3,i=t.query,s=e.queries.get(i);s?!s.Sa()&&t.ba()&&(n=2):(s=new Vc,n=t.ba()?0:1);try{switch(n){case 0:s.ya=await e.onListen(i,!0);break;case 1:s.ya=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(a){let u=Vr(a,`Initialization of query '${Qn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.wa.push(t),t.va(e.onlineState),s.ya&&t.Ca(s.ya)&&xl(e)}async function Cl(r,t){let e=O(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.wa.indexOf(t);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=t.ba()?0:1:!s.Sa()&&t.ba()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function rw(r,t){let e=O(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.wa)u.Ca(i)&&(n=!0);a.ya=i}}n&&xl(e)}function iw(r,t,e){let n=O(r),i=n.queries.get(t);if(i)for(let s of i.wa)s.onError(e);n.queries.delete(t)}function xl(r){r.Da.forEach(t=>{t.next()})}var xc,Wf;(Wf=xc||(xc={})).Fa="default",Wf.Cache="cache";var Ui=class{constructor(t,e,n){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new wr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let n=e!=="Offline";return(!this.options.ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=wr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==xc.Cache}};var Dc=class{constructor(t,e){this.qa=t,this.byteLength=e}Qa(){return"metadata"in this.qa}};var So=class{constructor(t){this.serializer=t}Qs(t){return ae(this.serializer,t)}$s(t){return t.metadata.exists?cg(this.serializer,t.document,!1):wt.newNoDocument(this.Qs(t.metadata.name),this.Us(t.metadata.readTime))}Us(t){return ft(t)}},Nc=class{constructor(t,e){this.$a=t,this.serializer=e,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=jg(t)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.qa.namedQuery)this.Ua.push(t.qa.namedQuery);else if(t.qa.documentMetadata){this.Ka.push({metadata:t.qa.documentMetadata}),t.qa.documentMetadata.exists||++e;let n=H.fromString(t.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.qa.document&&(this.Ka[this.Ka.length-1].document=t.qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ga(t){let e=new Map,n=new So(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Qs(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||K()).add(s);e.set(a,u)}}return e}async za(t){let e=await Gy(t,new So(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let i of this.Ua)await Ky(t,i,n.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:e}}};function jg(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Ro=class{constructor(t){this.key=t}},Po=class{constructor(t){this.key=t}},Vo=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=K(),this.mutatedKeys=K(),this.Xa=Gm(t),this.eu=new Ao(this.Xa)}get tu(){return this.Ha}nu(t,e){let n=e?e.ru:new bo,i=e?e.eu:this.eu,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),S=Wi(this.query,g)?g:null,C=!!_&&this.mutatedKeys.has(_.key),N=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),D=!1;_&&S?_.data.isEqual(S.data)?C!==N&&(n.track({type:3,doc:S}),D=!0):this.iu(_,S)||(n.track({type:2,doc:S}),D=!0,(l&&this.Xa(S,l)>0||d&&this.Xa(S,d)<0)&&(u=!0)):!_&&S?(n.track({type:0,doc:S}),D=!0):_&&!S&&(n.track({type:1,doc:_}),D=!0,(l||d)&&(u=!0)),D&&(S?(a=a.add(S),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:s}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let a=t.ru.pa();a.sort((f,g)=>(function(S,C){let N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{At:D})}};return N(S)-N(C)})(f.type,g.type)||this.Xa(f.doc,g.doc)),this.su(n),i=i!=null&&i;let u=e&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new wr(this.query,t.eu,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new bo,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=K(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let e=[];return t.forEach(n=>{this.Za.has(n)||e.push(new Po(n))}),this.Za.forEach(n=>{t.has(n)||e.push(new Ro(n))}),e}uu(t){this.Ha=t.qs,this.Za=K();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return wr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},nn="SyncEngine",kc=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},Fc=class{constructor(t){this.key=t,this.lu=!1}},Oc=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Zt(u=>jm(u),Qi),this.Tu=new Map,this.Iu=new Set,this.du=new st(F.comparator),this.Eu=new Map,this.Au=new Oi,this.Ru={},this.Vu=new Map,this.mu=gr.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};async function sw(r,t,e=!0){let n=Ho(r),i,s=n.Pu.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await zg(n,t,e,!0),i}async function ow(r,t){let e=Ho(r);await zg(e,t,!0,!1)}async function zg(r,t,e,n){let i=await pr(r.localStore,Ft(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=await Dl(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Wo(r.remoteStore,i),u}async function Dl(r,t,e,n,i){r.gu=(g,_,S)=>(async function(N,D,j,B){let q=D.view.nu(j);q.Ds&&(q=await _o(N.localStore,D.query,!1).then(({documents:v})=>D.view.nu(v,q)));let $=B&&B.targetChanges.get(D.targetId),W=B&&B.targetMismatches.get(D.targetId)!=null,G=D.view.applyChanges(q,N.isPrimaryClient,$,W);return Mc(N,D.targetId,G._u),G.snapshot})(r,g,_,S);let s=await _o(r.localStore,t,!0),a=new Vo(t,s.qs),u=a.nu(s.documents),l=Di.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);Mc(r,e,d._u);let f=new kc(t,e,a);return r.Pu.set(t,f),r.Tu.has(e)?r.Tu.get(e).push(t):r.Tu.set(e,[t]),d.snapshot}async function aw(r,t,e){let n=O(r),i=n.Pu.get(t),s=n.Tu.get(i.targetId);if(s.length>1)return n.Tu.set(i.targetId,s.filter(a=>!Qi(a,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await _r(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&yr(n.remoteStore,i.targetId),vr(n,i.targetId)}).catch(Ye)):(vr(n,i.targetId),await _r(n.localStore,i.targetId,!0))}async function uw(r,t){let e=O(r),n=e.Pu.get(t),i=e.Tu.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),yr(e.remoteStore,n.targetId))}async function cw(r,t,e){let n=Ol(r);try{let i=await(function(a,u){let l=O(a),d=rt.now(),f=u.reduce((S,C)=>S.add(C.key),K()),g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",S=>{let C=qt(),N=K();return l.Os.getEntries(S,f).next(D=>{C=D,C.forEach((j,B)=>{B.isValidDocument()||(N=N.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(S,C)).next(D=>{g=D;let j=[];for(let B of u){let q=Ty(B,g.get(B.key).overlayedDocument);q!=null&&j.push(new te(B.key,q,Fm(q.value.mapValue),lt.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,j,u)}).next(D=>{_=D;let j=D.applyToLocalDocumentSet(g,N);return l.documentOverlayCache.saveOverlays(S,D.batchId,j)})}).then(()=>({batchId:_.batchId,changes:$m(g)}))})(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),(function(a,u,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new st(z)),d=d.insert(u,l),a.Ru[a.currentUser.toKey()]=d})(n,i.batchId,e),await Se(n,i.changes),await Rr(n.remoteStore)}catch(i){let s=Vr(i,"Failed to persist write");e.reject(s)}}async function Gg(r,t){let e=O(r);try{let n=await jy(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Eu.get(s);a&&(L(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?L(a.lu,14607):i.removedDocuments.size>0&&(L(a.lu,42227),a.lu=!1))}),await Se(e,n,t)}catch(n){await Ye(n)}}function Hf(r,t,e){let n=O(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.Pu.forEach((s,a)=>{let u=a.view.va(t);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let l=O(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let _ of g.wa)_.va(u)&&(d=!0)}),d&&xl(l)})(n.eventManager,t),i.length&&n.hu.J_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function lw(r,t,e){let n=O(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Eu.get(t),s=i&&i.key;if(s){let a=new st(F.comparator);a=a.insert(s,wt.newNoDocument(s,U.min()));let u=K().add(s),l=new xi(U.min(),new Map,new st(z),a,u);await Gg(n,l),n.du=n.du.remove(s),n.Eu.delete(t),Fl(n)}else await _r(n.localStore,t,!1).then(()=>vr(n,t,e)).catch(Ye)}async function hw(r,t){let e=O(r),n=t.batch.batchId;try{let i=await By(e.localStore,t);kl(e,n,null),Nl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await Se(e,i)}catch(i){await Ye(i)}}async function dw(r,t,e){let n=O(r);try{let i=await(function(a,u){let l=O(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(L(g!==null,37113),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})})(n.localStore,t);kl(n,t,e),Nl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await Se(n,i)}catch(i){await Ye(i)}}async function fw(r,t){let e=O(r);en(e.remoteStore)||x(nn,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await(function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))})(e.localStore);if(n===Le)return void t.resolve();let i=e.Vu.get(n)||[];i.push(t),e.Vu.set(n,i)}catch(n){let i=Vr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}}function Nl(r,t){(r.Vu.get(t)||[]).forEach(e=>{e.resolve()}),r.Vu.delete(t)}function kl(r,t,e){let n=O(r),i=n.Ru[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Ru[n.currentUser.toKey()]=i}}function vr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Tu.get(t))r.Pu.delete(n),e&&r.hu.pu(n,e);r.Tu.delete(t),r.isPrimaryClient&&r.Au.zr(t).forEach(n=>{r.Au.containsKey(n)||Kg(r,n)})}function Kg(r,t){r.Iu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(yr(r.remoteStore,e),r.du=r.du.remove(t),r.Eu.delete(e),Fl(r))}function Mc(r,t,e){for(let n of e)n instanceof Ro?(r.Au.addReference(n.key,t),mw(r,n)):n instanceof Po?(x(nn,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,t),r.Au.containsKey(n.key)||Kg(r,n.key)):M(19791,{yu:n})}function mw(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Iu.has(n)||(x(nn,"New document in limbo: "+e),r.Iu.add(n),Fl(r))}function Fl(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Iu.values().next().value;r.Iu.delete(t);let e=new F(H.fromString(t)),n=r.mu.next();r.Eu.set(n,new Fc(e)),r.du=r.du.insert(e,n),Wo(r.remoteStore,new mr(Ft(br(e.path)),n,"TargetPurposeLimboResolution",Gt.ue))}}async function Se(r,t,e){let n=O(r),i=[],s=[],a=[];n.Pu.isEmpty()||(n.Pu.forEach((u,l)=>{a.push(n.gu(l,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){i.push(d);let g=dc.Es(l.targetId,d);s.push(g)}}))}),await Promise.all(a),n.hu.J_(i),await(async function(l,d){let f=O(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>b.forEach(d,_=>b.forEach(_.Is,S=>f.persistence.referenceDelegate.addReference(g,_.targetId,S)).next(()=>b.forEach(_.ds,S=>f.persistence.referenceDelegate.removeReference(g,_.targetId,S)))))}catch(g){if(!Ze(g))throw g;x(bl,"Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let S=f.Fs.get(_),C=S.snapshotVersion,N=S.withLastLimboFreeSnapshotVersion(C);f.Fs=f.Fs.insert(_,N)}}})(n.localStore,s))}async function gw(r,t){let e=O(r);if(!e.currentUser.isEqual(t)){x(nn,"User change. New user:",t.toKey());let n=await Rg(e.localStore,t);e.currentUser=t,(function(s,a){s.Vu.forEach(u=>{u.forEach(l=>{l.reject(new V(R.CANCELLED,a))})}),s.Vu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await Se(e,n.Bs)}}function pw(r,t){let e=O(r),n=e.Eu.get(t);if(n&&n.lu)return K().add(n.key);{let i=K(),s=e.Tu.get(t);if(!s)return i;for(let a of s){let u=e.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}async function _w(r,t){let e=O(r),n=await _o(e.localStore,t.query,!0),i=t.view.uu(n);return e.isPrimaryClient&&Mc(e,t.targetId,i._u),i}async function yw(r,t){let e=O(r);return xg(e.localStore,t).then(n=>Se(e,n))}async function ww(r,t,e,n){let i=O(r),s=await(function(u,l){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Xn(g,l).next(_=>_?d.localDocuments.getDocuments(g,_):b.resolve(null)))})(i.localStore,t);s!==null?(e==="pending"?await Rr(i.remoteStore):e==="acknowledged"||e==="rejected"?(kl(i,t,n||null),Nl(i,t),(function(u,l){O(O(u).mutationQueue).rr(l)})(i.localStore,t)):M(6720,"Unknown batchState",{wu:e}),await Se(i,s)):x(nn,"Cannot apply mutation batch with id: "+t)}async function vw(r,t){let e=O(r);if(Ho(e),Ol(e),t===!0&&e.fu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=await Xf(e,n.toArray());e.fu=!0,await Rc(e.remoteStore,!0);for(let s of i)Wo(e.remoteStore,s)}else if(t===!1&&e.fu!==!1){let n=[],i=Promise.resolve();e.Tu.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(vr(e,a),_r(e.localStore,a,!0))),yr(e.remoteStore,a)}),await i,await Xf(e,n),(function(a){let u=O(a);u.Eu.forEach((l,d)=>{yr(u.remoteStore,d)}),u.Au.jr(),u.Eu=new Map,u.du=new st(F.comparator)})(e),e.fu=!1,await Rc(e.remoteStore,!1)}}async function Xf(r,t,e){let n=O(r),i=[],s=[];for(let a of t){let u,l=n.Tu.get(a);if(l&&l.length!==0){u=await pr(n.localStore,Ft(l[0]));for(let d of l){let f=n.Pu.get(d),g=await _w(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=await Cg(n.localStore,a);u=await pr(n.localStore,d),await Dl(n,$g(d),a,!1,u.resumeToken)}i.push(u)}return n.hu.J_(s),i}function $g(r){return Bm(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Iw(r){return(function(e){return O(O(e).persistence).Ps()})(O(r).localStore)}async function Tw(r,t,e,n){let i=O(r);if(i.fu)return void x(nn,"Ignoring unexpected query state notification.");let s=i.Tu.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=await xg(i.localStore,zm(s[0])),u=xi.createSynthesizedRemoteEventForCurrentChange(t,e==="current",mt.EMPTY_BYTE_STRING);await Se(i,a,u);break}case"rejected":await _r(i.localStore,t,!0),vr(i,t,n);break;default:M(64155,e)}}async function Ew(r,t,e){let n=Ho(r);if(n.fu){for(let i of t){if(n.Tu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){x(nn,"Adding an already active target "+i);continue}let s=await Cg(n.localStore,i),a=await pr(n.localStore,s);await Dl(n,$g(s),a.targetId,!1,a.resumeToken),Wo(n.remoteStore,a)}for(let i of e)n.Tu.has(i)&&await _r(n.localStore,i,!1).then(()=>{yr(n.remoteStore,i),vr(n,i)}).catch(Ye)}}function Ho(r){let t=O(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=pw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lw.bind(null,t),t.hu.J_=rw.bind(null,t.eventManager),t.hu.pu=iw.bind(null,t.eventManager),t}function Ol(r){let t=O(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=hw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=dw.bind(null,t),t}function Aw(r,t,e){let n=O(r);(async function(s,a,u){try{let l=await a.getMetadata();if(await(function(S,C){let N=O(S),D=ft(C.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",j=>N.Ti.getBundleMetadata(j,C.id)).then(j=>!!j&&j.createTime.compareTo(D)>=0)})(s.localStore,l))return await a.close(),u._completeWith((function(S){return{taskState:"Success",documentsLoaded:S.totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}})(l)),Promise.resolve(new Set);u._updateProgress(jg(l));let d=new Nc(l,a.serializer),f=await a.Su();for(;f;){let _=await d.Wa(f);_&&u._updateProgress(_),f=await a.Su()}let g=await d.za(s.localStore);return await Se(s,g.Ja,void 0),await(function(S,C){let N=O(S);return N.persistence.runTransaction("Save bundle","readwrite",D=>N.Ti.saveBundleMetadata(D,C))})(s.localStore,l),u._completeWith(g.progress),Promise.resolve(g.ja)}catch(l){return Bt(nn,`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Ml=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Hi(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,n){return null}Fu(e,n){return null}vu(e){return Sg(this.persistence,new po,e.initialUser,this.serializer)}Du(e){return new Mi(mo.Vi,this.serializer)}bu(e){return new vo}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return r.provider={build:()=>new r},r})(),Lc=class extends Ml{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){L(this.persistence.referenceDelegate instanceof go,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new lo(n,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new Mi(n=>go.Vi(n,e),this.serializer)}},Co=class extends Ml{constructor(t,e,n){super(),this.Mu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Mu.initialize(this,t),await Ol(this.Mu.syncEngine),await Rr(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(t){return Sg(this.persistence,new po,t.initialUser,this.serializer)}Cu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new lo(n,t.asyncQueue,e)}Fu(t,e){let n=new lu(e,this.persistence);return new cu(t.asyncQueue,n)}Du(t){let e=Al(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new hc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Og(),Ls(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(t){return new vo}},qc=class extends Co{constructor(t,e){super(t,e,!1),this.Mu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);let e=this.Mu.syncEngine;this.sharedClientState instanceof _i&&(this.sharedClientState.syncEngine={Do:ww.bind(null,e),vo:Tw.bind(null,e),Co:Ew.bind(null,e),Ps:Iw.bind(null,e),bo:yw.bind(null,e)},await this.sharedClientState.start()),await this.persistence.ji(async n=>{await vw(this.Mu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())})}bu(t){let e=Og();if(!_i.C(e))throw new V(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Al(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new _i(e,t.asyncQueue,n,t.clientId,t.initialUser)}},Ll=(()=>{class r{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Hf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=gw.bind(null,this.syncEngine),await Rc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Cc})()}createDatastore(e){let n=Hi(e.databaseInfo.databaseId),i=(function(a){return new vc(a)})(e.databaseInfo);return(function(a,u,l,d){return new Ac(a,u,l,d)})(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return(function(i,s,a,u,l){return new Sc(i,s,a,u,l)})(this.localStore,this.datastore,e.asyncQueue,n=>Hf(this.syncEngine,n,0),(function(){return Io.C()?new Io:new pc})())}createSyncEngine(e,n){return(function(s,a,u,l,d,f,g){let _=new Oc(s,a,u,l,d,f);return g&&(_.fu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await(async function(s){let a=O(s);x(bn,"RemoteStore shutting down."),a.Ia.add(5),await Sr(a),a.Ea.shutdown(),a.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}return r.provider={build:()=>new r},r})();function Jf(r,t=10240){let e=0;return{async read(){if(e<r.byteLength){let n={value:r.slice(e,e+t),done:!1};return e+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}var Ir=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):ht("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Uc=class{constructor(t,e){this.Nu=t,this.serializer=e,this.metadata=new vt,this.buffer=new Uint8Array,this.Bu=(function(){return new TextDecoder("utf-8")})(),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){let t=await this.ku();if(t===null)return null;let e=this.Bu.decode(t),n=Number(e);isNaN(n)&&this.qu(`length string (${e}) is not valid number`);let i=await this.Qu(n);return new Dc(JSON.parse(i),t.length+n)}$u(){return this.buffer.findIndex(t=>t===123)}async ku(){for(;this.$u()<0&&!await this.Uu(););if(this.buffer.length===0)return null;let t=this.$u();t<0&&this.qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Qu(t){for(;this.buffer.length<t;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");let e=this.Bu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}qu(t){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${t}`)}async Uu(){let t=await this.Nu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}};var Bc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=await(async function(i,s){let a=O(i),u={documents:s.map(g=>Ni(a.serializer,g))},l=await a.Jo("BatchGetDocuments",a.serializer.databaseId,H.emptyPath(),u,s.length),d=new Map;l.forEach(g=>{let _=Py(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());L(!!_,55234,{key:g}),f.push(_)}),f})(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new He(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=F.fromPath(n);this.mutations.push(new Pi(i,this.precondition(i)))}),await(async function(n,i){let s=O(n),a={writes:i.map(u=>ki(s.serializer,u))};await s.Wo("Commit",s.serializer.databaseId,H.emptyPath(),a)})(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw M(50498,{Wu:t.constructor.name});e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new V(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?lt.exists(!1):lt.updateTime(e):lt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new V(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lt.updateTime(e)}return lt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var jc=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.Gu=n.maxAttempts,this.F_=new qi(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let t=new Bc(this.datastore),e=this.Ju(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.Hu(i)}))}).catch(n=>{this.Hu(n)})})}Ju(t){try{let e=this.updateFunction(t);return!Gi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!ng(e)}return!1}};var Je="FirestoreClient",zc=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=_t.UNAUTHENTICATED,this.clientId=yi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async a=>{x(Je,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(x(Je,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Vr(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}};async function Ya(r,t){r.asyncQueue.verifyOperationInProgress(),x(Je,"Initializing OfflineComponentProvider");let e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await Rg(t.localStore,i),n=i)}),t.persistence.setDatabaseDeletedListener(()=>{Bt("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{x("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Bt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),r._offlineComponents=t}async function Yf(r,t){r.asyncQueue.verifyOperationInProgress();let e=await ql(r);x(Je,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>$f(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>$f(t.remoteStore,i)),r._onlineComponents=t}async function ql(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){x(Je,"Using user provided OfflineComponentProvider");try{await Ya(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!(function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(e))throw e;Bt("Error using user provided cache. Falling back to memory cache: "+e),await Ya(r,new Ml)}}else x(Je,"Using default OfflineComponentProvider"),await Ya(r,new Lc(void 0));return r._offlineComponents}async function Xo(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(x(Je,"Using user provided OnlineComponentProvider"),await Yf(r,r._uninitializedComponentsProvider._online)):(x(Je,"Using default OnlineComponentProvider"),await Yf(r,new Ll))),r._onlineComponents}function Qg(r){return ql(r).then(t=>t.persistence)}function Ul(r){return ql(r).then(t=>t.localStore)}function Wg(r){return Xo(r).then(t=>t.remoteStore)}function Bl(r){return Xo(r).then(t=>t.syncEngine)}function bw(r){return Xo(r).then(t=>t.datastore)}async function Tr(r){let t=await Xo(r),e=t.eventManager;return e.onListen=sw.bind(null,t.syncEngine),e.onUnlisten=aw.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=ow.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=uw.bind(null,t.syncEngine),e}function Sw(r){return r.asyncQueue.enqueue(async()=>{let t=await Qg(r),e=await Wg(r);return t.setNetworkEnabled(!0),(function(i){let s=O(i);return s.Ia.delete(0),Xi(s)})(e)})}function Rw(r){return r.asyncQueue.enqueue(async()=>{let t=await Qg(r),e=await Wg(r);return t.setNetworkEnabled(!1),(async function(i){let s=O(i);s.Ia.add(0),await Sr(s),s.Aa.set("Offline")})(e)})}function Pw(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(async()=>(async function(i,s,a){try{let u=await(function(d,f){let g=O(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))})(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new V(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=Vr(u,`Failed to get document '${s} from cache`);a.reject(l)}})(await Ul(r),t,e)),e.promise}function Hg(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(async()=>(function(s,a,u,l,d){let f=new Ir({next:_=>{f.Ou(),a.enqueueAndForget(()=>Cl(s,g));let S=_.docs.has(u);!S&&_.fromCache?d.reject(new V(R.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&_.fromCache&&l&&l.source==="server"?d.reject(new V(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ui(br(u.path),f,{includeMetadataChanges:!0,ka:!0});return Vl(s,g)})(await Tr(r),r.asyncQueue,t,e,n)),n.promise}function Vw(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(async()=>(async function(i,s,a){try{let u=await _o(i,s,!0),l=new Vo(s,u.qs),d=l.nu(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=Vr(u,`Failed to execute query '${s} against cache`);a.reject(l)}})(await Ul(r),t,e)),e.promise}function Xg(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(async()=>(function(s,a,u,l,d){let f=new Ir({next:_=>{f.Ou(),a.enqueueAndForget(()=>Cl(s,g)),_.fromCache&&l.source==="server"?d.reject(new V(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ui(u,f,{includeMetadataChanges:!0,ka:!0});return Vl(s,g)})(await Tr(r),r.asyncQueue,t,e,n)),n.promise}function Cw(r,t){let e=new Ir(t);return r.asyncQueue.enqueueAndForget(async()=>(function(i,s){O(i).Da.add(s),s.next()})(await Tr(r),e)),()=>{e.Ou(),r.asyncQueue.enqueueAndForget(async()=>(function(i,s){O(i).Da.delete(s)})(await Tr(r),e))}}function xw(r,t,e,n){let i=(function(a,u){let l;return l=typeof a=="string"?ol().encode(a):a,(function(f,g){return new Uc(f,g)})((function(f,g){if(f instanceof Uint8Array)return Jf(f,g);if(f instanceof ArrayBuffer)return Jf(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(l),u)})(e,Hi(t));r.asyncQueue.enqueueAndForget(async()=>{Aw(await Bl(r),i,n)})}function Dw(r,t){return r.asyncQueue.enqueue(async()=>(function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Ti.getNamedQuery(a,i))})(await Ul(r),t))}function Jg(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Zf=new Map;var Yg="firestore.googleapis.com",tm=!0,xo=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new V(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Yg,this.ssl=tm}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:tm;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=wg;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<qy)throw new V(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}ul("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jg((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,i){return n.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Sn=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new V(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xo(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Za;switch(n.type){case"firstParty":return new ru(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new V(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){let n=Zf.get(e);n&&(x("ComponentProvider","Removing Datastore"),Zf.delete(e),n.terminate())})(this),Promise.resolve()}};function Zg(r,t,e,n={}){var i;r=J(r,Sn);let s=Fa(t),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),l=`${t}:${e}`;s&&(_d(`https://${l}`),wd("Firestore",!0)),a.host!==Yg&&a.host!==l&&Bt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:n});if(!Ts(d,u)&&(r._setSettings(d),n.mockUserToken)){let f,g;if(typeof n.mockUserToken=="string")f=n.mockUserToken,g=_t.MOCK_USER;else{f=yd(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let _=n.mockUserToken.sub||n.mockUserToken.user_id;if(!_)throw new V(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new _t(_)}r._authCredentials=new tu(new qs(f,g))}}var At=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},tt=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ue(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(zi(e,r._jsonSchema))return new r(t,n||null,new F(H.fromString(e.referencePath)))}};tt._jsonSchemaVersion="firestore/documentReference/1.0",tt._jsonSchema={type:yt("string",tt._jsonSchemaVersion),referencePath:yt("string")};var ue=class r extends At{constructor(t,e,n){super(t,e,br(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new tt(this.firestore,null,new F(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function jl(r,t,...e){if(r=ct(r),al("collection","path",t),r instanceof Sn){let n=H.fromString(t,...e);return Qd(n),new ue(r,null,n)}{if(!(r instanceof tt||r instanceof ue))throw new V(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return Qd(n),new ue(r.firestore,null,n)}}function tp(r,t){if(r=J(r,Sn),al("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(R.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(r,null,(function(n){return new Yt(H.emptyPath(),n)})(t))}function Ji(r,t,...e){if(r=ct(r),arguments.length===1&&(t=yi.newId()),al("doc","path",t),r instanceof Sn){let n=H.fromString(t,...e);return $d(n),new tt(r,null,new F(n))}{if(!(r instanceof tt||r instanceof ue))throw new V(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return $d(n),new tt(r.firestore,r instanceof ue?r.converter:null,new F(n))}}function zl(r,t){return r=ct(r),t=ct(t),(r instanceof tt||r instanceof ue)&&(t instanceof tt||t instanceof ue)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function Gl(r,t){return r=ct(r),t=ct(t),r instanceof At&&t instanceof At&&r.firestore===t.firestore&&Qi(r._query,t._query)&&r.converter===t.converter}var em="AsyncQueue",Do=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new qi(this,"async_queue_retry"),this.oc=()=>{let n=Ls();n&&x(em,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=t;let e=Ls();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=Ls();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new vt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!Ze(t))throw t;x(em,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(n=>{throw this.tc=n,this.nc=!1,ht("INTERNAL UNHANDLED ERROR: ",nm(n)),n}).then(n=>(this.nc=!1,n))));return this._c=e,e}enqueueAfterDelay(t,e,n){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let i=Pc.createAndSchedule(this,t,e,n,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&M(47125,{hc:nm(this.tc)})}verifyOperationInProgress(){}async Pc(){let t;do t=this._c,await t;while(t!==this._c)}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function nm(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function Gc(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1})(r,["next","error","complete"])}var Kc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new vt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var ep=-1,at=class extends Sn{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Do,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Do(t),this._firestoreClient=void 0,await t}}};function bt(r){if(r._terminated)throw new V(R.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||np(r),r._firestoreClient}function np(r){var t,e,n;let i=r._freezeSettings(),s=(function(u,l,d,f){return new mu(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Jg(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)})(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new zc(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&(function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}})(r._componentsProvider))}function rp(r,t){Bt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return sp(r,Ll.provider,{build:n=>new Co(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function ip(r){Bt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();sp(r,Ll.provider,{build:e=>new qc(e,t.cacheSizeBytes)})}function sp(r,t,e){if((r=J(r,at))._firestoreClient||r._terminated)throw new V(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new V(R.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},np(r)}function op(r){if(r._initialized&&!r._terminated)throw new V(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new vt;return r._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await(async function(n){if(!je.C())return Promise.resolve();let i=n+bg;await je.delete(i)})(Al(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function ap(r){return(function(e){let n=new vt;return e.asyncQueue.enqueueAndForget(async()=>fw(await Bl(e),n)),n.promise})(bt(r=J(r,at)))}function up(r){return Sw(bt(r=J(r,at)))}function cp(r){return Rw(bt(r=J(r,at)))}function lp(r,t){let e=bt(r=J(r,at)),n=new Kc;return xw(e,r._databaseId,t,n),n}function hp(r,t){return Dw(bt(r=J(r,at)),t).then(e=>e?new At(r,null,e.query):null)}var $t=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(mt.fromBase64String(t))}catch(e){throw new V(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(zi(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};$t._jsonSchemaVersion="firestore/bytes/1.0",$t._jsonSchema={type:yt("string",$t._jsonSchemaVersion),bytes:yt("string")};var ee=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new V(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ae=class{constructor(t){this._methodName=t}};var ce=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(zi(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};ce._jsonSchemaVersion="firestore/geoPoint/1.0",ce._jsonSchema={type:yt("string",ce._jsonSchemaVersion),latitude:yt("number"),longitude:yt("number")};var qe=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return(function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0})(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(zi(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new V(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};qe._jsonSchemaVersion="firestore/vectorValue/1.0",qe._jsonSchema={type:yt("string",qe._jsonSchemaVersion),vectorValues:yt("object")};var Nw=/^__.*__$/,$c=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new te(t,this.data,this.fieldMask,e,this.fieldTransforms):new We(t,this.data,e,this.fieldTransforms)}},No=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new te(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function dp(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ec:r})}}var ko=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:n,mc:!1});return i.fc(t),i}gc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:n,mc:!1});return i.Ac(),i}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return Fo(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(dp(this.Ec)&&Nw.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},Qc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Hi(t)}Dc(t,e,n,i=!1){return new ko({Ec:t,methodName:e,bc:n,path:dt.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Vn(r){let t=r._freezeSettings(),e=Hi(r._databaseId);return new Qc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Jo(r,t,e,n,i,s={}){let a=r.Dc(s.merge||s.mergeFields?2:0,t,e,i);Ql("Data must be an object, but it was:",a,n);let u=gp(n,a),l,d;if(s.merge)l=new Kt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=Yc(t,g,e);if(!a.contains(_))throw new V(R.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);_p(f,_)||f.push(_)}l=new Kt(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new $c(new xt(u),l,d)}var Bi=class r extends Ae{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function fp(r,t,e){return new ko({Ec:3,bc:t.settings.bc,methodName:r._methodName,mc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Wc=class r extends Ae{_toFieldTransform(t){return new Tn(t.path,new $e)}isEqual(t){return t instanceof r}},Hc=class r extends Ae{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=fp(this,t,!0),n=this.vc.map(s=>Cn(s,e)),i=new Te(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&Ts(this.vc,t.vc)}},Xc=class r extends Ae{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=fp(this,t,!0),n=this.vc.map(s=>Cn(s,e)),i=new Ee(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&Ts(this.vc,t.vc)}},Jc=class r extends Ae{constructor(t,e){super(t),this.Cc=e}_toFieldTransform(t){let e=new Qe(t.serializer,Hm(t.serializer,this.Cc));return new Tn(t.path,e)}isEqual(t){return t instanceof r&&this.Cc===t.Cc}};function Kl(r,t,e,n){let i=r.Dc(1,t,e);Ql("Data must be an object, but it was:",i,n);let s=[],a=xt.empty();tn(n,(l,d)=>{let f=Wl(t,l,e);d=ct(d);let g=i.gc(f);if(d instanceof Bi)s.push(f);else{let _=Cn(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new Kt(s);return new No(a,u,i.fieldTransforms)}function $l(r,t,e,n,i,s){let a=r.Dc(1,t,e),u=[Yc(t,n,e)],l=[i];if(s.length%2!=0)throw new V(R.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Yc(t,s[_])),l.push(s[_+1]);let d=[],f=xt.empty();for(let _=u.length-1;_>=0;--_)if(!_p(d,u[_])){let S=u[_],C=l[_];C=ct(C);let N=a.gc(S);if(C instanceof Bi)d.push(S);else{let D=Cn(C,N);D!=null&&(d.push(S),f.set(S,D))}}let g=new Kt(d);return new No(f,g,a.fieldTransforms)}function mp(r,t,e,n=!1){return Cn(e,r.Dc(n?4:3,t))}function Cn(r,t){if(pp(r=ct(r)))return Ql("Unsupported field value:",t,r),gp(r,t);if(r instanceof Ae)return(function(n,i){if(!dp(i.Ec))throw i.wc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return(function(n,i){let s=[],a=0;for(let u of n){let l=Cn(u,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}})(r,t)}return(function(n,i){if((n=ct(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Hm(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=rt.fromDate(n);return{timestampValue:fr(i.serializer,s)}}if(n instanceof rt){let s=new rt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:fr(i.serializer,s)}}if(n instanceof ce)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof $t)return{bytesValue:ig(i.serializer,n._byteString)};if(n instanceof tt){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Il(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof qe)return(function(a,u){return{mapValue:{fields:{[gl]:{stringValue:pl},[ur]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.wc("VectorValues must only contain numeric values.");return vl(u.serializer,d)})}}}}}})(n,i);throw i.wc(`Unsupported field value: ${Bo(n)}`)})(r,t)}function gp(r,t){let e={};return Sm(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tn(r,(n,i)=>{let s=Cn(i,t.Vc(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function pp(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof rt||r instanceof ce||r instanceof $t||r instanceof tt||r instanceof Ae||r instanceof qe)}function Ql(r,t,e){if(!pp(e)||!cm(e)){let n=Bo(e);throw n==="an object"?t.wc(r+" a custom object"):t.wc(r+" "+n)}}function Yc(r,t,e){if((t=ct(t))instanceof ee)return t._internalPath;if(typeof t=="string")return Wl(r,t);throw Fo("Field path arguments must be of type string or ",r,!1,void 0,e)}var kw=new RegExp("[~\\*/\\[\\]]");function Wl(r,t,e){if(t.search(kw)>=0)throw Fo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new ee(...t.split("."))._internalPath}catch{throw Fo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Fo(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new V(R.INVALID_ARGUMENT,u+r+l)}function _p(r,t){return r.some(e=>e.isEqual(t))}var Rn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Zc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Yo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Zc=class extends Rn{data(){return super.data()}};function Yo(r,t){return typeof t=="string"?Wl(r,t):t instanceof ee?t._internalPath:t._delegate._internalPath}function yp(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new V(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ji=class{},Pn=class extends ji{};function Re(r,t,...e){let n=[];t instanceof ji&&n.push(t),n=n.concat(e),(function(s){let a=s.filter(l=>l instanceof tl).length,u=s.filter(l=>l instanceof Oo).length;if(a>1||a>0&&u>0)throw new V(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(let i of n)r=i._apply(r);return r}var Oo=class r extends Pn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Pp(t._query,e),new At(t.firestore,t.converter,Pu(t._query,e))}_parse(t){let e=Vn(t.firestore);return(function(s,a,u,l,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){im(g,f);let C=[];for(let N of g)C.push(rm(l,s,N));_={arrayValue:{values:C}}}else _=rm(l,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||im(g,f),_=mp(u,a,g,f==="in"||f==="not-in");return Q.create(d,f,_)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function wp(r,t,e){let n=t,i=Yo("where",r);return Oo._create(i,n,e)}var tl=class r extends ji{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:((function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)Pp(a,l),a=Pu(a,l)})(t._query,e),new At(t.firestore,t.converter,Pu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var el=class r extends Pn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=(function(i,s,a){if(i.startAt!==null)throw new V(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vn(s,a)})(t._query,this._field,this._direction);return new At(t.firestore,t.converter,(function(i,s){let a=i.explicitOrderBy.concat([s]);return new Yt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(t._query,e))}};function vp(r,t="asc"){let e=t,n=Yo("orderBy",r);return el._create(n,e)}var Mo=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new At(t.firestore,t.converter,Zs(t._query,this._limit,this._limitType))}};function Ip(r){return lm("limit",r),Mo._create("limit",r,"F")}function Tp(r){return lm("limitToLast",r),Mo._create("limitToLast",r,"L")}var Lo=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Rp(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,(function(i,s){return new Yt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(t._query,e))}};function Ep(...r){return Lo._create("startAt",r,!0)}function Ap(...r){return Lo._create("startAfter",r,!1)}var qo=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Rp(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,(function(i,s){return new Yt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)})(t._query,e))}};function bp(...r){return qo._create("endBefore",r,!1)}function Sp(...r){return qo._create("endAt",r,!0)}function Rp(r,t,e,n){if(e[0]=ct(e[0]),e[0]instanceof Rn)return(function(s,a,u,l,d){if(!l)throw new V(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Zn(s))if(g.field.isKeyField())f.push(wn(a,l.key));else{let _=l.data.field(g.field);if(Ko(_))throw new V(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let S=g.field.canonicalString();throw new V(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}f.push(_)}return new he(f,d)})(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=Vn(r.firestore);return(function(a,u,l,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new V(R.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let S=[];for(let C=0;C<f.length;C++){let N=f[C];if(_[C].field.isKeyField()){if(typeof N!="string")throw new V(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!yl(a)&&N.indexOf("/")!==-1)throw new V(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let D=a.path.child(H.fromString(N));if(!F.isDocumentKey(D))throw new V(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let j=new F(D);S.push(wn(u,j))}else{let D=mp(l,d,N);S.push(D)}}return new he(S,g)})(r._query,r.firestore._databaseId,i,t,e,n)}}function rm(r,t,e){if(typeof(e=ct(e))=="string"){if(e==="")throw new V(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yl(t)&&e.indexOf("/")!==-1)throw new V(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(H.fromString(e));if(!F.isDocumentKey(n))throw new V(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return wn(r,new F(n))}if(e instanceof tt)return wn(r,e._key);throw new V(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bo(e)}.`)}function im(r,t){if(!Array.isArray(r)||r.length===0)throw new V(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Pp(r,t){let e=(function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new V(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Er=class{convertValue(t,e="none"){switch(Ge(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ot(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ie(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw M(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return tn(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e[ur].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ot(a.doubleValue));return new qe(s)}convertGeoPoint(t){return new ce(ot(t.latitude),ot(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=$o(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(bi(t));default:return null}}convertTimestamp(t){let e=ve(t);return new rt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=H.fromString(t);L(gg(n),9688,{name:t});let i=new ze(n.get(1),n.get(3)),s=new F(n.popFirst(5));return i.isEqual(e)||ht(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Zo(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var nl=class extends Er{constructor(t){super(),this.firestore=t}convertBytes(t){return new $t(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}};var we=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ot=class r extends Rn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Ue(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Yo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};Ot._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ot._jsonSchema={type:yt("string",Ot._jsonSchemaVersion),bundleSource:yt("string","DocumentSnapshot"),bundleName:yt("string"),bundle:yt("string")};var Ue=class extends Ot{data(t={}){return super.data(t)}},Ut=class r{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new we(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Ue(this._firestore,this._userDataWriter,n.key,n,new we(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new V(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Ue(i._firestore,i._userDataWriter,u.doc.key,u.doc,new we(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new Ue(i._firestore,i._userDataWriter,u.doc.key,u.doc,new we(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Fw(u.type),doc:l,oldIndex:d,newIndex:f}})}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=yi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(e.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function Fw(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:r})}}function Hl(r,t){return r instanceof Ot&&t instanceof Ot?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Ut&&t instanceof Ut&&r._firestore===t._firestore&&Gl(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function Vp(r){r=J(r,tt);let t=J(r.firestore,at);return Hg(bt(t),r._key).then(e=>Zl(t,r,e))}Ut._jsonSchemaVersion="firestore/querySnapshot/1.0",Ut._jsonSchema={type:yt("string",Ut._jsonSchemaVersion),bundleSource:yt("string","QuerySnapshot"),bundleName:yt("string"),bundle:yt("string")};var be=class extends Er{constructor(t){super(),this.firestore=t}convertBytes(t){return new $t(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}};function Cp(r){r=J(r,tt);let t=J(r.firestore,at),e=bt(t),n=new be(t);return Pw(e,r._key).then(i=>new Ot(t,n,r._key,i,new we(i!==null&&i.hasLocalMutations,!0),r.converter))}function xp(r){r=J(r,tt);let t=J(r.firestore,at);return Hg(bt(t),r._key,{source:"server"}).then(e=>Zl(t,r,e))}function Dp(r){r=J(r,At);let t=J(r.firestore,at),e=bt(t),n=new be(t);return yp(r._query),Xg(e,r._query).then(i=>new Ut(t,n,r,i))}function Np(r){r=J(r,At);let t=J(r.firestore,at),e=bt(t),n=new be(t);return Vw(e,r._query).then(i=>new Ut(t,n,r,i))}function kp(r){r=J(r,At);let t=J(r.firestore,at),e=bt(t),n=new be(t);return Xg(e,r._query,{source:"server"}).then(i=>new Ut(t,n,r,i))}function Xl(r,t,e){r=J(r,tt);let n=J(r.firestore,at),i=Zo(r.converter,t,e);return Cr(n,[Jo(Vn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,lt.none())])}function Jl(r,t,e,...n){r=J(r,tt);let i=J(r.firestore,at),s=Vn(i),a;return a=typeof(t=ct(t))=="string"||t instanceof ee?$l(s,"updateDoc",r._key,t,e,n):Kl(s,"updateDoc",r._key,t),Cr(i,[a.toMutation(r._key,lt.exists(!0))])}function Fp(r){return Cr(J(r.firestore,at),[new He(r._key,lt.none())])}function Op(r,t){let e=J(r.firestore,at),n=Ji(r),i=Zo(r.converter,t);return Cr(e,[Jo(Vn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,lt.exists(!1))]).then(()=>n)}function Yl(r,...t){var e,n,i;r=ct(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Gc(t[a])||(s=t[a++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Gc(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,f;if(r instanceof tt)d=J(r.firestore,at),f=br(r._key.path),l={next:g=>{t[a]&&t[a](Zl(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=J(r,At);d=J(g.firestore,at),f=g._query;let _=new be(d);l={next:S=>{t[a]&&t[a](new Ut(d,_,g,S))},error:t[a+1],complete:t[a+2]},yp(r._query)}return(function(_,S,C,N){let D=new Ir(N),j=new Ui(S,D,C);return _.asyncQueue.enqueueAndForget(async()=>Vl(await Tr(_),j)),()=>{D.Ou(),_.asyncQueue.enqueueAndForget(async()=>Cl(await Tr(_),j))}})(bt(d),f,u,l)}function Mp(r,t){return Cw(bt(r=J(r,at)),Gc(t)?t:{next:t})}function Cr(r,t){return(function(n,i){let s=new vt;return n.asyncQueue.enqueueAndForget(async()=>cw(await Bl(n),i,s)),s.promise})(bt(r),t)}function Zl(r,t,e){let n=e.docs.get(t._key),i=new be(r);return new Ot(r,i,t._key,n,new we(e.hasPendingWrites,e.fromCache),t.converter)}var Ow={maxAttempts:5};var Uo=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Vn(t)}set(t,e,n){this._verifyNotCommitted();let i=Me(t,this._firestore),s=Zo(i.converter,e,n),a=Jo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,lt.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=Me(t,this._firestore),a;return a=typeof(e=ct(e))=="string"||e instanceof ee?$l(this._dataReader,"WriteBatch.update",s._key,e,n,i):Kl(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,lt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Me(t,this._firestore);return this._mutations=this._mutations.concat(new He(e._key,lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Me(r,t){if((r=ct(r)).firestore!==t)throw new V(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var rl=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Vn(t)}get(t){let e=Me(t,this._firestore),n=new nl(this._firestore);return this._transaction.lookup([e._key]).then(i=>{if(!i||i.length!==1)return M(24041);let s=i[0];if(s.isFoundDocument())return new Rn(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new Rn(this._firestore,n,e._key,null,e.converter);throw M(18433,{doc:s})})}set(t,e,n){let i=Me(t,this._firestore),s=Zo(i.converter,e,n),a=Jo(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,n);return this._transaction.set(i._key,a),this}update(t,e,n,...i){let s=Me(t,this._firestore),a;return a=typeof(e=ct(e))=="string"||e instanceof ee?$l(this._dataReader,"Transaction.update",s._key,e,n,i):Kl(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,a),this}delete(t){let e=Me(t,this._firestore);return this._transaction.delete(e._key),this}};var il=class extends rl{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Me(t,this._firestore),n=new be(this._firestore);return super.get(t).then(i=>new Ot(this._firestore,n,e._key,i._document,new we(!1,!1),e.converter))}};function Lp(r,t,e){r=J(r,at);let n=Object.assign(Object.assign({},Ow),e);return(function(s){if(s.maxAttempts<1)throw new V(R.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(s,a,u){let l=new vt;return s.asyncQueue.enqueueAndForget(async()=>{let d=await bw(s);new jc(s.asyncQueue,d,u,a,l).zu()}),l.promise})(bt(r),i=>t(new il(r,i)),n)}function qp(){return new Bi("deleteField")}function Up(){return new Wc("serverTimestamp")}function Bp(...r){return new Hc("arrayUnion",r)}function jp(...r){return new Xc("arrayRemove",r)}function zp(r){return new Jc("increment",r)}(function(t,e=!0){(function(i){Ar=i})(bd),Ed(new Es("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new at(new eu(n.getProvider("auth-internal")),new iu(a,n.getProvider("app-check-internal")),(function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ze(d.options.projectId,f)})(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),La(jd,zd,t),La(jd,zd,"esm2017")})();var Mw="@firebase/firestore-compat",Lw="0.3.53";function sh(r,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new V("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return t}function Gp(){if(typeof Uint8Array>"u")throw new V("unimplemented","Uint8Arrays are not available in this environment.")}function Kp(){if(!Rm())throw new V("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ta=class r{constructor(t){this._delegate=t}static fromBase64String(t){return Kp(),new r($t.fromBase64String(t))}static fromUint8Array(t){return Gp(),new r($t.fromUint8Array(t))}toBase64(){return Kp(),this._delegate.toBase64()}toUint8Array(){return Gp(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function th(r){return qw(r,["next","error","complete"])}function qw(r,t){if(typeof r!="object"||r===null)return!1;let e=r;for(let n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}var eh=class{enableIndexedDbPersistence(t,e){return rp(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return ip(t._delegate)}clearIndexedDbPersistence(t){return op(t._delegate)}},ea=class{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof ze||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&Bt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,n={}){Zg(this._delegate,t,e,n)}enableNetwork(){return up(this._delegate)}disableNetwork(){return cp(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,ul("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return ap(this._delegate)}onSnapshotsInSync(t){return Mp(this._delegate,t)}get app(){if(!this._appCompat)throw new V("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Nr(this,jl(this._delegate,t))}catch(e){throw Mt(e,"collection()","Firestore.collection()")}}doc(t){try{return new de(this,Ji(this._delegate,t))}catch(e){throw Mt(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new kn(this,tp(this._delegate,t))}catch(e){throw Mt(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Lp(this._delegate,e=>t(new na(this,e)))}batch(){return bt(this._delegate),new ra(new Uo(this._delegate,t=>Cr(this._delegate,t)))}loadBundle(t){return lp(this._delegate,t)}namedQuery(t){return hp(this._delegate,t).then(e=>e?new kn(this,e):null)}},xr=class extends Er{constructor(t){super(),this.firestore=t}convertBytes(t){return new ta(new $t(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return de.forKey(e,this.firestore,null)}};function Uw(r){sm(r)}var na=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new xr(t)}get(t){let e=xn(t);return this._delegate.get(e).then(n=>new Dn(this._firestore,new Ot(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,e.converter)))}set(t,e,n){let i=xn(t);return n?(sh("Transaction.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=xn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=xn(t);return this._delegate.delete(e),this}},ra=class{constructor(t){this._delegate=t}set(t,e,n){let i=xn(t);return n?(sh("WriteBatch.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=xn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=xn(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Dr=class r{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){let n=new Ue(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Nn(this._firestore,n),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let n=r.INSTANCES,i=n.get(t);i||(i=new WeakMap,n.set(t,i));let s=i.get(e);return s||(s=new r(t,new xr(t),e),i.set(e,s)),s}};Dr.INSTANCES=new WeakMap;var de=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xr(t)}static forPath(t,e,n){if(t.length%2!==0)throw new V("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new r(e,new tt(e._delegate,n,new F(t)))}static forKey(t,e,n){return new r(e,new tt(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new Nr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Nr(this.firestore,jl(this._delegate,t))}catch(e){throw Mt(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=ct(t),t instanceof tt?zl(this._delegate,t):!1}set(t,e){e=sh("DocumentReference.set",e);try{return e?Xl(this._delegate,t,e):Xl(this._delegate,t)}catch(n){throw Mt(n,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return arguments.length===1?Jl(this._delegate,t):Jl(this._delegate,t,e,...n)}catch(i){throw Mt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Fp(this._delegate)}onSnapshot(...t){let e=$p(t),n=Qp(t,i=>new Dn(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Yl(this._delegate,e,n)}get(t){let e;return t?.source==="cache"?e=Cp(this._delegate):t?.source==="server"?e=xp(this._delegate):e=Vp(this._delegate),e.then(n=>new Dn(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Dr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Mt(r,t,e){return r.message=r.message.replace(t,e),r}function $p(r){for(let t of r)if(typeof t=="object"&&!th(t))return t;return{}}function Qp(r,t){var e,n;let i;return th(r[0])?i=r[0]:th(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Dn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new de(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Hl(this._delegate,t._delegate)}},Nn=class extends Dn{data(t){let e=this._delegate.data(t);return this._delegate._converter||am(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},kn=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xr(t)}where(t,e,n){try{return new r(this.firestore,Re(this._delegate,wp(t,e,n)))}catch(i){throw Mt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new r(this.firestore,Re(this._delegate,vp(t,e)))}catch(n){throw Mt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new r(this.firestore,Re(this._delegate,Ip(t)))}catch(e){throw Mt(e,"limit()","Query.limit()")}}limitToLast(t){try{return new r(this.firestore,Re(this._delegate,Tp(t)))}catch(e){throw Mt(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new r(this.firestore,Re(this._delegate,Ep(...t)))}catch(e){throw Mt(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new r(this.firestore,Re(this._delegate,Ap(...t)))}catch(e){throw Mt(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new r(this.firestore,Re(this._delegate,bp(...t)))}catch(e){throw Mt(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new r(this.firestore,Re(this._delegate,Sp(...t)))}catch(e){throw Mt(e,"endAt()","Query.endAt()")}}isEqual(t){return Gl(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=Np(this._delegate):t?.source==="server"?e=kp(this._delegate):e=Dp(this._delegate),e.then(n=>new Yi(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...t){let e=$p(t),n=Qp(t,i=>new Yi(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Yl(this._delegate,e,n)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Dr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},nh=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new Nn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Yi=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new kn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new Nn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new nh(this._firestore,e))}forEach(t,e){this._delegate.forEach(n=>{t.call(e,new Nn(this._firestore,n))})}isEqual(t){return Hl(this._delegate,t._delegate)}},Nr=class r extends kn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new de(this.firestore,t):null}doc(t){try{return t===void 0?new de(this.firestore,Ji(this._delegate)):new de(this.firestore,Ji(this._delegate,t))}catch(e){throw Mt(e,"doc()","CollectionReference.doc()")}}add(t){return Op(this._delegate,t).then(e=>new de(this.firestore,e))}isEqual(t){return zl(this._delegate,t._delegate)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Dr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function xn(r){return J(r,tt)}var rh=class r{constructor(...t){this._delegate=new ee(...t)}static documentId(){return new r(dt.keyField().canonicalString())}isEqual(t){return t=ct(t),t instanceof ee?this._delegate._internalPath.isEqual(t._internalPath):!1}};var ih=class r{static serverTimestamp(){let t=Up();return t._methodName="FieldValue.serverTimestamp",new r(t)}static delete(){let t=qp();return t._methodName="FieldValue.delete",new r(t)}static arrayUnion(...t){let e=Bp(...t);return e._methodName="FieldValue.arrayUnion",new r(e)}static arrayRemove(...t){let e=jp(...t);return e._methodName="FieldValue.arrayRemove",new r(e)}static increment(t){let e=zp(t);return e._methodName="FieldValue.increment",new r(e)}constructor(t){this._delegate=t}isEqual(t){return this._delegate.isEqual(t._delegate)}};var Bw={Firestore:ea,GeoPoint:ce,Timestamp:rt,Blob:ta,Transaction:na,WriteBatch:ra,DocumentReference:de,DocumentSnapshot:Dn,Query:kn,QueryDocumentSnapshot:Nn,QuerySnapshot:Yi,CollectionReference:Nr,FieldPath:rh,FieldValue:ih,setLogLevel:Uw,CACHE_SIZE_UNLIMITED:ep};function jw(r,t){r.INTERNAL.registerComponent(new Es("firestore-compat",e=>{let n=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(n,i)},"PUBLIC").setServiceProps(Object.assign({},Bw)))}function zw(r){jw(r,(t,e)=>new ea(t,e,new eh)),r.registerVersion(Mw,Lw)}zw(qa);function Gw(r,t=hd){return new ld(e=>{let n;return t!=null?t.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},e)}):n=r.onSnapshot({includeMetadataChanges:!0},e),()=>{n?.()}})}function Wp(r,t){return Gw(r,t)}function Kw(r,t){return Wp(r,t).pipe(ws(void 0),_s(),Xt(e=>{let[n,i]=e;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function uh(r,t){return Wp(r,t).pipe(Xt(e=>({payload:e,type:"query"})))}var ia=class{ref;afs;injector=ei(vs);constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let n=this.ref.collection(t),{ref:i,query:s}=Jp(n,e);return new oa(i,s,this.afs)}snapshotChanges(){return Kw(this.ref,this.afs.schedulers.outsideAngular).pipe(Qt(this.injector))}valueChanges(t={}){return this.snapshotChanges().pipe(Xt(({payload:e})=>t.idField?Da(ps({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Zr(this.ref.get(t)).pipe(Qt(this.injector))}};function sa(r,t){return uh(r,t).pipe(ws(void 0),_s(),Xt(e=>{let[n,i]=e,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,l)=>{let d=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:u}})}),a}))}function Hp(r,t,e){return sa(r,e).pipe(ys((n,i)=>$w(n,i.map(s=>s.payload),t),[]),dd(),Xt(n=>n.map(i=>({type:i.type,payload:i}))))}function $w(r,t,e){return t.forEach(n=>{e.indexOf(n.type)>-1&&(r=Qw(r,n))}),r}function oh(r,t,e,...n){let i=r.slice();return i.splice(t,e,...n),i}function Qw(r,t){switch(t.type){case"added":if(!r[t.newIndex]?.doc.ref.isEqual(t.doc.ref))return oh(r,t.newIndex,0,t);break;case"modified":if(r[t.oldIndex]==null||r[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=r.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return oh(r,t.newIndex,1,t);break;case"removed":if(r[t.oldIndex]?.doc.ref.isEqual(t.doc.ref))return oh(r,t.oldIndex,1);break}return r}function Xp(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var oa=class{ref;query;afs;injector=ei(vs);constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=sa(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Xt(n=>n.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(ws(void 0),_s(),ka(([n,i])=>i.length>0||!n),Xt(([,n])=>n),Qt(this.injector))}auditTrail(t){return this.stateChanges(t).pipe(ys((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=Xp(t);return Hp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Qt(this.injector))}valueChanges(t={}){return uh(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(e=>e.payload.docs.map(n=>t.idField?Da(ps({},n.data()),{[t.idField]:n.id}):n.data())),Qt(this.injector))}get(t){return Zr(this.query.get(t)).pipe(Qt(this.injector))}add(t){return this.ref.add(t)}doc(t){return new ia(this.ref.doc(t),this.afs)}},ah=class{query;afs;injector=ei(vs);constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?sa(this.query,this.afs.schedulers.outsideAngular).pipe(Qt(this.injector)):sa(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(e=>e.filter(n=>t.indexOf(n.type)>-1)),ka(e=>e.length>0),Qt(this.injector))}auditTrail(t){return this.stateChanges(t).pipe(ys((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=Xp(t);return Hp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Qt(this.injector))}valueChanges(t={}){return uh(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(n=>n.payload.docs.map(i=>t.idField?ps({[t.idField]:i.id},i.data()):i.data())),Qt(this.injector))}get(t){return Zr(this.query.get(t)).pipe(Qt(this.injector))}},Ww=new ti("angularfire2.enableFirestorePersistence"),Hw=new ti("angularfire2.firestore.persistenceSettings"),Xw=new ti("angularfire2.firestore.settings"),Jw=new ti("angularfire2.firestore.use-emulator");function Jp(r,t=e=>e){return{query:t(r),ref:r}}var Uv=(()=>{class r{schedulers;firestore;persistenceEnabled$;ngZone=ei(Is);constructor(e,n,i,s,a,u,l,d,f,g,_,S,C,N,D,j,B){this.schedulers=l;let q=Cd(e,u,n),$=f;g&&Ld(q,u,_,C,N,D,S,j),[this.firestore,this.persistenceEnabled$]=xd(`${q.name}.firestore`,"AngularFirestore",q.name,()=>{let W=u.runOutsideAngular(()=>q.firestore());if(s&&W.settings(s),$&&W.useEmulator(...$),i&&!gd(a)){let G=()=>{try{return Zr(W.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(v){return typeof console<"u"&&console.warn(v),Na(!1)}};return[W,u.runOutsideAngular(G)]}else return[W,Na(!1)]},[s,$,i])}collection(e,n){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:a}=Jp(i,n),u=this.ngZone.run(()=>s);return new oa(u,a,this)}collectionGroup(e,n){let i=n||(a=>a),s=this.firestore.collectionGroup(e);return new ah(i(s),this)}doc(e){let n;typeof e=="string"?n=this.firestore.doc(e):n=e;let i=this.ngZone.run(()=>n);return new ia(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(Tt(Pd),Tt(Vd,8),Tt(Ww,8),Tt(Xw,8),Tt(md),Tt(Is),Tt(Sd),Tt(Hw,8),Tt(Jw,8),Tt(qd,8),Tt(Dd,8),Tt(Nd,8),Tt(kd,8),Tt(Fd,8),Tt(Od,8),Tt(Md,8),Tt(Rd,8))};static \u0275prov=fd({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();export{Uv as a};
