"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[500],{3500:(X,L,a)=>{a.r(L),a.d(L,{S2mapModule:()=>w});var h=a(1368),p=a(6504),d=a(4192),y=a(1528),x=a(3368),G=a(7800),m=a(6716),v=a(3616),O=a(4680),M=a(6700),C=a(5657),f=a(6040),e=a(4496),E=a(7976),b=a(7028),B=a(8280),T=a(2064);function D(l,N){if(1&l&&(e.I0R(0,"span"),e.OEk(1),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.oRS("Zoom: ",t.mapZoomLevel,"")}}const I=[{path:"map/index.htm",redirectTo:"map"},{path:"map",component:(()=>{class l{translate;http;cellMainScales={};cellSubScales={};googleMap;S2LEVEL_MAX=20;S2LevelRange=[1,this.S2LEVEL_MAX];S2LevelSubScaleMax=3;inputS2Level=1;inputS2LevelSubScale=0;inputS2Level$=new M.g(this.inputS2Level);inputS2LevelSubScale$=new M.g(this.inputS2LevelSubScale);mapBounds$=new C.E;isDeveloper=!m.OU.production;mapZoomLevel;destroy$=new C.E;constructor(t,n){this.translate=t,this.http=n}ngOnInit(){var t=this;return(0,y.c)(function*(){const o=yield new G.c1({apiKey:m.OU.googleMapApiKey,version:"weekly",libraries:["places"]}).load();(0,m.Oh)("Google API loaded",o);const s={center:{lat:m.OU.MapDefaultLocation.lat,lng:m.OU.MapDefaultLocation.lng},zoom:7},i=document.getElementById("toolsS2MapMain");t.googleMap=new o.maps.Map(i,s),t.googleMap.addListener("bounds_changed",t.onMapBoundsChanged.bind(t)),(0,f.E)([t.inputS2Level$,t.mapBounds$]).pipe((0,v.a)(t.destroy$)).subscribe(([c,g])=>{const r=t.googleMap.getZoom();"number"==typeof r?(t.S2LevelRange=t.getZoomLevelS2Range(r),t.S2LevelSubScaleMax=Math.min(Math.max(t.S2LEVEL_MAX-c,0),3),t.drawMainScales(c,g)):(0,m.sJ)("Unexpectedly failed to get zoom",r)}),(0,f.E)([t.inputS2Level$,t.inputS2LevelSubScale$,t.mapBounds$]).pipe((0,O.o)(100),(0,v.a)(t.destroy$)).subscribe(([c,g,r])=>{t.drawSubScales(c+g,r)})})()}ngOnDestroy(){this.destroy$.next()}onChangeLevel(t){this.inputS2Level$.next(t)}clearScales(t){for(const n in t)t[n].setMap(null),delete t[n]}drawSubScales(t,n){this.clearScales(this.cellSubScales);const o=this.googleMap.getCenter();if(!o)return void(0,m.sJ)("Unexpectedly failed to get map center");const s=this.toS2Cell(o,t);this.drawWithNeighbors(this.cellSubScales,n,s,.3)}drawMainScales(t,n){this.clearScales(this.cellMainScales);const o=this.googleMap.getCenter();if(!o)return;const s=this.toS2Cell(o,t);this.drawWithNeighbors(this.cellMainScales,n,s)}drawWithNeighbors(t,n,o,s=1){const i=this.toGoogleBounds(o);if(!n.intersects(i))return;const c=o.toHilbertQuadkey();if(c in t)return;const g=o.getCornerLatLngs(),r=g.map(u=>this.toGoogleLatLng(u));r.push(this.toGoogleLatLng(g[0]));const S=new google.maps.Polyline({path:r,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.8*s,strokeWeight:1*s,map:this.googleMap});t[c]=S;for(const u of o.getNeighbors()){const A=u.getLatLng();new google.maps.LatLng(this.toGoogleLatLng(A)),this.drawWithNeighbors(t,n,u,s)}}toS2Cell(t,n){return x.S2.S2Cell.FromLatLng({lat:t.lat(),lng:t.lng()},n)}toGoogleBounds(t){const n=t.getCornerLatLngs();return new google.maps.LatLngBounds(n[0],n[1]).extend(n[2]).extend(n[3])}toGoogleLatLng(t){return{lat:t.lat,lng:t.lng}}onMapBoundsChanged(){const t=this.googleMap.getZoom();if(!t)return;this.mapZoomLevel=t;const n=this.getZoomLevelS2Range(t);if(this.inputS2Level<n[0]||n[1]<this.inputS2Level){const s=this.clamp(this.inputS2Level,n[0],n[1]);this.inputS2Level=s,this.inputS2Level$.next(s)}const o=this.googleMap.getBounds();o?this.mapBounds$.next(o):(0,m.sJ)("Unexpectedly failed to get bounds.")}clamp(t,n,o){return Math.trunc(Math.min(o,Math.max(n,t)))}getZoomLevelS2Range(t){const n=this.clamp(Math.trunc(t),0,22),o=[{min:1,max:3},{min:1,max:6},{min:1,max:7},{min:1,max:7},{min:1,max:8},{min:1,max:8},{min:1,max:9},{min:1,max:9},{min:1,max:10},{min:1,max:11},{min:1,max:12},{min:1,max:12},{min:1,max:13},{min:1,max:13},{min:1,max:14},{min:8,max:15},{min:8,max:16},{min:9,max:17},{min:9,max:18},{min:10,max:19},{min:10,max:this.S2LEVEL_MAX},{min:11,max:this.S2LEVEL_MAX},{min:12,max:this.S2LEVEL_MAX}];return[o[n].min,o[n].max]}onChangeSubScale(t){this.inputS2LevelSubScale$.next(t)}static \u0275fac=function(n){return new(n||l)(e.GI1(E.GI),e.GI1(b.hD))};static \u0275cmp=e.In1({type:l,selectors:[["app-s2-map"]],decls:18,vars:22,consts:[["id","toolsS2MapMain",2,"width","100%","height","600px"],[4,"ngIf"],[1,"form-group","m-2"],[1,"input-group","row","m-2"],[1,"col-1","form-check-label","p-2","text-end",3,"title"],[1,"col-2"],["type","number",1,"form-control",3,"min","max","ngModel","ngModelChange"],["fill","#7878dd","src","/assets/octicons/question.svg",1,"col-1",3,"title"]],template:function(n,o){1&n&&(e.wR5(0,"div",0),e.yuY(1,D,2,1,"span",1),e.I0R(2,"div",2)(3,"div",3)(4,"label",4),e.wVc(5,"translate"),e.OEk(6),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"span",5)(9,"input",6),e.iHE("ngModelChange",function(i){return e.kNx(o.inputS2Level,i)||(o.inputS2Level=i),i}),e.qCj("ngModelChange",function(i){return o.onChangeLevel(i)}),e.C$Y()(),e.I0R(10,"label",4),e.wVc(11,"translate"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"span",5)(15,"input",6),e.iHE("ngModelChange",function(i){return e.kNx(o.inputS2LevelSubScale,i)||(o.inputS2LevelSubScale=i),i}),e.qCj("ngModelChange",function(i){return o.onChangeSubScale(i)}),e.C$Y()(),e.wR5(16,"app-inline-svg",7),e.wVc(17,"translate"),e.C$Y()()),2&n&&(e.yG2(),e.E7m("ngIf",o.isDeveloper),e.yG2(3),e._6D("title",e.kDX(5,12,"TOOLTIP_S2_CELL_LEVEL")),e.yG2(2),e.cNF(e.kDX(7,14,"LABEL_S2_CELL_LEVEL")),e.yG2(3),e.E7m("min",o.S2LevelRange[0])("max",o.S2LevelRange[1]),e.OKB("ngModel",o.inputS2Level),e.yG2(),e._6D("title",e.kDX(11,16,"TOOLTIP_S2_CELL_SUB_SCALE")),e.yG2(2),e.cNF(e.kDX(13,18,"LABEL_S2_CELL_SUB_SCALES")),e.yG2(3),e.E7m("min",0)("max",o.S2LevelSubScaleMax),e.OKB("ngModel",o.inputS2LevelSubScale),e.yG2(),e._6D("title",e.kDX(17,20,"TOOLTIP_S2CELL_LEVEL")))},dependencies:[h.u_,p.ot,p.O4,p.ue,p.Gu,p._t,p._G,B.E,T.sD]})}return l})(),data:{gitweeTitle:"TITLE_TOOL_S2GEO_MAP"}}];let $=(()=>{class l{constructor(){(0,m.qe)("S2mapRoutingModule.constructor()")}static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[d.qQ.forChild(I),d.qQ]})}return l})();var R=a(5797),V=a(4576);let w=(()=>{class l{constructor(){(0,m.rD)("Dynamically loaded S2mapModule")}static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[{provide:E.k1,useValue:"app/tools/s2map/s2map/"}],imports:[h.MD,p.y,R.i,V.w,$]})}return l})()}}]);