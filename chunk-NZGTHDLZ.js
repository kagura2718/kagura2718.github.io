import{a as Ct}from"./chunk-FB4QFPYY.js";import{a as Bt,b as Q,c as St}from"./chunk-UHJZ44LA.js";import{a as _t,e as It}from"./chunk-TRZEWYSM.js";import{b as M,c as $}from"./chunk-ZW6WAZYB.js";import{a as K}from"./chunk-MFBLWIPG.js";import{b as J}from"./chunk-U3KK23CY.js";import{a as k}from"./chunk-W7BVDA43.js";import{$a as mt,Ab as U,Ba as m,Bb as q,Cb as ut,Eb as d,Gb as B,Ha as v,Ka as S,M as ot,Ob as H,Oc as L,P as R,Pa as T,Pb as lt,Qc as C,R as at,Tc as w,Va as l,Wa as I,Wc as pt,Xa as s,Xb as h,Xc as ft,Yb as y,Yc as gt,Zb as A,Zc as xt,_a as rt,_b as st,_c as Et,ab as g,ad as vt,b as nt,ba as W,bb as u,cb as a,da as G,db as F,ea as z,fa as p,ga as f,gd as Ft,hd as ht,ic as et,jb as j,la as tt,m as Y,mb as E,na as O,nd as yt,o as Z,pb as x,pd as wt,qd as Dt,rb as r,rc as ct,sc as P,sd as bt,tc as dt,ya as b,z as N}from"./chunk-PNXDVUHT.js";function Rt(e,i){if(e&1){let t=E();u(0,"div",0)(1,"button",8),x("click",function(){p(t);let n=r();return f(n.onClickDismiss())}),u(2,"span",9),d(3,"\xD7"),a()()()}}function Ot(e,i){e&1&&(u(0,"div",6),d(1,"OK!"),a())}function jt(e,i){e&1&&(u(0,"div",10),d(1,"\u5165\u529B\u5FC5\u9808\u3067\u3059\u3002"),a())}function Ut(e,i){e&1&&(u(0,"div",10),d(1,"\u9577\u3059\u304E\u307E\u3059\u3002"),a())}function qt(e,i){e&1&&(u(0,"div",10),d(1,"\u77ED\u3059\u304E\u307E\u3059\u3002"),a())}function Ht(e,i){if(e&1&&(l(0,jt,2,0,"div",10),l(1,Ut,2,0,"div",10),l(2,qt,2,0,"div",10)),e&2){let t=r();s(t.textareaControl.errors!=null&&t.textareaControl.errors.required?0:-1),m(),s(t.textareaControl.errors!=null&&t.textareaControl.errors.maxlength?1:-1),m(),s(t.textareaControl.errors!=null&&t.textareaControl.errors.minlength?2:-1)}}var V=class e{constructor(i,t,o,n,c){this.user=i;this.auth=t;this.toastr=o;this.funcs=n;this.tos=c}editModel;pageId;showDismiss=!1;replyId;requestSent=new tt;editDismiss=new tt;inputForm;get textareaControl(){return this.inputForm.get("commentText")}ngOnInit(){C("CommentEditorComponent.OnInit()"),this.inputForm=new Et({}),this.inputForm.addControl("commentText",new vt(this.editModel?this.editModel.message:null,[ft.required]))}onClickDismiss(){C("CommentEditorComponent.onClickDismiss()"),this.editDismiss.emit()}async doNewPost(){let i={message:this.textareaControl.value,pageId:this.pageId,replyId:this.replyId};return await this.funcs.call("postComment",i)}async doUpdatePost(i){let t={pageId:this.pageId,commentId:i.id,message:this.textareaControl.value};return await this.funcs.call("editComment",t)}onClickPostComment(){C("CommentEditorComponent.onClickPostComment()"),!this.inputForm.invalid&&(this.textareaControl.invalid||this.tos.confirmTos$(`${this.auth.myUid}/commentAgreement`,L.CommentServiceTosUrl).pipe(N(i=>i)).subscribe(async i=>{this.inputForm.disable();try{this.editModel?await this.doUpdatePost(this.editModel):await this.doNewPost(),this.toastr.info("\u6295\u7A3F\u3057\u307E\u3057\u305F\u3002(\u627F\u8A8D\u3055\u308C\u308B\u307E\u3067\u4ED6\u306E\u4EBA\u306B\u306F\u8868\u793A\u3055\u308C\u307E\u305B\u3093\u3002)"),this.textareaControl.setValue(""),this.inputForm.markAsPristine(),this.inputForm.markAsUntouched(),this.requestSent.emit()}catch(t){if("message"in t){let o=t.message;this.toastr.error(`\u6295\u7A3F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002( ${o} )`)}else this.toastr.error("\u6295\u7A3F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")}finally{this.inputForm.enable()}}))}static \u0275fac=function(t){return new(t||e)(v(Q),v($),v(k),v(M),v(Bt))};static \u0275cmp=S({type:e,selectors:[["gitfire-comment-editor"]],inputs:{editModel:"editModel",pageId:"pageId",showDismiss:"showDismiss",replyId:"replyId"},outputs:{requestSent:"requestSent",editDismiss:"editDismiss"},decls:16,vars:14,consts:[[1,"text-end"],[1,"input-group",3,"formGroup"],["title","\u3053\u306E\u540D\u524D\u3067\u6295\u7A3F\u306F\u8868\u793A\u3055\u308C\u307E\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["disabled","",1,"m-3",3,"value"],[1,"m-3"],["autofocus","","name","commentText","formControlName","commentText","placeholder","\u6295\u7A3F\u3059\u308B\u30B3\u30E1\u30F3\u30C8\u3092\u3053\u3053\u306B\u66F8\u3044\u3066\u304F\u3060\u3055\u3044\u3002","required","","minlength","5","maxlength","65536",1,"p-3","form-control"],[1,"valid-feedback"],["title","\u30B3\u30E1\u30F3\u30C8\u5185\u5BB9\u306F\u627F\u8A8D\u5F8C\u306B\u8868\u793A\u3055\u308C\u307E\u3059\u3002",1,"btn","btn-primary","m-2",3,"click","disabled"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"invalid-feedback"]],template:function(t,o){t&1&&(l(0,Rt,4,0,"div",0),u(1,"div",1)(2,"div")(3,"label"),d(4,"\u540D\u524D"),F(5,"img",2),d(6,": "),a(),F(7,"input",3),h(8,"async"),a(),u(9,"div",4),F(10,"textarea",5),l(11,Ot,2,0,"div",6)(12,Ht,3,3),a(),u(13,"div")(14,"button",7),x("click",function(){return o.onClickPostComment()}),d(15,"\u6295\u7A3F\u3059\u308B"),a()()()),t&2&&(s(o.showDismiss?0:-1),m(),ut("was-validated",o.textareaControl.dirty||o.textareaControl.touched),g("formGroup",o.inputForm),m(6),g("value",H(y(8,12,o.user.myNickname$()))),m(2),q("width",100,"%"),m(),q("height",8,"rem"),m(),s(o.textareaControl.invalid?12:11),m(3),g("disabled",o.textareaControl.invalid||o.inputForm.disabled))},dependencies:[bt,pt,gt,xt,yt,wt,Dt,ht,Ft,P],encapsulation:2})};var Wt=(e,i)=>i.store.id;function Gt(e,i){e&1&&F(0,"span",1)}function zt(e,i){if(e&1&&(u(0,"span",6)(1,"small",5),h(2,"date"),d(3),h(4,"date"),a()()),e&2){let t=r().$implicit;m(),g("title",H(A(2,3,t.updatedAt,"yyyy-MM-dd HH:mm"))),m(2),B("\u66F4\u65B0\u65E5: ",A(4,6,t.updatedAt,"yyyy-MM-dd"))}}function Jt(e,i){if(e&1&&(u(0,"span",6)(1,"small"),d(2),h(3,"date"),a()()),e&2){let t=r().$implicit;m(2),B("\u627F\u8A8D\u65E5: ",A(3,1,t.decisionAt,"yyyy-MM-dd"))}}function Kt(e,i){if(e&1){let t=E();u(0,"a",27),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickApprove(n,c))}),d(1,"\u627F\u8A8D"),a()}}function Qt(e,i){if(e&1){let t=E();u(0,"a",28),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickApprove(n,c))}),d(1,"\u7DE8\u96C6\u627F\u8A8D"),a()}}function Xt(e,i){if(e&1){let t=E();u(0,"a",29),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickApprove(n,c))}),d(1,"\u524A\u9664\u627F\u8A8D"),a()}}function Yt(e,i){if(e&1){let t=E();u(0,"a",30),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickReject(n,c))}),d(1,"\u62D2\u5426"),a()}}function Zt(e,i){if(e&1){let t=E();u(0,"a",31),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickReject(n,c))}),d(1,"\u7DE8\u96C6\u62D2\u5426"),a()}}function te(e,i){if(e&1){let t=E();u(0,"a",32),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickReject(n,c))}),d(1,"\u7DE8\u96C6\u62D2\u5426"),a()}}function ee(e,i){if(e&1){let t=E();u(0,"a",33),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickProtect(n,c))}),d(1,"\u4FDD\u8B77"),a()}}function ie(e,i){if(e&1){let t=E();u(0,"a",34),x("click",function(n){p(t);let c=r(2).$implicit,_=r(2);return f(_.onClickUnProtect(n,c))}),d(1,"\u4FDD\u8B77\u89E3\u9664"),a()}}function ne(e,i){if(e&1&&(u(0,"span",7)(1,"span",17),d(2,"\uFE19"),a(),u(3,"div",18),l(4,Kt,2,0,"a",19),l(5,Qt,2,0,"a",20),l(6,Xt,2,0,"a",21),l(7,Yt,2,0,"a",22),l(8,Zt,2,0,"a",23),l(9,te,2,0,"a",24),l(10,ee,2,0,"a",25),l(11,ie,2,0,"a",26),a()()),e&2){let t=r().$implicit;m(4),s(t.store.state==="pending"?4:-1),m(),s(t.store.state==="approved"&&t.store.editedState==="edit-request"?5:-1),m(),s(t.store.state==="approved"&&t.store.editedState==="delete-request"?6:-1),m(),s(t.store.state==="pending"?7:-1),m(),s(t.store.state==="approved"&&t.store.editedState==="edit-request"?8:-1),m(),s(t.store.state==="approved"&&t.store.editedState==="delete-request"?9:-1),m(),s(t.store.state==="approved"&&!t.store.isAdminEdit?10:-1),m(),s(t.store.state==="approved"&&t.store.isAdminEdit?11:-1)}}function oe(e,i){e&1&&F(0,"gitfire-user-box",9),e&2&&g("userPublic",i)}function ae(e,i){e&1&&(u(0,"span",11),d(1,"\u7BA1\u7406\u4EBA\u306B\u3088\u308B\u4FDD\u8B77"),a())}function re(e,i){e&1&&(u(0,"span",12),d(1,"\u5374\u4E0B\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3067\u3059\u3002"),a())}function me(e,i){e&1&&(u(0,"span",13),d(1,"\u627F\u8A8D\u5F85\u3061\u306E\u30B3\u30E1\u30F3\u30C8\u3067\u3059\u3002"),a())}function ue(e,i){e&1&&(u(0,"span",13),d(1,"\u524A\u9664\u3055\u308C\u307E\u3057\u305F\u3002"),a())}function le(e,i){e&1&&(u(0,"span",12),d(1,"\u7DE8\u96C6\u7533\u8ACB\u304C\u5374\u4E0B\u3055\u308C\u307E\u3057\u305F\u3002"),a())}function se(e,i){e&1&&(u(0,"span",12),d(1,"\u524A\u9664\u7533\u8ACB\u304C\u5374\u4E0B\u3055\u308C\u307E\u3057\u305F\u3002"),a())}function ce(e,i){e&1&&(u(0,"span",12),d(1,"\u524A\u9664\u7533\u8ACB\u4E2D\u3067\u3059\u3002"),a())}function de(e,i){e&1&&(u(0,"span",13),d(1,"\u7DE8\u96C6\u7533\u8ACB\u4E2D\u3067\u3059\u3002"),a())}function _e(e,i){if(e&1&&l(0,le,2,0,"span",12)(1,se,2,0,"span",12)(2,ce,2,0,"span",12)(3,de,2,0,"span",13),e&2){let t,o=r().$implicit;s((t=o.store.editedState)==="edit-rejected"?0:t==="delete-rejected"?1:t==="delete-request"?2:t==="edit-request"?3:-1)}}function Ce(e,i){if(e&1){let t=E();u(0,"gitfire-comment-editor",37),x("requestSent",function(){p(t);let n=r(3).$implicit,c=r(2);return f(c.onEditRequested(n))})("editDismiss",function(){p(t);let n=r(3).$implicit,c=r(2);return f(c.onEditDismissed(n))}),a()}if(e&2){let t=r(5);g("pageId",t.pageId())("editModel",i)("showDismiss",!0)}}function pe(e,i){if(e&1&&(l(0,Ce,1,3,"gitfire-comment-editor",36),h(1,"async")),e&2){let t,o=r(2).$implicit;s((t=y(1,1,o.editor$))?0:-1,t)}}function fe(e,i){if(e&1&&F(0,"div",35),e&2){let t=r(2).$implicit;g("innerHTML",t.store.messageHtml,b)}}function ge(e,i){if(e&1&&(u(0,"div"),l(1,pe,2,3),l(2,fe,1,1,"div",35),a()),e&2){let t=r().$implicit;m(),s(t.isEditing?1:-1),m(),s(t.store.state==="approved"&&!t.isEditing?2:-1)}}function xe(e,i){if(e&1&&F(0,"div",35),e&2){let t=r(2).$implicit;g("innerHTML",t.store.messageHtml,b)}}function Ee(e,i){if(e&1&&l(0,xe,1,1,"div",35),e&2){let t=r().$implicit;s(t.store.state==="approved"?0:-1)}}function ve(e,i){e&1&&F(0,"span",1)}function Fe(e,i){e&1&&F(0,"div",40),e&2&&g("innerHTML",i.messageHtml,b)}function he(e,i){e&1&&j(0)}function ye(e,i){if(e&1&&T(0,he,1,0,"ng-container",41),e&2){r(2);let t=U(2);g("ngTemplateOutlet",t)}}function we(e,i){if(e&1&&(u(0,"div",38)(1,"span",13),d(2,"\u7533\u8ACB\u4E2D\u306E\u30E1\u30C3\u30BB\u30FC\u30B8"),a(),l(3,Fe,1,1,"div",40),h(4,"async"),I(5,ye,1,1,"ng-container"),a()),e&2){let t,o=r(2).$implicit;m(3),s((t=y(4,1,o.privateMessage$))?3:5,t)}}function De(e,i){e&1&&F(0,"div",40),e&2&&g("innerHTML",i.messageHtml,b)}function be(e,i){e&1&&j(0)}function Ie(e,i){if(e&1&&T(0,be,1,0,"ng-container",41),e&2){r(2);let t=U(2);g("ngTemplateOutlet",t)}}function Be(e,i){if(e&1&&(u(0,"div",39)(1,"span",12),d(2,"\u5374\u4E0B\u3055\u308C\u305F\u30E1\u30C3\u30BB\u30FC\u30B8"),a(),l(3,De,1,1,"div",40),h(4,"async"),I(5,Ie,1,1,"ng-container"),a()),e&2){let t,o=r(2).$implicit;m(3),s((t=y(4,1,o.privateMessage$))?3:5,t)}}function Se(e,i){e&1&&F(0,"div",40),e&2&&g("innerHTML",i.messageHtml,b)}function Te(e,i){e&1&&j(0)}function Ae(e,i){if(e&1&&T(0,Te,1,0,"ng-container",41),e&2){r(3);let t=U(2);g("ngTemplateOutlet",t)}}function Pe(e,i){if(e&1&&(u(0,"div",38)(1,"span",13),d(2,"\u7DE8\u96C6\u7533\u8ACB\u4E2D\u306E\u30E1\u30C3\u30BB\u30FC\u30B8"),a(),l(3,Se,1,1,"div",40),h(4,"async"),I(5,Ae,1,1,"ng-container"),a()),e&2){let t,o=r(3).$implicit;m(3),s((t=y(4,1,o.privateMessage$))?3:5,t)}}function ke(e,i){e&1&&F(0,"div",40),e&2&&g("innerHTML",i.messageHtml,b)}function Le(e,i){e&1&&j(0)}function Me(e,i){if(e&1&&T(0,Le,1,0,"ng-container",41),e&2){r(3);let t=U(2);g("ngTemplateOutlet",t)}}function $e(e,i){if(e&1&&(u(0,"div",39)(1,"span",12),d(2,"\u7DE8\u96C6\u7533\u8ACB\u304C\u5374\u4E0B\u3055\u308C\u305F\u30E1\u30C3\u30BB\u30FC\u30B8"),a(),l(3,ke,1,1,"div",40),h(4,"async"),I(5,Me,1,1,"ng-container"),a()),e&2){let t,o=r(3).$implicit;m(3),s((t=y(4,1,o.privateMessage$))?3:5,t)}}function Ve(e,i){if(e&1&&(u(0,"div"),l(1,Pe,6,3,"div",38),l(2,$e,6,3,"div",39),a()),e&2){let t=r(2).$implicit;m(),s(t.store.editedState==="edit-request"?1:-1),m(),s(t.store.editedState==="edit-rejected"?2:-1)}}function Re(e,i){if(e&1&&(u(0,"div",14),T(1,ve,1,0,"ng-template",null,0,st),l(3,we,6,3,"div",38),l(4,Be,6,3,"div",39),l(5,Ve,3,2,"div"),a()),e&2){let t=r().$implicit;m(3),s(t.store.state==="pending"?3:-1),m(),s(t.store.state==="rejected"?4:-1),m(),s(t.store.state==="approved"?5:-1)}}function Oe(e,i){if(e&1){let t=E();u(0,"button",42),x("click",function(n){p(t);let c=r().$implicit,_=r(2);return f(_.onClickReply(n,c))}),d(1,"\u8FD4\u4FE1"),a()}}function je(e,i){if(e&1){let t=E();u(0,"button",43),x("click",function(n){p(t);let c=r().$implicit,_=r(2);return f(_.onClickDelete(n,c))}),d(1,"\u524A\u9664"),a(),u(2,"button",44),x("click",function(n){p(t);let c=r().$implicit,_=r(2);return f(_.onClickEdit(n,c))}),d(3,"\u7DE8\u96C6"),a()}}function Ue(e,i){if(e&1){let t=E();u(0,"div",15)(1,"gitfire-comment-editor",45),x("requestSent",function(){p(t);let n=r().$implicit,c=r(2);return f(c.onReplyRequested(n))})("editDismiss",function(){p(t);let n=r().$implicit,c=r(2);return f(c.onReplyDismissed(n))}),a()()}if(e&2){let t=r().$implicit,o=r(2);m(),g("showDismiss",!0)("replyId",t.store.id)("pageId",o.pageId())}}function qe(e,i){if(e&1&&(u(0,"div",4)(1,"div")(2,"div")(3,"span",5),h(4,"date"),d(5),h(6,"date"),a(),l(7,zt,5,9,"span",6),l(8,Jt,4,4,"span",6),l(9,ne,12,8,"span",7),a(),u(10,"div",8),d(11,"\u30E6\u30FC\u30B6: "),l(12,oe,1,1,"gitfire-user-box",9),h(13,"async"),a()(),u(14,"div",10)(15,"div"),l(16,ae,2,0,"span",11),l(17,re,2,0,"span",12)(18,me,2,0,"span",13)(19,ue,2,0,"span",13)(20,_e,4,1),a(),u(21,"div"),l(22,ge,3,2,"div"),l(23,Ee,1,1),a(),l(24,Re,6,3,"div",14),a(),u(25,"div",15),l(26,Oe,2,0,"button",16),l(27,je,4,0),a(),l(28,Ue,2,3,"div",15),a()),e&2){let t,o,n=i.$implicit,c=i.$index,_=r(2);q("background",c%2!==0?_.ACCENT_COLOR:null),g("id",lt("appGitfireComment-",n.store.id)),m(3),g("title",H(A(4,19,n.publishAt,"yyyy-MM-dd HH:mm"))),m(2),B("\u6295\u7A3F\u65E5\u6642: ",A(6,22,n.publishAt,"yyyy-MM-dd HH:mm")),m(2),s(n.isEdited?7:-1),m(),s(n.decisionAt?8:-1),m(),s(n.isDisplayAdmin?9:-1),m(3),s((t=y(13,25,n.user$))?12:-1,t),m(4),s(n.store.isAdminEdit?16:-1),m(),s((o=n.store.state)==="rejected"?17:o==="pending"?18:o==="deleted"?19:o==="approved"?20:-1),m(5),s(n.isOwn?22:-1),m(),s(n.isOwn?-1:23),m(),s(n.isOwn||n.isDisplayAdmin?24:-1),m(2),s(n.canReply?26:-1),m(),s(n.canChange?27:-1),m(),s(n.isReplying?28:-1)}}function He(e,i){if(e&1){let t=E();u(0,"button",46),x("click",function(n){p(t);let c=r(2);return f(c.onClickMoreComment(n))}),d(1,"\u3055\u3089\u306B\u8AAD\u307F\u8FBC\u3080"),a()}}function Ne(e,i){if(e&1&&(u(0,"div"),rt(1,qe,29,27,"div",2,Wt),l(3,He,2,0,"button",3),a()),e&2){let t=r();m(),mt(t.comments()),m(2),s(t.maybeMoreComment?3:-1)}}var it=class{store;updatedAt;publishAt;decisionAt;isEdited;privateMessage$;editor$;user$;isEditing;isReplying;isDisplayAdmin;canReply;canChange;isOwn},X=class e{constructor(i,t,o,n,c,_){this.auth=i;this.user=t;this.dialog=o;this.store=n;this.funcs=c;this.toastr=_;this.comments$=this.pageId$.pipe(R(D=>z(this.env,()=>this.store.doc(`/comment/v1/page/${D}`).collection("public",$t=>$t.orderBy("publishAt","desc").limit(30)).valueChanges({idField:"id"}))))}ACCENT_COLOR=L.themaColor.EVEN;destroy$=new nt;pageId=et();pageId$=J(this.pageId);isPageProtect=et(!1);env=W(G);comments$;comments=O([]);commentData={};maybeMoreComment=!1;isLoading=O(!0);ngOnDestroy(){C("CommentListComponent.OnDestroy()"),this.destroy$.next()}ngOnInit(){C("CommentListComponent.OnInit()"),this.comments$.pipe(at(this.destroy$)).subscribe(i=>{let t=this.comments();for(let o of i){let n=this.commentData[o.id];n||(n=new it,t.push(n)),n.publishAt=o.publishAt.toDate(),n.updatedAt=o.updatedAt.toDate();let c=n.updatedAt.getTime()-n.publishAt.getTime();if(n.isEdited=o.editedState!=="none"&&Math.abs(c)>5,o.decisionAt&&(n.decisionAt=o.decisionAt.toDate()),n.user$=this.user.user$(o.owner),n.store=o,this.auth.myUid===o.owner||this.auth.isAdmin){if(!n.privateMessage$){let _={pageId:this.pageId(),commentId:o.id};n.privateMessage$=Y(_).pipe(R(D=>this.funcs.call("readPrivateComment",D)),Z(D=>D)),n.editor$=n.privateMessage$.pipe(Z(D=>({id:D.id,message:D.message,images:D.images})))}}else n.editor$=Y({id:o.id,message:o.message,images:o.images});n.isDisplayAdmin=this.auth.isAdmin,n.isOwn=o.owner===this.auth.myUid,n.canReply=!this.isPageProtect()&&!n.isOwn&&o.state=="approved"&&!o.isProtect,n.canChange=n.isOwn&&!o.isAdminEdit&&!o.isProtect&&o.state==="approved",this.commentData[o.id]=n}this.comments.set(t.sort((o,n)=>n.publishAt.getTime()-o.publishAt.getTime())),this.isLoading.set(!1)})}onClickEdit(i,t){C("CommentListComponent.onClickEdit()"),t.isEditing=!0}async doDeleteRequest(i){let t={pageId:this.pageId(),commentId:i.store.id};try{await this.funcs.call("deleteComment",t),this.toastr.info("\u524A\u9664\u7533\u8ACB\u3057\u307E\u3057\u305F\u3002\u627F\u8A8D\u5F8C\u306B\u524A\u9664\u3055\u308C\u307E\u3059\u3002")}catch(o){w("Error while delete request",o);let n=o instanceof Error?o.message:"Unknown error";this.toastr.error(`\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ( ${n} )`)}}async onClickDelete(i,t){C("onClickDelete()",i,t);let o=this.dialog.createHtmlBuilder(),n=new _t(`
<div>
\u7BA1\u7406\u4EBA\u306B\u627F\u8A8D\u3055\u308C\u305F\u5F8C\u3067\u524A\u9664\u3055\u308C\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F
</div>
`);o.setMessage(n).setType(1).setSize(1).setTitle("\u78BA\u8A8D").okButton(async()=>{await this.doDeleteRequest(t)}).cancelButton(()=>{}).open()}onClickReply(i,t){C("CommentListComponent.onClickReply()",i,t),t.isReplying=!0}onEditDismissed(i){C("CommentListComponent.onEditDismissed()"),i.isEditing=!1}onEditRequested(i){C("CommentListComponent.onEditRequested()"),i.isEditing=!1}onReplyRequested(i){C("CommentListComponent.onReplyRequested()"),i.isReplying=!1}onReplyDismissed(i){C("CommentListComponent.onReplyDismissed()"),i.isReplying=!1}onClickMoreComment(i){C("CommentListComponent.onClickMoreComment()")}async onClickApprove(i,t){C("CommentListComponent.onClickApprove()");let o={pageId:this.pageId(),commentId:t.store.id};try{await this.funcs.call("approveComment",o),this.toastr.info("\u627F\u8A8D\u3057\u307E\u3057\u305F\u3002")}catch(n){w("Error while approve",n);let c=n instanceof Error?n.message:"Unknown error";this.toastr.error(`\u627F\u8A8D\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${c} )`)}}async onClickReject(i,t){C("CommentListComponent.onClickReject()");let o={pageId:this.pageId(),commentId:t.store.id};try{await this.funcs.call("rejectComment",o),this.toastr.info("\u5374\u4E0B\u3057\u307E\u3057\u305F\u3002")}catch(n){w("Error while reject",n);let c=n instanceof Error?n.message:"Unknown error";this.toastr.error(`\u5374\u4E0B\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${c} )`)}}async onClickProtect(i,t){C("CommentListComponent.onClickProtect()");let o={pageId:this.pageId(),commentId:t.store.id};try{await this.funcs.call("protectComment",o),this.toastr.info("\u4FDD\u8B77\u3057\u307E\u3057\u305F\u3002")}catch(n){w("Error while protect",n);let c=n instanceof Error?n.message:"Unknown error";this.toastr.error(`\u4FDD\u8B77\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${c} )`)}}async onClickUnProtect(i,t){C("CommentListComponent.onClickUnProtect()");let o={pageId:this.pageId(),commentId:t.store.id,unprotect:!0};try{await this.funcs.call("protectComment",o),this.toastr.info("\u4FDD\u8B77\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")}catch(n){w("Error while unprotect",n);let c=n instanceof Error?n.message:"Unknown error";this.toastr.error(`\u4FDD\u8B77\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${c} )`)}}static \u0275fac=function(t){return new(t||e)(v($),v(Q),v(It),v(K),v(M),v(k))};static \u0275cmp=S({type:e,selectors:[["gitfire-comment-list"]],inputs:{pageId:[1,"pageId"],isPageProtect:[1,"isPageProtect"]},outputs:{pageId:"pageIdChange",isPageProtect:"isPageProtectChange"},decls:2,vars:2,consts:[["loadingMessage",""],["role","status",1,"spinner-border","text-primary"],[3,"id","background"],["title","\u53E4\u3044\u6295\u7A3F\u3092\u3055\u3089\u306B\u8AAD\u307F\u8FBC\u307F\u307E\u3059\u3002",1,"btn","btn-primary"],[3,"id"],[3,"title"],[1,"mx-1"],["data-bs-toggle","dropdown",1,"mx-2",2,"position","absolute","right","0px"],[2,"height","2rem"],[3,"userPublic"],[1,"m-1"],[1,"border","border-danger","text-danger","m-1","p-1"],[1,"text-warning"],[1,"text-info"],[1,"p-2"],[1,"m-2"],["title","\u3053\u306E\u30B3\u30E1\u30F3\u30C8\u3078\u8FD4\u4FE1\u3057\u307E\u3059\u3002",1,"btn","btn-primary","m-1"],[1,"gitweeMenuItem"],[1,"dropdown-menu"],["title","\u4FDD\u7559\u72B6\u614B\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem"],["title","\u7DE8\u96C6\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem"],["title","\u524A\u9664\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem"],["title","\u4FDD\u7559\u72B6\u614B\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem"],["title","\u7DE8\u96C6\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem"],["title","\u524A\u9664\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem"],["title","\u30B3\u30E1\u30F3\u30C8\u3092\u4FDD\u8B77\u3057\u307E\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem"],["title","\u30B3\u30E1\u30F3\u30C8\u4FDD\u8B77\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem"],["title","\u4FDD\u7559\u72B6\u614B\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7DE8\u96C6\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524A\u9664\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u627F\u8A8D\u3057\u307E\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u4FDD\u7559\u72B6\u614B\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7DE8\u96C6\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524A\u9664\u7533\u8ACB\u3055\u308C\u305F\u30B3\u30E1\u30F3\u30C8\u3092\u62D2\u5426\u3057\u307E\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30B3\u30E1\u30F3\u30C8\u3092\u4FDD\u8B77\u3057\u307E\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30B3\u30E1\u30F3\u30C8\u4FDD\u8B77\u3092\u89E3\u9664\u3057\u307E\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],[1,"p-2",3,"innerHTML"],[3,"pageId","editModel","showDismiss"],[3,"requestSent","editDismiss","pageId","editModel","showDismiss"],[1,"border","border-info"],[1,"border","border-warning"],[3,"innerHTML"],[4,"ngTemplateOutlet"],["title","\u3053\u306E\u30B3\u30E1\u30F3\u30C8\u3078\u8FD4\u4FE1\u3057\u307E\u3059\u3002",1,"btn","btn-primary","m-1",3,"click"],["title","\u6295\u7A3F\u306E\u524A\u9664\u3092\u7533\u8ACB\u3057\u307E\u3059\u3002",1,"btn","btn-warning","m-1",3,"click"],["title","\u30B3\u30E1\u30F3\u30C8\u3092\u7DE8\u96C6\u3057\u307E\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[3,"requestSent","editDismiss","showDismiss","replyId","pageId"],["title","\u53E4\u3044\u6295\u7A3F\u3092\u3055\u3089\u306B\u8AAD\u307F\u8FBC\u307F\u307E\u3059\u3002",1,"btn","btn-primary",3,"click"]],template:function(t,o){if(t&1&&(l(0,Gt,1,0,"span",1),l(1,Ne,4,1,"div")),t&2){let n;s(o.isLoading()?0:-1),m(),s((n=o.comments())?1:-1,n)}},dependencies:[ct,V,St,P,dt],styles:[".gitweeMenuItem[_ngcontent-%COMP%]{cursor:pointer}"]})};function We(e,i){if(e&1){let t=E();u(0,"button",7),x("click",function(){p(t);let n=r(4);return f(n.onClickProtect())}),d(1,"\u30DA\u30FC\u30B8\u3092\u4FDD\u8B77"),a()}}function Ge(e,i){if(e&1){let t=E();u(0,"button",8),x("click",function(){p(t);let n=r(4);return f(n.onClickUnProtect())}),d(1,"\u4FDD\u8B77\u3092\u89E3\u9664"),a()}}function ze(e,i){if(e&1&&(l(0,We,2,0,"button",5),l(1,Ge,2,0,"button",6)),e&2){let t=r();s(t.isProtect?-1:0),m(),s(t.isProtect?1:-1)}}function Je(e,i){e&1&&(u(0,"span",9)(1,"span",10),d(2,"\u30DA\u30FC\u30B8\u306F\u4FDD\u8B77\u3055\u308C\u3066\u3044\u307E\u3059"),a()())}function Ke(e,i){if(e&1&&l(0,Je,3,0,"span",9),e&2){let t=r();s(t.isProtect?0:-1)}}function Qe(e,i){if(e&1){let t=E();u(0,"button",11),x("click",function(n){p(t);let c=r(3);return f(c.onClickWatchPage(n,!0))}),d(1,"Watch(\u30C6\u30B9\u30C8\u4E2D)"),a(),u(2,"button",12),x("click",function(n){p(t);let c=r(3);return f(c.onClickWatchPage(n,!1))}),d(3,"Unwatch(\u30C6\u30B9\u30C8\u4E2D)"),a()}}function Xe(e,i){if(e&1&&(u(0,"span",13),d(1),a()),e&2){let t=r(2);m(),B("(\u4FDD\u7559 ",t.countPending," \u4EF6)")}}function Ye(e,i){if(e&1&&(u(0,"div",4)(1,"span"),d(2),a(),l(3,Xe,2,1,"span",13),a()),e&2){let t=r();m(2),B("",t.countAll," \u4EF6\u306E\u30B3\u30E1\u30F3\u30C8"),m(),s(t.countPending>0?3:-1)}}function Ze(e,i){e&1&&(u(0,"div",1),d(1,"\u30B3\u30E1\u30F3\u30C8\u306F\u3042\u308A\u307E\u305B\u3093"),a())}function ti(e,i){if(e&1&&(u(0,"div")(1,"div",1),l(2,ze,2,2),l(3,Ke,1,1),l(4,Qe,4,0),a(),l(5,Ye,4,2,"div",4)(6,Ze,2,0,"div",1),a()),e&2){let t=r(2);m(2),s(t.auth.isAdmin?2:-1),m(),s(t.auth.isAdmin?-1:3),m(),s(t.auth.hasMessaging?4:-1),m(),s(i.countAll>0?5:6)}}function ei(e,i){e&1&&(u(0,"div",1),d(1,"\u30B3\u30E1\u30F3\u30C8\u306F\u3042\u308A\u307E\u305B\u3093"),a())}function ii(e,i){if(e&1&&F(0,"gitfire-comment-editor",2),e&2){let t=r(2);g("pageId",t.pageId())}}function ni(e,i){if(e&1&&(u(0,"div"),l(1,ti,7,4,"div"),h(2,"async"),I(3,ei,2,0,"div",1),u(4,"div"),l(5,ii,1,1,"gitfire-comment-editor",2),h(6,"async"),F(7,"gitfire-comment-list",3),h(8,"async"),a()()),e&2){let t,o,n,c=r();m(),s((t=y(2,4,c.pageInfo$))?1:3,t),m(4),s((o=y(6,6,c.pageInfo$))!=null&&o.isProtect?-1:5),m(2),g("pageId",c.pageId())("isPageProtect",(n=y(8,8,c.pageInfo$))==null?null:n.isProtect)}}function oi(e,i){e&1&&F(0,"span",0)}var Mt=class e{constructor(i,t,o,n,c){this.auth=i;this.router=t;this.funcs=o;this.store=n;this.toastr=c;this.pageInfo$=this.pageId$.pipe(R(_=>z(this.env,()=>this.store.doc(`/comment/v1/page/${_}`).valueChanges().pipe(ot(1)))))}env=W(G);pagePath;pageJson;pageInfo$;pageId=O(null);pageId$=J(this.pageId).pipe(N(i=>!!i));pagePath2PageKey(i){let t=`${L.PAGE_DATA}/`,o=t.length,n=i.jsonPath;if(!n.startsWith(t))throw new Error(`Not a supported path ${n}`);return n.substring(o-1)}buildLeafUrl(){let i=this.pageJson;return i.anchorLink?i.anchorId?`${i.anchorLink}#${i.anchorId}`:i.anchorLink:this.router.url}async ngOnInit(){C("CommentEntryComponent.OnInit()",this.pagePath);let i=this.pageJson?.pageKey||this.pagePath2PageKey(this.pagePath),t=this.buildLeafUrl(),o={pageKey:i,leafUrl:t},n=await this.funcs.call("getPageId",o);this.pageId.set(n),C("getPageId",n,o)}async doProtectPage(i){let t={pageId:this.pageId(),unprotect:i};await this.funcs.call("protectPage",t)}async onClickUnProtect(){C("CommentEntryComponent.onClickUnProtect()");try{this.doProtectPage(!0),this.toastr.info("\u30DA\u30FC\u30B8\u306E\u4FDD\u8B77\u3092\u89E3\u9664\u3057\u307E\u3057\u305F\u3002")}catch(i){w(i);let t=i instanceof Error?i.message:"Unknown error";this.toastr.error(`\u30DA\u30FC\u30B8\u306E\u4FDD\u8B77\u3092\u89E3\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${t} )`)}}async onClickWatchPage(i,t){C("CommentEntryComponent.onClickWatchPage()");try{let o={pageId:this.pageId(),isWatch:t};await this.funcs.call("watchCommentPage",o),this.toastr.info(t?"\u30DA\u30FC\u30B8\u306E Watch \u3092\u958B\u59CB\u3057\u307E\u3057\u305F\u3002":"\u30DA\u30FC\u30B8\u3092 Watch \u3092\u505C\u6B62\u3057\u307E\u3057\u305F\u3002")}catch(o){w(o);let n=o instanceof Error?o.message:"Unknown error";this.toastr.error(`\u30DA\u30FC\u30B8\u306E Watch \u72B6\u614B\u3092\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${n} )`)}}async onClickProtect(){C("CommentEntryComponent.onClickProtect()");try{this.doProtectPage(!1),this.toastr.info("\u30DA\u30FC\u30B8\u3092\u4FDD\u8B77\u3057\u307E\u3057\u305F\u3002")}catch(i){w(i);let t=i instanceof Error?i.message:"Unknown error";this.toastr.error(`\u30DA\u30FC\u30B8\u3092\u4FDD\u8B77\u72B6\u614B\u306B\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 ( ${t} )`)}}static \u0275fac=function(t){return new(t||e)(v($),v(Ct),v(M),v(K),v(k))};static \u0275cmp=S({type:e,selectors:[["gitfire-comment-entry"]],inputs:{pagePath:"pagePath",pageJson:"pageJson"},decls:3,vars:1,consts:[["role","status",1,"spinner-border","text-primary"],[1,"text-end"],[3,"pageId"],[3,"pageId","isPageProtect"],[1,"m-1","text-end"],["title","\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u7981\u6B62\u3057\u307E\u3059\u3002",1,"btn","btn-danger","m-1"],["title","\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u53EF\u80FD\u306B\u3057\u307E\u3059\u3002",1,"btn","btn-info","m-1"],["title","\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u7981\u6B62\u3057\u307E\u3059\u3002",1,"btn","btn-danger","m-1",3,"click"],["title","\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3092\u53EF\u80FD\u306B\u3057\u307E\u3059\u3002",1,"btn","btn-info","m-1",3,"click"],[1,"p-1","border","border-danger"],[1,"text-danger"],["title","\u3053\u306E\u6A5F\u80FD\u306F\u8A66\u9A13\u904B\u7528\u4E2D\u3067\u3059\u3002\u3053\u306E\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3001\u66F4\u65B0\u3092\u901A\u77E5\u3057\u307E\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],["title","\u3053\u306E\u6A5F\u80FD\u306F\u8A66\u9A13\u904B\u7528\u4E2D\u3067\u3059\u3002\u3053\u306E\u30DA\u30FC\u30B8\u3078\u306E\u30B3\u30E1\u30F3\u30C8\u3001\u66F4\u65B0\u901A\u77E5\u3092\u505C\u6B62\u3057\u307E\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[1,"text-warning"]],template:function(t,o){t&1&&(F(0,"hr"),l(1,ni,9,10,"div")(2,oi,1,0,"span",0)),t&2&&(m(),s(o.pageId()?1:2))},dependencies:[V,X,P],encapsulation:2})};export{V as a,X as b,Mt as c};
