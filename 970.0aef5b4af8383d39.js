"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[970],{681(N,L,s){s.d(L,{g:()=>M});var D=s(9769),_=s(5547);function f(o,n){1&o&&(_.j41(0,"span",2),_.EFF(1,"[\u524a\u9664]"),_.k0s())}function O(o,n){1&o&&_.nrm(0,"img",5),2&o&&_.Y8G("src",_.mNQ(n.$implicit),_.B4B)}function U(o,n){if(1&o&&(_.j41(0,"span",3),_.DNE(1,O,1,2,"img",4),_.EFF(2),_.k0s()),2&o){const G=n.$implicit;_.Y8G("title",_.mNQ(G.about)),_.R7$(),_.Y8G("ngIf",G.photoURL),_.R7$(),_.JRh(G.nickname)}}let M=(()=>{class o{userPublic;constructor(){}static \u0275fac=function(h){return new(h||o)};static \u0275cmp=_.VBU({type:o,selectors:[["gitfire-user-box"]],inputs:{userPublic:"userPublic"},decls:3,vars:2,consts:[["voidUser",""],["class","p-1",3,"title",4,"ngIf","ngIfElse"],["title","\u524a\u9664\u3055\u308c\u305f\u30e6\u30fc\u30b6\u3067\u3059",1,"text-warning"],[1,"p-1",3,"title"],["class","p-1","style","height: 100%; width: 2rem;",3,"src",4,"ngIf"],[1,"p-1",2,"height","100%","width","2rem",3,"src"]],template:function(h,I){if(1&h&&_.DNE(0,f,2,0,"ng-template",null,0,_.C5r)(2,U,3,4,"span",1),2&h){const p=_.sdS(1);_.R7$(2),_.Y8G("ngIf",I.userPublic)("ngIfElse",p)}},dependencies:[D.MD,D.bT],encapsulation:2})}return o})()},3371(N,L,s){s.d(L,{O:()=>I});var D=s(9769),_=s(9417),f=s(375),O=s(3049),U=s(8531),M=s(3562),o=s(5312),n=s(5547);function G(p,C){1&p&&n.nrm(0,"span",12)}function h(p,C){if(1&p&&(n.qex(0),n.j41(1,"div",10),n.nrm(2,"div",13),n.k0s(),n.bVm()),2&p){const t=n.XpG();n.R7$(2),n.Y8G("innerHTML",t.tosJson.html,n.npT)}}let I=(()=>{class p extends U.s{confirmed=new f.bkB;inputConfirmForm;tosJson;constructor(){super()}ngOnInit(){(0,o.Oi)("TosConfirmComponent.OnInit()"),this.inputConfirmForm=new _.gE({}),this.inputConfirmForm.addControl("neverConfirmTosCheck",new _.MJ(!1))}ngAfterViewInit(){(0,o.Oi)("TosConfirmComponent.AfterViewInit()")}get neverCheckTosControl(){return this.inputConfirmForm.get("neverConfirmTosCheck")}onClickConfirm(t){if(t.preventDefault(),this.inputConfirmForm.markAllAsTouched(),this.inputConfirmForm.invalid)return;const b=new M.n,R=this.inputConfirmForm.get("neverConfirmTosCheck");b.saveNeverAsk=R.value,b.isConfirmed=!0,this.confirmed.emit(b)}static \u0275fac=function(b){return new(b||p)};static \u0275cmp=n.VBU({type:p,selectors:[["gitfire-tos-confirm"]],inputs:{tosJson:"tosJson"},outputs:{confirmed:"confirmed"},features:[n.Vt3],decls:19,vars:6,consts:[["loadingTemplate",""],[1,"container"],[4,"ngIf","ngIfElse"],[1,"text-center"],[3,"formGroup"],[1,"m-5","custom-control","custom-checkbox"],["for","appGitfireTosConfirmNeverDismissCheck",1,"visually-hidden"],["id","appGitfireTosConfirmNeverDismissCheck","name","neverConfirmTosCheck","formControlName","neverConfirmTosCheck","type","checkbox",1,"form-check-input"],[1,"text-muted","fw-light"],["routerLink","/terms.htm"],[1,"m-3"],["id","appGitfireTosConfirmButton","data-bs-dismiss","modal",1,"btn","btn-success",3,"click","disabled"],["role","status",1,"spinner-border","text-primary"],[3,"innerHTML"]],template:function(b,R){if(1&b){const W=n.RV6();n.DNE(0,G,1,0,"ng-template",null,0,n.C5r),n.j41(2,"div",1),n.DNE(3,h,3,1,"ng-container",2),n.j41(4,"div",3)(5,"form",4)(6,"div",5)(7,"label",6),n.EFF(8,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),n.k0s(),n.nrm(9,"input",7),n.EFF(10,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),n.k0s(),n.j41(11,"div",8),n.EFF(12,"\u8a73\u3057\u304f\u306f"),n.j41(13,"a",9),n.EFF(14,"[\u5229\u7528\u898f\u7d04]"),n.k0s(),n.EFF(15,"\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002 "),n.k0s(),n.j41(16,"div",10)(17,"button",11),n.bIt("click",function($){return f.eBV(W),f.Njj(R.onClickConfirm($))}),n.EFF(18,"\u78ba\u8a8d\u3057\u307e\u3057\u305f"),n.k0s()()()()()}if(2&b){const W=n.sdS(1);n.R7$(3),n.Y8G("ngIf",R.tosJson)("ngIfElse",W),n.R7$(2),n.Y8G("formGroup",R.inputConfirmForm),n.R7$(),n.AVh("was-validated",R.neverCheckTosControl.dirty||R.neverCheckTosControl.touched),n.R7$(11),n.Y8G("disabled",!R.inputConfirmForm.valid)}},dependencies:[D.MD,D.bT,_.X1,_.qT,_.Zm,_.BC,_.cb,_.j4,_.JD,O.Wk],encapsulation:2})}return p})()},3562(N,L,s){s.d(L,{O:()=>_,n:()=>D});class D{saveNeverAsk;isConfirmed}var _=function(f){return f[f.Ok=0]="Ok",f[f.No=1]="No",f[f.OkPermanent=2]="OkPermanent",f}(_||{})},4710(N,L,s){s.d(L,{F:()=>ht});var D=s(467),_=s(9769),f=s(6354),O=s(5558),U=s(6977),M=s(1413),o=s(7673),n=s(5371),G=s(681),h=s(619),I=s(2275),p=s(5312),C=s(375),t=s(5547),b=s(1474),R=s(9243),W=s(8334),j=s(4871),$=s(5794);function F(i,m){1&i&&t.nrm(0,"span",3)}function x(i,m){if(1&i&&(t.j41(0,"span",21)(1,"small",7),t.nI1(2,"date"),t.EFF(3),t.nI1(4,"date"),t.k0s()()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("title",t.mNQ(t.i5U(2,3,e.updatedAt,"yyyy-MM-dd HH:mm"))),t.R7$(2),t.SpI("\u66f4\u65b0\u65e5: ",t.i5U(4,6,e.updatedAt,"yyyy-MM-dd"))}}function E(i,m){if(1&i&&(t.j41(0,"span",21)(1,"small"),t.EFF(2),t.nI1(3,"date"),t.k0s()()),2&i){const e=t.XpG().$implicit;t.R7$(2),t.SpI("\u627f\u8a8d\u65e5: ",t.i5U(3,1,e.decisionAt,"yyyy-MM-dd"))}}function T(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",33),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickApprove(r,c))}),t.EFF(1,"\u627f\u8a8d"),t.k0s()}}function B(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",34),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickApprove(r,c))}),t.EFF(1,"\u7de8\u96c6\u627f\u8a8d"),t.k0s()}}function Y(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",35),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickApprove(r,c))}),t.EFF(1,"\u524a\u9664\u627f\u8a8d"),t.k0s()}}function A(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",36),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickReject(r,c))}),t.EFF(1,"\u62d2\u5426"),t.k0s()}}function w(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",37),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickReject(r,c))}),t.EFF(1,"\u7de8\u96c6\u62d2\u5426"),t.k0s()}}function d(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",38),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickReject(r,c))}),t.EFF(1,"\u7de8\u96c6\u62d2\u5426"),t.k0s()}}function k(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",39),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickProtect(r,c))}),t.EFF(1,"\u4fdd\u8b77"),t.k0s()}}function a(i,m){if(1&i){const e=t.RV6();t.j41(0,"a",40),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2).$implicit,l=t.XpG(2);return C.Njj(l.onClickUnProtect(r,c))}),t.EFF(1,"\u4fdd\u8b77\u89e3\u9664"),t.k0s()}}function g(i,m){if(1&i&&(t.j41(0,"span",22)(1,"span",23),t.EFF(2,"\ufe19"),t.k0s(),t.j41(3,"div",24),t.DNE(4,T,2,0,"a",25)(5,B,2,0,"a",26)(6,Y,2,0,"a",27)(7,A,2,0,"a",28)(8,w,2,0,"a",29)(9,d,2,0,"a",30)(10,k,2,0,"a",31)(11,a,2,0,"a",32),t.k0s()()),2&i){const e=t.XpG().$implicit;t.R7$(4),t.Y8G("ngIf","pending"===e.store.state),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&"edit-request"===e.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&"delete-request"===e.store.editedState),t.R7$(),t.Y8G("ngIf","pending"===e.store.state),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&"edit-request"===e.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&"delete-request"===e.store.editedState),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&!e.store.isAdminEdit),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&e.store.isAdminEdit)}}function v(i,m){1&i&&t.nrm(0,"gitfire-user-box",41),2&i&&t.Y8G("userPublic",m.$implicit)}function P(i,m){1&i&&(t.j41(0,"span",42),t.EFF(1,"\u7ba1\u7406\u4eba\u306b\u3088\u308b\u4fdd\u8b77"),t.k0s())}function X(i,m){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u5374\u4e0b\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3067\u3059\u3002"),t.k0s())}function K(i,m){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u627f\u8a8d\u5f85\u3061\u306e\u30b3\u30e1\u30f3\u30c8\u3067\u3059\u3002"),t.k0s())}function V(i,m){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function S(i,m){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u7de8\u96c6\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function J(i,m){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u524a\u9664\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u307e\u3057\u305f\u3002"),t.k0s())}function H(i,m){1&i&&(t.j41(0,"span",43),t.EFF(1,"\u524a\u9664\u7533\u8acb\u4e2d\u3067\u3059\u3002"),t.k0s())}function Q(i,m){1&i&&(t.j41(0,"span",44),t.EFF(1,"\u7de8\u96c6\u7533\u8acb\u4e2d\u3067\u3059\u3002"),t.k0s())}function z(i,m){if(1&i&&(t.qex(0)(1,14),t.DNE(2,S,2,0,"span",15)(3,J,2,0,"span",15)(4,H,2,0,"span",15)(5,Q,2,0,"span",16),t.bVm()()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngSwitch",e.store.editedState),t.R7$(),t.Y8G("ngSwitchCase","edit-rejected"),t.R7$(),t.Y8G("ngSwitchCase","delete-rejected"),t.R7$(),t.Y8G("ngSwitchCase","delete-request"),t.R7$(),t.Y8G("ngSwitchCase","edit-request")}}function Z(i,m){if(1&i){const e=t.RV6();t.qex(0),t.j41(1,"gitfire-comment-editor",46),t.bIt("requestSent",function(){C.eBV(e);const r=t.XpG(3).$implicit,c=t.XpG(2);return C.Njj(c.onEditRequested(r))})("editDismiss",function(){C.eBV(e);const r=t.XpG(3).$implicit,c=t.XpG(2);return C.Njj(c.onEditDismissed(r))}),t.k0s(),t.bVm()}if(2&i){const e=m.$implicit,u=t.XpG(5);t.R7$(),t.Y8G("pageId",u.pageId)("editModel",e)("showDismiss",!0)}}function q(i,m){if(1&i&&(t.qex(0),t.DNE(1,Z,2,3,"ng-container",2),t.nI1(2,"async"),t.bVm()),2&i){const e=t.XpG(2).$implicit;t.R7$(),t.Y8G("ngIf",t.bMT(2,1,e.editor$))}}function tt(i,m){if(1&i&&t.nrm(0,"div",47),2&i){const e=t.XpG(2).$implicit;t.Y8G("innerHTML",e.store.messageHtml,t.npT)}}function nt(i,m){if(1&i&&(t.j41(0,"div"),t.DNE(1,q,3,3,"ng-container",2)(2,tt,1,1,"div",45),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",e.isEditing),t.R7$(),t.Y8G("ngIf","approved"===e.store.state&&!e.isEditing)}}function et(i,m){if(1&i&&t.nrm(0,"div",47),2&i){const e=t.XpG(2).$implicit;t.Y8G("innerHTML",e.store.messageHtml,t.npT)}}function it(i,m){if(1&i&&(t.qex(0),t.DNE(1,et,1,1,"div",45),t.bVm()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf","approved"===e.store.state)}}function ot(i,m){1&i&&t.nrm(0,"span",3)}function st(i,m){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",m.$implicit.messageHtml,t.npT)}function rt(i,m){if(1&i&&(t.j41(0,"div",51)(1,"span",44),t.EFF(2,"\u7533\u8acb\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,st,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG();const e=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",e)}}function ut(i,m){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",m.$implicit.messageHtml,t.npT)}function _t(i,m){if(1&i&&(t.j41(0,"div",54)(1,"span",43),t.EFF(2,"\u5374\u4e0b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,ut,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG();const e=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",e)}}function at(i,m){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",m.$implicit.messageHtml,t.npT)}function mt(i,m){if(1&i&&(t.j41(0,"div",51)(1,"span",44),t.EFF(2,"\u7de8\u96c6\u7533\u8acb\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,at,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG(2);const e=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",e)}}function ct(i,m){1&i&&t.nrm(0,"div",53),2&i&&t.Y8G("innerHTML",m.$implicit.messageHtml,t.npT)}function dt(i,m){if(1&i&&(t.j41(0,"div",54)(1,"span",43),t.EFF(2,"\u7de8\u96c6\u7533\u8acb\u304c\u5374\u4e0b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8"),t.k0s(),t.DNE(3,ct,1,1,"div",52),t.nI1(4,"async"),t.k0s()),2&i){t.XpG(2);const e=t.sdS(2),u=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf",t.bMT(4,2,u.privateMessage$))("ngIfElse",e)}}function lt(i,m){if(1&i&&(t.j41(0,"div"),t.DNE(1,mt,5,4,"div",49)(2,dt,5,4,"div",50),t.k0s()),2&i){const e=t.XpG(2).$implicit;t.R7$(),t.Y8G("ngIf","edit-request"===e.store.editedState),t.R7$(),t.Y8G("ngIf","edit-rejected"===e.store.editedState)}}function pt(i,m){if(1&i&&(t.j41(0,"div",48),t.DNE(1,ot,1,0,"ng-template",null,0,t.C5r)(3,rt,5,4,"div",49)(4,_t,5,4,"div",50)(5,lt,3,2,"div",2),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(3),t.Y8G("ngIf","pending"===e.store.state),t.R7$(),t.Y8G("ngIf","rejected"===e.store.state),t.R7$(),t.Y8G("ngIf","approved"===e.store.state)}}function Ct(i,m){if(1&i){const e=t.RV6();t.qex(0),t.j41(1,"button",55),t.bIt("click",function(r){C.eBV(e);const c=t.XpG().$implicit,l=t.XpG(2);return C.Njj(l.onClickReply(r,c))}),t.EFF(2,"\u8fd4\u4fe1"),t.k0s(),t.bVm()}}function Et(i,m){if(1&i){const e=t.RV6();t.qex(0),t.j41(1,"button",56),t.bIt("click",function(r){C.eBV(e);const c=t.XpG().$implicit,l=t.XpG(2);return C.Njj(l.onClickDelete(r,c))}),t.EFF(2,"\u524a\u9664"),t.k0s(),t.j41(3,"button",57),t.bIt("click",function(r){C.eBV(e);const c=t.XpG().$implicit,l=t.XpG(2);return C.Njj(l.onClickEdit(r,c))}),t.EFF(4,"\u7de8\u96c6"),t.k0s(),t.bVm()}}function gt(i,m){if(1&i){const e=t.RV6();t.j41(0,"div",19)(1,"gitfire-comment-editor",58),t.bIt("requestSent",function(){C.eBV(e);const r=t.XpG().$implicit,c=t.XpG(2);return C.Njj(c.onReplyRequested(r))})("editDismiss",function(){C.eBV(e);const r=t.XpG().$implicit,c=t.XpG(2);return C.Njj(c.onReplyDismissed(r))}),t.k0s()()}if(2&i){const e=t.XpG().$implicit,u=t.XpG(2);t.R7$(),t.Y8G("showDismiss",!0)("replyId",e.store.id)("pageId",u.pageId)}}function ft(i,m){if(1&i&&(t.j41(0,"div",6)(1,"div")(2,"div")(3,"span",7),t.nI1(4,"date"),t.EFF(5),t.nI1(6,"date"),t.k0s(),t.DNE(7,x,5,9,"span",8)(8,E,4,4,"span",8)(9,g,12,8,"span",9),t.k0s(),t.j41(10,"div",10),t.EFF(11,"\u30e6\u30fc\u30b6: "),t.DNE(12,v,1,1,"gitfire-user-box",11),t.nI1(13,"async"),t.k0s()(),t.j41(14,"div",12)(15,"div"),t.DNE(16,P,2,0,"span",13),t.qex(17,14),t.DNE(18,X,2,0,"span",15)(19,K,2,0,"span",16)(20,V,2,0,"span",16)(21,z,6,5,"ng-container",17),t.bVm(),t.k0s(),t.j41(22,"div"),t.DNE(23,nt,3,2,"div",2)(24,it,2,1,"ng-container",2),t.k0s(),t.DNE(25,pt,6,3,"div",18),t.k0s(),t.j41(26,"div",19),t.DNE(27,Ct,3,0,"ng-container",2)(28,Et,5,0,"ng-container",2),t.k0s(),t.DNE(29,gt,2,3,"div",20),t.k0s()),2&i){const e=m.$implicit,u=m.odd,r=t.XpG(2);t.xc7("background",u?r.ACCENT_COLOR:null),t.Y8G("id",t.VkB("appGitfireComment-",e.store.id)),t.R7$(3),t.Y8G("title",t.mNQ(t.i5U(4,23,e.publishAt,"yyyy-MM-dd HH:mm"))),t.R7$(2),t.SpI("\u6295\u7a3f\u65e5\u6642: ",t.i5U(6,26,e.publishAt,"yyyy-MM-dd HH:mm")),t.R7$(2),t.Y8G("ngIf",e.isEdited),t.R7$(),t.Y8G("ngIf",e.decisionAt),t.R7$(),t.Y8G("ngIf",e.isDisplayAdmin),t.R7$(3),t.Y8G("ngIf",t.bMT(13,29,e.user$)),t.R7$(4),t.Y8G("ngIf",e.store.isAdminEdit),t.R7$(),t.Y8G("ngSwitch",e.store.state),t.R7$(),t.Y8G("ngSwitchCase","rejected"),t.R7$(),t.Y8G("ngSwitchCase","pending"),t.R7$(),t.Y8G("ngSwitchCase","deleted"),t.R7$(),t.Y8G("ngSwitchCase","approved"),t.R7$(2),t.Y8G("ngIf",e.isOwn),t.R7$(),t.Y8G("ngIf",!e.isOwn),t.R7$(),t.Y8G("ngIf",e.isOwn||e.isDisplayAdmin),t.R7$(2),t.Y8G("ngIf",e.canReply),t.R7$(),t.Y8G("ngIf",e.canChange),t.R7$(),t.Y8G("ngIf",e.isReplying)}}function vt(i,m){if(1&i){const e=t.RV6();t.j41(0,"button",59),t.bIt("click",function(r){C.eBV(e);const c=t.XpG(2);return C.Njj(c.onClickMoreComment(r))}),t.EFF(1,"\u3055\u3089\u306b\u8aad\u307f\u8fbc\u3080"),t.k0s()}}function Dt(i,m){if(1&i&&(t.j41(0,"div"),t.DNE(1,ft,30,31,"div",4)(2,vt,2,0,"button",5),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.comments),t.R7$(),t.Y8G("ngIf",e.maybeMoreComment)}}class It{store;updatedAt;publishAt;decisionAt;isEdited;privateMessage$;editor$;user$;isEditing;isReplying;isDisplayAdmin;canReply;canChange;isOwn}let ht=(()=>{class i{auth;user;dialog;store;funcs;toastr;ACCENT_COLOR=p.cA.themaColor.EVEN;destroy$=new M.B;pageId;isPageProtect=!1;comments$;comments=[];commentData={};maybeMoreComment=!1;isLoading=!0;constructor(e,u,r,c,l,y){this.auth=e,this.user=u,this.dialog=r,this.store=c,this.funcs=l,this.toastr=y,this.comments$=this.store.doc(`/comment/v1/page/${this.pageId}`).collection("public",Ft=>Ft.orderBy("publishAt","desc").limit(30)).valueChanges({idField:"id"})}ngOnDestroy(){(0,p.Oi)("CommentListComponent.OnDestroy()"),this.destroy$.next()}ngOnInit(){(0,p.Oi)("CommentListComponent.OnInit()"),this.comments$.pipe((0,U.Q)(this.destroy$)).subscribe(e=>{for(let u of e){let r=this.commentData[u.id];r||(r=new It,this.comments.push(r)),r.publishAt=u.publishAt.toDate(),r.updatedAt=u.updatedAt.toDate();const c=r.updatedAt.getTime()-r.publishAt.getTime();r.isEdited="none"!==u.editedState&&Math.abs(c)>5,u.decisionAt&&(r.decisionAt=u.decisionAt.toDate()),r.user$=this.user.user$(u.owner),r.store=u,this.auth.myUid===u.owner||this.auth.isAdmin?r.privateMessage$||(r.privateMessage$=(0,o.of)({pageId:this.pageId,commentId:u.id}).pipe((0,O.n)(y=>this.funcs.call("readPrivateComment",y)),(0,f.T)(y=>y)),r.editor$=r.privateMessage$.pipe((0,f.T)(y=>({id:y.id,message:y.message,images:y.images})))):r.editor$=(0,o.of)({id:u.id,message:u.message,images:u.images}),r.isDisplayAdmin=this.auth.isAdmin,r.isOwn=u.owner===this.auth.myUid,r.canReply=!this.isPageProtect&&!r.isOwn&&"approved"==u.state&&!u.isProtect,r.canChange=r.isOwn&&!u.isAdminEdit&&!u.isProtect&&"approved"===u.state,this.commentData[u.id]=r}this.comments=this.comments.sort((u,r)=>r.publishAt.getTime()-u.publishAt.getTime()),this.isLoading=!1})}onClickEdit(e,u){(0,p.Oi)("CommentListComponent.onClickEdit()"),u.isEditing=!0}doDeleteRequest(e){var u=this;return(0,D.A)(function*(){const r={pageId:u.pageId,commentId:e.store.id};try{yield u.funcs.call("deleteComment",r),u.toastr.info("\u524a\u9664\u7533\u8acb\u3057\u307e\u3057\u305f\u3002\u627f\u8a8d\u5f8c\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002")}catch(c){(0,p.sJ)("Error while delete request",c);const l=c instanceof Error?c.message:"Unknown error";u.toastr.error(`\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002 ( ${l} )`)}})()}onClickDelete(e,u){var r=this;return(0,D.A)(function*(){(0,p.Oi)("onClickDelete()",e,u);const c=r.dialog.createHtmlBuilder(),l=new I.tt("\n<div>\n\u7ba1\u7406\u4eba\u306b\u627f\u8a8d\u3055\u308c\u305f\u5f8c\u3067\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n</div>\n");c.setMessage(l).setType(h.hs.Warn).setSize(h.EV.Default).setTitle("\u78ba\u8a8d").okButton((0,D.A)(function*(){yield r.doDeleteRequest(u)})).cancelButton(()=>{}).open()})()}onClickReply(e,u){(0,p.Oi)("CommentListComponent.onClickReply()",e,u),u.isReplying=!0}onEditDismissed(e){(0,p.Oi)("CommentListComponent.onEditDismissed()"),e.isEditing=!1}onEditRequested(e){(0,p.Oi)("CommentListComponent.onEditRequested()"),e.isEditing=!1}onReplyRequested(e){(0,p.Oi)("CommentListComponent.onReplyRequested()"),e.isReplying=!1}onReplyDismissed(e){(0,p.Oi)("CommentListComponent.onReplyDismissed()"),e.isReplying=!1}onClickMoreComment(e){(0,p.Oi)("CommentListComponent.onClickMoreComment()")}onClickApprove(e,u){var r=this;return(0,D.A)(function*(){(0,p.Oi)("CommentListComponent.onClickApprove()");const c={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("approveComment",c),r.toastr.info("\u627f\u8a8d\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,p.sJ)("Error while approve",l);const y=l instanceof Error?l.message:"Unknown error";r.toastr.error(`\u627f\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickReject(e,u){var r=this;return(0,D.A)(function*(){(0,p.Oi)("CommentListComponent.onClickReject()");const c={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("rejectComment",c),r.toastr.info("\u5374\u4e0b\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,p.sJ)("Error while reject",l);const y=l instanceof Error?l.message:"Unknown error";r.toastr.error(`\u5374\u4e0b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickProtect(e,u){var r=this;return(0,D.A)(function*(){(0,p.Oi)("CommentListComponent.onClickProtect()");const c={pageId:r.pageId,commentId:u.store.id};try{yield r.funcs.call("protectComment",c),r.toastr.info("\u4fdd\u8b77\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,p.sJ)("Error while protect",l);const y=l instanceof Error?l.message:"Unknown error";r.toastr.error(`\u4fdd\u8b77\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}onClickUnProtect(e,u){var r=this;return(0,D.A)(function*(){(0,p.Oi)("CommentListComponent.onClickUnProtect()");const c={pageId:r.pageId,commentId:u.store.id,unprotect:!0};try{yield r.funcs.call("protectComment",c),r.toastr.info("\u4fdd\u8b77\u89e3\u9664\u3057\u307e\u3057\u305f\u3002")}catch(l){(0,p.sJ)("Error while unprotect",l);const y=l instanceof Error?l.message:"Unknown error";r.toastr.error(`\u4fdd\u8b77\u89e3\u9664\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${y} )`)}})()}static \u0275fac=function(u){return new(u||i)(t.rXU(b.u),t.rXU(R.D),t.rXU(h.o3),t.rXU(W.Qe),t.rXU(j.Y),t.rXU($.tw))};static \u0275cmp=t.VBU({type:i,selectors:[["gitfire-comment-list"]],inputs:{pageId:"pageId",isPageProtect:"isPageProtect"},decls:2,vars:2,consts:[["loadingMessage",""],["class","spinner-border text-primary","role","status",4,"ngIf"],[4,"ngIf"],["role","status",1,"spinner-border","text-primary"],[3,"id","background",4,"ngFor","ngForOf"],["class","btn btn-primary","title","\u53e4\u3044\u6295\u7a3f\u3092\u3055\u3089\u306b\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002",3,"click",4,"ngIf"],[3,"id"],[3,"title"],["class","mx-1",4,"ngIf"],["class","mx-2","style","position: absolute; right: 0px;","data-bs-toggle","dropdown",4,"ngIf"],[2,"height","2rem"],[3,"userPublic",4,"ngIf"],[1,"m-1"],["class","border border-danger text-danger m-1 p-1",4,"ngIf"],[3,"ngSwitch"],["class","text-warning",4,"ngSwitchCase"],["class","text-info",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","p-2",4,"ngIf"],[1,"m-2"],["class","m-2",4,"ngIf"],[1,"mx-1"],["data-bs-toggle","dropdown",1,"mx-2",2,"position","absolute","right","0px"],[1,"gitweeMenuItem"],[1,"dropdown-menu"],["class","text-info dropdown-item gitweeMenuItem","title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-info dropdown-item gitweeMenuItem","title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-info dropdown-item gitweeMenuItem","title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-warning dropdown-item gitweeMenuItem","title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-danger dropdown-item gitweeMenuItem","title","\u30b3\u30e1\u30f3\u30c8\u3092\u4fdd\u8b77\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","text-danger dropdown-item gitweeMenuItem","title","\u30b3\u30e1\u30f3\u30c8\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u627f\u8a8d\u3057\u307e\u3059\u3002",1,"text-info","dropdown-item","gitweeMenuItem",3,"click"],["title","\u4fdd\u7559\u72b6\u614b\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u7de8\u96c6\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u524a\u9664\u7533\u8acb\u3055\u308c\u305f\u30b3\u30e1\u30f3\u30c8\u3092\u62d2\u5426\u3057\u307e\u3059\u3002",1,"text-warning","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u3092\u4fdd\u8b77\u3057\u307e\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3059\u3002",1,"text-danger","dropdown-item","gitweeMenuItem",3,"click"],[3,"userPublic"],[1,"border","border-danger","text-danger","m-1","p-1"],[1,"text-warning"],[1,"text-info"],["class","p-2",3,"innerHTML",4,"ngIf"],[3,"requestSent","editDismiss","pageId","editModel","showDismiss"],[1,"p-2",3,"innerHTML"],[1,"p-2"],["class","border border-info",4,"ngIf"],["class","border border-warning",4,"ngIf"],[1,"border","border-info"],[3,"innerHTML",4,"ngIf","ngIfElse"],[3,"innerHTML"],[1,"border","border-warning"],["title","\u3053\u306e\u30b3\u30e1\u30f3\u30c8\u3078\u8fd4\u4fe1\u3057\u307e\u3059\u3002",1,"btn","btn-primary","m-1",3,"click"],["title","\u6295\u7a3f\u306e\u524a\u9664\u3092\u7533\u8acb\u3057\u307e\u3059\u3002",1,"btn","btn-warning","m-1",3,"click"],["title","\u30b3\u30e1\u30f3\u30c8\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[3,"requestSent","editDismiss","showDismiss","replyId","pageId"],["title","\u53e4\u3044\u6295\u7a3f\u3092\u3055\u3089\u306b\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002",1,"btn","btn-primary",3,"click"]],template:function(u,r){1&u&&t.DNE(0,F,1,0,"span",1)(1,Dt,3,2,"div",2),2&u&&(t.Y8G("ngIf",r.isLoading),t.R7$(),t.Y8G("ngIf",r.comments))},dependencies:[_.MD,_.Sq,_.bT,_.ux,_.e1,n.m,G.g,_.Jj,_.vh],styles:[".gitweeMenuItem[_ngcontent-%COMP%]{cursor:pointer}"]})}return i})()},5371(N,L,s){s.d(L,{m:()=>$});var D=s(467),_=s(9769),f=s(9417),O=s(375),U=s(5964),M=s(5312),o=s(5547),n=s(9243),G=s(1474),h=s(5794),I=s(4871),p=s(7234);function C(F,x){if(1&F){const E=o.RV6();o.j41(0,"div",9)(1,"button",10),o.bIt("click",function(){O.eBV(E);const B=o.XpG();return O.Njj(B.onClickDismiss())}),o.j41(2,"span",11),o.EFF(3,"\xd7"),o.k0s()()()}}function t(F,x){1&F&&(o.j41(0,"div",12),o.EFF(1,"OK!"),o.k0s())}function b(F,x){1&F&&(o.j41(0,"div",14),o.EFF(1,"\u5165\u529b\u5fc5\u9808\u3067\u3059\u3002"),o.k0s())}function R(F,x){1&F&&(o.j41(0,"div",14),o.EFF(1,"\u9577\u3059\u304e\u307e\u3059\u3002"),o.k0s())}function W(F,x){1&F&&(o.j41(0,"div",14),o.EFF(1,"\u77ed\u3059\u304e\u307e\u3059\u3002"),o.k0s())}function j(F,x){if(1&F&&(o.qex(0),o.DNE(1,b,2,0,"div",13)(2,R,2,0,"div",13)(3,W,2,0,"div",13),o.bVm()),2&F){const E=o.XpG();o.R7$(),o.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.required),o.R7$(),o.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.maxlength),o.R7$(),o.Y8G("ngIf",null==E.textareaControl.errors?null:E.textareaControl.errors.minlength)}}let $=(()=>{class F{user;auth;toastr;funcs;tos;editModel;pageId;showDismiss=!1;replyId;requestSent=new O.bkB;editDismiss=new O.bkB;inputForm;constructor(E,T,B,Y,A){this.user=E,this.auth=T,this.toastr=B,this.funcs=Y,this.tos=A}get textareaControl(){return this.inputForm.get("commentText")}ngOnInit(){(0,M.Oi)("CommentEditorComponent.OnInit()"),this.inputForm=new f.gE({}),this.inputForm.addControl("commentText",new f.MJ(this.editModel?this.editModel.message:null,[f.k0.required]))}onClickDismiss(){(0,M.Oi)("CommentEditorComponent.onClickDismiss()"),this.editDismiss.emit()}doNewPost(){var E=this;return(0,D.A)(function*(){const T={message:E.textareaControl.value,pageId:E.pageId,replyId:E.replyId};return yield E.funcs.call("postComment",T)})()}doUpdatePost(E){var T=this;return(0,D.A)(function*(){const B={pageId:T.pageId,commentId:E.id,message:T.textareaControl.value};return yield T.funcs.call("editComment",B)})()}onClickPostComment(){var E=this;(0,M.Oi)("CommentEditorComponent.onClickPostComment()"),!this.inputForm.invalid&&(this.textareaControl.invalid||this.tos.confirmTos$(`${this.auth.myUid}/commentAgreement`,M.cA.CommentServiceTosUrl).pipe((0,U.p)(T=>T)).subscribe(function(){var T=(0,D.A)(function*(B){E.inputForm.disable();try{E.editModel?yield E.doUpdatePost(E.editModel):yield E.doNewPost(),E.toastr.info("\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002(\u627f\u8a8d\u3055\u308c\u308b\u307e\u3067\u4ed6\u306e\u4eba\u306b\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002)"),E.textareaControl.setValue(""),E.inputForm.markAsPristine(),E.inputForm.markAsUntouched(),E.requestSent.emit()}catch(Y){E.toastr.error("message"in Y?`\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002( ${Y.message} )`:"\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{E.inputForm.enable()}});return function(B){return T.apply(this,arguments)}}()))}static \u0275fac=function(T){return new(T||F)(o.rXU(n.D),o.rXU(G.u),o.rXU(h.tw),o.rXU(I.Y),o.rXU(p.u))};static \u0275cmp=o.VBU({type:F,selectors:[["gitfire-comment-editor"]],inputs:{editModel:"editModel",pageId:"pageId",showDismiss:"showDismiss",replyId:"replyId"},outputs:{requestSent:"requestSent",editDismiss:"editDismiss"},decls:16,vars:15,consts:[["class","text-end",4,"ngIf"],[1,"input-group",3,"formGroup"],["title","\u3053\u306e\u540d\u524d\u3067\u6295\u7a3f\u306f\u8868\u793a\u3055\u308c\u307e\u3059\u3002","src","/assets/octicons/question.svg",1,"m-1","octicon-info","help-icon"],["disabled","",1,"m-3",3,"value"],[1,"m-3"],["autofocus","","name","commentText","formControlName","commentText","placeholder","\u6295\u7a3f\u3059\u308b\u30b3\u30e1\u30f3\u30c8\u3092\u3053\u3053\u306b\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u3002","required","","minlength","5","maxlength","65536",1,"p-3","form-control"],["class","valid-feedback",4,"ngIf"],[4,"ngIf"],["title","\u30b3\u30e1\u30f3\u30c8\u5185\u5bb9\u306f\u627f\u8a8d\u5f8c\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002",1,"btn","btn-primary","m-2",3,"click","disabled"],[1,"text-end"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["aria-hidden","true"],[1,"valid-feedback"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]],template:function(T,B){1&T&&(o.DNE(0,C,4,0,"div",0),o.j41(1,"div",1)(2,"div")(3,"label"),o.EFF(4,"\u540d\u524d"),o.nrm(5,"img",2),o.EFF(6,": "),o.k0s(),o.nrm(7,"input",3),o.nI1(8,"async"),o.k0s(),o.j41(9,"div",4),o.nrm(10,"textarea",5),o.DNE(11,t,2,0,"div",6)(12,j,4,3,"ng-container",7),o.k0s(),o.j41(13,"div")(14,"button",8),o.bIt("click",function(){return B.onClickPostComment()}),o.EFF(15,"\u6295\u7a3f\u3059\u308b"),o.k0s()()()),2&T&&(o.Y8G("ngIf",B.showDismiss),o.R7$(),o.AVh("was-validated",B.textareaControl.dirty||B.textareaControl.touched),o.Y8G("formGroup",B.inputForm),o.R7$(6),o.Y8G("value",o.mNQ(o.bMT(8,13,B.user.myNickname$()))),o.R7$(2),o.xc7("width",100,"%"),o.R7$(),o.xc7("height",8,"rem"),o.R7$(),o.Y8G("ngIf",!B.textareaControl.invalid),o.R7$(),o.Y8G("ngIf",B.textareaControl.invalid),o.R7$(2),o.Y8G("disabled",B.textareaControl.invalid||B.inputForm.disabled))},dependencies:[_.MD,_.bT,f.X1,f.me,f.BC,f.cb,f.YS,f.xh,f.tU,f.j4,f.JD,_.Jj],encapsulation:2})}return F})()},7234(N,L,s){s.d(L,{u:()=>b});var D=s(467),_=s(375),f=s(7935),O=s(3562),U=s(3371),M=s(2275),o=s(1413),n=s(6354),G=s(5558),h=s(6697),I=s(5312),p=s(6674),C=s(619),t=s(8334);let b=(()=>{class R{http;dialog;store;privUser;env=(0,_.WQX)(_.uvJ);constructor(j,$,F){this.http=j,this.dialog=$,this.store=F,this.privUser=this.store.collection("/users/v1/protected")}constructSetupTosConfirm(j,$){return F=>{F.tosJson=$.json,F.confirmed.subscribe(x=>{if(!x.isConfirmed)throw new Error("assert");$.answer=x.saveNeverAsk?O.O.OkPermanent:O.O.Ok,j.next($)})}}confirmTos$(j,$){var F=this;if(j.match(/\/$/))throw new Error(`Assertion. Not a supported ${j}`);const x=new o.B,T=(new o.B,new o.B),B=new o.B,Y=this.http.fetchGhJson($).pipe((0,h.s)(1),(0,G.n)(A=>(0,_.N4e)(this.env,()=>{const w=this.privUser.doc(`${j}/${A.version}`),d={json:A,cached:!1,cacheRef:w};return w.get().pipe((0,n.T)((k,a)=>(k.exists&&k.data().alwaysConfirmed&&((0,I.Oi)("TOS has already been confirmed."),d.cached=!0),d)))})));return B.pipe().subscribe({next:A=>{this.dialog.createDefaultBuilder().prepareBody(U.O).setupChild(this.constructSetupTosConfirm(T,A)).setType(M.hs.Warn).setSize(M.EV.Default).setTitle("\u5229\u7528\u898f\u7d04\u306e\u78ba\u8a8d").closeButton(()=>{A.answer=O.O.No,T.next(A)}).setFinalize(()=>{A.answer=O.O.No,T.next(A)}).open()},complete:()=>{(0,I.Oi)("completeed dialog$")},error:A=>{(0,I.sJ)("error dialog$",A)}}),Y.pipe((0,h.s)(1)).subscribe({next:A=>{A.cached?x.next(!0):B.next(A)},complete:()=>{(0,I.Oi)("Completed TOS reading")},error:A=>{(0,I.sJ)("Failed reading TOS cache",A)}}),T.pipe((0,h.s)(1)).subscribe({next:(A=(0,D.A)(function*(w){switch(w.answer){case O.O.Ok:x.next(!0);break;case O.O.No:x.next(!1);break;case O.O.OkPermanent:const d={_docClass:"User:UserAgreementStore",alwaysConfirmed:!0,createdAt:F.fieldTimestamp()};x.next(!0),yield w.cacheRef.set(d);break;default:throw new Error(`Not a valid answer ${w.answer}`)}}),function(d){return A.apply(this,arguments)}),complete:()=>{(0,I.Oi)("Completed dialog result."),x.complete()},error:A=>{(0,I.sJ)("Failed receive dialog result"),x.complete()}}),x;var A}fieldTimestamp(){return f.A.firestore.FieldValue.serverTimestamp()}static \u0275fac=function($){return new($||R)(_.KVO(p.kl),_.KVO(C.o3),_.KVO(t.Qe))};static \u0275prov=_.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},9243(N,L,s){s.d(L,{D:()=>o});var D=s(375),_=s(7673),f=s(6354),O=s(9568),U=s(8334),M=s(1474);let o=(()=>{class n{store;auth;pubUser;nicknameCache={};userCache={};env=(0,D.WQX)(D.uvJ);constructor(h,I){this.store=h,this.auth=I,this.pubUser=this.store.collection("/users/v1/public")}myNickname$(){return this.auth.myUid?this.nickname$(this.auth.myUid):(0,_.of)("")}user$(h){let I=this.userCache[h];return I||(I=(0,D.N4e)(this.env,()=>this.pubUser.doc(h).valueChanges().pipe((0,O.t)(1))),this.userCache[h]=I,I)}nickname$(h){let I=this.nicknameCache[h];return I||(I=this.user$(h).pipe((0,f.T)(p=>p?p.nickname:null)),this.nicknameCache[h]=I,I)}static \u0275fac=function(I){return new(I||n)(D.KVO(U.Qe),D.KVO(M.u))};static \u0275prov=D.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},9970(N,L,s){s.r(L),s.d(L,{CommentEntryComponent:()=>w});var D=s(467),_=s(9769),f=s(9568),O=s(5371),U=s(4710),M=s(5312),o=s(375),n=s(5547),G=s(1474),h=s(1637),I=s(4871),p=s(8334),C=s(5794);function t(d,k){1&d&&n.nrm(0,"span",3)}function b(d,k){1&d&&(n.j41(0,"div",7),n.EFF(1,"\u30b3\u30e1\u30f3\u30c8\u306f\u3042\u308a\u307e\u305b\u3093"),n.k0s())}function R(d,k){if(1&d){const a=n.RV6();n.j41(0,"button",11),n.bIt("click",function(){o.eBV(a);const v=n.XpG(4);return o.Njj(v.onClickProtect())}),n.EFF(1,"\u30da\u30fc\u30b8\u3092\u4fdd\u8b77"),n.k0s()}}function W(d,k){if(1&d){const a=n.RV6();n.j41(0,"button",12),n.bIt("click",function(){o.eBV(a);const v=n.XpG(4);return o.Njj(v.onClickUnProtect())}),n.EFF(1,"\u4fdd\u8b77\u3092\u89e3\u9664"),n.k0s()}}function j(d,k){if(1&d&&(n.qex(0),n.DNE(1,R,2,0,"button",9)(2,W,2,0,"button",10),n.bVm()),2&d){const a=n.XpG().$implicit;n.R7$(),n.Y8G("ngIf",!a.isProtect),n.R7$(),n.Y8G("ngIf",a.isProtect)}}function $(d,k){1&d&&(n.j41(0,"span",14)(1,"span",15),n.EFF(2,"\u30da\u30fc\u30b8\u306f\u4fdd\u8b77\u3055\u308c\u3066\u3044\u307e\u3059"),n.k0s()())}function F(d,k){if(1&d&&(n.qex(0),n.DNE(1,$,3,0,"span",13),n.bVm()),2&d){const a=n.XpG().$implicit;n.R7$(),n.Y8G("ngIf",a.isProtect)}}function x(d,k){if(1&d){const a=n.RV6();n.qex(0),n.j41(1,"button",16),n.bIt("click",function(v){o.eBV(a);const P=n.XpG(3);return o.Njj(P.onClickWatchPage(v,!0))}),n.EFF(2,"Watch(\u30c6\u30b9\u30c8\u4e2d)"),n.k0s(),n.j41(3,"button",17),n.bIt("click",function(v){o.eBV(a);const P=n.XpG(3);return o.Njj(P.onClickWatchPage(v,!1))}),n.EFF(4,"Unwatch(\u30c6\u30b9\u30c8\u4e2d)"),n.k0s(),n.bVm()}}function E(d,k){if(1&d&&(n.j41(0,"span",20),n.EFF(1),n.k0s()),2&d){const a=n.XpG(2).$implicit;n.R7$(),n.SpI("(\u4fdd\u7559 ",a.countPending," \u4ef6)")}}function T(d,k){if(1&d&&(n.j41(0,"div",18)(1,"span"),n.EFF(2),n.k0s(),n.DNE(3,E,2,1,"span",19),n.k0s()),2&d){const a=n.XpG().$implicit;n.R7$(2),n.SpI("",a.countAll," \u4ef6\u306e\u30b3\u30e1\u30f3\u30c8"),n.R7$(),n.Y8G("ngIf",a.countPending>0)}}function B(d,k){if(1&d&&(n.j41(0,"div")(1,"div",7),n.DNE(2,j,3,2,"ng-container",2)(3,F,2,1,"ng-container",2)(4,x,5,0,"ng-container",2),n.k0s(),n.DNE(5,T,4,2,"div",8),n.k0s()),2&d){const a=k.$implicit;n.XpG();const g=n.sdS(2),v=n.XpG();n.R7$(2),n.Y8G("ngIf",v.auth.isAdmin),n.R7$(),n.Y8G("ngIf",!v.auth.isAdmin),n.R7$(),n.Y8G("ngIf",v.auth.hasMessaging),n.R7$(),n.Y8G("ngIf",a.countAll>0)("ngIfElse",g)}}function Y(d,k){if(1&d&&n.nrm(0,"gitfire-comment-editor",21),2&d){const a=n.XpG(2);n.Y8G("pageId",a.pageId)}}function A(d,k){if(1&d&&(n.j41(0,"div"),n.DNE(1,b,2,0,"ng-template",null,0,n.C5r)(3,B,6,5,"div",4),n.nI1(4,"async"),n.j41(5,"div"),n.DNE(6,Y,1,1,"gitfire-comment-editor",5),n.nI1(7,"async"),n.nrm(8,"gitfire-comment-list",6),n.nI1(9,"async"),n.k0s()()),2&d){let a,g;const v=n.sdS(2),P=n.XpG();n.R7$(3),n.Y8G("ngIf",n.bMT(4,5,P.pageInfo$))("ngIfElse",v),n.R7$(3),n.Y8G("ngIf",!(null!=(a=n.bMT(7,7,P.pageInfo$))&&a.isProtect)),n.R7$(2),n.Y8G("pageId",P.pageId)("isPageProtect",null==(g=n.bMT(9,9,P.pageInfo$))?null:g.isProtect)}}let w=(()=>{class d{auth;router;funcs;store;toastr;pagePath;pageJson;pageInfo$;pageId;constructor(a,g,v,P,X){this.auth=a,this.router=g,this.funcs=v,this.store=P,this.toastr=X,this.pageInfo$=this.store.doc(`/comment/v1/page/${this.pageId}`).valueChanges().pipe((0,f.t)(1))}pagePath2PageKey(a){const g=`${M.cA.PAGE_DATA}/`,v=g.length,P=a.jsonPath;if(!P.startsWith(g))throw new Error(`Not a supported path ${P}`);return P.substring(v-1)}buildLeafUrl(){const a=this.pageJson;return a.anchorLink?a.anchorId?`${a.anchorLink}#${a.anchorId}`:a.anchorLink:this.router.url}ngOnInit(){var a=this;return(0,D.A)(function*(){(0,M.Oi)("CommentEntryComponent.OnInit()",a.pagePath);const P={pageKey:a.pageJson?.pageKey||a.pagePath2PageKey(a.pagePath),leafUrl:a.buildLeafUrl()};a.pageId=yield a.funcs.call("getPageId",P),(0,M.Oi)("getPageId",a.pageId,P)})()}doProtectPage(a){var g=this;return(0,D.A)(function*(){const v={pageId:g.pageId,unprotect:a};yield g.funcs.call("protectPage",v)})()}onClickUnProtect(){var a=this;return(0,D.A)(function*(){(0,M.Oi)("CommentEntryComponent.onClickUnProtect()");try{a.doProtectPage(!0),a.toastr.info("\u30da\u30fc\u30b8\u306e\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3057\u305f\u3002")}catch(g){(0,M.sJ)(g);const v=g instanceof Error?g.message:"Unknown error";a.toastr.error(`\u30da\u30fc\u30b8\u306e\u4fdd\u8b77\u3092\u89e3\u9664\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${v} )`)}})()}onClickWatchPage(a,g){var v=this;return(0,D.A)(function*(){(0,M.Oi)("CommentEntryComponent.onClickWatchPage()");try{const P={pageId:v.pageId,isWatch:g};yield v.funcs.call("watchCommentPage",P),v.toastr.info(g?"\u30da\u30fc\u30b8\u306e Watch \u3092\u958b\u59cb\u3057\u307e\u3057\u305f\u3002":"\u30da\u30fc\u30b8\u3092 Watch \u3092\u505c\u6b62\u3057\u307e\u3057\u305f\u3002")}catch(P){(0,M.sJ)(P);const X=P instanceof Error?P.message:"Unknown error";v.toastr.error(`\u30da\u30fc\u30b8\u306e Watch \u72b6\u614b\u3092\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${X} )`)}})()}onClickProtect(){var a=this;return(0,D.A)(function*(){(0,M.Oi)("CommentEntryComponent.onClickProtect()");try{a.doProtectPage(!1),a.toastr.info("\u30da\u30fc\u30b8\u3092\u4fdd\u8b77\u3057\u307e\u3057\u305f\u3002")}catch(g){(0,M.sJ)(g);const v=g instanceof Error?g.message:"Unknown error";a.toastr.error(`\u30da\u30fc\u30b8\u3092\u4fdd\u8b77\u72b6\u614b\u306b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ( ${v} )`)}})()}static \u0275fac=function(g){return new(g||d)(n.rXU(G.u),n.rXU(h.O),n.rXU(I.Y),n.rXU(p.Qe),n.rXU(C.tw))};static \u0275cmp=n.VBU({type:d,selectors:[["gitfire-comment-entry"]],inputs:{pagePath:"pagePath",pageJson:"pageJson"},decls:3,vars:2,consts:[["commentNothing",""],["class","spinner-border text-primary","role","status",4,"ngIf"],[4,"ngIf"],["role","status",1,"spinner-border","text-primary"],[4,"ngIf","ngIfElse"],[3,"pageId",4,"ngIf"],[3,"pageId","isPageProtect"],[1,"text-end"],["class","m-1 text-end",4,"ngIf","ngIfElse"],["class","btn btn-danger m-1","title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u7981\u6b62\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["class","btn btn-info m-1","title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002",3,"click",4,"ngIf"],["title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u7981\u6b62\u3057\u307e\u3059\u3002",1,"btn","btn-danger","m-1",3,"click"],["title","\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002",1,"btn","btn-info","m-1",3,"click"],["class","p-1 border border-danger",4,"ngIf"],[1,"p-1","border","border-danger"],[1,"text-danger"],["title","\u3053\u306e\u6a5f\u80fd\u306f\u8a66\u9a13\u904b\u7528\u4e2d\u3067\u3059\u3002\u3053\u306e\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3001\u66f4\u65b0\u3092\u901a\u77e5\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],["title","\u3053\u306e\u6a5f\u80fd\u306f\u8a66\u9a13\u904b\u7528\u4e2d\u3067\u3059\u3002\u3053\u306e\u30da\u30fc\u30b8\u3078\u306e\u30b3\u30e1\u30f3\u30c8\u3001\u66f4\u65b0\u901a\u77e5\u3092\u505c\u6b62\u3057\u307e\u3059\u3002",1,"btn","btn-secondary","m-1",3,"click"],[1,"m-1","text-end"],["class","text-warning",4,"ngIf"],[1,"text-warning"],[3,"pageId"]],template:function(g,v){1&g&&(n.nrm(0,"hr"),n.DNE(1,t,1,0,"span",1)(2,A,10,11,"div",2)),2&g&&(n.R7$(),n.Y8G("ngIf",!v.pageId),n.R7$(),n.Y8G("ngIf",v.pageId))},dependencies:[_.MD,_.bT,O.m,U.F,_.Jj],encapsulation:2})}return d})()}}]);