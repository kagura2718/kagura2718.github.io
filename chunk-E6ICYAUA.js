import{Fa as J,j as I}from"./chunk-TLXFBRJE.js";import{g as H}from"./chunk-ISJWRPLC.js";import{a as L}from"./chunk-F5WVDCG3.js";import{$a as p,Aa as u,Bb as g,Db as a,Fc as B,G as E,Ga as _,Ic as R,Ja as V,Q as F,Tc as x,Ua as l,Vc as O,Wa as s,Wc as G,Yc as U,Zc as q,_c as N,ab as r,ad as A,b as y,bb as o,c as T,cb as C,cd as M,ea as h,fa as f,gd as $,hd as j,ka as k,l as P,lb as v,nd as Q,ob as w,od as W,pd as z,qb as c,qd as K,sd as X,tb as D,ub as b,vb as S}from"./chunk-KNL377UP.js";var Z=["mainForm"],tt=["confirmPasswordInput"];function et(e,i){e&1&&(r(0,"div",6),a(1,"OK!"),o())}function it(e,i){e&1&&(r(0,"div",12),a(1,"E \u30E1\u30FC\u30EB\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function nt(e,i){e&1&&(r(0,"div",12),a(1,"E \u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),o())}function ot(e,i){if(e&1&&(l(0,it,2,0,"div",12),l(1,nt,2,0,"div",12)),e&2){let t=c();s(t.emailControl.errors!=null&&t.emailControl.errors.required?0:-1),u(),s(t.emailControl.errors!=null&&t.emailControl.errors.minlength?1:-1)}}function rt(e,i){e&1&&(r(0,"div",6),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u5F37\u5EA6\u306F\u5145\u5206\u306B\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),o())}function at(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function ut(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306E\u9577\u3055\u304C\u8DB3\u308A\u307E\u305B\u3093\u3002"),o())}function lt(e,i){if(e&1&&(l(0,at,2,0,"div",12),l(1,ut,2,0,"div",12)),e&2){let t=c();s(t.passwordControl.errors!=null&&t.passwordControl.errors.required?0:-1),u(),s(t.passwordControl.errors!=null&&t.passwordControl.errors.minlength?1:-1)}}function st(e,i){e&1&&(r(0,"div",6),a(1,"\u4E00\u81F4\u3057\u307E\u3057\u305F\uFF01"),o())}function dt(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5FC5\u9808\u3067\u3059\u3002"),o())}function ct(e,i){e&1&&(r(0,"div",12),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u304C\u4E00\u81F4\u3057\u307E\u305B\u3093\u3002"),o())}function mt(e,i){if(e&1&&(l(0,dt,2,0,"div",12),l(1,ct,2,0,"div",12)),e&2){let t=c(2);s(t.confirmPasswordControl.errors!=null&&t.confirmPasswordControl.errors.required?0:-1),u(),s(t.confirmPasswordControl.errors!=null&&t.confirmPasswordControl.errors.passwordMisMatch?1:-1)}}function pt(e,i){if(e&1&&(r(0,"div",3)(1,"label",13),a(2,"Confirm Password"),o(),C(3,"input",14,1),l(5,st,2,0,"div",6)(6,mt,2,2),o()),e&2){let t=c();g("was-validated",t.confirmPasswordControl.dirty||t.confirmPasswordControl.touched),u(3),p("autocomplete",t.passwordAutocomplete),u(2),s(t.confirmPasswordControl.invalid?6:5)}}function Ct(e,i){e&1&&(r(0,"div",20),a(1,"OK!"),o())}function ht(e,i){e&1&&(r(0,"div",21),a(1,"\u898F\u7D04\u306B\u540C\u610F\u3057\u3066\u3044\u305F\u3060\u304F\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002"),o())}function ft(e,i){if(e&1&&l(0,ht,2,0,"div",21),e&2){let t=c(2);s(t.agreeTosControl.errors!=null&&t.agreeTosControl.errors.required?0:-1)}}function _t(e,i){if(e&1&&(r(0,"div",15)(1,"label",16),a(2,"\u898F\u7D04\u306B\u540C\u610F\u3059\u308B"),o(),C(3,"input",17),r(4,"a",18),a(5," [\u5229\u7528\u898F\u7D04] "),o(),r(6,"span",19),a(7,"\u306B\u540C\u610F\u3057\u307E\u3059\u3002"),o(),l(8,Ct,2,0,"div",20)(9,ft,1,1),o()),e&2){let t=c();g("was-validated",t.agreeTosControl.dirty||t.agreeTosControl.touched),u(8),s(t.agreeTosControl.invalid?9:8)}}function vt(e,i){if(e&1){let t=v();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickSignup(d))}),a(1,"\u30A2\u30AB\u30A6\u30F3\u30C8\u4F5C\u6210"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function wt(e,i){if(e&1){let t=v();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickLogin(d))}),C(1,"img",23),a(2,"\u30ED\u30B0\u30A4\u30F3"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function gt(e,i){if(e&1){let t=v();r(0,"button",22),w("click",function(d){h(t);let m=c();return f(m.onClickReauth(d))}),C(1,"img",23),a(2,"\u518D\u8A8D\u8A3C"),o()}if(e&2){let t=c();p("disabled",!t.inputAuthForm.valid)}}function At(e,i){if(e&1){let t=v();r(0,"app-oauth-federations",24),w("loginSucceeded",function(){h(t);let d=c();return f(d.onOauthLoginSucceeded())})("loginFailed",function(d){h(t);let m=c();return f(m.onOauthLoginFailed(d))}),o()}}var Y=class e{constructor(i,t,n,d){this.auth=i;this.toastr=t;this.router=n;this.route=d}isLogin=!1;isReauth=!1;reauthUser=null;isSignup=!1;showFederations=!0;reauthed=new k;destroy$=new y;inputAuthForm;loginUser$=new T(null);passwordAutocomplete;mainForm;confirmPasswordInput;ngOnInit(){this.passwordAutocomplete=this.isSignup?"new-password":"current-password",this.inputAuthForm=new N({}),this.inputAuthForm.addControl("email",new A("")),this.inputAuthForm.addControl("password",new A("")),this.isSignup&&(this.inputAuthForm.addControl("retypePassword",new A("")),this.inputAuthForm.addControl("agreeTosCheck",new A(!1)),this.inputAuthForm.setValidators([this.validateXFPassword.bind(this)])),this.inputAuthForm.disable(),this.initializeAuthForm()}ngOnDestroy(){this.destroy$.next()}ngAfterViewInit(){this.auth.authState.pipe(F(this.destroy$)).subscribe(i=>{this.loginUser$.next(i)})}navigateAfterSucceeded(){this.route.queryParams.pipe(F(this.destroy$),E(1)).subscribe(i=>{let t=i.redirectPath;if(t){this.router.navigate([t]);return}this.router.navigate(["/"])})}erroredConnected(i){x("error while connecting account",i);let t=i instanceof Error?i.message:"Unknown error";this.toastr.error(`Login \u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002 
 ( ${t} )`)}loginSucceeded(){this.toastr.success("Login \u3057\u307E\u3057\u305F\u3002"),this.navigateAfterSucceeded()}connectSucceeded(i){this.toastr.success("Sign-up \u3057\u307E\u3057\u305F\u3002"),this.navigateAfterSucceeded()}get emailControl(){return this.inputAuthForm.get("email")}get passwordControl(){return this.inputAuthForm.get("password")}get confirmPasswordControl(){return this.inputAuthForm.get("retypePassword")}get agreeTosControl(){return this.inputAuthForm.get("agreeTosCheck")}validateXFPassword(i){let t=i.get("password"),n=i.get("retypePassword");return t.value!==n.value?(n.setErrors({passwordMisMatch:!0}),this.confirmPasswordInput&&this.confirmPasswordInput.nativeElement.setCustomValidity("create error state"),null):(this.confirmPasswordInput&&this.confirmPasswordInput.nativeElement.setCustomValidity(""),n.setErrors(null),null)}validateAuthForm(){return this.inputAuthForm.markAllAsTouched(),this.inputAuthForm.invalid?(x("Assert! Button should be disabled."),!1):!0}initializeAuthForm(){P(this.auth.setPersistence(I.auth.Auth.Persistence.SESSION)).pipe(E(1),F(this.destroy$)).subscribe({next:()=>{this.inputAuthForm.enable()},error:i=>{this.toastr.error("\u8A8D\u8A3C Server \u3092\u521D\u671F\u5316\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}})}async onClickSignup(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=await this.auth.createUserWithEmailAndPassword(this.emailControl.value,this.passwordControl.value);this.toastr.info("\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F\u3002\u30E1\u30FC\u30EB\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),await t.user.sendEmailVerification(),this.navigateAfterSucceeded()}catch(t){x("Error while reject",t);let n=t instanceof Error?t.message:"Unknown error";this.toastr.error(`\u30A2\u30AB\u30A6\u30F3\u30C8\u306E\u4F5C\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u6700\u521D\u304B\u3089\u3084\u308A\u76F4\u3057\u3066\u304F\u3060\u3055\u3044\u3002
 ( ${n} )`)}}async onClickLogin(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=await this.auth.signInWithEmailAndPassword(this.emailControl.value,this.passwordControl.value);this.loginSucceeded()}catch(t){this.erroredConnected(t)}}async onClickReauth(i){if(i.preventDefault(),!!this.validateAuthForm())try{let t=I.auth.EmailAuthProvider.credential(this.emailControl.value,this.passwordControl.value);await this.reauthUser.reauthenticateWithCredential(t),this.reauthed.next()}catch(t){this.erroredConnected(t)}}onOauthLoginFailed(i){this.erroredConnected(i)}onOauthLoginSucceeded(){this.loginSucceeded()}static \u0275fac=function(t){return new(t||e)(_(H),_(L),_(R),_(B))};static \u0275cmp=V({type:e,selectors:[["gitfire-login-input-auth"]],viewQuery:function(t,n){if(t&1&&D(Z,5)(tt,5),t&2){let d;b(d=S())&&(n.mainForm=d.first),b(d=S())&&(n.confirmPasswordInput=d.first)}},inputs:{isLogin:"isLogin",isReauth:"isReauth",reauthUser:"reauthUser",isSignup:"isSignup",showFederations:"showFederations"},outputs:{reauthed:"reauthed"},decls:21,vars:15,consts:[["mainForm",""],["confirmPasswordInput",""],[3,"formGroup"],[1,"row","m-3"],["for","appGitfireLoginEmailInput",1,"visually-hidden"],["id","appGitfireLoginEmailInput","name","email","formControlName","email","placeholder","email@example.com","autocomplete","email","type","email","required","","autofill","","autofocus","","maxlength","1024","minlength","5",1,"form-control","col-12"],[1,"valid-feedback"],["for","appGitfireLoginPasswordInput",1,"visually-hidden"],["id","appGitfireLoginPasswordInput","type","password","name","password","formControlName","password","placeholder","Password","required","","autofill","","maxlength","256","minlength","6",1,"form-control","col-12",3,"autocomplete"],[1,"row","m-3",3,"was-validated"],[1,"row","custom-control","custom-checkbox","m-5","text-center",3,"was-validated"],[1,"btn","btn-lg","btn-primary","btn-block",3,"disabled"],[1,"invalid-feedback"],["for","appGitfireSignupPasswordConfirmInput",1,"visually-hidden"],["id","appGitfireSignupPasswordConfirmInput","type","password","name","password_confirm","formControlName","retypePassword","placeholder","Confirm password","required","",1,"form-control","col-12",3,"autocomplete"],[1,"row","custom-control","custom-checkbox","m-5","text-center"],["for","appGitfireAgreeTosCheck",1,"col-auto","visually-hidden"],["id","col-auto appGitfireAgreeTosCheck","formControlName","agreeTosCheck","type","checkbox","required","",1,"form-check-input"],["tabindex","-1","about","_blank","href","/terms.htm",1,"col-auto"],[1,"col-auto"],[1,"valid-feedback","col-auto"],[1,"invalid-feedback","col-auto"],[1,"btn","btn-lg","btn-primary","btn-block",3,"click","disabled"],["src","/assets/octicons/sign-in.svg",1,"m-1","gitfire-link-icon","octicon-info"],[3,"loginSucceeded","loginFailed"]],template:function(t,n){t&1&&(r(0,"form",2,0)(2,"div",3)(3,"label",4),a(4,"Email"),o(),C(5,"input",5),l(6,et,2,0,"div",6)(7,ot,2,2),o(),r(8,"div",3)(9,"label",7),a(10,"Password"),o(),C(11,"input",8),l(12,rt,2,0,"div",6),l(13,lt,2,2),o(),l(14,pt,7,4,"div",9),l(15,_t,10,3,"div",10),r(16,"div",3),l(17,vt,2,1,"button",11),l(18,wt,3,1,"button",11),l(19,gt,3,1,"button",11),o(),l(20,At,1,0,"app-oauth-federations"),o()),t&2&&(p("formGroup",n.inputAuthForm),u(2),g("was-validated",n.emailControl.dirty||n.emailControl.touched),u(4),s(n.emailControl.invalid?7:6),u(2),g("was-validated",n.passwordControl.dirty||n.passwordControl.touched),u(3),p("autocomplete",n.passwordAutocomplete),u(),s(n.isSignup&&!n.passwordControl.invalid?12:-1),u(),s(n.passwordControl.invalid?13:-1),u(),s(n.isSignup?14:-1),u(),s(n.isSignup?15:-1),u(2),s(n.isSignup?17:-1),u(),s(n.isLogin?18:-1),u(),s(n.isReauth?19:-1),u(),s(n.showFederations?20:-1))},dependencies:[X,M,G,O,U,q,Q,z,K,W,j,$,J],encapsulation:2})};export{Y as a};
