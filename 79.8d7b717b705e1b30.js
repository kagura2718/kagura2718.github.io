"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[79],{8079:(Xy,Lf,ae)=>{ae.d(Lf,{Qe:()=>Fd,cM:()=>_y});var Bf=ae(177),se=ae(4438),Ue=ae(1825),li=ae(9253),yt=ae(1152),qf=ae(3236),Uf=ae(1985),hi=ae(8455),xu=ae(7673),Cs=ae(9172),Gf=ae(9974),Kf=ae(4360);function Ds(){return(0,Gf.N)((r,e)=>{let t,n=!1;r.subscribe((0,Kf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var Gt,Fu,Je=ae(6354),Ns=ae(2816),zf=ae(3294),Cu=ae(5964),jf=(ae(2438),ae(3345)),b=ae(467),di=ae(8742),Du=ae(1362),Ye=ae(8041),ee=ae(1076),Nu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ku={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,p,I){I||(I=0);var E=Array(16);if("string"==typeof p)for(var v=0;16>v;++v)E[v]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;var P=T.g[3],y=(p=T.g[0])+(P^(I=T.g[1])&((v=T.g[2])^P))+E[0]+3614090360&4294967295;y=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=I+(y<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=p+(v^P&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=p+(I^v^P)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=p+(v^(I|~P))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((P=(p=I+((y=p+(v^(I|~P))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=P+((y=v+(p^(P|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+P&4294967295}function a(T,p){this.h=p;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var P=0|T[v];E&&P==p||(I[v]=P,E=!1)}this.g=I}(function e(T,p){function I(){}I.prototype=p.prototype,T.D=p.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,P){for(var y=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)y[gt-2]=arguments[gt];return p.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,p){void 0===p&&(p=T.length);for(var I=p-this.blockSize,E=this.B,v=this.h,P=0;P<p;){if(0==v)for(;P<=I;)i(this,T,P),P+=this.blockSize;if("string"==typeof T){for(;P<p;)if(E[v++]=T.charCodeAt(P++),v==this.blockSize){i(this,E),v=0;break}}else for(;P<p;)if(E[v++]=T[P++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=p},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var I=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=255&I,I/=256;for(this.u(T),T=Array(16),p=I=0;4>p;++p)for(var E=0;32>E;E+=8)T[I++]=this.g[p]>>>E&255;return T};var u={};function c(T){return-128<=T&&128>T?function s(T,p){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=p(T)}(T,function(p){return new a([0|p],0>p?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return D(h(-T));for(var p=[],I=1,E=0;T>=I;E++)p[E]=T/I|0,I*=4294967296;return new a(p,0)}var g=c(0),_=c(1),R=c(16777216);function x(T){if(0!=T.h)return!1;for(var p=0;p<T.g.length;p++)if(0!=T.g[p])return!1;return!0}function k(T){return-1==T.h}function D(T){for(var p=T.g.length,I=[],E=0;E<p;E++)I[E]=~T.g[E];return new a(I,~T.h).add(_)}function B(T,p){return T.add(D(p))}function K(T,p){for(;(65535&T[p])!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function q(T,p){this.g=T,this.h=p}function z(T,p){if(x(p))throw Error("division by zero");if(x(T))return new q(g,g);if(k(T))return p=z(D(T),p),new q(D(p.g),D(p.h));if(k(p))return p=z(T,D(p)),new q(D(p.g),p.h);if(30<T.g.length){if(k(T)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=p;0>=E.l(T);)I=H(I),E=H(E);var v=$(I,1),P=$(E,1);for(E=$(E,2),I=$(I,2);!x(E);){var y=P.add(E);0>=y.l(T)&&(v=v.add(I),P=y),E=$(E,1),I=$(I,1)}return p=B(T,v.j(p)),new q(v,p)}for(v=g;0<=T.l(p);){for(I=Math.max(1,Math.floor(T.m()/p.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(P=h(I)).j(p);k(y)||0<y.l(T);)y=(P=h(I-=E)).j(p);x(P)&&(P=_),v=v.add(P),T=B(T,y)}return new q(v,T)}function H(T){for(var p=T.g.length+1,I=[],E=0;E<p;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(I,T.h)}function $(T,p){var I=p>>5;p%=32;for(var E=T.g.length-I,v=[],P=0;P<E;P++)v[P]=0<p?T.i(P+I)>>>p|T.i(P+I+1)<<32-p:T.i(P+I);return new a(v,T.h)}(r=a.prototype).m=function(){if(k(this))return-D(this).m();for(var T=0,p=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(k(this))return"-"+D(this).toString(T);for(var p=h(Math.pow(T,6)),I=this,E="";;){var v=z(I,p).g,P=((0<(I=B(I,v.j(p))).g.length?I.g[0]:I.h)>>>0).toString(T);if(x(I=v))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return k(T=B(this,T))?-1:x(T)?0:1},r.abs=function(){return k(this)?D(this):this},r.add=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=p;v++){var P=E+(65535&this.i(v))+(65535&T.i(v)),y=(P>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(P&=65535)}return new a(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(x(this)||x(T))return g;if(k(this))return k(T)?D(this).j(D(T)):D(D(this).j(T));if(k(T))return D(this.j(D(T)));if(0>this.l(R)&&0>T.l(R))return h(this.m()*T.m());for(var p=this.g.length+T.g.length,I=[],E=0;E<2*p;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var P=this.i(E)>>>16,y=65535&this.i(E),gt=T.i(v)>>>16,jr=65535&T.i(v);I[2*E+2*v]+=y*jr,K(I,2*E+2*v),I[2*E+2*v+1]+=P*jr,K(I,2*E+2*v+1),I[2*E+2*v+1]+=y*gt,K(I,2*E+2*v+1),I[2*E+2*v+2]+=P*gt,K(I,2*E+2*v+2)}for(E=0;E<p;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=p;E<2*p;E++)I[E]=0;return new a(I,0)},r.A=function(T){return z(this,T).h},r.and=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)&T.i(E);return new a(I,this.h&T.h)},r.or=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)|T.i(E);return new a(I,this.h|T.h)},r.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)^T.i(E);return new a(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Fu=ku.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,p){if(0==T.length)throw Error("number format error: empty string");if(2>(p=p||10)||36<p)throw Error("radix out of range: "+p);if("-"==T.charAt(0))return D(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(p,8)),E=g,v=0;v<T.length;v+=8){var P=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+P),p);8>P?(P=h(Math.pow(p,P)),E=E.j(P).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},Gt=ku.Integer=a}).apply(typeof Nu<"u"?Nu:typeof self<"u"?self:typeof window<"u"?window:{});var Mu,Ou,rr,Lu,mi,ks,Bu,qu,Uu,fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof fi&&fi];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var A=o[m];if(!(A in d))break e;d=d[A]}(l=l(m=d[o=o[o.length-1]]))!=m&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,A={next:function(){if(!m&&d<o.length){var V=d++;return{value:l(V,o[V]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),o.apply(l,A)}}return function(){return o.apply(l,arguments)}}function _(o,l,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function R(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,A,V){for(var M=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)M[ie-2]=arguments[ie];return l.prototype[A].apply(m,M)}}function k(o){const l=o.length;if(0<l){const d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function D(o,l){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(c(m)){const A=o.length||0,V=m.length||0;o.length=A+V;for(let M=0;M<V;M++)o[A+M]=m[M]}else o.push(m)}}function K(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function z(o){return z[" "](o),o}z[" "]=function(){};var H=!(-1==q().indexOf("Gecko")||-1!=q().toLowerCase().indexOf("webkit")&&-1==q().indexOf("Edge")||-1!=q().indexOf("Trident")||-1!=q().indexOf("MSIE")||-1!=q().indexOf("Edge"));function $(o,l,d){for(const m in o)l.call(d,o[m],m,o)}function p(o){const l={};for(const d in o)l[d]=o[d];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let d,m;for(let A=1;A<arguments.length;A++){for(d in m=arguments[A],m)o[d]=m[d];for(let V=0;V<I.length;V++)d=I[V],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function v(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function P(o){u.setTimeout(()=>{throw o},0)}function y(){var o=su;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var jr=new class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new yy,o=>o.reset());class yy{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Qr,$r=!1,su=new class gt{constructor(){this.h=this.g=null}add(l,d){const m=jr.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},Md=()=>{const o=u.Promise.resolve(void 0);Qr=()=>{o.then(Iy)}};var Iy=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){P(d)}var l=jr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}$r=!1};function Lt(){this.s=this.s,this.C=this.C}function Ne(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Lt.prototype.s=!1,Lt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Lt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ne.prototype.h=function(){this.defaultPrevented=!0};var Ty=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Wr(o,l){if(Ne.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(H){e:{try{z(l.nodeName);var A=!0;break e}catch{}A=!1}A||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:Ey[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Wr.aa.h.call(this)}}x(Wr,Ne);var Ey={2:"touch",3:"pen",4:"mouse"};Wr.prototype.h=function(){Wr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Hr="closure_listenable_"+(1e6*Math.random()|0),vy=0;function Ay(o,l,d,m,A){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=A,this.key=++vy,this.da=this.fa=!1}function ms(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function gs(o){this.src=o,this.g={},this.h=0}function ou(o,l){var d=l.type;if(d in o.g){var V,m=o.g[d],A=Array.prototype.indexOf.call(m,l,void 0);(V=0<=A)&&Array.prototype.splice.call(m,A,1),V&&(ms(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function au(o,l,d,m){for(var A=0;A<o.length;++A){var V=o[A];if(!V.da&&V.listener==l&&V.capture==!!d&&V.ha==m)return A}return-1}gs.prototype.add=function(o,l,d,m,A){var V=o.toString();(o=this.g[V])||(o=this.g[V]=[],this.h++);var M=au(o,l,m,A);return-1<M?(l=o[M],d||(l.fa=!1)):((l=new Ay(l,this.src,V,!!m,A)).fa=d,o.push(l)),l};var uu="closure_lm_"+(1e6*Math.random()|0),cu={};function Od(o,l,d,m,A){if(m&&m.once)return Bd(o,l,d,m,A);if(Array.isArray(l)){for(var V=0;V<l.length;V++)Od(o,l[V],d,m,A);return null}return d=fu(d),o&&o[Hr]?o.K(l,d,h(m)?!!m.capture:!!m,A):Ld(o,l,d,!1,m,A)}function Ld(o,l,d,m,A,V){if(!l)throw Error("Invalid event type");var M=h(A)?!!A.capture:!!A,ie=hu(o);if(ie||(o[uu]=ie=new gs(o)),(d=ie.add(l,d,m,M,V)).proxy)return d;if(m=function wy(){const l=Ry;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)Ty||(A=M),void 0===A&&(A=!1),o.addEventListener(l.toString(),m,A);else if(o.attachEvent)o.attachEvent(Ud(l.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function Bd(o,l,d,m,A){if(Array.isArray(l)){for(var V=0;V<l.length;V++)Bd(o,l[V],d,m,A);return null}return d=fu(d),o&&o[Hr]?o.L(l,d,h(m)?!!m.capture:!!m,A):Ld(o,l,d,!0,m,A)}function qd(o,l,d,m,A){if(Array.isArray(l))for(var V=0;V<l.length;V++)qd(o,l[V],d,m,A);else m=h(m)?!!m.capture:!!m,d=fu(d),o&&o[Hr]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=au(V=o.g[l],d,m,A))&&(ms(V[d]),Array.prototype.splice.call(V,d,1),0==V.length&&(delete o.g[l],o.h--))):o&&(o=hu(o))&&(l=o.g[l.toString()],o=-1,l&&(o=au(l,d,m,A)),(d=-1<o?l[o]:null)&&lu(d))}function lu(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[Hr])ou(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(Ud(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=hu(l))?(ou(d,o),0==d.h&&(d.src=null,l[uu]=null)):ms(o)}}}function Ud(o){return o in cu?cu[o]:cu[o]="on"+o}function Ry(o,l){if(o.da)o=!0;else{l=new Wr(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&lu(o),o=d.call(m,l)}return o}function hu(o){return(o=o[uu])instanceof gs?o:null}var du="__closure_events_fn_"+(1e9*Math.random()>>>0);function fu(o){return"function"==typeof o?o:(o[du]||(o[du]=function(l){return o.handleEvent(l)}),o[du])}function ke(){Lt.call(this),this.i=new gs(this),this.M=this,this.F=null}function Be(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,"string"==typeof l)l=new Ne(l,o);else if(l instanceof Ne)l.target=l.target||o;else{var A=l;E(l=new Ne(m,o),A)}if(A=!0,d)for(var V=d.length-1;0<=V;V--){var M=l.g=d[V];A=ps(M,m,!0,l)&&A}if(A=ps(M=l.g=o,m,!0,l)&&A,A=ps(M,m,!1,l)&&A,d)for(V=0;V<d.length;V++)A=ps(M=l.g=d[V],m,!1,l)&&A}function ps(o,l,d,m){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var A=!0,V=0;V<l.length;++V){var M=l[V];if(M&&!M.da&&M.capture==d){var ie=M.listener,Ve=M.ha||M.src;M.fa&&ou(o.i,M),A=!1!==ie.call(Ve,m)&&A}}return A&&!m.defaultPrevented}function Gd(o,l,d){if("function"==typeof o)d&&(o=_(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=_(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Kd(o){o.g=Gd(()=>{o.g=null,o.i&&(o.i=!1,Kd(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}x(ke,Lt),ke.prototype[Hr]=!0,ke.prototype.removeEventListener=function(o,l,d,m){qd(this,o,l,d,m)},ke.prototype.N=function(){if(ke.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)ms(d[m]);delete o.g[l],o.h--}}this.F=null},ke.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},ke.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};class Py extends Lt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Kd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jr(o){Lt.call(this),this.h=o,this.g={}}x(Jr,Lt);var zd=[];function jd(o){$(o.g,function(l,d){this.g.hasOwnProperty(d)&&lu(l)},o),o.g={}}Jr.prototype.N=function(){Jr.aa.N.call(this),jd(this)},Jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mu=u.JSON.stringify,Sy=u.JSON.parse,Vy=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function gu(){}function $d(){}gu.prototype.h=null;var Yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function pu(){Ne.call(this,"d")}function _u(){Ne.call(this,"c")}x(pu,Ne),x(_u,Ne);var hn={},Wd=null;function _s(){return Wd=Wd||new ke}function Hd(o){Ne.call(this,hn.La,o)}function Xr(o){const l=_s();Be(l,new Hd(l))}function Jd(o,l){Ne.call(this,hn.STAT_EVENT,o),this.stat=l}function qe(o){const l=_s();Be(l,new Jd(l,o))}function Yd(o,l){Ne.call(this,hn.Ma,o),this.size=l}function Zr(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function ei(){this.g=!0}function Zn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function Dy(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var V=A[0];if("noop"!=V&&"stop"!=V&&"close"!=V)for(var M=1;M<A.length;M++)A[M]=""}}}return mu(d)}catch{return l}}(o,d)+(m?" "+m:"")})}hn.La="serverreachability",x(Hd,Ne),hn.STAT_EVENT="statevent",x(Jd,Ne),hn.Ma="timingevent",x(Yd,Ne),ei.prototype.xa=function(){this.g=!1},ei.prototype.info=function(){};var yu,ys={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Xd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Is(){}function Bt(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new Jr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}x(Is,gu),Is.prototype.g=function(){return new XMLHttpRequest},Is.prototype.i=function(){return{}},yu=new Is;var ef={},Iu={};function Tu(o,l,d){o.L=1,o.v=As(pt(l)),o.m=d,o.P=!0,tf(o,null)}function tf(o,l){o.F=Date.now(),Ts(o),o.A=pt(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),pf(d.i,"t",m),o.C=0,d=o.j.J,o.h=new Zd,o.g=kf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new Py(_(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(zd[0]=A.toString()),A=zd);for(var V=0;V<A.length;V++){var M=Od(d,A[V],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Xr(),function by(o,l,d,m,A,V){o.info(function(){if(o.g)if(V)for(var M="",ie=V.split("&"),Ve=0;Ve<ie.length;Ve++){var Z=ie[Ve].split("=");if(1<Z.length){var Fe=Z[0];Z=Z[1];var Me=Fe.split("_");M=2<=Me.length&&"type"==Me[1]?M+(Fe+"=")+Z+"&":M+(Fe+"=redacted&")}}else M=null;else M=V;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+l+"\n"+d+"\n"+M})}(o.i,o.u,o.A,o.l,o.R,o.m)}function nf(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function Ny(o,l){var d=o.C,m=l.indexOf("\n",d);return-1==m?Iu:(d=Number(l.substring(d,m)),isNaN(d)?ef:(m+=1)+d>l.length?Iu:(l=l.slice(m,m+d),o.C=m+d,l))}function Ts(o){o.S=Date.now()+o.I,rf(o,o.I)}function rf(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=Zr(_(o.ba,o),l)}function Eu(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function ti(o){0==o.j.G||o.J||xf(o.j,o)}function dn(o){Eu(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,jd(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function vu(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||Au(d.h,o)))if(!o.K&&Au(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var A=m;if(0==A[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;Vs(d),Ps(d)}Su(d),qe(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&0==d.v&&!d.C&&(d.C=Zr(_(d.Za,d),6e3));if(1>=af(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else mn(d,11)}else if((o.K||d.g==o)&&Vs(d),!K(l))for(A=d.Da.g.parse(l),l=0;l<A.length;l++){let Z=A[l];if(d.T=Z[0],Z=Z[1],2==d.G)if("c"==Z[0]){d.K=Z[1],d.ia=Z[2];const Fe=Z[3];null!=Fe&&(d.la=Fe,d.j.info("VER="+d.la));const Me=Z[4];null!=Me&&(d.Aa=Me,d.j.info("SVER="+d.Aa));const nr=Z[5];null!=nr&&"number"==typeof nr&&0<nr&&(d.L=m=1.5*nr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const He=o.g;if(He){const xs=He.g?He.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xs){var V=m.h;V.g||-1==xs.indexOf("spdy")&&-1==xs.indexOf("quic")&&-1==xs.indexOf("h2")||(V.j=V.l,V.g=new Set,V.h&&(wu(V,V.h),V.h=null))}if(m.D){const bu=He.g?He.g.getResponseHeader("X-HTTP-Session-Id"):null;bu&&(m.ya=bu,he(m.I,m.D,bu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var M=o;if((m=d).qa=Nf(m,m.J?m.ia:null,m.W),M.K){uf(m.h,M);var ie=M,Ve=m.L;Ve&&(ie.I=Ve),ie.B&&(Eu(ie),Ts(ie)),m.g=M}else Vf(m);0<d.i.length&&Ss(d)}else"stop"!=Z[0]&&"close"!=Z[0]||mn(d,7);else 3==d.G&&("stop"==Z[0]||"close"==Z[0]?"stop"==Z[0]?mn(d,7):Pu(d):"noop"!=Z[0]&&d.l&&d.l.ta(Z),d.v=0)}Xr()}catch{}}Bt.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==_t(o)?l.j():this.Y(o)},Bt.prototype.Y=function(o){try{if(o==this.g)e:{const Me=_t(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Me)&&(3!=Me||this.g&&(this.h.h||this.g.oa()||Af(this.g)))){this.J||4!=Me||7==l||Xr(),Eu(this);var d=this.g.Z();this.X=d;t:if(nf(this)){var m=Af(this.g);o="";var A=m.length,V=4==_t(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){dn(this),ti(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<A;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(V&&l==A-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=200==d,function xy(o,l,d,m,A,V,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+l+"\n"+d+"\n"+V+" "+M})}(this.i,this.u,this.A,this.l,this.R,Me,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Ve=this.g;if((ie=Ve.g?Ve.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ie)){var Z=ie;break t}}Z=null}if(!(d=Z)){this.o=!1,this.s=3,qe(12),dn(this),ti(this);break e}Zn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vu(this,d)}if(this.P){let He;for(d=!0;!this.J&&this.C<M.length;){if(He=Ny(this,M),He==Iu){4==Me&&(this.s=4,qe(14),d=!1),Zn(this.i,this.l,null,"[Incomplete Response]");break}if(He==ef){this.s=4,qe(15),Zn(this.i,this.l,M,"[Invalid Chunk]"),d=!1;break}Zn(this.i,this.l,He,null),vu(this,He)}if(nf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Me||0!=M.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<M.length&&!this.W){this.W=!0;var Fe=this.j;Fe.g==this&&Fe.ba&&!Fe.M&&(Fe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Vu(Fe),Fe.M=!0,qe(11))}}else Zn(this.i,this.l,M,"[Invalid Chunked Response]"),dn(this),ti(this)}else Zn(this.i,this.l,M,null),vu(this,M);4==Me&&dn(this),this.o&&!this.J&&(4==Me?xf(this.j,this):(this.o=!1,Ts(this)))}else(function Jy(o){const l={};o=(o.g&&2<=_t(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(K(o[m]))continue;var d=v(o[m]);const A=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const V=l[A]||[];l[A]=V,V.push(d)}!function T(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(m){return m.join(", ")})})(this.g),400==d&&0<M.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),dn(this),ti(this)}}}catch{}},Bt.prototype.cancel=function(){this.J=!0,dn(this)},Bt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function Cy(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Xr(),qe(17)),dn(this),this.s=2,ti(this)):rf(this,this.S-o)};var ky=class{constructor(o,l){this.g=o,this.map=l}};function sf(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function of(o){return!!o.h||!!o.g&&o.g.size>=o.j}function af(o){return o.h?1:o.g?o.g.size:0}function Au(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function wu(o,l){o.g?o.g.add(l):o.h=l}function uf(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function cf(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return k(o.i)}function lf(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function My(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const m in o)l[d++]=m;return l}}}(o),m=function Fy(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}for(m in l=[],d=0,o)l[d++]=o[m];return l}(o),A=m.length,V=0;V<A;V++)l.call(void 0,m[V],d&&d[V],o)}sf.prototype.cancel=function(){if(this.i=cf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var hf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof fn){this.h=o.h,Es(this,o.j),this.o=o.o,this.g=o.g,vs(this,o.s),this.l=o.l;var l=o.i,d=new ii;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),df(this,d),this.m=o.m}else o&&(l=String(o).match(hf))?(this.h=!1,Es(this,l[1]||"",!0),this.o=ni(l[2]||""),this.g=ni(l[3]||"",!0),vs(this,l[4]),this.l=ni(l[5]||"",!0),df(this,l[6]||"",!0),this.m=ni(l[7]||"")):(this.h=!1,this.i=new ii(null,this.h))}function pt(o){return new fn(o)}function Es(o,l,d){o.j=d?ni(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function vs(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function df(o,l,d){l instanceof ii?(o.i=l,function Ky(o,l){l&&!o.j&&(qt(o),o.i=null,o.g.forEach(function(d,m){var A=m.toLowerCase();m!=A&&(mf(this,m),pf(this,A,d))},o)),o.j=l}(o.i,o.h)):(d||(l=ri(l,Uy)),o.i=new ii(l,o.h))}function he(o,l,d){o.i.set(l,d)}function As(o){return he(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ni(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ri(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,Ly),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Ly(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}fn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(ri(l,ff,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(ri(l,ff,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(ri(d,"/"==d.charAt(0)?qy:By,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",ri(d,Gy)),o.join("")};var ff=/[#\/\?@]/g,By=/[#\?:]/g,qy=/[#\?]/g,Uy=/[#\?@]/g,Gy=/#/g;function ii(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function qt(o){o.g||(o.g=new Map,o.h=0,o.i&&function Oy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),A=null;if(0<=m){var V=o[d].substring(0,m);A=o[d].substring(m+1)}else V=o[d];l(V,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function mf(o,l){qt(o),l=er(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function gf(o,l){return qt(o),l=er(o,l),o.g.has(l)}function pf(o,l,d){mf(o,l),0<d.length&&(o.i=null,o.g.set(er(o,l),k(d)),o.h+=d.length)}function er(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Ut(o,l,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function Qy(){this.g=new Vy}function $y(o,l,d){const m=d||"";try{lf(o,function(A,V){let M=A;h(A)&&(M=mu(A)),l.push(m+V+"="+encodeURIComponent(M))})}catch(A){throw l.push(m+"type="+encodeURIComponent("_badmap")),A}}function si(o){this.l=o.Ub||null,this.j=o.eb||!1}function ws(o,l){ke.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function _f(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function oi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ai(o)}function ai(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function yf(o){let l="";return $(o,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function Ru(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=yf(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):he(o,l,d))}function pe(o){ke.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ii.prototype).add=function(o,l){qt(this),this.i=null,o=er(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){qt(this),this.g.forEach(function(d,m){d.forEach(function(A){o.call(l,A,m,this)},this)},this)},r.na=function(){qt(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){const A=o[m];for(let V=0;V<A.length;V++)d.push(l[m])}return d},r.V=function(o){qt(this);let l=[];if("string"==typeof o)gf(this,o)&&(l=l.concat(this.g.get(er(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return qt(this),this.i=null,gf(this,o=er(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];const V=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var A=V;""!==M[m]&&(A+="="+encodeURIComponent(String(M[m]))),o.push(A)}}return this.i=o.join("&")},x(si,gu),si.prototype.g=function(){return new ws(this.l,this.j)},si.prototype.i=function(o){return function(){return o}}({}),x(ws,ke),(r=ws.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,ai(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,oi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ai(this)),this.g&&(this.readyState=3,ai(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;_f(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?oi(this):ai(this),3==this.readyState&&_f(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,oi(this))},r.Qa=function(o){this.g&&(this.response=o,oi(this))},r.ga=function(){this.g&&oi(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(ws.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),x(pe,ke);var Wy=/^https?$/i,Hy=["POST","PUT"];function If(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Tf(o),Rs(o)}function Tf(o){o.A||(o.A=!0,Be(o,"complete"),Be(o,"error"))}function Ef(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=_t(o)||2!=o.Z()))if(o.u&&4==_t(o))Gd(o.Ea,0,o);else if(Be(o,"readystatechange"),4==_t(o)){o.h=!1;try{const M=o.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===M){var A=String(o.D).match(hf)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),m=!Wy.test(A?A.toLowerCase():"")}d=m}if(d)Be(o,"complete"),Be(o,"success");else{o.m=6;try{var V=2<_t(o)?o.g.statusText:""}catch{V=""}o.l=V+" ["+o.Z()+"]",Tf(o)}}finally{Rs(o)}}}function Rs(o,l){if(o.g){vf(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Be(o,"ready");try{d.onreadystatechange=m}catch{}}}function vf(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function _t(o){return o.g?o.g.readyState:0}function Af(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ui(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function wf(o){this.Aa=0,this.i=[],this.j=new ei,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ui("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ui("baseRetryDelayMs",5e3,o),this.cb=ui("retryDelaySeedMs",1e4,o),this.Wa=ui("forwardChannelMaxRetries",2,o),this.wa=ui("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new sf(o&&o.concurrentRequestLimit),this.Da=new Qy,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Pu(o){if(Rf(o),3==o.G){var l=o.U++,d=pt(o.I);if(he(d,"SID",o.K),he(d,"RID",l),he(d,"TYPE","terminate"),ci(o,d),(l=new Bt(o,o.j,l)).L=2,l.v=As(pt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=kf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ts(l)}Df(o)}function Ps(o){o.g&&(Vu(o),o.g.cancel(),o.g=null)}function Rf(o){Ps(o),o.u&&(u.clearTimeout(o.u),o.u=null),Vs(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function Ss(o){if(!of(o.h)&&!o.s){o.s=!0;var l=o.Ga;Qr||Md(),$r||(Qr(),$r=!0),su.add(l,o),o.B=0}}function Pf(o,l){var d;d=l?l.l:o.U++;const m=pt(o.I);he(m,"SID",o.K),he(m,"RID",d),he(m,"AID",o.T),ci(o,m),o.m&&o.o&&Ru(m,o.m,o.o),d=new Bt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Sf(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),wu(o.h,d),Tu(d,m,l)}function ci(o,l){o.H&&$(o.H,function(d,m){he(l,m,d)}),o.l&&lf({},function(d,m){he(l,m,d)})}function Sf(o,l,d){d=Math.min(o.i.length,d);var m=o.l?_(o.l.Na,o.l,o):null;e:{var A=o.i;let V=-1;for(;;){const M=["count="+d];-1==V?0<d?(V=A[0].g,M.push("ofs="+V)):V=0:M.push("ofs="+V);let ie=!0;for(let Ve=0;Ve<d;Ve++){let Z=A[Ve].g;const Fe=A[Ve].map;if(Z-=V,0>Z)V=Math.max(0,A[Ve].g-100),ie=!1;else try{$y(Fe,M,"req"+Z+"_")}catch{m&&m(Fe)}}if(ie){m=M.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function Vf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Qr||Md(),$r||(Qr(),$r=!0),su.add(l,o),o.v=0}}function Su(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=Zr(_(o.Fa,o),Cf(o,o.v)),o.v++,0))}function Vu(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function bf(o){o.g=new Bt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=pt(o.qa);he(l,"RID","rpc"),he(l,"SID",o.K),he(l,"AID",o.T),he(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&he(l,"TO",o.ja),he(l,"TYPE","xmlhttp"),ci(o,l),o.m&&o.o&&Ru(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=As(pt(l)),d.m=null,d.P=!0,tf(d,o)}function Vs(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function xf(o,l){var d=null;if(o.g==l){Vs(o),Vu(o),o.g=null;var m=2}else{if(!Au(o.h,l))return;d=l.D,uf(o.h,l),m=1}if(0!=o.G)if(l.o)if(1==m){d=l.m?l.m.length:0,l=Date.now()-l.F;var A=o.B;Be(m=_s(),new Yd(m,d)),Ss(o)}else Vf(o);else if(3==(A=l.s)||0==A&&0<l.X||!(1==m&&function Yy(o,l){return!(af(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=Zr(_(o.Ga,o,l),Cf(o,o.B)),o.B++,0)))}(o,l)||2==m&&Su(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),A){case 1:mn(o,5);break;case 4:mn(o,10);break;case 3:mn(o,6);break;default:mn(o,2)}}function Cf(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function mn(o,l){if(o.j.info("Error code "+l),2==l){var d=_(o.fb,o),m=o.Xa;const A=!m;m=new fn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Es(m,"https"),As(m),A?function zy(o,l){const d=new ei;if(u.Image){const m=new Image;m.onload=R(Ut,d,"TestLoadImage: loaded",!0,l,m),m.onerror=R(Ut,d,"TestLoadImage: error",!1,l,m),m.onabort=R(Ut,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(Ut,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}(m.toString(),d):function jy(o,l){new ei;const m=new AbortController,A=setTimeout(()=>{m.abort(),Ut(0,0,!1,l)},1e4);fetch(o,{signal:m.signal}).then(V=>{clearTimeout(A),Ut(0,0,!!V.ok,l)}).catch(()=>{clearTimeout(A),Ut(0,0,!1,l)})}(m.toString(),d)}else qe(2);o.G=0,o.l&&o.l.sa(l),Df(o),Rf(o)}function Df(o){if(o.G=0,o.ka=[],o.l){const l=cf(o.h);(0!=l.length||0!=o.i.length)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Nf(o,l,d){var m=d instanceof fn?pt(d):new fn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),vs(m,m.s);else{var A=u.location;m=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;var V=new fn(null);m&&Es(V,m),l&&(V.g=l),A&&vs(V,A),d&&(V.l=d),m=V}return l=o.ya,(d=o.D)&&l&&he(m,d,l),he(m,"VER",o.la),ci(o,m),m}function kf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new pe(o.Ca&&!o.pa?new si({eb:d}):o.pa)).Ha(o.J),l}function Ff(){}function bs(){}function $e(o,l){ke.call(this),this.g=new wf(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!K(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!K(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new tr(this)}function Mf(o){pu.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function Of(){_u.call(this),this.status=1}function tr(o){this.g=o}(r=pe.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yu.g(),this.v=function Qd(o){return o.h||(o.h=o.i())}(this.o?this.o:yu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(V){return void If(this,V)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const V of m.keys())d.set(V,m.get(V))}m=Array.from(d.keys()).find(V=>"content-type"==V.toLowerCase()),A=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Hy,l,void 0))||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,M]of d)this.g.setRequestHeader(V,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{vf(this),this.u=!0,this.g.send(o),this.u=!1}catch(V){If(this,V)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Be(this,"complete"),Be(this,"abort"),Rs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Rs(this,!0)),pe.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ef(this):this.bb())},r.bb=function(){Ef(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<_t(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),Sy(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=wf.prototype).la=8,r.G=1,r.connect=function(o,l,d,m){qe(0),this.W=o,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Nf(this,null,this.W),Ss(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const A=new Bt(this,this.j,o);let V=this.o;if(this.S&&(V?(V=p(V),E(V,this.S)):V=this.S),null!==this.m||this.O||(A.H=V,V=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(l+=m)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Sf(this,A,l),he(d=pt(this.I),"RID",o),he(d,"CVER",22),this.D&&he(d,"X-HTTP-Session-Id",this.D),ci(this,d),V&&(this.O?l="headers="+encodeURIComponent(String(yf(V)))+"&"+l:this.m&&Ru(d,this.m,V)),wu(this.h,A),this.Ua&&he(d,"TYPE","init"),this.P?(he(d,"$req",l),he(d,"SID","null"),A.T=!0,Tu(A,d,null)):Tu(A,d,l),this.G=2}}else 3==this.G&&(o?Pf(this,o):0==this.i.length||of(this.h)||Pf(this))},r.Fa=function(){if(this.u=null,bf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Zr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Ps(this),bf(this))},r.Za=function(){null!=this.C&&(this.C=null,Ps(this),Su(this),qe(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Ff.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},bs.prototype.g=function(o,l){return new $e(o,l)},x($e,ke),$e.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$e.prototype.close=function(){Pu(this.g)},$e.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=mu(o),o=d);l.i.push(new ky(l.Ya++,o)),3==l.G&&Ss(l)},$e.prototype.N=function(){this.g.l=null,delete this.j,Pu(this.g),delete this.g,$e.aa.N.call(this)},x(Mf,pu),x(Of,_u),x(tr,Ff),tr.prototype.ua=function(){Be(this.g,"a")},tr.prototype.ta=function(o){Be(this.g,new Mf(o))},tr.prototype.sa=function(o){Be(this.g,new Of)},tr.prototype.ra=function(){Be(this.g,"b")},bs.prototype.createWebChannel=bs.prototype.g,$e.prototype.send=$e.prototype.o,$e.prototype.open=$e.prototype.m,$e.prototype.close=$e.prototype.close,Uu=st.createWebChannelTransport=function(){return new bs},qu=st.getStatEventTarget=function(){return _s()},Bu=st.Event=hn,ks=st.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ys.NO_ERROR=0,ys.TIMEOUT=8,ys.HTTP_ERROR=6,mi=st.ErrorCode=ys,Xd.COMPLETE="complete",Lu=st.EventType=Xd,$d.EventType=Yr,Yr.OPEN="a",Yr.CLOSE="b",Yr.ERROR="c",Yr.MESSAGE="d",ke.prototype.listen=ke.prototype.K,rr=st.WebChannel=$d,Ou=st.FetchXmlHttpFactory=si,pe.prototype.listenOnce=pe.prototype.L,pe.prototype.getLastError=pe.prototype.Ka,pe.prototype.getLastErrorCode=pe.prototype.Ba,pe.prototype.getStatus=pe.prototype.Z,pe.prototype.getResponseJson=pe.prototype.Oa,pe.prototype.getResponseText=pe.prototype.oa,pe.prototype.send=pe.prototype.ea,pe.prototype.setWithCredentials=pe.prototype.Ha,Mu=st.XhrIo=pe}).apply(typeof fi<"u"?fi:typeof self<"u"?self:typeof window<"u"?window:{});const Gu="@firebase/firestore";class ve{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let gn="10.12.1";const It=new Ye.Vy("@firebase/firestore");function pn(){return It.logLevel}function N(r,...e){if(It.logLevel<=Ye.$b.DEBUG){const t=e.map(Fs);It.debug(`Firestore (${gn}): ${r}`,...t)}}function _e(r,...e){if(It.logLevel<=Ye.$b.ERROR){const t=e.map(Fs);It.error(`Firestore (${gn}): ${r}`,...t)}}function Ge(r,...e){if(It.logLevel<=Ye.$b.WARN){const t=e.map(Fs);It.warn(`Firestore (${gn}): ${r}`,...t)}}function Fs(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function L(r="Unexpected state"){const e=`FIRESTORE (${gn}) INTERNAL ASSERTION FAILED: `+r;throw _e(e),new Error(e)}function U(r,e){r||L()}function F(r,e){return r}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends ee.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Te{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ku{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}}class Hf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Jf{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Te;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Te,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,b.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Te)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U("string"==typeof n.accessToken),new Ku(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e),new ve(e)}}class Yf{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Xf{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Yf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class zu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zf{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U("string"==typeof t.token),this.R=t.token,new zu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function em(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class ju{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=em(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function j(r,e){return r<e?-1:r>e?1:0}function _n(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Qu(r){return r+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new de(0,0))}static max(){return new G(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ir{constructor(e,t,n){void 0===t?t=0:t>e.length&&L(),void 0===n?n=e.length-t:n>e.length-t&&L(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ir.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ir?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class J extends ir{construct(e,t,n){return new J(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new J(t)}static emptyPath(){return new J([])}}const tm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends ir{construct(e,t,n){return new ue(e,t,n)}static isValidIdentifier(e){return tm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new C(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(J.fromString(e))}static fromName(e){return new O(J.fromString(e).popFirst(5))}static empty(){return new O(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===J.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new J(e.slice()))}}class yn{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Ms(r){return r.fields.find(e=>2===e.kind)}function Kt(r){return r.fields.filter(e=>2!==e.kind)}yn.UNKNOWN_ID=-1;class zt{constructor(e,t){this.fieldPath=e,this.kind=t}}class In{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new In(0,je.min())}}function $u(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new je(i,O.empty(),e)}function Wu(r){return new je(r.readTime,r.key,-1)}class je{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new je(G.min(),O.empty(),-1)}static max(){return new je(G.max(),O.empty(),-1)}}function Os(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(r.documentKey,e.documentKey),0!==t?t:j(r.largestBatchId,e.largestBatchId))}const Hu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ju{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Tt(r){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,b.A)(function*(r){if(r.code!==S.FAILED_PRECONDITION||r.message!==Hu)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,n)=>{t(e)})}static reject(e){return new w((t,n)=>{n(e)})}static waitFor(e){return new w((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const n of e)t=t.next(i=>i?w.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new w((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new w((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class gi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Te,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new sr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=Bs(n.target.error);this.V.reject(new sr(e,i))}}static open(e,t,n,i){try{return new gi(t,e.transaction(i,n))}catch(s){throw new sr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new sm(t)}}class Xe{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Xe.S((0,ee.ZQ)())&&_e("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),jt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ee.zW)())return!1;if(Xe.C())return!0;const e=(0,ee.ZQ)(),t=Xe.S(e),n=0<t&&t<10,i=Yu(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,b.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new sr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new C(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new sr(e,u))},s.onupgradeneeded=a=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,b.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=gi.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),w.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Yu(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class im{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return jt(this.B.delete())}}class sr extends C{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Et(r){return"IndexedDbTransactionError"===r.name}class sm{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),jt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),jt(this.store.add(e))}get(e){return jt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),jt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),jt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new w((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new w((n,i)=>{t.onerror=s=>{const a=Bs(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new w((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new im(u),h=t(u.primaryKey,u.value,c);if(h instanceof w){const f=h.catch(g=>(c.done(),w.reject(g)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>w.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function jt(r){return new w((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=Bs(n.target.error);t(i)}})}let Xu=!1;function Bs(r){const e=Xe.S((0,ee.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Xu||(Xu=!0,setTimeout(()=>{throw n},0)),n}}return r}class om{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){Et(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Tt(n)}yield t.X(6e4)}))}}class am{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,b.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return N("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=Wu(s);Os(a,n)>0&&(n=a)}),new je(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Qe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function or(r){return null==r}function ar(r){return 0===r&&1/r==-1/0}function Zu(r){return"number"==typeof r&&Number.isInteger(r)&&!ar(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function be(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ec(e)),e=um(r.get(t),e);return ec(e)}function um(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function ec(r){return r+"\x01\x01"}function Ze(r){const e=r.length;if(U(e>=2),2===e)return U("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),J.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&L(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}const tc=["userId","batchId"];function pi(r,e){return[r,be(e)]}function nc(r,e,t){return[r,be(e),t]}const cm={},lm=["prefixPath","collectionGroup","readTime","documentId"],hm=["prefixPath","collectionGroup","documentId"],dm=["collectionGroup","readTime","prefixPath","documentId"],fm=["canonicalId","targetId"],mm=["targetId","path"],gm=["path","targetId"],pm=["collectionId","parent"],_m=["indexId","uid"],ym=["uid","sequenceNumber"],Im=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Tm=["indexId","uid","orderedDocumentKey"],Em=["userId","collectionPath","documentId"],vm=["userId","collectionPath","largestBatchId"],Am=["userId","collectionGroup","largestBatchId"],rc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],wm=[...rc,"documentOverlays"],ic=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],sc=ic,oc=[...sc,"indexConfiguration","indexState","indexEntries"],Rm=oc;class qs extends Ju{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ae(r,e){const t=F(r);return Xe.F(t._e,e)}function ac(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function vt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function cc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class oe{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _i(this.root,e,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _i(this.root,e,this.comparator,!0)}}class _i{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??Re.RED,this.left=i??Re.EMPTY,this.right=s??Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Re(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lc(this.data.getIterator())}getIteratorFrom(e){return new lc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class lc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Tn(r){return r.hasNext()?r.getNext():void 0}class Ke{constructor(e){this.fields=e,e.sort(ue.comparator)}static empty(){return new Ke([])}unionWith(e){let t=new ne(ue.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _n(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class hc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ee{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new hc("Invalid base64 string: "+s):s}}(e);return new Ee(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Ee(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ee.EMPTY_BYTE_STRING=new Ee("");const Sm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ot(r){if(U(!!r),"string"==typeof r){let e=0;const t=Sm.exec(r);if(U(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ge(r.seconds),nanos:ge(r.nanos)}}function ge(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function at(r){return"string"==typeof r?Ee.fromBase64String(r):Ee.fromUint8Array(r)}function yi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ii(r){const e=r.mapValue.fields.__previous_value__;return yi(e)?Ii(e):e}function ur(r){const e=ot(r.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}class Vm{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class At{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new At("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof At&&e.projectId===this.projectId&&e.database===this.database}}const wt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ti={nullValue:"NULL_VALUE"};function Rt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?yi(r)?4:gc(r)?9007199254740991:10:L()}function et(r,e){if(r===e)return!0;const t=Rt(r);if(t!==Rt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ur(r).isEqual(ur(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=ot(i.timestampValue),u=ot(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,at(r.bytesValue).isEqual(at(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ge(i.geoPointValue.latitude)===ge(s.geoPointValue.latitude)&&ge(i.geoPointValue.longitude)===ge(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ge(i.integerValue)===ge(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=ge(i.doubleValue),u=ge(s.doubleValue);return a===u?ar(a)===ar(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return _n(r.arrayValue.values||[],e.arrayValue.values||[],et);case 10:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(ac(a)!==ac(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!et(a[c],u[c])))return!1;return!0}(r,e);default:return L()}var s}function cr(r,e){return void 0!==(r.values||[]).find(t=>et(t,e))}function Pt(r,e){if(r===e)return 0;const t=Rt(r),n=Rt(e);if(t!==n)return j(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=ge(s.integerValue||s.doubleValue),c=ge(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return dc(r.timestampValue,e.timestampValue);case 4:return dc(ur(r),ur(e));case 5:return j(r.stringValue,e.stringValue);case 6:return function(s,a){const u=at(s),c=at(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=j(u[h],c[h]);if(0!==f)return f}return j(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=j(ge(s.latitude),ge(a.latitude));return 0!==u?u:j(ge(s.longitude),ge(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,a){const u=s.values||[],c=a.values||[];for(let h=0;h<u.length&&h<c.length;++h){const f=Pt(u[h],c[h]);if(f)return f}return j(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===wt.mapValue&&a===wt.mapValue)return 0;if(s===wt.mapValue)return 1;if(a===wt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){const _=j(c[g],f[g]);if(0!==_)return _;const R=Pt(u[c[g]],h[f[g]]);if(0!==R)return R}return j(c.length,f.length)}(r.mapValue,e.mapValue);default:throw L()}}function dc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return j(r,e);const t=ot(r),n=ot(e),i=j(t.seconds,n.seconds);return 0!==i?i:j(t.nanos,n.nanos)}function En(r){return Us(r)}function Us(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ot(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?at(r.bytesValue).toBase64():"referenceValue"in r?O.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Us(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${Us(t.fields[a])}`;return i+"}"}(r.mapValue):L()}function Qt(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Gs(r){return!!r&&"integerValue"in r}function lr(r){return!!r&&"arrayValue"in r}function fc(r){return!!r&&"nullValue"in r}function mc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function vi(r){return!!r&&"mapValue"in r}function hr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return vt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=hr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function gc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}function bm(r){return"nullValue"in r?Ti:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Qt(At.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:L()}function xm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Qt(At.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?wt:L()}function pc(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function _c(r,e){const t=Pt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!vi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hr(t)}setAll(e){let t=ue.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=hr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());vi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];vi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){vt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Pe(hr(this.value))}}function yc(r){const e=[];return vt(r.fields,(t,n)=>{const i=new ue([t]);if(vi(n)){const s=yc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Ke(e)}class ce{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new ce(e,0,G.min(),G.min(),G.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,i){return new ce(e,1,t,G.min(),n,i,0)}static newNoDocument(e,t){return new ce(e,2,t,G.min(),G.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new ce(e,3,t,G.min(),G.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class St{constructor(e,t){this.position=e,this.inclusive=t}}function Ic(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?O.comparator(O.fromName(a.referenceValue),t.key):Pt(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Tc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!et(r.position[t],e.position[t]))return!1;return!0}class dr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Cm(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Ec{}class Y extends Ec{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Dm(e,t,n):"array-contains"===t?new Fm(e,n):"in"===t?new Sc(e,n):"not-in"===t?new Mm(e,n):"array-contains-any"===t?new Om(e,n):new Y(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Nm(e,n):new km(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Pt(t,this.value)):null!==t&&Rt(this.value)===Rt(t)&&this.matchesComparison(Pt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class te extends Ec{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new te(e,t)}matches(e){return vn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function vn(r){return"and"===r.op}function Ks(r){return"or"===r.op}function zs(r){return vc(r)&&vn(r)}function vc(r){for(const e of r.filters)if(e instanceof te)return!1;return!0}function js(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+En(r.value);if(zs(r))return r.filters.map(e=>js(e)).join(",");{const e=r.filters.map(t=>js(t)).join(",");return`${r.op}(${e})`}}function Ac(r,e){return r instanceof Y?(n=r,(i=e)instanceof Y&&n.op===i.op&&n.field.isEqual(i.field)&&et(n.value,i.value)):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&Ac(a,i.filters[u]),!0)}(r,e):void L();var n,i}function wc(r,e){const t=r.filters.concat(e);return te.create(t,r.op)}function Rc(r){return r instanceof Y?`${(t=r).field.canonicalString()} ${t.op} ${En(t.value)}`:r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(Rc).join(" ,")+"}"}(r):"Filter";var t}class Dm extends Y{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class Nm extends Y{constructor(e,t){super(e,"in",t),this.keys=Pc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class km extends Y{constructor(e,t){super(e,"not-in",t),this.keys=Pc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Pc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>O.fromName(n.referenceValue))}class Fm extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return lr(t)&&cr(t.arrayValue,this.value)}}class Sc extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&cr(this.value.arrayValue,t)}}class Mm extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(cr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!cr(this.value.arrayValue,t)}}class Om extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!lr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>cr(this.value.arrayValue,n))}}class Lm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Qs(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Lm(r,e,t,n,i,s,a)}function $t(r){const e=F(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>js(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),or(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>En(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>En(n)).join(",")),e.ue=t}return e.ue}function fr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Cm(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Ac(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Tc(r.startAt,e.startAt)&&Tc(r.endAt,e.endAt)}function Ai(r){return O.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function wi(r,e){return r.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function Vc(r,e,t){let n=Ti,i=!0;for(const s of wi(r,e)){let a=Ti,u=!0;switch(s.op){case"<":case"<=":a=bm(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ti}pc({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];pc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function bc(r,e,t){let n=wt,i=!0;for(const s of wi(r,e)){let a=wt,u=!0;switch(s.op){case">=":case">":a=xm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=wt}_c({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];_c({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class ut{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function xc(r,e,t,n,i,s,a,u){return new ut(r,e,t,n,i,s,a,u)}function An(r){return new ut(r)}function Cc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function $s(r){return null!==r.collectionGroup}function wn(r){const e=F(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ne(ue.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new dr(s,n))}),t.has(ue.keyField().canonicalString())||e.ce.push(new dr(ue.keyField(),n))}return e.ce}function xe(r){const e=F(r);return e.le||(e.le=function Nc(r,e){if("F"===r.limitType)return Qs(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new dr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new St(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new St(r.startAt.position,r.startAt.inclusive):null;return Qs(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,wn(r))),e.le}function Ws(r,e){const t=r.filters.concat([e]);return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ri(r,e,t){return new ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function mr(r,e){return fr(xe(r),xe(e))&&r.limitType===e.limitType}function kc(r){return`${$t(xe(r))}|lt:${r.limitType}`}function Rn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Rc(i)).join(", ")}]`),or(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>En(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>En(i)).join(",")),`Target(${n})`}(xe(r))}; limitType=${r.limitType})`}function gr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of wn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=Ic(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,wn(n),i)||n.endAt&&!function(a,u,c){const h=Ic(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,wn(n),i)));var n,i}function Fc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Mc(r){return(e,t)=>{let n=!1;for(const i of wn(r)){const s=Bm(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Bm(r,e,t){const n=r.field.isKeyField()?O.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Pt(c,h):L()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}class ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return cc(this.inner)}size(){return this.innerSize}}const qm=new oe(O.comparator);function ze(){return qm}const Oc=new oe(O.comparator);function pr(...r){let e=Oc;for(const t of r)e=e.insert(t.key,t);return e}function Lc(r){let e=Oc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function tt(){return _r()}function Bc(){return _r()}function _r(){return new ct(r=>r.toString(),(r,e)=>r.isEqual(e))}const Um=new oe(O.comparator),Gm=new ne(O.comparator);function Q(...r){let e=Gm;for(const t of r)e=e.add(t);return e}const Km=new ne(j);function Hs(){return Km}function qc(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ar(e)?"-0":e}}function Uc(r){return{integerValue:""+r}}function Gc(r,e){return Zu(e)?Uc(e):qc(r,e)}class Pi{constructor(){this._=void 0}}function zm(r,e,t){return r instanceof Pn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&yi(s)&&(s=Ii(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Wt?zc(r,e):r instanceof Ht?jc(r,e):function(i,s){const a=Kc(i,s),u=Qc(a)+Qc(i.Pe);return Gs(a)&&Gs(i.Pe)?Uc(u):qc(i.serializer,u)}(r,e)}function jm(r,e,t){return r instanceof Wt?zc(r,e):r instanceof Ht?jc(r,e):t}function Kc(r,e){return r instanceof Sn?Gs(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Pn extends Pi{}class Wt extends Pi{constructor(e){super(),this.elements=e}}function zc(r,e){const t=$c(e);for(const n of r.elements)t.some(i=>et(i,n))||t.push(n);return{arrayValue:{values:t}}}class Ht extends Pi{constructor(e){super(),this.elements=e}}function jc(r,e){let t=$c(e);for(const n of r.elements)t=t.filter(i=>!et(i,n));return{arrayValue:{values:t}}}class Sn extends Pi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Qc(r){return ge(r.integerValue||r.doubleValue)}function $c(r){return lr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class yr{constructor(e,t){this.field=e,this.transform=t}}class $m{constructor(e,t){this.version=e,this.transformResults=t}}class fe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fe}static exists(e){return new fe(void 0,e)}static updateTime(e){return new fe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Si(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Vi{}function Wc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new bn(r.key,fe.none()):new Vn(r.key,r.data,fe.none());{const t=r.data,n=Pe.empty();let i=new ne(ue.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new lt(r.key,n,new Ke(i.toArray()),fe.none())}}function Wm(r,e,t){r instanceof Vn?function(i,s,a){const u=i.value.clone(),c=Yc(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof lt?function(i,s,a){if(!Si(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=Yc(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Jc(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ir(r,e,t,n){return r instanceof Vn?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=s.value.clone(),f=Xc(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof lt?function(s,a,u,c){if(!Si(s.precondition,a))return u;const h=Xc(s.fieldTransforms,c,a),f=a.data;return f.setAll(Jc(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Si(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Hm(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Kc(n.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(n.field,s))}return t||null}function Hc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&_n(n,i,(s,a)=>function Qm(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Wt&&i instanceof Wt||n instanceof Ht&&i instanceof Ht?_n(n.elements,i.elements,et):n instanceof Sn&&i instanceof Sn?et(n.Pe,i.Pe):n instanceof Pn&&i instanceof Pn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Vn extends Vi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class lt extends Vi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Jc(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Yc(r,e,t){const n=new Map;U(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,jm(a,u,t[i]))}return n}function Xc(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,zm(s,a,e))}return n}class bn extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Js extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ys{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Wm(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ir(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Bc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=Wc(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(G.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&_n(this.mutations,e.mutations,(t,n)=>Hc(t,n))&&_n(this.baseMutations,e.baseMutations,(t,n)=>Hc(t,n))}}class Xs{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length);let i=function(){return Um}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Xs(e,t,n,i)}}class Zs{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Jm{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ie,X;function el(r){switch(r){default:return L();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function tl(r){if(void 0===r)return _e("GRPC error has no .code"),S.UNKNOWN;switch(r){case Ie.OK:return S.OK;case Ie.CANCELLED:return S.CANCELLED;case Ie.UNKNOWN:return S.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return S.INTERNAL;case Ie.UNAVAILABLE:return S.UNAVAILABLE;case Ie.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Ie.NOT_FOUND:return S.NOT_FOUND;case Ie.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Ie.ABORTED:return S.ABORTED;case Ie.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Ie.DATA_LOSS:return S.DATA_LOSS;default:return L()}}(X=Ie||(Ie={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function nl(){return new TextEncoder}const Ym=new Gt([4294967295,4294967295],0);function rl(r){const e=nl().encode(r),t=new Fu;return t.update(e),new Uint8Array(t.digest())}function il(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Gt([t,n],0),new Gt([i,s],0)]}class eo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Tr(`Invalid padding: ${t}`);if(n<0)throw new Tr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Tr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Tr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Gt.fromNumber(n)));return 1===i.compare(Ym)&&(i=new Gt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=rl(e),[n,i]=il(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new eo(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=rl(e),[n,i]=il(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Tr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Er{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,vr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Er(G.min(),i,new oe(j),ze(),Q())}}class vr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new vr(n,t,Q(),Q(),Q())}}class xi{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class sl{constructor(e,t){this.targetId=e,this.me=t}}class ol{constructor(e,t,n=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class al{constructor(){this.fe=0,this.ge=cl(),this.pe=Ee.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=Q(),t=Q(),n=Q();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:L()}}),new vr(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=cl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Xm{constructor(e){this.Le=e,this.Be=new Map,this.ke=ze(),this.qe=ul(),this.Qe=new oe(j)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Ai(s))if(0===n){const a=new O(s.path);this.Ue(t,a,ce.newNoDocument(a,G.min()))}else U(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=at(n).toUint8Array()}catch(c){if(c instanceof hc)return Ge("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new eo(a,i,s)}catch(c){return Ge(c instanceof Tr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Ai(u.target)){const c=new O(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,ce.newNoDocument(c,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let n=Q();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new Er(e,t,this.Qe,this.ke,n);return this.ke=ze(),this.qe=ul(),this.Qe=new oe(j),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new al,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(j),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new al),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ul(){return new oe(O.comparator)}function cl(){return new oe(O.comparator)}const Zm={asc:"ASCENDING",desc:"DESCENDING"},eg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tg={and:"AND",or:"OR"};class ng{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function to(r,e){return r.useProto3Json||or(e)?e:{value:e}}function xn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ll(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function rg(r,e){return xn(r,e.toTimestamp())}function ye(r){return U(!!r),G.fromTimestamp(function(t){const n=ot(t);return new de(n.seconds,n.nanos)}(r))}function no(r,e){return ro(r,e).canonicalString()}function ro(r,e){const t=(i=r,new J(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function hl(r){const e=J.fromString(r);return U(vl(e)),e}function Ar(r,e){return no(r.databaseId,e.path)}function nt(r,e){const t=hl(e);if(t.get(1)!==r.databaseId.projectId)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(ml(t))}function dl(r,e){return no(r.databaseId,e)}function fl(r){const e=hl(r);return 4===e.length?J.emptyPath():ml(e)}function io(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ml(r){return U(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function gl(r,e,t){return{name:Ar(r,e),fields:t.value.mapValue.fields}}function pl(r,e,t){const n=nt(r,e.name),i=ye(e.updateTime),s=e.createTime?ye(e.createTime):G.min(),a=new Pe({mapValue:{fields:e.fields}}),u=ce.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function wr(r,e){let t;if(e instanceof Vn)t={update:gl(r,e.key,e.value)};else if(e instanceof bn)t={delete:Ar(r,e.key)};else if(e instanceof lt)t={update:gl(r,e.key,e.data),updateMask:hg(e.fieldMask)};else{if(!(e instanceof Js))return L();t={verify:Ar(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Wt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ht)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Sn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:rg(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:L()),t;var s}function so(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?fe.updateTime(ye(s.updateTime)):void 0!==s.exists?fe.exists(s.exists):fe.none():fe.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(U("REQUEST_TIME"===u.setToServerValue),c=new Pn):"appendMissingElements"in u?c=new Wt(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new Ht(u.removeAllFromArray.values||[]):"increment"in u?c=new Sn(a,u.increment):L();const h=ue.fromServerFormat(u.fieldPath);return new yr(h,c)}(r,i)):[];var s;if(e.update){const i=nt(r,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new Ke((e.updateMask.fieldPaths||[]).map(f=>ue.fromServerFormat(f)));return new lt(i,s,a,t,n)}return new Vn(i,s,t,n)}if(e.delete){const i=nt(r,e.delete);return new bn(i,t)}if(e.verify){const i=nt(r,e.verify);return new Js(i,t)}return L()}function _l(r,e){return{documents:[dl(r,e.path)]}}function Ci(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=dl(r,i);const s=function(h){if(0!==h.length)return El(te.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:Vt((_=f).field),direction:ug(_.dir)};var _})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=to(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Il(r){let e=fl(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){U(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const _=Tl(g);return _ instanceof te&&zs(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(_=>{return new dr(Cn((x=_).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let u=null;t.limit&&(u=function(g){let _;return _="object"==typeof g?g.value:g,or(_)?null:_}(t.limit));let c=null;var g;t.startAt&&(c=new St((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new St(g.values||[],!g.before)}(t.endAt)),xc(e,i,a,s,u,"F",c,h)}function Tl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Cn(t.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Cn(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Cn(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Cn(t.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):void 0!==r.fieldFilter?Y.create(Cn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return te.create(t.compositeFilter.filters.map(n=>Tl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(t.compositeFilter.op))}(r):L();var t}function ug(r){return Zm[r]}function cg(r){return eg[r]}function lg(r){return tg[r]}function Vt(r){return{fieldPath:r.canonicalString()}}function Cn(r){return ue.fromServerFormat(r.fieldPath)}function El(r){return r instanceof Y?function(t){if("=="===t.op){if(mc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NAN"}};if(fc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(mc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NAN"}};if(fc(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vt(t.field),op:cg(t.op),value:t.value}}}(r):r instanceof te?function(t){const n=t.getFilters().map(i=>El(i));return 1===n.length?n[0]:{compositeFilter:{op:lg(t.op),filters:n}}}(r):L()}function hg(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vl(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class ht{constructor(e,t,n,i,s=G.min(),a=G.min(),u=Ee.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new ht(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Al{constructor(e){this.ct=e}}function wl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Di(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Ar(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:xn(s,a.version.toTimestamp()),createTime:xn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Jt(e.version)};else{if(!e.isUnknownDocument())return L();n.unknownDocument={path:t.path.toArray(),version:Jt(e.version)}}var s,a;return n}function Di(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Jt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yt(r){const e=new de(r.seconds,r.nanoseconds);return G.fromTimestamp(e)}function Xt(r,e){const t=(e.baseMutations||[]).map(s=>so(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>so(r.ct,s)),i=de.fromMillis(e.localWriteTimeMs);return new Ys(e.batchId,i,t,n)}function Rr(r){const e=Yt(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Yt(r.lastLimboFreeSnapshotVersion):G.min();let n;return n=void 0!==r.query.documents?(U(1===(s=r.query).documents.length),xe(An(fl(s.documents[0])))):function(s){return xe(Il(s))}(r.query),new ht(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ee.fromBase64String(r.resumeToken));var s}function Rl(r,e){const t=Jt(e.snapshotVersion),n=Jt(e.lastLimboFreeSnapshotVersion);let i;i=Ai(e.target)?_l(r.ct,e.target):Ci(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:$t(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function oo(r){const e=Il({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Ri(e,e.limit,"L"):e}function ao(r,e){return new Zs(e.largestBatchId,so(r.ct,e.overlayMutation))}function Pl(r,e){const t=e.path.lastSegment();return[r,be(e.path.popLast()),t]}function Sl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Jt(n.readTime),documentKey:be(n.documentKey.path),largestBatchId:n.largestBatchId}}class fg{getBundleMetadata(e,t){return Vl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Yt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Vl(e).put({bundleId:(i=t).id,createTime:Jt(ye(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return bl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:oo(s.bundledQuery),readTime:Yt(s.readTime)};var s})}saveNamedQuery(e,t){return bl(e).put({name:(i=t).name,readTime:Jt(ye(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Vl(r){return Ae(r,"bundles")}function bl(r){return Ae(r,"namedQueries")}class Ni{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Ni(e,t.uid||"")}getOverlay(e,t){return Pr(e).get(Pl(this.userId,t)).next(n=>n?ao(this.serializer,n):null)}getOverlays(e,t){const n=tt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new Zs(t,a);i.push(this.ht(e,u))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(be(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Pr(e).j("collectionPathOverlayIndex",u))}),w.waitFor(s)}getOverlaysForCollection(e,t,n){const i=tt(),s=be(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Pr(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=ao(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=tt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const g=ao(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Pr(e).put(function(i,s,a){const[u,c,h]=Pl(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:wr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function Pr(r){return Ae(r,"documentOverlays")}class Zt{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ge(e.integerValue));else if("doubleValue"in e){const n=ge(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),ar(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=ot(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(at(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?gc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):L()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),O.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function mg(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function xl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=mg(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}Zt.bt=new Zt;class gg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{const i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){const t=this.Bt(e),n=xl(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Bt(e),n=xl(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class pg{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class _g{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class Sr{constructor(){this.Gt=new gg,this.zt=new pg(this.Gt),this.jt=new _g(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class en{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new en(this.indexId,this.documentKey,this.arrayValue,n)}}function bt(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Cl(r.arrayValue,e.arrayValue),0!==t?t:(t=Cl(r.directionalValue,e.directionalValue),0!==t?t:O.comparator(r.documentKey,e.documentKey)))}function Cl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Dl{constructor(e){this.Yt=new ne((t,n)=>ue.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const n=t;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(e){if(U(e.collectionGroup===this.collectionId),this.en)return!1;const t=Ms(e);if(void 0!==t&&!this.nn(t))return!1;const n=Kt(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){const u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.rn(u,c)||!this.sn(this.Zt[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.Zt.length||!this.sn(this.Zt[a++],n[s]))return!1;return!0}on(){if(this.en)return null;let e=new ne(ue.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new zt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new zt(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new zt(n.field,"asc"===n.dir?0:1)));return new yn(yn.UNKNOWN_ID,this.collectionId,t,In.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Nl(r){var e,t;if(U(r instanceof Y||r instanceof te),r instanceof Y){if(r instanceof Sc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}const n=r.filters.map(i=>Nl(i));return te.create(n,r.op)}function yg(r){if(0===r.getFilters().length)return[];const e=lo(Nl(r));return U(kl(e)),uo(e)||co(e)?[e]:e.getFilters()}function uo(r){return r instanceof Y}function co(r){return r instanceof te&&zs(r)}function kl(r){return uo(r)||co(r)||function(t){if(t instanceof te&&Ks(t)){for(const n of t.getFilters())if(!uo(n)&&!co(n))return!1;return!0}return!1}(r)}function lo(r){if(U(r instanceof Y||r instanceof te),r instanceof Y)return r;if(1===r.filters.length)return lo(r.filters[0]);const e=r.filters.map(n=>lo(n));let t=te.create(e,r.op);return t=ki(t),kl(t)?t:(U(t instanceof te),U(vn(t)),U(t.filters.length>1),t.filters.reduce((n,i)=>ho(n,i)))}function ho(r,e){let t;return U(r instanceof Y||r instanceof te),U(e instanceof Y||e instanceof te),t=r instanceof Y?e instanceof Y?te.create([r,e],"and"):Fl(r,e):e instanceof Y?Fl(e,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0),vn(i)&&vn(s))return wc(i,s.getFilters());const a=Ks(i)?i:s,u=Ks(i)?s:i,c=a.filters.map(h=>ho(h,u));return te.create(c,"or")}(r,e),ki(t)}function Fl(r,e){if(vn(e))return wc(e,r.getFilters());{const t=e.filters.map(n=>ho(r,n));return te.create(t,"or")}}function ki(r){if(U(r instanceof Y||r instanceof te),r instanceof Y)return r;const e=r.getFilters();if(1===e.length)return ki(e[0]);if(vc(r))return r;const t=e.map(i=>ki(i)),n=[];return t.forEach(i=>{i instanceof Y?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:te.create(n,r.op)}class Ig{constructor(){this._n=new fo}addToCollectionParentIndex(e,t){return this._n.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(je.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(je.min())}updateCollectionGroup(e,t,n){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class fo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ne(J.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ne(J.comparator)).toArray()}}const Fi=new Uint8Array(0);class Tg{constructor(e,t){this.databaseId=t,this.an=new fo,this.un=new ct(n=>$t(n),(n,i)=>fr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});const s={collectionId:n,parent:be(i)};return Ml(e).put(s)}return w.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Qu(t),""],!1,!0);return Ml(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(Ze(a.parent))}return n})}addFieldIndex(e,t){const n=Vr(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Nn(e);return s.next(u=>{a.put(Sl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Vr(e),i=Nn(e),s=Dn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Vr(e),n=Dn(e),i=Nn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return w.forEach(this.cn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Dl(n).on();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Dn(e);let i=!0;const s=new Map;return w.forEach(this.cn(t),a=>this.ln(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=Q();const u=[];return w.forEach(s,(c,h)=>{var q;N("IndexedDbIndexManager",`Using index ${q=c,`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`} to execute ${$t(t)}`);const f=function(q,z){const H=Ms(z);if(void 0===H)return null;for(const $ of wi(q,H.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(h,c),g=function(q,z){const H=new Map;for(const $ of Kt(z))for(const T of wi(q,$.fieldPath))switch(T.op){case"==":case"in":H.set($.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return H.set($.fieldPath.canonicalString(),T.value),Array.from(H.values())}return null}(h,c),_=function(q,z){const H=[];let $=!0;for(const T of Kt(z)){const p=0===T.kind?Vc(q,T.fieldPath,q.startAt):bc(q,T.fieldPath,q.startAt);H.push(p.value),$&&($=p.inclusive)}return new St(H,$)}(h,c),R=function(q,z){const H=[];let $=!0;for(const T of Kt(z)){const p=0===T.kind?bc(q,T.fieldPath,q.endAt):Vc(q,T.fieldPath,q.endAt);H.push(p.value),$&&($=p.inclusive)}return new St(H,$)}(h,c),x=this.hn(c,h,_),k=this.hn(c,h,R),D=this.Pn(c,h,g),B=this.In(c.indexId,f,x,_.inclusive,k,R.inclusive,D);return w.forEach(B,K=>n.G(K,t.limit).next(q=>{q.forEach(z=>{const H=O.fromSegments(z.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return w.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:yg(te.create(e.filters,"and")).map(n=>Qs(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let g=0;g<c;++g){const _=t?this.Tn(t[g/h]):Fi,R=this.En(e,_,n[g%h],i),x=this.dn(e,_,s[g%h],a),k=u.map(D=>this.En(e,_,D,!0));f.push(...this.createRange(R,x,k))}return f}En(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s:s.Jt()}dn(e,t,n,i){const s=new en(e,O.empty(),t,n);return i?s.Jt():s}ln(e,t){const n=new Dl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.cn(t);return w.forEach(i,s=>this.ln(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new ne(ue.comparator),f=!1;for(const g of c.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?f=!0:h=h.add(_.field));for(const g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}An(e,t){const n=new Sr;for(const i of Kt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Ht(i.kind);Zt.bt.Pt(s,a)}return n.Wt()}Tn(e){const t=new Sr;return Zt.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new Sr;return Zt.bt.Pt(Qt(this.databaseId,t),n.Ht(function(s){const a=Kt(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let i=[];i.push(new Sr);let s=0;for(const a of Kt(e)){const u=n[s++];for(const c of i)if(this.Vn(t,a.fieldPath)&&lr(u))i=this.mn(i,a,u);else{const h=c.Ht(a.kind);Zt.bt.Pt(u,h)}}return this.fn(i)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new Sr;c.seed(u.Wt()),Zt.bt.Pt(a,c.Ht(t.kind)),s.push(c)}return s}Vn(e,t){return!!e.filters.find(n=>n instanceof Y&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Vr(e),i=Nn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return w.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){const _=g?new In(g.sequenceNumber,new je(Yt(g.readTime),new O(Ze(g.documentKey)),g.largestBatchId)):In.empty(),R=f.fields.map(([x,k])=>new zt(ue.fromServerFormat(x),k));return new yn(f.indexId,f.collectionGroup,R,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:j(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Vr(e),s=Nn(e);return this.gn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>w.forEach(u,c=>s.put(Sl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return w.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?w.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),w.forEach(u,c=>this.pn(e,i,c).next(h=>{const f=this.yn(s,c);return h.isEqual(f)?w.resolve():this.wn(e,s,c,h,f)}))))})}Sn(e,t,n,i){return Dn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,i){return Dn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const i=Dn(e);let s=new ne(bt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(a,u)=>{s=s.add(new en(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(e,t){let n=new ne(bt);const i=this.An(t,e);if(null==i)return n;const s=Ms(t);if(null!=s){const a=e.data.field(s.fieldPath);if(lr(a))for(const u of a.arrayValue.values||[])n=n.add(new en(t.indexId,e.key,this.Tn(u),i))}else n=n.add(new en(t.indexId,e.key,Fi,i));return n}wn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,g,_){const R=c.getIterator(),x=h.getIterator();let k=Tn(R),D=Tn(x);for(;k||D;){let B=!1,K=!1;if(k&&D){const q=f(k,D);q<0?K=!0:q>0&&(B=!0)}else null!=k?K=!0:B=!0;B?(g(D),D=Tn(x)):K?(_(k),k=Tn(R)):(k=Tn(R),D=Tn(x))}}(i,s,bt,u=>{a.push(this.Sn(e,t,n,u))},u=>{a.push(this.bn(e,t,n,u))}),w.waitFor(a)}gn(e){let t=1;return Nn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>bt(a,u)).filter((a,u,c)=>!u||0!==bt(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=bt(a,e),c=bt(a,t);if(0===u)i[0]=e.Jt();else if(u>0&&c<0)i.push(a),i.push(a.Jt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Fi,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Fi,[]]))}return s}Dn(e,t){return bt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ol)}getMinOffset(e,t){return w.mapArray(this.cn(t),n=>this.ln(e,n).next(i=>i||L())).next(Ol)}}function Ml(r){return Ae(r,"collectionParents")}function Dn(r){return Ae(r,"indexEntries")}function Vr(r){return Ae(r,"indexConfiguration")}function Nn(r){return Ae(r,"indexState")}function Ol(r){U(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Os(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new je(e.readTime,e.documentKey,t)}const Ll={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Bl(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{U(1===u)}));const h=[];for(const f of t.mutations){const g=nc(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return w.waitFor(s).next(()=>h)}function Mi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw L();e=r.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Oi{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(e,t,n,i){U(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Oi(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=kn(e),a=xt(e);return a.add({}).next(u=>{U("number"==typeof u);const c=new Ys(u,t,n,i),h=function(R,x,k){const D=k.baseMutations.map(K=>wr(R.ct,K)),B=k.mutations.map(K=>wr(R.ct,K));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:B}}(this.serializer,this.userId,c),f=[];let g=new ne((_,R)=>j(_.canonicalString(),R.canonicalString()));for(const _ of i){const R=nc(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(h)),f.push(s.put(R,cm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Cn[u]=c.keys()}),w.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return xt(e).get(t).next(n=>n?(U(n.userId===this.userId),Xt(this.serializer,n)):null)}vn(e,t){return this.Cn[t]?w.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return xt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n),s=Xt(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return xt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).U("userMutationsIndex",t).next(n=>n.map(i=>Xt(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=pi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return kn(e).J({range:i},(a,u,c)=>{const[h,f,g]=a,_=Ze(f);if(h===this.userId&&t.path.isEqual(_))return xt(e).get(g).next(R=>{if(!R)throw L();U(R.userId===this.userId),s.push(Xt(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);const i=[];return t.forEach(s=>{const a=pi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=kn(e).J({range:u},(h,f,g)=>{const[_,R,x]=h,k=Ze(R);_===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(c)}),w.waitFor(i).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=pi(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new ne(j);return kn(e).J({range:a},(c,h,f)=>{const[g,_,R]=c,x=Ze(_);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Fn(e,u))}Fn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(xt(e).get(s).next(a=>{if(null===a)throw L();U(a.userId===this.userId),n.push(Xt(this.serializer,a))}))}),w.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Bl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),w.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return kn(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=Ze(s[1]);i.push(c)}else u.done()}).next(()=>{U(0===i.length)})})}containsKey(e,t){return ql(e,this.userId,t)}xn(e){return Ul(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ql(r,e,t){const n=pi(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return kn(r).J({range:s,H:!0},(u,c,h)=>{const[f,g,_]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function xt(r){return Ae(r,"mutations")}function kn(r){return Ae(r,"documentMutations")}function Ul(r){return Ae(r,"mutationQueues")}class tn{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new tn(0)}static Ln(){return new tn(-1)}}class Eg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const n=new tn(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>G.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fn(e).delete(t.targetId)).next(()=>this.Bn(e)).next(n=>(U(n.targetCount>0),n.targetCount-=1,this.kn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Fn(e).J((a,u)=>{const c=Rr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Fn(e).J((n,i)=>{const s=Rr(i);t(s)})}Bn(e){return Gl(e).get("targetGlobalKey").next(t=>(U(null!==t),t))}kn(e,t){return Gl(e).put("targetGlobalKey",t)}qn(e,t){return Fn(e).put(Rl(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=$t(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Fn(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Rr(u);fr(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Ct(e);return t.forEach(a=>{const u=be(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),w.waitFor(i)}removeMatchingKeys(e,t,n){const i=Ct(e);return w.forEach(t,s=>{const a=be(s.path);return w.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Ct(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ct(e);let s=Q();return i.J({range:n,H:!0},(a,u,c)=>{const h=Ze(a[1]),f=new O(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=be(t.path),i=IDBKeyRange.bound([n],[Qu(n)],!1,!0);let s=0;return Ct(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Fn(e).get(t).next(n=>n?Rr(n):null)}}function Fn(r){return Ae(r,"targets")}function Gl(r){return Ae(r,"targetGlobal")}function Ct(r){return Ae(r,"targetDocuments")}function Kl([r,e],[t,n]){const i=j(r,t);return 0===i?j(e,n):i}class vg{constructor(e){this.Kn=e,this.buffer=new ne(Kl),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Kl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Et(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Tt(n)}yield t.zn(3e5)}))}}class Ag{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return w.resolve(Qe.oe);const n=new vg(t);return this.jn.forEachTarget(e,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(Ll)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ll):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),pn()<=Ye.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${g} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class wg{constructor(e,t){this.db=e,this.garbageCollector=function jl(r,e){return new Ag(r,e)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Zn(e){let t=0;return this.Jn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(n,i)=>t(i))}addReference(e,t,n){return Li(e,n)}removeReference(e,t,n){return Li(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Li(e,t)}er(e,t){return function(i,s){let a=!1;return Ul(i).Y(u=>ql(i,u,s).next(c=>(c&&(a=!0),w.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(e,(a,u)=>{if(u<=t){const c=this.er(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,G.min()),Ct(e).delete([0,be(a.path)])))});i.push(c)}}).next(()=>w.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Li(e,t)}Xn(e,t){const n=Ct(e);let i,s=Qe.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==Qe.oe&&t(new O(Ze(i)),s),s=h,i=c):s=Qe.oe}).next(()=>{s!==Qe.oe&&t(new O(Ze(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Li(r,e){return Ct(r).put((i=r.currentSequenceNumber,{targetId:0,path:be(e.path),sequenceNumber:i}));var i}class Ql{constructor(){this.changes=new ct(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?w.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Rg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return nn(e).put(n)}removeEntry(e,t,n){return nn(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Di(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=ce.newInvalidDocument(t);return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(t))},(i,s)=>{n=this.nr(t,s)}).next(()=>n)}rr(e,t){let n={size:0,document:ce.newInvalidDocument(t)};return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(t))},(i,s)=>{n={document:this.nr(t,s),size:Mi(s)}}).next(()=>n)}getEntries(e,t){let n=ze();return this.ir(e,t,(i,s)=>{const a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(e,t){let n=ze(),i=new oe(O.comparator);return this.ir(e,t,(s,a)=>{const u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,Mi(a))}).next(()=>({documents:n,_r:i}))}ir(e,t,n){if(t.isEmpty())return w.resolve();let i=new ne(Jl);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(br(i.first()),br(i.last())),a=i.getIterator();let u=a.getNext();return nn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const g=O.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Jl(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(br(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Di(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=ze();for(const g of h){const _=this.nr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(gr(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=ze();const a=Hl(t,n),u=Hl(t,je.max());return nn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const g=this.nr(O.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Pg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Wl(e).get("remoteDocumentGlobalKey").next(t=>(U(!!t),t))}tr(e,t){return Wl(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const n=function dg(r,e){let t;if(e.document)t=pl(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=O.fromSegments(e.noDocument.path),i=Yt(e.noDocument.readTime);t=ce.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return L();{const n=O.fromSegments(e.unknownDocument.path),i=Yt(e.unknownDocument.version);t=ce.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new de(i[0],i[1]);return G.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(G.min()))return n}return ce.newInvalidDocument(e)}}function $l(r){return new Rg(r)}class Pg extends Ql{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new ct(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ne((s,a)=>j(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=wl(this.ar.serializer,a);i=i.add(s.path.popLast());const h=Mi(c);n+=h-u.size,t.push(this.ar.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=wl(this.ar.serializer,a.convertToNoDocument(G.min()));t.push(this.ar.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,n)),w.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(n=>(this.ur.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function Wl(r){return Ae(r,"remoteDocumentGlobal")}function nn(r){return Ae(r,"remoteDocumentsV14")}function br(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Hl(r,e){const t=e.documentKey.path.toArray();return[r,Di(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Jl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=j(t[s],n[s]),i)return i;return i=j(t.length,n.length),i||(i=j(t[t.length-2],n[n.length-2]),i||j(t[t.length-1],n[n.length-1]))}class Sg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Yl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Ir(n.mutation,i,Ke.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Q()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Q()){const i=tt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=pr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=tt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Q()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=ze();const a=_r(),u=_r();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof lt)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),Ir(f.mutation,h,f.mutation.getFieldMask(),de.now())):a.set(h.key,Ke.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new Sg(f,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=_r();let i=new oe((a,u)=>a-u),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||Ke.empty();f=u.applyToLocalView(h,f),n.set(c,f);const g=(i.get(u.batchId)||Q()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,g=Bc();f.forEach(_=>{if(!s.has(_)){const R=Wc(t.get(_),n.get(_));null!==R&&g.set(_,R),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return w.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return O.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):$s(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):w.resolve(tt());let u=-1,c=s;return a.next(h=>w.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?w.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,Q())).next(f=>({batchId:u,changes:Lc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let i=pr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=pr();return this.indexManager.getCollectionParents(e,s).next(u=>w.forEach(u,c=>{const h=(g=t,_=c.child(s),new ut(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,ce.newInvalidDocument(f)))});let u=pr();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Ir(f.mutation,h,Ke.empty(),de.now()),gr(t,h)&&(u=u.insert(c,h))}),u})}}class Vg{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return w.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:ye(i.createTime)}),w.resolve();var i}getNamedQuery(e,t){return w.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:oo(i.bundledQuery),readTime:ye(i.readTime)}),w.resolve();var i}}class bg{constructor(){this.overlays=new oe(O.comparator),this.hr=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.hr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),w.resolve()}getOverlaysForCollection(e,t,n){const i=tt(),s=t.length+1,a=new O(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new oe((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=tt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=tt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return w.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Zs(t,n));let s=this.hr.get(t);void 0===s&&(s=Q(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class mo{constructor(){this.Pr=new ne(we.Ir),this.Tr=new ne(we.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new we(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new we(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new O(new J([])),n=new we(t,e),i=new we(t,e+1);let s=Q();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new we(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class we{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return O.comparator(e.key,t.key)||j(e.pr,t.pr)}static Er(e,t){return j(e.pr,t.pr)||O.comparator(e.key,t.key)}}class xg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new ne(we.Ir)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.yr;this.yr++;const a=new Ys(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.wr=this.wr.add(new we(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return w.resolve(a)}lookupMutationBatch(e,t){return w.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{const u=this.Sr(a.pr);s.push(u)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ne(j);return t.forEach(i=>{const s=new we(i,0),a=new we(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),w.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;O.isDocumentKey(s)||(s=s.child(""));const a=new we(new O(s),0);let u=new ne(j);return this.wr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.pr)),!0)},a),w.resolve(this.Dr(u))}Dr(e){const t=[];return e.forEach(n=>{const i=this.Sr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){U(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return w.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new we(t,0),i=this.wr.firstAfterOrEqual(n);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Cg{constructor(e){this.vr=e,this.docs=new oe(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return w.resolve(n?n.document.mutableCopy():ce.newInvalidDocument(t))}getEntries(e,t){let n=ze();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ce.newInvalidDocument(i))}),w.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=ze();const a=t.path,u=new O(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Os(Wu(f),n)<=0||(i.has(f.key)||gr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,n,i){L()}Fr(e,t){return w.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Dg(this)}getSize(e){return w.resolve(this.size)}}class Dg extends Ql{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),w.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Ng{constructor(e){this.persistence=e,this.Mr=new ct(t=>$t(t),fr),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.Or=0,this.Nr=new mo,this.targetCount=0,this.Lr=tn.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),w.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new tn(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.qn(t),w.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return w.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),w.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),w.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return w.resolve(n)}containsKey(e,t){return w.resolve(this.Nr.containsKey(t))}}class go{constructor(e,t){this.Br={},this.overlays={},this.kr=new Qe(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Ng(this),this.indexManager=new Ig,this.remoteDocumentCache=new Cg(n=>this.referenceDelegate.Kr(n)),this.serializer=new Al(t),this.$r=new Vg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new bg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new xg(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new kg(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return w.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class kg extends Ju{constructor(e){super(),this.currentSequenceNumber=e}}class Bi{constructor(e){this.persistence=e,this.zr=new mo,this.jr=null}static Hr(e){return new Bi(e)}get Jr(){if(this.jr)return this.jr;throw L()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),w.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),w.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Jr,n=>{const i=O.fromPath(n);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return w.or([()=>w.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Fg{constructor(e){this.serializer=e}O(e,t,n,i){const s=new gi("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tc,{unique:!0}),c.createObjectStore("documentMutations"),Xl(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=w.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Xl(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tc,{unique:!0});const g=h.store("mutations"),_=f.map(R=>g.put(R));return w.waitFor(_)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:Em});h.createIndex("collectionPathOverlayIndex",vm,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Am,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:lm});h.createIndex("documentKeyIndex",hm),h.createIndex("collectionGroupIndex",dm)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:_m}).createIndex("sequenceNumberIndex",ym,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Im}).createIndex("documentKeyIndex",Tm,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),a}ei(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Mi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>w.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>w.forEach(u,c=>{U(c.userId===s.userId);const h=Xt(this.serializer,c);return Bl(e,s.userId,h).next(()=>{})}))}))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new J(a),h=[0,be(c)];s.push(t.get(h).next(f=>f?w.resolve():t.put({targetId:0,path:be(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:pm});const n=t.store("collectionParents"),i=new fo,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:be(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new J(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=Ze(u);return s(f.popLast())}))}ri(e){const t=e.store("targets");return t.J((n,i)=>{const s=Rr(i),a=Rl(this.serializer,s);return t.put(a)})}ii(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(g=a,g.document?new O(J.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>w.waitFor(i))}si(e,t){const n=t.store("mutations"),i=$l(this.serializer),s=new go(Bi.Hr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:Q();Xt(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),w.forEach(u,(c,h)=>{const f=new ve(h),g=Ni.lt(this.serializer,f),_=s.getIndexManager(f),R=Oi.lt(f,this.serializer,_,s.referenceDelegate);return new Yl(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new qs(t,Qe.oe),c).next()})})}}function Xl(r){r.createObjectStore("targetDocuments",{keyPath:mm}).createIndex("documentTargetsIndex",gm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",fm,{unique:!0}),r.createObjectStore("targetGlobal")}const po="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _o{constructor(e,t,n,i,s,a,u,c,h,f,g=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=h,this.ai=f,this.ui=g,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=_=>Promise.resolve(),!_o.D())throw new C(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new wg(this,i),this.Ti=t+"main",this.serializer=new Al(c),this.Ei=new Xe(this.Ti,this.ui,new Fg(this.serializer)),this.Qr=new Eg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$l(this.serializer),this.$r=new fg,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===f&&_e("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,po);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Qe(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var t=this;return this.Ii=function(){var n=(0,b.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(function(){var t=(0,b.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,b.A)(function*(){t.started&&(yield t.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ui(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Et(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return xr(e).get("owner").next(t=>w.resolve(this.Si(t)))}bi(e){return Ui(e).delete(this.clientId)}Di(){var e=this;return(0,b.A)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=Ae(n,"clientMetadata");return i.U().next(s=>{const a=e.vi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return w.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.di)for(const n of t)e.di.removeItem(e.Fi(n.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?w.resolve(!0):xr(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,po);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ui(e).U().next(n=>void 0===this.vi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.A)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new qs(t,Qe.oe);return e.yi(n).next(()=>e.bi(n))}),e.Ei.close(),e.Li()})()}vi(e,t){return e.filter(n=>this.Ci(n.updateTimeMs,t)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Ui(e).U().next(t=>this.vi(t,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Oi.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Tg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ni.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(c=this.ui)?Rm:15===c?oc:14===c?sc:13===c?ic:12===c?wm:11===c?rc:void L();var c;let a;return this.Ei.runTransaction(e,i,s,u=>(a=new qs(u,this.kr?this.kr.next():Qe.oe),"readwrite-primary"===t?this.gi(a).next(c=>!!c||this.pi(a)).next(c=>{if(!c)throw _e(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new C(S.FAILED_PRECONDITION,Hu);return n(a)}).next(c=>this.wi(a).next(()=>c)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(e){return xr(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(S.FAILED_PRECONDITION,po)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xr(e).put("owner",t)}static D(){return Xe.D()}yi(e){const t=xr(e);return t.get("owner").next(n=>this.Si(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(_e(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,ee.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return _e("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){_e("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function xr(r){return Ae(r,"owner")}function Ui(r){return Ae(r,"clientMetadata")}function yo(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Io{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=Q(),i=Q();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Io(e,t.fromCache,n,i)}}class Mg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Zl{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,ee.nr)()?8:Yu((0,ee.ZQ)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ji(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Mg;return this.Ji(e,t,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(e,t,a,u.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Rn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),w.resolve()):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Query:",Rn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(pn()<=Ye.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Rn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xe(t))):w.resolve())}ji(e,t){if(Cc(t))return w.resolve(null);let n=xe(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ri(t,null,"F"),n=xe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=Q(...s);return this.zi.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.Zi(t,u);return this.Xi(t,h,a,c.readTime)?this.ji(e,Ri(t,null,"F")):this.es(e,h,t,c)}))})))}Hi(e,t,n,i){return Cc(t)||i.isEqual(G.min())?w.resolve(null):this.zi.getDocuments(e,n).next(s=>{const a=this.Zi(t,s);return this.Xi(t,a,n,i)?w.resolve(null):(pn()<=Ye.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Rn(t)),this.es(e,a,t,$u(i,-1)).next(u=>u))})}Zi(e,t){let n=new ne(Mc(e));return t.forEach((i,s)=>{gr(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return pn()<=Ye.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Rn(t)),this.zi.getDocumentsMatchingQuery(e,t,je.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class Og{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new oe(j),this.rs=new ct(s=>$t(s),fr),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yl(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function eh(r,e,t,n){return new Og(r,e,t,n)}function th(r,e){return To.apply(this,arguments)}function To(){return(To=(0,b.A)(function*(r,e){const t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=Q();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({us:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function nh(r){const e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function rh(r,e,t){let n=Q(),i=Q();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=ze();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{cs:a,ls:i}})}function qg(r,e){const t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Mn(r,e){const t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(s=>s?(i=s,w.resolve(i)):t.Qr.allocateTargetId(n).next(a=>(i=new ht(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.ns.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}function On(r,e,t){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,b.A)(function*(r,e,t){const n=F(r),i=n.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Et(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})).apply(this,arguments)}function Gi(r,e,t){const n=F(r);let i=G.min(),s=Q();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const g=F(c),_=g.rs.get(f);return void 0!==_?w.resolve(g.ns.get(_)):g.Qr.getTargetData(h,f)}(n,a,xe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ts.getDocumentsMatchingQuery(a,e,t?i:G.min(),t?s:Q())).next(u=>(oh(n,Fc(e),u),{documents:u,hs:s})))}function ih(r,e){const t=F(r),n=F(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function sh(r,e){const t=F(r),n=t.ss.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,$u(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(oh(t,e,i),i))}function oh(r,e,t){let n=r.ss.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(e,n)}function vo(){return(vo=(0,b.A)(function*(r,e,t,n){const i=F(r);let s=Q(),a=ze();for(const h of t){const f=e.Ps(h.metadata.name);h.document&&(s=s.add(f));const g=e.Is(h);g.setReadTime(e.Ts(h.metadata.readTime)),a=a.insert(f,g)}const u=i.os.newChangeBuffer({trackRemovals:!0}),c=yield Mn(i,(f=n,xe(An(J.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>rh(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Qr.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.cs,f.ls)).next(()=>f.cs)))})).apply(this,arguments)}function Gg(r,e){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,b.A)(function*(r,e,t=Q()){const n=yield Mn(r,xe(oo(e.bundledQuery))),i=F(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=ye(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.$r.saveNamedQuery(s,e);const u=n.withResumeToken(Ee.EMPTY_BYTE_STRING,a);return i.ns=i.ns.insert(u.targetId,u),i.Qr.updateTargetData(s,u).next(()=>i.Qr.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Qr.addMatchingKeys(s,t,n.targetId)).next(()=>i.$r.saveNamedQuery(s,e))})})).apply(this,arguments)}function ah(r,e){return`firestore_clients_${r}_${e}`}function uh(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function wo(r,e){return`firestore_targets_${r}_${e}`}class Ki{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Es(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new Ki(e,t,i.state,s):(_e("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new Cr(e,n.state,i):(_e("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zi{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Hs();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Zu(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new zi(e,s):(_e("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ro{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ro(t.clientId,t.onlineState):(_e("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Po{constructor(){this.activeTargetIds=Hs()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class So{constructor(e,t,n,i,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new oe(j),this.started=!1,this.ys=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=ah(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Po),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.A)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Vs)continue;const s=e.getItem(ah(e.persistenceKey,i));if(s){const a=zi.Es(i,s);a&&(e.ps=e.ps.insert(a.clientId,a))}}e.Ms();const n=e.storage.getItem(e.vs);if(n){const i=e.xs(n);i&&e.Os(i)}for(const i of e.ys)e.gs(i);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(wo(this.persistenceKey,e));if(n){const i=Cr.Es(e,n);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wo(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ws)return void _e("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,b.A)(function*(){if(t.started){if(null!==n.key)if(t.bs.test(n.key)){if(null==n.newValue){const i=t.$s(n.key);return t.Us(i,null)}{const i=t.Ws(n.key,n.newValue);if(i)return t.Us(i.clientId,i)}}else if(t.Ds.test(n.key)){if(null!==n.newValue){const i=t.Gs(n.key,n.newValue);if(i)return t.zs(i)}}else if(t.Cs.test(n.key)){if(null!==n.newValue){const i=t.js(n.key,n.newValue);if(i)return t.Hs(i)}}else if(n.key===t.vs){if(null!==n.newValue){const i=t.xs(n.newValue);if(i)return t.Os(i)}}else if(n.key===t.Ss){const i=function(a){let u=Qe.oe;if(null!=a)try{const c=JSON.parse(a);U("number"==typeof c),u=c}catch(c){_e("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==Qe.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Fs){const i=t.Js(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ys(s)))}}else t.ys.push(n)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){const i=new Ki(this.currentUser,e,t,n),s=uh(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){const t=uh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,t,n){const i=wo(this.persistenceKey,e),s=new Cr(e,t,n);this.setItem(i,s.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return zi.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),i=Number(n[1]);return Ki.Es(new ve(void 0!==n[2]?n[2]:null),i,t)}js(e,t){const n=this.Cs.exec(e),i=Number(n[1]);return Cr.Es(i,t)}xs(e){return Ro.Es(e)}Js(e){return JSON.parse(e)}zs(e){var t=this;return(0,b.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Zs(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Hs();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class ch{constructor(){this.no=new Po,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Po,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Kg{io(e){}shutdown(){}}class lh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ji=null;function Vo(){return null===ji?ji=268435456+Math.round(2147483648*Math.random()):ji++,"0x"+ji.toString(16)}const zg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jg{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const De="WebChannelConnection";class Qg extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,n,i,s,a){const u=Vo(),c=this.vo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(h,s,a),this.Mo(t,c,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ge("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}xo(t,n,i,s,a,u){return this.Co(t,n,i,s,a)}Fo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+gn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}vo(t,n){return`${this.wo}/v1/${n}:${zg[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){const s=Vo();return new Promise((a,u)=>{const c=new Mu;c.setWithCredentials(!0),c.listenOnce(Lu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case mi.NO_ERROR:const f=c.getResponseJson();N(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case mi.TIMEOUT:N(De,`RPC '${e}' ${s} timed out`),u(new C(S.DEADLINE_EXCEEDED,"Request time out"));break;case mi.HTTP_ERROR:const g=c.getStatus();if(N(De,`RPC '${e}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=_?.error;if(R&&R.status&&R.message){const x=function(D){const B=D.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(B)>=0?B:S.UNKNOWN}(R.status);u(new C(x,R.message))}else u(new C(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new C(S.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{N(De,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(De,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Oo(e,t,n){const i=Vo(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Uu(),u=qu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.xmlHttpFactory=new Ou({})),this.Fo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");N(De,`Creating RPC '${e}' stream ${i}: ${f}`,c);const g=a.createWebChannel(f,c);let _=!1,R=!1;const x=new jg({lo:D=>{R?N(De,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(N(De,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),N(De,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},ho:()=>g.close()}),k=(D,B,K)=>{D.listen(B,q=>{try{K(q)}catch(z){setTimeout(()=>{throw z},0)}})};return k(g,rr.EventType.OPEN,()=>{R||(N(De,`RPC '${e}' stream ${i} transport opened.`),x.mo())}),k(g,rr.EventType.CLOSE,()=>{R||(R=!0,N(De,`RPC '${e}' stream ${i} transport closed`),x.po())}),k(g,rr.EventType.ERROR,D=>{R||(R=!0,Ge(De,`RPC '${e}' stream ${i} transport errored:`,D),x.po(new C(S.UNAVAILABLE,"The operation could not be completed")))}),k(g,rr.EventType.MESSAGE,D=>{var B;if(!R){const K=D.data[0];U(!!K);const z=K.error||(null===(B=K[0])||void 0===B?void 0:B.error);if(z){N(De,`RPC '${e}' stream ${i} received error:`,z);const H=z.status;let $=function(I){const E=Ie[I];if(void 0!==E)return tl(E)}(H),T=z.message;void 0===$&&($=S.INTERNAL,T="Unknown error status: "+H+" with message "+z.message),R=!0,x.po(new C($,T)),g.close()}else N(De,`RPC '${e}' stream ${i} received:`,K),x.yo(K)}}),k(u,Bu.STAT_EVENT,D=>{D.stat===ks.PROXY?N(De,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===ks.NOPROXY&&N(De,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.fo()},0),x}}function hh(){return typeof window<"u"?window:null}function Qi(){return typeof document<"u"?document:null}function Dr(r){return new ng(r,!0)}class bo{constructor(e,t,n=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class dh{constructor(e,t,n,i,s,a,u,c){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new bo(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}stop(){var e=this;return(0,b.A)(function*(){e.Zo()&&(yield e.close(0))})()}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){var e=this;return(0,b.A)(function*(){if(e.Xo())return e.close(0)})()}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.s_(),n.o_(),n.Yo.cancel(),n.jo++,4!==e?n.Yo.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(_e(t.toString()),_e("Using maximum backoff delay to prevent overloading the backend."),n.Yo.Ko()):t&&t.code===S.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.__(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ao(t)})()}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{const i=new C(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){var e=this;this.state=5,this.Yo.$o((0,b.A)(function*(){e.state=0,e.start()}))}c_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $g extends dh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function sg(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:L(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(U(void 0===f||"string"==typeof f),Ee.fromBase64String(f||"")):(U(void 0===f||f instanceof Buffer||f instanceof Uint8Array),Ee.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?S.UNKNOWN:tl(h.code);return new C(f,h.message||"")}(a);t=new ol(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=nt(r,n.document.name),s=ye(n.document.updateTime),a=n.document.createTime?ye(n.document.createTime):G.min(),u=new Pe({mapValue:{fields:n.document.fields}}),c=ce.newFoundDocument(i,s,a,u);t=new xi(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=nt(r,n.document),s=n.readTime?ye(n.readTime):G.min(),a=ce.newNoDocument(i,s);t=new xi([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=nt(r,n.document);t=new xi([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return L();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new Jm(i,s);t=new sl(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return G.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?ye(a.readTime):G.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=io(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=Ai(c)?{documents:_l(s,c)}:{query:Ci(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ll(s,a.resumeToken);const h=to(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(G.min())>0){u.readTime=xn(s,a.snapshotVersion.toTimestamp());const h=to(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function ag(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=io(this.serializer),t.removeTarget=e,this.i_(t)}}class Wg extends dh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function og(r,e){return r&&r.length>0?(U(void 0!==e),r.map(t=>function(i,s){let a=ye(i.updateTime?i.updateTime:s);return a.isEqual(G.min())&&(a=ye(s)),new $m(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=ye(e.commitTime);return this.listener.A_(n,t)}return U(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=io(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>wr(this.serializer,n))};this.i_(t)}}class Hg extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,ro(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(S.UNKNOWN,s.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(e,ro(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(S.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class Jg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(_e(t),this.y_=!1):N("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Yg{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(u=>{n.enqueueAndForget((0,b.A)(function*(){var c;Dt(a)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,b.A)(function*(f){const g=F(f);g.M_.add(4),yield Ln(g),g.N_.set("Unknown"),g.M_.delete(4),yield Nr(g)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.N_=new Jg(n,i)}}function Nr(r){return xo.apply(this,arguments)}function xo(){return(xo=(0,b.A)(function*(r){if(Dt(r))for(const e of r.x_)yield e(!0)})).apply(this,arguments)}function Ln(r){return Co.apply(this,arguments)}function Co(){return(Co=(0,b.A)(function*(r){for(const e of r.x_)yield e(!1)})).apply(this,arguments)}function $i(r,e){const t=F(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),ko(t)?No(t):Un(t).Xo()&&Do(t,e))}function Bn(r,e){const t=F(r),n=Un(t);t.F_.delete(e),n.Xo()&&fh(t,e),0===t.F_.size&&(n.Xo()?n.n_():Dt(t)&&t.N_.set("Unknown"))}function Do(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Un(r).P_(e)}function fh(r,e){r.L_.xe(e),Un(r).I_(e)}function No(r){r.L_=new Xm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Un(r).start(),r.N_.w_()}function ko(r){return Dt(r)&&!Un(r).Zo()&&r.F_.size>0}function Dt(r){return 0===F(r).M_.size}function mh(r){r.L_=void 0}function Xg(r){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,b.A)(function*(r){r.N_.set("Online")})).apply(this,arguments)}function Zg(r){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,b.A)(function*(r){r.F_.forEach((e,t)=>{Do(r,e)})})).apply(this,arguments)}function ep(r,e){return Oo.apply(this,arguments)}function Oo(){return(Oo=(0,b.A)(function*(r,e){mh(r),ko(r)?(r.N_.D_(e),No(r)):r.N_.set("Unknown")})).apply(this,arguments)}function tp(r,e,t){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,b.A)(function*(r,e,t){if(r.N_.set("Online"),e instanceof ol&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.F_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.F_.delete(c),s.L_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Wi(r,n)}else if(e instanceof xi?r.L_.Ke(e):e instanceof sl?r.L_.He(e):r.L_.We(e),!t.isEqual(G.min()))try{const n=yield nh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.L_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.F_.get(h);f&&s.F_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.F_.get(c);if(!f)return;s.F_.set(c,f.withResumeToken(Ee.EMPTY_BYTE_STRING,f.snapshotVersion)),fh(s,c);const g=new ht(f.target,c,h,f.sequenceNumber);Do(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Wi(r,n)}var n}),Lo.apply(this,arguments)}function Wi(r,e,t){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,b.A)(function*(r,e,t){if(!Et(e))throw e;r.M_.add(1),yield Ln(r),r.N_.set("Offline"),t||(t=()=>nh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield Nr(r)}))})).apply(this,arguments)}function gh(r,e){return e().catch(t=>Wi(r,t,e))}function qn(r){return qo.apply(this,arguments)}function qo(){return(qo=(0,b.A)(function*(r){const e=F(r),t=Nt(e);let n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;np(e);)try{const i=yield qg(e.localStore,n);if(null===i){0===e.v_.length&&t.n_();break}n=i.batchId,rp(e,i)}catch(i){yield Wi(e,i)}ph(e)&&_h(e)})).apply(this,arguments)}function np(r){return Dt(r)&&r.v_.length<10}function rp(r,e){r.v_.push(e);const t=Nt(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function ph(r){return Dt(r)&&!Nt(r).Zo()&&r.v_.length>0}function _h(r){Nt(r).start()}function ip(r){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,b.A)(function*(r){Nt(r).V_()})).apply(this,arguments)}function sp(r){return Go.apply(this,arguments)}function Go(){return(Go=(0,b.A)(function*(r){const e=Nt(r);for(const t of r.v_)e.d_(t.mutations)})).apply(this,arguments)}function op(r,e,t){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,b.A)(function*(r,e,t){const n=r.v_.shift(),i=Xs.from(n,e,t);yield gh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield qn(r)})).apply(this,arguments)}function ap(r,e){return zo.apply(this,arguments)}function zo(){return zo=(0,b.A)(function*(r,e){var t;e&&Nt(r).E_&&(yield(t=(0,b.A)(function*(i,s){if(el(u=s.code)&&u!==S.ABORTED){const a=i.v_.shift();Nt(i).t_(),yield gh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield qn(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),ph(r)&&_h(r)}),zo.apply(this,arguments)}function yh(r,e){return jo.apply(this,arguments)}function jo(){return(jo=(0,b.A)(function*(r,e){const t=F(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=Dt(t);t.M_.add(3),yield Ln(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Nr(t)})).apply(this,arguments)}function Qo(r,e){return $o.apply(this,arguments)}function $o(){return($o=(0,b.A)(function*(r,e){const t=F(r);e?(t.M_.delete(2),yield Nr(t)):e||(t.M_.add(2),yield Ln(t),t.N_.set("Unknown"))})).apply(this,arguments)}function Un(r){return r.B_||(r.B_=function(t,n,i){const s=F(t);return s.f_(),new $g(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:Xg.bind(null,r),To:Zg.bind(null,r),Ao:ep.bind(null,r),h_:tp.bind(null,r)}),r.x_.push(function(){var e=(0,b.A)(function*(t){t?(r.B_.t_(),ko(r)?No(r):r.N_.set("Unknown")):(yield r.B_.stop(),mh(r))});return function(t){return e.apply(this,arguments)}}())),r.B_}function Nt(r){return r.k_||(r.k_=function(t,n,i){const s=F(t);return s.f_(),new Wg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:ip.bind(null,r),Ao:ap.bind(null,r),R_:sp.bind(null,r),A_:op.bind(null,r)}),r.x_.push(function(){var e=(0,b.A)(function*(t){t?(r.k_.t_(),yield qn(r)):(yield r.k_.stop(),r.v_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))});return function(t){return e.apply(this,arguments)}}())),r.k_}class Wo{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Wo(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gn(r,e){if(_e("AsyncQueue",`${e}: ${r}`),Et(r))return new C(S.UNAVAILABLE,`${e}: ${r}`);throw r}class Kn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=pr(),this.sortedSet=new oe(this.comparator)}static emptySet(e){return new Kn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Kn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Kn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ih{constructor(){this.q_=new oe(O.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):L():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class zn{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new zn(e,t,Kn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class up{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class cp{constructor(){this.queries=new ct(e=>kc(e),mr),this.onlineState="Unknown",this.z_=new Set}}function Ho(r,e){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,b.A)(function*(r,e){const t=F(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(n=2):(s=new up,n=e.G_()?0:1);try{switch(n){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=Gn(a,`Initialization of query '${Rn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Zo(t)})).apply(this,arguments)}function Yo(r,e){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,b.A)(function*(r,e){const t=F(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.U_.indexOf(e);a>=0&&(s.U_.splice(a,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function lp(r,e){const t=F(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&Zo(t)}function hp(r,e,t){const n=F(r),i=n.queries.get(e);if(i)for(const s of i.U_)s.onError(t);n.queries.delete(e)}function Zo(r){r.z_.forEach(e=>{e.next()})}var ea,Th;(Th=ea||(ea={})).J_="default",Th.Cache="cache";class ta{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new zn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=zn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==ea.Cache}}class dp{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class Eh{constructor(e){this.serializer=e}Ps(e){return nt(this.serializer,e)}Is(e){return e.metadata.exists?pl(this.serializer,e.document,!1):ce.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return ye(e)}}class fp{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vh(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const n=J.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,n=new Eh(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Ps(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||Q()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,b.A)(function*(){const t=yield function Ug(r,e,t,n){return vo.apply(this,arguments)}(e.localStore,new Eh(e.serializer),e.documents,e.oa.id),n=e.aa(e.documents);for(const i of e.queries)yield Gg(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function vh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Ah{constructor(e){this.key=e}}class wh{constructor(e){this.key=e}}class Rh{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Q(),this.mutatedKeys=Q(),this.Ia=Mc(e),this.Ta=new Kn(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new Ih,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const _=i.get(f),R=gr(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;_&&R?_.data.isEqual(R.data)?x!==k&&(n.track({type:3,doc:R}),D=!0):this.Ra(_,R)||(n.track({type:2,doc:R}),D=!0,(c&&this.Ia(R,c)>0||h&&this.Ia(R,h)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),D=!0):_&&!R&&(n.track({type:1,doc:_}),D=!0,(c||h)&&(u=!0)),D&&(R?(a=a.add(R),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const a=e.Aa.Q_();a.sort((f,g)=>function(R,x){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(R)-k(x)}(f.type,g.type)||this.Ia(f.doc,g.doc)),this.Va(n),i=null!=i&&i;const u=t&&!i?this.ma():[],c=0===this.Pa.size&&this.current&&!i?1:0,h=c!==this.ha;return this.ha=c,0!==a.length||h?{snapshot:new zn(this.query,e.Ta,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Ih,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=Q(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});const t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new wh(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new Ah(n))}),t}pa(e){this.la=e.hs,this.Pa=Q();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return zn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class mp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class gp{constructor(e){this.key=e,this.wa=!1}}class pp{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new ct(u=>kc(u),mr),this.Da=new Map,this.Ca=new Set,this.va=new oe(O.comparator),this.Fa=new Map,this.Ma=new mo,this.xa={},this.Oa=new Map,this.Na=tn.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function _p(r,e){return na.apply(this,arguments)}function na(){return(na=(0,b.A)(function*(r,e,t=!0){const n=Hi(r);let i;const s=n.ba.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Ph(n,e,t,!0),i})).apply(this,arguments)}function yp(r,e){return ra.apply(this,arguments)}function ra(){return(ra=(0,b.A)(function*(r,e){const t=Hi(r);yield Ph(t,e,!0,!1)})).apply(this,arguments)}function Ph(r,e,t,n){return ia.apply(this,arguments)}function ia(){return(ia=(0,b.A)(function*(r,e,t,n){const i=yield Mn(r.localStore,xe(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let u;return n&&(u=yield sa(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&$i(r.remoteStore,i),u})).apply(this,arguments)}function sa(r,e,t,n,i){return oa.apply(this,arguments)}function oa(){return oa=(0,b.A)(function*(r,e,t,n,i){r.Ba=(g,_,R)=>{return(x=(0,b.A)(function*(D,B,K,q){let z=B.view.da(K);z.Xi&&(z=yield Gi(D.localStore,B.query,!1).then(({documents:p})=>B.view.da(p,z)));const H=q&&q.targetChanges.get(B.targetId),$=q&&null!=q.targetMismatches.get(B.targetId),T=B.view.applyChanges(z,D.isPrimaryClient,H,$);return _a(D,B.targetId,T.fa),T.snapshot}),function k(D,B,K,q){return x.apply(this,arguments)})(r,g,_,R);var x};const s=yield Gi(r.localStore,e,!0),a=new Rh(e,s.hs),u=a.da(s.documents),c=vr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);_a(r,t,h.fa);const f=new mp(e,t,a);return r.ba.set(e,f),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),h.snapshot}),oa.apply(this,arguments)}function Ip(r,e,t){return aa.apply(this,arguments)}function aa(){return(aa=(0,b.A)(function*(r,e,t){const n=F(r),i=n.ba.get(e),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!mr(a,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield On(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Bn(n.remoteStore,i.targetId),jn(n,i.targetId)}).catch(Tt))):(jn(n,i.targetId),yield On(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Tp(r,e){return ua.apply(this,arguments)}function ua(){return(ua=(0,b.A)(function*(r,e){const t=F(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Bn(t.remoteStore,n.targetId))})).apply(this,arguments)}function ca(){return(ca=(0,b.A)(function*(r,e,t){const n=Va(r);try{const i=yield function(a,u){const c=F(a),h=de.now(),f=u.reduce((R,x)=>R.add(x.key),Q());let g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let x=ze(),k=Q();return c.os.getEntries(R,f).next(D=>{x=D,x.forEach((B,K)=>{K.isValidDocument()||(k=k.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,x)).next(D=>{g=D;const B=[];for(const K of u){const q=Hm(K,g.get(K.key).overlayedDocument);null!=q&&B.push(new lt(K.key,q,yc(q.value.mapValue),fe.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,B,u)}).next(D=>{_=D;const B=D.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(R,D.batchId,B)})}).then(()=>({batchId:_.batchId,changes:Lc(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.xa[a.currentUser.toKey()];h||(h=new oe(j)),h=h.insert(u,c),a.xa[a.currentUser.toKey()]=h}(n,i.batchId,t),yield dt(n,i.changes),yield qn(n.remoteStore)}catch(i){const s=Gn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Sh(r,e){return la.apply(this,arguments)}function la(){return(la=(0,b.A)(function*(r,e){const t=F(r);try{const n=yield function Bg(r,e){const t=F(r),n=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const u=[];e.targetChanges.forEach((f,g)=>{const _=i.get(g);if(!_)return;u.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);var k,D,B;null!==e.targetMismatches.get(g)?R=R.withResumeToken(Ee.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),D=R,B=f,(0===(k=_).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8||B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0)&&u.push(t.Qr.updateTargetData(s,R))});let c=ze(),h=Q();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(rh(s,a,e.documentUpdates).next(f=>{c=f.cs,h=f.ls})),!n.isEqual(G.min())){const f=t.Qr.getLastRemoteSnapshotVersion(s).next(g=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return w.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Fa.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?U(a.wa):i.removedDocuments.size>0&&(U(a.wa),a.wa=!1))}),yield dt(t,n,e)}catch(n){yield Tt(n)}})).apply(this,arguments)}function Vh(r,e,t){const n=F(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.ba.forEach((s,a)=>{const u=a.view.j_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=F(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(const _ of g.U_)_.j_(u)&&(h=!0)}),h&&Zo(c)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function vp(r,e,t){return ha.apply(this,arguments)}function ha(){return(ha=(0,b.A)(function*(r,e,t){const n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Fa.get(e),s=i&&i.key;if(s){let a=new oe(O.comparator);a=a.insert(s,ce.newNoDocument(s,G.min()));const u=Q().add(s),c=new Er(G.min(),new Map,new oe(j),a,u);yield Sh(n,c),n.va=n.va.remove(s),n.Fa.delete(e),ya(n)}else yield On(n.localStore,e,!1).then(()=>jn(n,e,t)).catch(Tt)})).apply(this,arguments)}function Ap(r,e){return da.apply(this,arguments)}function da(){return(da=(0,b.A)(function*(r,e){const t=F(r),n=e.batch.batchId;try{const i=yield function Lg(r,e){const t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const g=h.batch,_=g.keys();let R=w.resolve();return _.forEach(x=>{R=R.next(()=>f.getEntry(c,x)).next(k=>{const D=h.docVersions.get(x);U(null!==D),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=Q();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);pa(t,n,null),ga(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield dt(t,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function wp(r,e,t){return fa.apply(this,arguments)}function fa(){return(fa=(0,b.A)(function*(r,e,t){const n=F(r);try{const i=yield function(a,u){const c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(U(null!==g),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);pa(n,e,t),ga(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield dt(n,i)}catch(i){yield Tt(i)}})).apply(this,arguments)}function ma(){return(ma=(0,b.A)(function*(r,e){const t=F(r);Dt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.Oa.get(n)||[];i.push(e),t.Oa.set(n,i)}catch(n){const i=Gn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function ga(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function pa(r,e,t){const n=F(r);let i=n.xa[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function jn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||bh(r,n)})}function bh(r,e){r.Ca.delete(e.path.canonicalString());const t=r.va.get(e);null!==t&&(Bn(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),ya(r))}function _a(r,e,t){for(const n of t)n instanceof Ah?(r.Ma.addReference(n.key,e),Pp(r,n)):n instanceof wh?(N("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||bh(r,n.key)):L()}function Pp(r,e){const t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(N("SyncEngine","New document in limbo: "+t),r.Ca.add(n),ya(r))}function ya(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){const e=r.Ca.values().next().value;r.Ca.delete(e);const t=new O(J.fromString(e)),n=r.Na.next();r.Fa.set(n,new gp(t)),r.va=r.va.insert(t,n),$i(r.remoteStore,new ht(xe(An(t.path)),n,"TargetPurposeLimboResolution",Qe.oe))}}function dt(r,e,t){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[],a=[];var u;n.ba.isEmpty()||(n.ba.forEach((u,c)=>{a.push(n.Ba(c,e,t).then(h=>{if((h||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(c.targetId,h&&!h.fromCache?"current":"not-current"),h){i.push(h);const f=Io.Ki(c.targetId,h);s.push(f)}}))}),yield Promise.all(a),n.Sa.h_(i),yield(u=(0,b.A)(function*(h,f){const g=F(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>w.forEach(f,R=>w.forEach(R.qi,x=>g.persistence.referenceDelegate.addReference(_,R.targetId,x)).next(()=>w.forEach(R.Qi,x=>g.persistence.referenceDelegate.removeReference(_,R.targetId,x)))))}catch(_){if(!Et(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const R=_.targetId;if(!_.fromCache){const x=g.ns.get(R),D=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);g.ns=g.ns.insert(R,D)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Ia.apply(this,arguments)}function Sp(r,e){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,b.A)(function*(r,e){const t=F(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield th(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(u=>{u.forEach(c=>{c.reject(new C(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield dt(t,n.us)}var s})).apply(this,arguments)}function Vp(r,e){const t=F(r),n=t.Fa.get(e);if(n&&n.wa)return Q().add(n.key);{let i=Q();const s=t.Da.get(e);if(!s)return i;for(const a of s){const u=t.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function bp(r,e){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,b.A)(function*(r,e){const t=F(r),n=yield Gi(t.localStore,e.query,!0),i=e.view.pa(n);return t.isPrimaryClient&&_a(t,e.targetId,i.fa),i})).apply(this,arguments)}function xp(r,e){return va.apply(this,arguments)}function va(){return(va=(0,b.A)(function*(r,e){const t=F(r);return sh(t.localStore,e).then(n=>dt(t,n))})).apply(this,arguments)}function Cp(r,e,t,n){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,b.A)(function*(r,e,t,n){const i=F(r),s=yield function(u,c){const h=F(u),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.vn(g,c).next(_=>_?h.localDocuments.getDocuments(g,_):w.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield qn(i.remoteStore):"acknowledged"===t||"rejected"===t?(pa(i,e,n||null),ga(i,e),c=e,F(F(i.localStore).mutationQueue).Mn(c)):L(),yield dt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function wa(){return(wa=(0,b.A)(function*(r,e){const t=F(r);if(Hi(t),Va(t),!0===e&&!0!==t.La){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield xh(t,n.toArray());t.La=!0,yield Qo(t.remoteStore,!0);for(const s of i)$i(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const n=[];let i=Promise.resolve();t.Da.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(jn(t,a),On(t.localStore,a,!0))),Bn(t.remoteStore,a)}),yield i,yield xh(t,n),function(a){const u=F(a);u.Fa.forEach((c,h)=>{Bn(u.remoteStore,h)}),u.Ma.mr(),u.Fa=new Map,u.va=new oe(O.comparator)}(t),t.La=!1,yield Qo(t.remoteStore,!1)}})).apply(this,arguments)}function xh(r,e,t){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,b.A)(function*(r,e,t){const n=F(r),i=[],s=[];for(const a of e){let u;const c=n.Da.get(a);if(c&&0!==c.length){u=yield Mn(n.localStore,xe(c[0]));for(const h of c){const f=n.ba.get(h),g=yield bp(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield ih(n.localStore,a);u=yield Mn(n.localStore,h),yield sa(n,Ch(h),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})).apply(this,arguments)}function Ch(r){return xc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Np(r){return t=F(r).localStore,F(F(t).persistence).Bi();var t}function kp(r,e,t,n){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,b.A)(function*(r,e,t,n){const i=F(r);if(i.La)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield sh(i.localStore,Fc(s[0])),u=Er.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ee.EMPTY_BYTE_STRING);yield dt(i,a,u);break}case"rejected":yield On(i.localStore,e,!0),jn(i,e,n);break;default:L()}})).apply(this,arguments)}function Fp(r,e,t){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r,e,t){const n=Hi(r);if(n.La){for(const i of e){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield ih(n.localStore,i),a=yield Mn(n.localStore,s);yield sa(n,Ch(s),a.targetId,!1,a.resumeToken),$i(n.remoteStore,a)}for(const i of t)n.Da.has(i)&&(yield On(n.localStore,i,!1).then(()=>{Bn(n.remoteStore,i),jn(n,i)}).catch(Tt))}})).apply(this,arguments)}function Hi(r){const e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Sh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vp.bind(null,e),e.Sa.h_=lp.bind(null,e.eventManager),e.Sa.ka=hp.bind(null,e.eventManager),e}function Va(r){const e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ap.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wp.bind(null,e),e}class Qn{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,b.A)(function*(){t.serializer=Dr(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return eh(this.persistence,new Zl,e.initialUser,this.serializer)}createPersistence(e){return new go(Bi.Hr,this.serializer)}createSharedClientState(e){return new ch}terminate(){var e=this;return(0,b.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ba extends Qn{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e),yield n.Qa.initialize(n,e),yield Va(n.Qa.syncEngine),yield qn(n.Qa.remoteStore),yield n.persistence.fi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return eh(this.persistence,new Zl,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new zl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new am(t,this.persistence);return new om(e.asyncQueue,n)}createPersistence(e){const t=yo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new _o(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,hh(),Qi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new ch}}class Dh extends ba{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e);const i=n.Qa.syncEngine;n.sharedClientState instanceof So&&(n.sharedClientState.syncEngine={Zs:Cp.bind(null,i),Xs:kp.bind(null,i),eo:Fp.bind(null,i),Bi:Np.bind(null,i),Ys:xp.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.fi(function(){var s=(0,b.A)(function*(a){yield function Dp(r,e){return wa.apply(this,arguments)}(n.Qa.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=hh();if(!So.D(t))throw new C(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=yo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new So(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class $n{initialize(e,t){var n=this;return(0,b.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Vh(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Sp.bind(null,n.syncEngine),yield Qo(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new cp}createDatastore(e){const t=Dr(e.databaseInfo.databaseId),n=new Qg(e.databaseInfo);return new Hg(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Vh(this.syncEngine,t,0),u=lh.D()?new lh:new Kg,new Yg(n,i,s,a,u);var n,i,s,a,u}createSyncEngine(e,t){return function(i,s,a,u,c,h,f){const g=new pp(i,s,a,u,c,h);return f&&(g.La=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,b.A)(function*(){var t,n;yield(n=(0,b.A)(function*(s){const a=F(s);N("RemoteStore","RemoteStore shutting down."),a.M_.add(5),yield Ln(a),a.O_.shutdown(),a.N_.set("Unknown")}),function i(s){return n.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function Nh(r,e=10240){let t=0;return{read:()=>(0,b.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,b.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Ji{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):_e("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Lp{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Te,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,b.A)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,b.A)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,b.A)(function*(){const t=yield e.za();if(null===t)return null;const n=e.Wa.decode(t),i=Number(n);isNaN(i)&&e.ja(`length string (${n}) is not valid number`);const s=yield e.Ha(i);return new dp(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>123===e)}za(){var e=this;return(0,b.A)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Ha(e){var t=this;return(0,b.A)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const n=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,b.A)(function*(){const t=yield e.Ua.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Bp{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,b.A)(function*(a,u){const c=F(a),h={documents:u.map(R=>Ar(c.serializer,R))},f=yield c.xo("BatchGetDocuments",c.serializer.databaseId,J.emptyPath(),h,u.length),g=new Map;f.forEach(R=>{const x=function ig(r,e){return"found"in e?function(n,i){U(!!i.found);const s=nt(n,i.found.name),a=ye(i.found.updateTime),u=i.found.createTime?ye(i.found.createTime):G.min(),c=new Pe({mapValue:{fields:i.found.fields}});return ce.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){U(!!i.missing),U(!!i.readTime);const s=nt(n,i.missing),a=ye(i.readTime);return ce.newNoDocument(s,a)}(r,e):L()}(c.serializer,R);g.set(x.key.toString(),x)});const _=[];return u.forEach(R=>{const x=g.get(R.toString());U(!!x),_.push(x)}),_}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new bn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=O.fromPath(i);e.mutations.push(new Js(s,e.precondition(s)))}),yield(n=(0,b.A)(function*(s,a){const u=F(s),c={writes:a.map(h=>wr(u.serializer,h))};yield u.Co("Commit",u.serializer.databaseId,J.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L();t=G.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new C(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class qp{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new bo(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Yo.$o((0,b.A)(function*(){const t=new Bp(e.datastore),n=e.tu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!or(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!el(t)}return!1}}class Up{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ve.UNAUTHENTICATED,this.clientId=ju.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var a=(0,b.A)(function*(u){N("FirestoreClient","Received user=",u.uid),yield s.authCredentialListener(u),s.user=u});return function(u){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(n,a=>(N("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Gn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Yi(r,e){return xa.apply(this,arguments)}function xa(){return xa=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield th(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),xa.apply(this,arguments)}function Ca(r,e){return Da.apply(this,arguments)}function Da(){return(Da=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Na(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>yh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>yh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function kh(r){return"FirebaseError"===r.name?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Na(r){return ka.apply(this,arguments)}function ka(){return(ka=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Yi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!kh(t))throw t;Ge("Error using user provided cache. Falling back to memory cache: "+t),yield Yi(r,new Qn)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield Yi(r,new Qn);return r._offlineComponents})).apply(this,arguments)}function Xi(r){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ca(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield Ca(r,new $n))),r._onlineComponents})).apply(this,arguments)}function Fh(r){return Na(r).then(e=>e.persistence)}function Wn(r){return Na(r).then(e=>e.localStore)}function Mh(r){return Xi(r).then(e=>e.remoteStore)}function Ma(r){return Xi(r).then(e=>e.syncEngine)}function Hn(r){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,b.A)(function*(r){const e=yield Xi(r),t=e.eventManager;return t.onListen=_p.bind(null,e.syncEngine),t.onUnlisten=Ip.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Tp.bind(null,e.syncEngine),t})).apply(this,arguments)}function Lh(r,e,t={}){const n=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new Ji({next:_=>{a.enqueueAndForget(()=>Yo(s,g));const R=_.docs.has(u);!R&&_.fromCache?h.reject(new C(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new ta(An(u.path),f,{includeMetadataChanges:!0,ra:!0});return Ho(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function Bh(r,e,t={}){const n=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,c,h){const f=new Ji({next:_=>{a.enqueueAndForget(()=>Yo(s,g)),_.fromCache&&"server"===c.source?h.reject(new C(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new ta(u,f,{includeMetadataChanges:!0,ra:!0});return Ho(s,g)}(yield Hn(r),r.asyncQueue,e,t,n)})),n.promise}function qh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Uh=new Map;function La(r,e,t){if(!t)throw new C(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Gh(r,e,t,n){if(!0===e&&!0===n)throw new C(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Kh(r){if(!O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function zh(r){if(O.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zi(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":L()}function W(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zi(r);throw new C(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function jh(r,e){if(e<=0)throw new C(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Qh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Gh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=qh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kr{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Wf;switch(n.type){case"firstParty":return new Xf(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Uh.get(t);n&&(N("ComponentProvider","Removing Datastore"),Uh.delete(t),n.terminate())}(this),Promise.resolve()}}class Se{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Se(this.firestore,e,this._query)}}class le{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}}class rt extends Se{constructor(e,t,n){super(e,t,An(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new O(e))}withConverter(e){return new rt(this.firestore,e,this._path)}}function Wh(r,e,...t){if(r=(0,ee.Ku)(r),La("collection","path",e),r instanceof kr){const n=J.fromString(e,...t);return zh(n),new rt(r,null,n)}{if(!(r instanceof le||r instanceof rt))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return zh(n),new rt(r.firestore,null,n)}}function es(r,e,...t){if(r=(0,ee.Ku)(r),1===arguments.length&&(e=ju.newId()),La("doc","path",e),r instanceof kr){const n=J.fromString(e,...t);return Kh(n),new le(r,null,new O(n))}{if(!(r instanceof le||r instanceof rt))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return Kh(n),new le(r.firestore,r instanceof rt?r.converter:null,new O(n))}}function Hh(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),(r instanceof le||r instanceof rt)&&(e instanceof le||e instanceof rt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Ba(r,e){return r=(0,ee.Ku)(r),e=(0,ee.Ku)(e),r instanceof Se&&e instanceof Se&&r.firestore===e.firestore&&mr(r._query,e._query)&&r.converter===e.converter}class e_{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new bo(this,"async_queue_retry"),this.hu=()=>{const t=Qi();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const e=Qi();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Qi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new Te;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,b.A)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Yo.reset()}catch(t){if(!Et(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Yo.$o(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{throw this.au=n,this.uu=!1,_e("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=Wo.createAndSchedule(this,e,t,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&L()}verifyOperationInProgress(){}du(){var e=this;return(0,b.A)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function qa(r){return function(t,n){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class t_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Te,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class re extends kr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new e_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Jh(this),this._firestoreClient.terminate()}}function me(r){return r._firestoreClient||Jh(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Jh(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Vm(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,qh(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._firestoreClient=new Up(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Yh(r,e,t){const n=new Te;return r.asyncQueue.enqueue((0,b.A)(function*(){try{yield Yi(r,t),yield Ca(r,e),n.resolve()}catch(i){const s=i;if(!kh(s))throw s;Ge("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Xh(r){if(r._initialized||r._terminated)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class it{constructor(e){this._byteString=e}static fromBase64String(e){try{return new it(Ee.fromBase64String(e))}catch(t){throw new C(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new it(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ft{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._methodName=e}}class ts{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}const d_=/^__.*__$/;class f_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vn(e,this.data,t,this.fieldTransforms)}}class Zh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new lt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ed(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class ns{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new ns(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return ss(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(ed(this.fu)&&d_.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class m_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Dr(e)}Fu(e,t,n,i=!1){return new ns({fu:e,methodName:t,vu:n,path:ue.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sn(r){const e=r._freezeSettings(),t=Dr(r._databaseId);return new m_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function rs(r,e,t,n,i,s={}){const a=r.Fu(s.merge||s.mergeFields?2:0,e,t,i);$a("Data must be an object, but it was:",a,n);const u=rd(n,a);let c,h;if(s.merge)c=new Ke(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const _=Or(e,g,t);if(!a.contains(_))throw new C(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);sd(f,_)||f.push(_)}c=new Ke(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new f_(new Pe(u),c,h)}class Mr extends rn{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mr}}function td(r,e,t){return new ns({fu:3,vu:e.settings.vu,methodName:r._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ua extends rn{_toFieldTransform(e){return new yr(e.path,new Pn)}isEqual(e){return e instanceof Ua}}class Ga extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=td(this,e,!0),n=this.Mu.map(s=>on(s,t)),i=new Wt(n);return new yr(e.path,i)}isEqual(e){return e instanceof Ga&&(0,ee.bD)(this.Mu,e.Mu)}}class Ka extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=td(this,e,!0),n=this.Mu.map(s=>on(s,t)),i=new Ht(n);return new yr(e.path,i)}isEqual(e){return e instanceof Ka&&(0,ee.bD)(this.Mu,e.Mu)}}class za extends rn{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new Sn(e.serializer,Gc(e.serializer,this.xu));return new yr(e.path,t)}isEqual(e){return e instanceof za&&this.xu===e.xu}}function ja(r,e,t,n){const i=r.Fu(1,e,t);$a("Data must be an object, but it was:",i,n);const s=[],a=Pe.empty();vt(n,(c,h)=>{const f=is(e,c,t);h=(0,ee.Ku)(h);const g=i.Su(f);if(h instanceof Mr)s.push(f);else{const _=on(h,g);null!=_&&(s.push(f),a.set(f,_))}});const u=new Ke(s);return new Zh(a,u,i.fieldTransforms)}function Qa(r,e,t,n,i,s){const a=r.Fu(1,e,t),u=[Or(e,n,t)],c=[i];if(s.length%2!=0)throw new C(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Or(e,s[_])),c.push(s[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!sd(h,u[_])){const R=u[_];let x=c[_];x=(0,ee.Ku)(x);const k=a.Su(R);if(x instanceof Mr)h.push(R);else{const D=on(x,k);null!=D&&(h.push(R),f.set(R,D))}}const g=new Ke(h);return new Zh(f,g,a.fieldTransforms)}function nd(r,e,t,n=!1){return on(t,r.Fu(n?4:3,e))}function on(r,e){if(id(r=(0,ee.Ku)(r)))return $a("Unsupported field value:",e,r),rd(r,e);if(r instanceof rn)return function(n,i){if(!ed(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=on(u,i.bu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ee.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Gc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:xn(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:xn(i.serializer,s)}}if(n instanceof ts)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof it)return{bytesValue:ll(i.serializer,n._byteString)};if(n instanceof le){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:no(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${Zi(n)}`)}(r,e)}function rd(r,e){const t={};return cc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vt(r,(n,i)=>{const s=on(i,e.pu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function id(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof ts||r instanceof it||r instanceof le||r instanceof rn)}function $a(r,e,t){if(!id(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=Zi(t);throw e.Du("an object"===n?r+" a custom object":r+" "+n)}var i}function Or(r,e,t){if((e=(0,ee.Ku)(e))instanceof ft)return e._internalPath;if("string"==typeof e)return is(r,e);throw ss("Field path arguments must be of type string or ",r,!1,void 0,t)}const g_=new RegExp("[~\\*/\\[\\]]");function is(r,e,t){if(e.search(g_)>=0)throw ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ft(...e.split("."))._internalPath}catch{throw ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ss(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new C(S.INVALID_ARGUMENT,u+r+c)}function sd(r,e){return r.some(t=>t.isEqual(e))}class Lr{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new p_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(os("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class p_ extends Lr{data(){return super.data()}}function os(r,e){return"string"==typeof e?is(r,e):e instanceof ft?e._internalPath:e._delegate._internalPath}function od(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wa{}class Br extends Wa{}function kt(r,e,...t){let n=[];e instanceof Wa&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Jn).length,u=s.filter(c=>c instanceof qr).length;if(a>1||a>0&&u>0)throw new C(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class qr extends Br{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new qr(e,t,n)}_apply(e){const t=this._parse(e);return ld(e._query,t),new Se(e.firestore,e.converter,Ws(e._query,t))}_parse(e){const t=sn(e.firestore);return function(s,a,u,c,h,f,g){let _;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){cd(g,f);const R=[];for(const x of g)R.push(ud(c,s,x));_={arrayValue:{values:R}}}else _=ud(c,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||cd(g,f),_=nd(u,"where",g,"in"===f||"not-in"===f);return Y.create(h,f,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Jn extends Wa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)ld(a,c),a=Ws(a,c)}(e._query,t),new Se(e.firestore,e.converter,Ws(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ha extends Br{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ha(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dr(s,a)}(e._query,this._field,this._direction);return new Se(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new ut(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class as extends Br{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new as(e,t,n)}_apply(e){return new Se(e.firestore,e.converter,Ri(e._query,this._limit,this._limitType))}}class us extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new us(e,t,n)}_apply(e){const t=ad(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class cs extends Br{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new cs(e,t,n)}_apply(e){const t=ad(e,this.type,this._docOrFields,this._inclusive);return new Se(e.firestore,e.converter,(s=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function ad(r,e,t,n){if(t[0]=(0,ee.Ku)(t[0]),t[0]instanceof Lr)return function(s,a,u,c,h){if(!c)throw new C(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of wn(s))if(g.field.isKeyField())f.push(Qt(a,c.key));else{const _=c.data.field(g.field);if(yi(_))throw new C(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const R=g.field.canonicalString();throw new C(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new St(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=sn(r.firestore);return function(a,u,c,h,f,g){const _=a.explicitOrderBy;if(f.length>_.length)throw new C(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let x=0;x<f.length;x++){const k=f[x];if(_[x].field.isKeyField()){if("string"!=typeof k)throw new C(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!$s(a)&&-1!==k.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);const D=a.path.child(J.fromString(k));if(!O.isDocumentKey(D))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const B=new O(D);R.push(Qt(u,B))}else{const D=nd(c,h,k);R.push(D)}}return new St(R,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function ud(r,e,t){if("string"==typeof(t=(0,ee.Ku)(t))){if(""===t)throw new C(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$s(e)&&-1!==t.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(J.fromString(t));if(!O.isDocumentKey(n))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Qt(r,new O(n))}if(t instanceof le)return Qt(r,t._key);throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zi(t)}.`)}function cd(r,e){if(!Array.isArray(r)||0===r.length)throw new C(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ld(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(S.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Ja{convertValue(e,t="none"){switch(Rt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(at(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return vt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new ts(ge(e.latitude),ge(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ii(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ur(e));default:return null}}convertTimestamp(e){const t=ot(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=J.fromString(e);U(vl(n));const i=new At(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(t)||_e(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ls(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class R_ extends Ja{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}class an{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mt extends Lr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(os("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ur extends mt{data(e={}){return super.data(e)}}class Ft{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Ur(this._firestore,this._userDataWriter,n.key,n,new an(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Ur(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Ur(i._firestore,i._userDataWriter,u.doc.key,u.doc,new an(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:S_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function S_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function dd(r,e){return r instanceof mt&&e instanceof mt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ft&&e instanceof Ft&&r._firestore===e._firestore&&Ba(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Mt extends Ja{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function fd(r,e,t){r=W(r,le);const n=W(r.firestore,re),i=ls(r.converter,e,t);return Yn(n,[rs(sn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,fe.none())])}function md(r,e,t,...n){r=W(r,le);const i=W(r.firestore,re),s=sn(i);let a;return a="string"==typeof(e=(0,ee.Ku)(e))||e instanceof ft?Qa(s,"updateDoc",r._key,e,t,n):ja(s,"updateDoc",r._key,e),Yn(i,[a.toMutation(r._key,fe.exists(!0))])}function gd(r,...e){var t,n,i;r=(0,ee.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||qa(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(qa(e[a])){const g=e[a];e[a]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let c,h,f;if(r instanceof le)h=W(r.firestore,re),f=An(r._key.path),c={next:g=>{e[a]&&e[a](Ya(h,r,g))},error:e[a+1],complete:e[a+2]};else{const g=W(r,Se);h=W(g.firestore,re),f=g._query;const _=new Mt(h);c={next:R=>{e[a]&&e[a](new Ft(h,_,g,R))},error:e[a+1],complete:e[a+2]},od(r._query)}return function(_,R,x,k){const D=new Ji(k),B=new ta(R,D,x);return _.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Ho(yield Hn(_),B)})),()=>{D.$a(),_.asyncQueue.enqueueAndForget((0,b.A)(function*(){return Yo(yield Hn(_),B)}))}}(me(h),f,u,c)}function Yn(r,e){return function(n,i){const s=new Te;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Ep(r,e,t){return ca.apply(this,arguments)}(yield Ma(n),i,s)})),s.promise}(me(r),e)}function Ya(r,e,t){const n=t.docs.get(e._key),i=new Mt(r);return new mt(r,i,e._key,n,new an(t.hasPendingWrites,t.fromCache),e.converter)}const j_={maxAttempts:5};class pd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=sn(e)}set(e,t,n){this._verifyNotCommitted();const i=Ot(e,this._firestore),s=ls(i.converter,t,n),a=rs(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,fe.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Ot(e,this._firestore);let a;return a="string"==typeof(t=(0,ee.Ku)(t))||t instanceof ft?Qa(this._dataReader,"WriteBatch.update",s._key,t,n,i):ja(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ot(e,this._firestore);return this._mutations=this._mutations.concat(new bn(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ot(r,e){if((r=(0,ee.Ku)(r)).firestore!==e)throw new C(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class Q_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=sn(t)}get(t){const n=Ot(t,this._firestore),i=new R_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return L();const a=s[0];if(a.isFoundDocument())return new Lr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Lr(this._firestore,i,n._key,null,n.converter);throw L()})}set(t,n,i){const s=Ot(t,this._firestore),a=ls(s.converter,n,i),u=rs(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Ot(t,this._firestore);let u;return u="string"==typeof(n=(0,ee.Ku)(n))||n instanceof ft?Qa(this._dataReader,"Transaction.update",a._key,n,i,s):ja(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Ot(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ot(e,this._firestore),n=new Mt(this._firestore);return super.get(e).then(i=>new mt(this._firestore,n,t._key,i._document,new an(!1,!1),t.converter))}}function Za(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Td(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Ed(){if(!function Pm(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){gn=di.SDK_VERSION,(0,di._registerComponent)(new Du.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new re(new Jf(n.getProvider("auth-internal")),new Zf(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new At(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,di.registerVersion)(Gu,"4.6.3",e),(0,di.registerVersion)(Gu,"4.6.3","esm2017")}();class Gr{constructor(e){this._delegate=e}static fromBase64String(e){return Ed(),new Gr(it.fromBase64String(e))}static fromUint8Array(e){return Td(),new Gr(it.fromUint8Array(e))}toBase64(){return Ed(),this._delegate.toBase64()}toUint8Array(){return Td(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function eu(r){return function ny(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class ry{enableIndexedDbPersistence(e,t){return function r_(r,e){Xh(r=W(r,re));const t=me(r);if(t._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new $n;return Yh(t,i,new ba(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function i_(r){Xh(r=W(r,re));const e=me(r);if(e._uninitializedComponentsProvider)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");Ge("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new $n;return Yh(e,n,new Dh(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function s_(r){if(r._initialized&&!r._terminated)throw new C(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Te;return r._queue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{yield(t=(0,b.A)(function*(i){if(!Xe.D())return Promise.resolve();const s=i+"main";yield Xe.delete(s)}),function n(i){return t.apply(this,arguments)})(yo(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class vd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof At||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ge("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function $h(r,e,t,n={}){var i;const s=(r=W(r,kr))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Ge("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=ve.MOCK_USER;else{u=(0,ee.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new C(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new ve(h)}r._authCredentials=new Hf(new Ku(u,c))}}(this._delegate,e,t,n)}enableNetwork(){return function a_(r){return function Gp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Fh(r),t=yield Mh(r);return e.setNetworkEnabled(!0),function(i){const s=F(i);return s.M_.delete(0),Nr(s)}(t)}))}(me(r=W(r,re)))}(this._delegate)}disableNetwork(){return function u_(r){return function Kp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield Fh(r),t=yield Mh(r);return e.setNetworkEnabled(!1),(n=(0,b.A)(function*(s){const a=F(s);a.M_.add(0),yield Ln(a),a.N_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(me(r=W(r,re)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Gh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function o_(r){return function(t){const n=new Te;return t.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Rp(r,e){return ma.apply(this,arguments)}(yield Ma(t),n)})),n.promise}(me(r=W(r,re)))}(this._delegate)}onSnapshotsInSync(e){return function M_(r,e){return function $p(r,e){const t=new Ji(e);return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Hn(r),s=t,F(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Hn(r),s=t,void F(i).z_.delete(s);var i,s}))}}(me(r=W(r,re)),qa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Xn(this,Wh(this._delegate,e))}catch(t){throw Oe(t,"collection()","Firestore.collection()")}}doc(e){try{return new We(this,es(this._delegate,e))}catch(t){throw Oe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Le(this,function Zp(r,e){if(r=W(r,kr),La("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Se(r,null,(n=e,new ut(J.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Oe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function $_(r,e,t){r=W(r,re);const n=Object.assign(Object.assign({},j_),t);return function(s){if(s.maxAttempts<1)throw new C(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new Te;return s.asyncQueue.enqueueAndForget((0,b.A)(function*(){const h=yield function Oh(r){return Xi(r).then(e=>e.datastore)}(s);new qp(s.asyncQueue,h,u,a,c).Xa()})),c.promise}(me(r),i=>e(new Q_(r,i)),n)}(this._delegate,t=>e(new Ad(this,t)))}batch(){return me(this._delegate),new wd(new pd(this._delegate,e=>Yn(this._delegate,e)))}loadBundle(e){return function c_(r,e){const t=me(r=W(r,re)),n=new t_;return function Wp(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?nl().encode(a):a,f=function(f,g){if(f instanceof Uint8Array)return Nh(f,g);if(f instanceof ArrayBuffer)return Nh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Lp(f,u);var f}(t,Dr(e));r.asyncQueue.enqueueAndForget((0,b.A)(function*(){!function Mp(r,e,t){const n=F(r);var i;(i=(0,b.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(x,k){const D=F(x),B=ye(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",K=>D.$r.getBundleMetadata(K,k.id)).then(K=>!!K&&K.createTime.compareTo(B)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(x=h).totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}),Promise.resolve(new Set);c._updateProgress(vh(h));const f=new fp(h,a.localStore,u.serializer);let g=yield u.qa();for(;g;){const R=yield f._a(g);R&&c._updateProgress(R),g=yield u.qa()}const _=yield f.complete();return yield dt(a,_.ca,void 0),yield function(x,k){const D=F(x);return D.persistence.runTransaction("Save bundle","readwrite",B=>D.$r.saveBundleMetadata(B,k))}(a.localStore,h),c._completeWith(_.progress),Promise.resolve(_.ua)}catch(h){return Ge("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var x}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield Ma(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function l_(r,e){return function Hp(r,e){return r.asyncQueue.enqueue((0,b.A)(function*(){return function(n,i){const s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield Wn(r),e)}))}(me(r=W(r,re)),e).then(t=>t?new Se(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Le(this,t):null)}}class ds extends Ja{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(new it(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return We.forKey(t,this.firestore,null)}}class Ad{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}get(e){const t=cn(e);return this._delegate.get(t).then(n=>new Kr(this._firestore,new mt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=cn(e);return n?(Za("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}}class wd{constructor(e){this._delegate=e}set(e,t,n){const i=cn(e);return n?(Za("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=cn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=cn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class un{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Ur(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=un.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new un(e,new ds(e),t),i.set(t,s)),s}}un.INSTANCES=new WeakMap;class We{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new We(t,new le(t._delegate,n,new O(e)))}static forKey(e,t,n){return new We(t,new le(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Xn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Xn(this.firestore,Wh(this._delegate,e))}catch(t){throw Oe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ee.Ku)(e))instanceof le&&Hh(this._delegate,e)}set(e,t){t=Za("DocumentReference.set",t);try{return t?fd(this._delegate,e,t):fd(this._delegate,e)}catch(n){throw Oe(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?md(this._delegate,e):md(this._delegate,e,t,...n)}catch(i){throw Oe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function k_(r){return Yn(W(r.firestore,re),[new bn(r._key,fe.none())])}(this._delegate)}onSnapshot(...e){const t=Rd(e),n=Pd(e,i=>new Kr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return gd(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function b_(r){r=W(r,le);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return function zp(r,e){const t=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield function(f,g){const _=F(f);return _.persistence.runTransaction("read document","readonly",R=>_.localDocuments.getDocument(R,g))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new C(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=Gn(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new mt(e,n,r._key,i,new an(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function x_(r){r=W(r,le);const e=W(r.firestore,re);return Lh(me(e),r._key,{source:"server"}).then(t=>Ya(e,r,t))}(this._delegate):function V_(r){r=W(r,le);const e=W(r.firestore,re);return Lh(me(e),r._key).then(t=>Ya(e,r,t))}(this._delegate),t.then(n=>new Kr(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new We(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function Oe(r,e,t){return r.message=r.message.replace(e,t),r}function Rd(r){for(const e of r)if("object"==typeof e&&!eu(e))return e;return{}}function Pd(r,e){var t,n;let i;return i=eu(r[0])?r[0]:eu(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Kr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new We(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return dd(this._delegate,e._delegate)}}class zr extends Kr{data(e){const t=this._delegate.data(e);return this._delegate._converter||function $f(r,e){r||L()}(void 0!==t),t}}class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ds(e)}where(e,t,n){try{return new Le(this.firestore,kt(this._delegate,function __(r,e,t){const n=e,i=os("where",r);return qr._create(i,n,t)}(e,t,n)))}catch(i){throw Oe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Le(this.firestore,kt(this._delegate,function y_(r,e="asc"){const t=e,n=os("orderBy",r);return Ha._create(n,t)}(e,t)))}catch(n){throw Oe(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Le(this.firestore,kt(this._delegate,function I_(r){return jh("limit",r),as._create("limit",r,"F")}(e)))}catch(t){throw Oe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Le(this.firestore,kt(this._delegate,function T_(r){return jh("limitToLast",r),as._create("limitToLast",r,"L")}(e)))}catch(t){throw Oe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Le(this.firestore,kt(this._delegate,function E_(...r){return us._create("startAt",r,!0)}(...e)))}catch(t){throw Oe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Le(this.firestore,kt(this._delegate,function v_(...r){return us._create("startAfter",r,!1)}(...e)))}catch(t){throw Oe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Le(this.firestore,kt(this._delegate,function A_(...r){return cs._create("endBefore",r,!1)}(...e)))}catch(t){throw Oe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Le(this.firestore,kt(this._delegate,function w_(...r){return cs._create("endAt",r,!0)}(...e)))}catch(t){throw Oe(t,"endAt()","Query.endAt()")}}isEqual(e){return Ba(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function D_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return function jp(r,e){const t=new Te;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const c=yield Gi(s,a,!0),h=new Rh(a,c.hs),f=h.da(c.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(c){const h=Gn(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Wn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate):"server"===e?.source?function N_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return Bh(t,r._query,{source:"server"}).then(i=>new Ft(e,n,r,i))}(this._delegate):function C_(r){r=W(r,Se);const e=W(r.firestore,re),t=me(e),n=new Mt(e);return od(r._query),Bh(t,r._query).then(i=>new Ft(e,n,r,i))}(this._delegate),t.then(n=>new tu(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Rd(e),n=Pd(e,i=>new tu(this.firestore,new Ft(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return gd(this._delegate,t,n)}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}class sy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class tu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new sy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new zr(this._firestore,n))})}isEqual(e){return dd(this._delegate,e._delegate)}}class Xn extends Le{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new We(this.firestore,e):null}doc(e){try{return new We(this.firestore,void 0===e?es(this._delegate):es(this._delegate,e))}catch(t){throw Oe(t,"doc()","CollectionReference.doc()")}}add(e){return function F_(r,e){const t=W(r.firestore,re),n=es(r),i=ls(r.converter,e);return Yn(t,[rs(sn(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,fe.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new We(this.firestore,t))}isEqual(e){return Hh(this._delegate,e._delegate)}withConverter(e){return new Xn(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function cn(r){return W(r,le)}class nu{constructor(...e){this._delegate=new ft(...e)}static documentId(){return new nu(ue.keyField().canonicalString())}isEqual(e){return(e=(0,ee.Ku)(e))instanceof ft&&this._delegate._internalPath.isEqual(e._internalPath)}}class ln{constructor(e){this._delegate=e}static serverTimestamp(){const e=function H_(){return new Ua("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ln(e)}static delete(){const e=function W_(){return new Mr("deleteField")}();return e._methodName="FieldValue.delete",new ln(e)}static arrayUnion(...e){const t=function J_(...r){return new Ga("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ln(t)}static arrayRemove(...e){const t=function Y_(...r){return new Ka("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ln(t)}static increment(e){const t=function X_(r){return new za("increment",r)}(e);return t._methodName="FieldValue.increment",new ln(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const oy={Firestore:vd,GeoPoint:ts,Timestamp:de,Blob:Gr,Transaction:Ad,WriteBatch:wd,DocumentReference:We,DocumentSnapshot:Kr,Query:Le,QueryDocumentSnapshot:zr,QuerySnapshot:tu,CollectionReference:Xn,FieldPath:nu,FieldValue:ln,setLogLevel:function iy(r){!function Qf(r){It.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};!function uy(r){(function ay(r,e){r.INTERNAL.registerComponent(new Du.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},oy)))})(r,(e,t)=>new vd(e,t,new ry)),r.registerVersion("@firebase/firestore-compat","0.3.32")}(jf.A);var cy=ae(7935);function Sd(r,e){return function ly(r,e=qf.E){return new Uf.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function ru(r,e){return Sd(r,e).pipe((0,Je.T)(t=>({payload:t,type:"query"})))}class Vd{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=kd(n,t);return new Cd(i,s,this.afs)}snapshotChanges(){return function hy(r,e){return Sd(r,e).pipe((0,Cs.Z)(void 0),Ds(),(0,Je.T)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Je.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,hi.H)(this.ref.get(e)).pipe(Ue.U0)}}function fs(r,e){return ru(r,e).pipe((0,Cs.Z)(void 0),Ds(),(0,Je.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function bd(r,e,t){return fs(r,t).pipe((0,Ns.S)((n,i)=>function dy(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function fy(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return iu(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return iu(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return iu(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,zf.F)(),(0,Je.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function iu(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function xd(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class Cd{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=fs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Je.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Cs.Z)(void 0),Ds(),(0,Cu.p)(([n,i])=>i.length>0||!n),(0,Je.T)(([,n])=>n),Ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ns.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=xd(e);return bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return ru(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),Ue.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(Ue.U0)}add(e){return this.ref.add(e)}doc(e){return new Vd(this.ref.doc(e),this.afs)}}class my{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?fs(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Cu.p)(t=>t.length>0),Ue.U0):fs(this.query,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Ns.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=xd(e);return bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue.U0)}valueChanges(e={}){return ru(this.query,this.afs.schedulers.outsideAngular).pipe((0,Je.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ue.U0)}get(e){return(0,hi.H)(this.query.get(e)).pipe(Ue.U0)}}const Dd=new se.nKC("angularfire2.enableFirestorePersistence"),Nd=new se.nKC("angularfire2.firestore.persistenceSettings"),gy=new se.nKC("angularfire2.firestore.settings"),py=new se.nKC("angularfire2.firestore.use-emulator");function kd(r,e=(t=>t)){return{query:e(r),ref:r}}let Fd=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,h,f,g,_,R,x,k,D,B,K){this.schedulers=c;const q=(0,li.iB)(t,u,n),z=f;g&&(0,yt.gF)(q,u,_,x,k,D,R,B),[this.firestore,this.persistenceEnabled$]=(0,li.BM)(`${q.name}.firestore`,"AngularFirestore",q.name,()=>{const H=u.runOutsideAngular(()=>q.firestore());if(s&&H.settings(s),z&&H.useEmulator(...z),i&&!(0,Bf.Vy)(a)){const $=()=>{try{return(0,hi.H)(H.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),(0,xu.of)(!1)}};return[H,u.runOutsideAngular($)]}return[H,(0,xu.of)(!1)]},[s,z,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:a}=kd(i,n),u=this.schedulers.ngZone.run(()=>s);return new Cd(u,a,this)}collectionGroup(t,n){const i=n||(a=>a),s=this.firestore.collectionGroup(t);return new my(i(s),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>n);return new Vd(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(se.KVO(li.rx),se.KVO(li.uP,8),se.KVO(Dd,8),se.KVO(gy,8),se.KVO(se.Agw),se.KVO(se.SKi),se.KVO(Ue.u0),se.KVO(Nd,8),se.KVO(py,8),se.KVO(yt.DS,8),se.KVO(yt.CP,8),se.KVO(yt.yy,8),se.KVO(yt.ZP,8),se.KVO(yt.$z,8),se.KVO(yt.AU,8),se.KVO(yt.UB,8),se.KVO(Ue.Jv,8))};static \u0275prov=se.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),_y=(()=>{class r{constructor(){cy.A.registerVersion("angularfire",Ue.xv.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Dd,useValue:!0},{provide:Nd,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=se.$C({type:r});static \u0275inj=se.G2t({providers:[Fd]})}return r})()}}]);