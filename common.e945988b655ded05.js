"use strict";(self.webpackChunkKaguraGithubPages=self.webpackChunkKaguraGithubPages||[]).push([[312],{8280:($,I,e)=>{e.d(I,{E:()=>s});var i=e(4496),t=e(5657),_=e(2540),C=e(1496),n=e(7368),f=e(4704),h=e(4e3),u=e(6684),v=e(8476),c=e(3616),l=e(7028),p=e(4476),w=e(1368);const m=["hostingSpan"];let s=(()=>{class r{http;sanitizer;error=new i._w7;src;fill;stroke;height;width;hostingSpan;contents$;svg$;destroy$=new t.E;src$=new _.o;width$=new _.o;height$=new _.o;constructor(o,a){this.http=o,this.sanitizer=a}ngOnInit(){this.contents$=this.src$.pipe((0,n.G)(o=>this.http.fetchText(o)),(0,f.k)(o=>this.sanitizer.bypassSecurityTrustHtml(o))),this.svg$=this.contents$.pipe((0,n.G)(o=>(0,C.I)(200)),(0,f.k)(o=>this.getUniqueSvgElement()),(0,h.a)(),(0,u.I)(o=>null!==o),(0,v.C)(1)),this.connectAttribute(o=>`${o}`,"width",this.width$),this.connectAttribute(o=>`${o}`,"height",this.height$)}ngOnDestroy(){this.destroy$.next()}connectAttribute(o,a,M){M.pipe((0,n.G)(y=>this.svg$.pipe((0,f.k)(x=>[x,o(y)]))),(0,c.a)(this.destroy$)).subscribe(([y,x])=>{y.setAttribute(a,x)})}getUniqueSvgElement(){const o=this.hostingSpan.nativeElement.getElementsByTagName("svg");return 1!==o.length?null:o[0]}validateSrc(o){if("string"!=typeof o)return!1;const a=o;if(!a.startsWith("/"))throw new Error(`Currently just support hosting inline svg ${a}`);return!0}ngOnChanges(o){if("src"in o){const a=o.src.currentValue;if(!this.validateSrc(a))return;this.src$.next(a)}if("width"in o){const a=o.width.currentValue;if("number"!=typeof a)throw new Error(`Not a number ${a}`);this.width$.next(a)}if("height"in o){const a=o.height.currentValue;if("number"!=typeof a)throw new Error(`Not a number ${a}`);this.height$.next(o.height.currentValue)}}static \u0275fac=function(a){return new(a||r)(i.GI1(l.hD),i.GI1(p.mI))};static \u0275cmp=i.In1({type:r,selectors:[["app-inline-svg"]],viewQuery:function(a,M){if(1&a&&i.CC$(m,5),2&a){let y;i.wto(y=i.Gqi())&&(M.hostingSpan=y.first)}},inputs:{src:"src",fill:"fill",stroke:"stroke",height:"height",width:"width"},outputs:{error:"error"},features:[i.SYr],decls:3,vars:7,consts:[[3,"innerHTML"],["hostingSpan",""]],template:function(a,M){1&a&&(i.wR5(0,"span",0,1),i.wVc(2,"async")),2&a&&(i.m4B("fill",M.fill)("stroke",M.stroke),i.E7m("innerHTML",i.kDX(2,5,M.contents$),i.E3n))},dependencies:[w.a]})}return r})()},8631:($,I,e)=>{e.d(I,{o:()=>t});var i=e(4496);let t=(()=>{class _{transform(n){if(null===n)return null;const f=Math.floor(Date.now()/1e3),h=Math.floor(f-n.getTime()/1e3);if(h<-10)return null;if(h<60)return"\u305f\u3063\u305f\u4eca";const u=Math.floor(h/60);if(u<60)return`${u} \u5206\u524d`;const v=Math.floor(u/60);if(v<24)return`${v} \u6642\u9593\u524d`;const c=Math.floor(v/24);if(c<30)return`${c} \u65e5\u524d`;const l=Math.floor(c/30);if(l<12)return`${l} \u30f6\u6708\u524d`;const p=Math.floor(c/365);return p<10?`${p} \u5e74\u524d`:"\u304b\u306a\u308a\u6614"}static \u0275fac=function(f){return new(f||_)};static \u0275pipe=i.UTH({name:"relativeTime",type:_,pure:!1})}return _})()},6228:($,I,e)=>{e.d(I,{c:()=>l});var i=e(1528),t=e(4496),_=e(9252),n=(e(8836),e(6716)),f=e(331),h=e(4400),u=e(1368);function v(p,w){if(1&p){const m=t.KQA();t.I0R(0,"div",2)(1,"button",3),t.OEk(2,"\u305d\u306e\u4ed6\u306e\u30ed\u30b0\u30a4\u30f3\u65b9\u6cd5"),t.C$Y(),t.I0R(3,"div",4)(4,"p"),t.OEk(5,"\u4ee5\u4e0b\u306e\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4f7f\u3046\u969b\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u8a2d\u5b9a\u3067 "),t.I0R(6,"b"),t.OEk(7),t.C$Y(),t.OEk(8,"\u304b\u3089\u306e\u7b2c\u4e09\u8005\u30af\u30c3\u30ad\u30fc (Third-Party Cookie) \u3092\u53d7\u3051\u5bb9\u308c\u308b\u8a2d\u5b9a\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t.C$Y(),t.I0R(9,"p"),t.OEk(10,"\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u5fc5\u305a "),t.I0R(11,"a",5),t.OEk(12,"[\u5229\u7528\u898f\u7d04]"),t.C$Y(),t.OEk(13," \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t.C$Y(),t.I0R(14,"div")(15,"img",6),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickGoogleAuth(r))}),t.C$Y(),t.I0R(16,"img",7),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickTwitterAuth(r))}),t.C$Y(),t.I0R(17,"span",8),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickGithubAuth(r))}),t.wR5(18,"img",9),t.OEk(19,"Sign in with Github"),t.C$Y()()()()}if(2&p){const m=t.GaO();t.yG2(7),t.oRS("",m.apiHostname," ")}}function c(p,w){if(1&p){const m=t.KQA();t.I0R(0,"div")(1,"img",10),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickGoogleAuth(r))}),t.C$Y(),t.I0R(2,"img",11),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickTwitterAuth(r))}),t.C$Y(),t.I0R(3,"img",12),t.qCj("click",function(r){t.usT(m);const D=t.GaO();return t.CGJ(D.onClickGithubAuth(r))}),t.C$Y()()}}let l=(()=>{class p{auth;toastr;apiHostname=n.OU.firebaseConfig.authDomain;isTiny=!1;loginSucceeded=new t._w7;loginFailed=new t._w7;constructor(m,s){this.auth=m,this.toastr=s}ngOnInit(){(0,n.qe)("OauthFederationsComponent.OnInit()")}doOauth(m){var s=this;return(0,i.c)(function*(){try{yield s.auth.signInWithPopup(m),s.loginSucceeded.next()}catch(r){s.loginFailed.next(r)}})()}onClickGoogleAuth(m){var s=this;return(0,i.c)(function*(){m.preventDefault();const r=new _.c.auth.GoogleAuthProvider;yield s.doOauth(r)})()}onClickTwitterAuth(m){var s=this;return(0,i.c)(function*(){m.preventDefault();const r=new _.c.auth.TwitterAuthProvider;yield s.doOauth(r)})()}onClickGithubAuth(m){var s=this;return(0,i.c)(function*(){m.preventDefault();const r=new _.c.auth.GithubAuthProvider;yield s.doOauth(r)})()}static \u0275fac=function(s){return new(s||p)(t.GI1(f._o),t.GI1(h.SA))};static \u0275cmp=t.In1({type:p,selectors:[["app-oauth-federations"]],inputs:{isTiny:"isTiny"},outputs:{loginSucceeded:"loginSucceeded",loginFailed:"loginFailed"},decls:2,vars:2,consts:[["class","row m-3",4,"ngIf"],[4,"ngIf"],[1,"row","m-3"],["type","button","data-bs-toggle","collapse","data-bs-target","#appGitfireOauthFederationsList","role","button","aria-label","Toggle other login","aria-expanded","false","aria-controls","appGitfireOauthFederationsList",1,"btn","btn-secondary","collapsed"],["id","appGitfireOauthFederationsList",1,"collapse","m-3"],["tabindex","-1","about","_blank","href","/terms.htm",1,""],["src","assets/google-login.png","alt","Google",1,"m-2","oauth-login-button","oauth-width-login-img",3,"click"],["src","assets/twitter-login.png","alt","Twitter",1,"m-2","oauth-login-button","oauth-width-login-img",3,"click"],[1,"m-2","oauth-login-button","oauth-pseudo-img",3,"click"],["src","assets/github-login.png","alt","Github",1,"m-1","oauth-circle-login-img"],["src","assets/google-login.png",1,"m-1","oauth-tiny-wide-img",3,"click"],["src","assets/twitter-login-small.png",1,"m-1","oauth-tiny-circle-img",3,"click"],["src","assets/github-login.png",1,"m-1","oauth-tiny-circle-img",3,"click"]],template:function(s,r){1&s&&t.yuY(0,v,20,1,"div",0)(1,c,4,0,"div",1),2&s&&(t.E7m("ngIf",!r.isTiny),t.yG2(),t.E7m("ngIf",r.isTiny))},dependencies:[u.u_],styles:[".oauth-login-button[_ngcontent-%COMP%]{cursor:pointer}.oauth-width-login-img[_ngcontent-%COMP%]{width:150px}.oauth-pseudo-img[_ngcontent-%COMP%]{border-style:ridge;border-radius:5px;padding:5px;white-space:nowrap}.oauth-circle-login-img[_ngcontent-%COMP%]{height:20px;width:20px}.oauth-tiny-wide-img[_ngcontent-%COMP%]{height:30px}.oauth-tiny-circle-img[_ngcontent-%COMP%]{width:30px}"]})}return p})()},5192:($,I,e)=>{e.d(I,{k:()=>x});var i=e(1528),t=e(9252);class _{saveNeverAsk;isConfirmed}var C=function(d){return d[d.Ok=0]="Ok",d[d.No=1]="No",d[d.OkPermanent=2]="OkPermanent",d}(C||{}),n=e(4496),f=e(6504),h=e(1524),u=e(6716),v=e(1368),c=e(4192);function l(d,U){1&d&&n.wR5(0,"span",12)}function p(d,U){if(1&d&&(n.SAx(0),n.I0R(1,"div",10),n.wR5(2,"div",13),n.C$Y(),n.k70()),2&d){const T=n.GaO();n.yG2(2),n.E7m("innerHTML",T.tosJson.html,n.E3n)}}let w=(()=>{class d extends h.m{confirmed=new n._w7;inputConfirmForm;tosJson;constructor(){super()}ngOnInit(){(0,u.qe)("TosConfirmComponent.OnInit()"),this.inputConfirmForm=new f.WC({}),this.inputConfirmForm.addControl("neverConfirmTosCheck",new f.Ku(!1))}ngAfterViewInit(){(0,u.qe)("TosConfirmComponent.AfterViewInit()")}get neverCheckTosControl(){return this.inputConfirmForm.get("neverConfirmTosCheck")}onClickConfirm(T){if(T.preventDefault(),this.inputConfirmForm.markAllAsTouched(),this.inputConfirmForm.invalid)return;const g=new _,O=this.inputConfirmForm.get("neverConfirmTosCheck");g.saveNeverAsk=O.value,g.isConfirmed=!0,this.confirmed.emit(g)}static \u0275fac=function(g){return new(g||d)};static \u0275cmp=n.In1({type:d,selectors:[["gitfire-tos-confirm"]],inputs:{tosJson:"tosJson"},outputs:{confirmed:"confirmed"},features:[n.eg9],decls:19,vars:6,consts:[["loadingTemplate",""],[1,"container"],[4,"ngIf","ngIfElse"],[1,"text-center"],[3,"formGroup"],[1,"m-5","custom-control","custom-checkbox"],["for","appGitfireTosConfirmNeverDismissCheck",1,"visually-hidden"],["id","appGitfireTosConfirmNeverDismissCheck","name","neverConfirmTosCheck","formControlName","neverConfirmTosCheck","type","checkbox",1,"form-check-input"],[1,"text-muted","fw-light"],["routerLink","/terms.htm"],[1,"m-3"],["id","appGitfireTosConfirmButton","data-bs-dismiss","modal",1,"btn","btn-success",3,"disabled","click"],["role","status",1,"spinner-border","text-primary"],[3,"innerHTML"]],template:function(g,O){if(1&g&&(n.yuY(0,l,1,0,"ng-template",null,0,n.gJz),n.I0R(2,"div",1),n.yuY(3,p,3,1,"ng-container",2),n.I0R(4,"div",3)(5,"form",4)(6,"div",5)(7,"label",6),n.OEk(8,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),n.C$Y(),n.wR5(9,"input",7),n.OEk(10,"\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044"),n.C$Y(),n.I0R(11,"div",8),n.OEk(12,"\u8a73\u3057\u304f\u306f"),n.I0R(13,"a",9),n.OEk(14,"[\u5229\u7528\u898f\u7d04]"),n.C$Y(),n.OEk(15,"\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002 "),n.C$Y(),n.I0R(16,"div",10)(17,"button",11),n.qCj("click",function(F){return O.onClickConfirm(F)}),n.OEk(18,"\u78ba\u8a8d\u3057\u307e\u3057\u305f"),n.C$Y()()()()()),2&g){const A=n.Gew(1);n.yG2(3),n.E7m("ngIf",O.tosJson)("ngIfElse",A),n.yG2(2),n.E7m("formGroup",O.inputConfirmForm),n.yG2(),n.eAK("was-validated",O.neverCheckTosControl.dirty||O.neverCheckTosControl.touched),n.yG2(11),n.E7m("disabled",!O.inputConfirmForm.valid)}},dependencies:[v.u_,f.sz,f.SU,f.ue,f.u,f.uW,f.Wo,c.ER]})}return d})();var m=e(6520),s=e(5657),r=e(3992),D=e(7368),o=e(4704),a=e(7028),M=e(496),y=e(8472);let x=(()=>{class d{http;dialog;store;privUser;constructor(T,g,O){this.http=T,this.dialog=g,this.store=O,this.privUser=this.store.collection("/users/v1/protected")}constructSetupTosConfirm(T,g){return O=>{O.tosJson=g.json,O.confirmed.subscribe(A=>{if(!A.isConfirmed)throw new Error("assert");g.answer=A.saveNeverAsk?C.OkPermanent:C.Ok,T.next(g)})}}confirmTos$(T,g){var O=this;if(T.match(/\/$/))throw new Error(`Assertion. Not a supported ${T}`);const A=new s.E,B=(new s.E,new s.E),R=new s.E,b=this.http.fetchGhJson(g).pipe((0,r.U)(1),(0,D.G)(E=>{const P=this.privUser.doc(`${T}/${E.version}`),k={json:E,cached:!1,cacheRef:P};return P.get().pipe((0,o.k)((G,L)=>(G.exists&&G.data().alwaysConfirmed&&((0,u.qe)("TOS has already been confirmed."),k.cached=!0),k)))}));return R.pipe().subscribe({next:E=>{this.dialog.createDefaultBuilder().prepareBody(w).setupChild(this.constructSetupTosConfirm(B,E)).setType(m.aU.Warn).setSize(m.q2.Default).setTitle("\u5229\u7528\u898f\u7d04\u306e\u78ba\u8a8d").closeButton(()=>{E.answer=C.No,B.next(E)}).setFinalize(()=>{E.answer=C.No,B.next(E)}).open()},complete:()=>{(0,u.qe)("completeed dialog$")},error:E=>{(0,u.sJ)("error dialog$",E)}}),b.pipe((0,r.U)(1)).subscribe({next:E=>{E.cached?A.next(!0):R.next(E)},complete:()=>{(0,u.qe)("Completed TOS reading")},error:E=>{(0,u.sJ)("Failed reading TOS cache")}}),B.pipe((0,r.U)(1)).subscribe({next:(E=(0,i.c)(function*(P){switch(P.answer){case C.Ok:A.next(!0);break;case C.No:A.next(!1);break;case C.OkPermanent:const k={_docClass:"User:UserAgreementStore",alwaysConfirmed:!0,createdAt:O.fieldTimestamp()};A.next(!0),yield P.cacheRef.set(k);break;default:throw new Error(`Not a valid answer ${P.answer}`)}}),function(k){return E.apply(this,arguments)}),complete:()=>{(0,u.qe)("Completed dialog result."),A.complete()},error:E=>{(0,u.sJ)("Failed receive dialog result"),A.complete()}}),A;var E}fieldTimestamp(){return t.c.firestore.FieldValue.serverTimestamp()}static \u0275fac=function(g){return new(g||d)(n.CoB(a.hD),n.CoB(M.EF),n.CoB(y.i4))};static \u0275prov=n.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},2980:($,I,e)=>{e.d(I,{o:()=>h});var i=e(2700),t=e(8476),_=e(4704),C=e(4496),n=e(8472),f=e(4304);let h=(()=>{class u{store;auth;pubUser;nicknameCache={};userCache={};constructor(c,l){this.store=c,this.auth=l,this.pubUser=this.store.collection("/users/v1/public")}myNickname$(){return this.auth.myUid?this.nickname$(this.auth.myUid):(0,i.of)("")}user$(c){let l=this.userCache[c];return l||(l=this.pubUser.doc(c).valueChanges().pipe((0,t.C)(1)),this.userCache[c]=l,l)}nickname$(c){let l=this.nicknameCache[c];return l||(l=this.user$(c).pipe((0,_.k)(p=>p?p.nickname:null)),this.nicknameCache[c]=l,l)}static \u0275fac=function(l){return new(l||u)(C.CoB(n.i4),C.CoB(f.o))};static \u0275prov=C.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},6016:($,I,e)=>{e.d(I,{e:()=>f});var i=e(4496),t=e(1368);function _(h,u){1&h&&(i.I0R(0,"span",2),i.OEk(1,"[\u524a\u9664]"),i.C$Y())}function C(h,u){1&h&&i.wR5(0,"img",5),2&h&&i._6D("src",u.$implicit,i.K6U)}function n(h,u){if(1&h&&(i.I0R(0,"span",3),i.yuY(1,C,1,1,"img",4),i.OEk(2),i.C$Y()),2&h){const v=u.$implicit;i._6D("title",v.about),i.yG2(),i.E7m("ngIf",v.photoURL),i.yG2(),i.cNF(v.nickname)}}let f=(()=>{class h{userPublic;constructor(){}static \u0275fac=function(c){return new(c||h)};static \u0275cmp=i.In1({type:h,selectors:[["gitfire-user-box"]],inputs:{userPublic:"userPublic"},decls:3,vars:2,consts:[["voidUser",""],["class","p-1",3,"title",4,"ngIf","ngIfElse"],["title","\u524a\u9664\u3055\u308c\u305f\u30e6\u30fc\u30b6\u3067\u3059",1,"text-warning"],[1,"p-1",3,"title"],["class","p-1","style","height: 100%; width: 2rem;",3,"src",4,"ngIf"],[1,"p-1",2,"height","100%","width","2rem",3,"src"]],template:function(c,l){if(1&c&&i.yuY(0,_,2,0,"ng-template",null,0,i.gJz)(2,n,3,3,"span",1),2&c){const p=i.Gew(1);i.yG2(2),i.E7m("ngIf",l.userPublic)("ngIfElse",p)}},dependencies:[t.u_]})}return h})()},8836:($,I,e)=>{e(1944),e(1004),e(2184),e(5976),e(4740)}}]);